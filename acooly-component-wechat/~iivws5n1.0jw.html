<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
  /*
      http://www.oschina.net/question/124879_76399
  */
  
  html { font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }
   
  body{
      color:#444;
      font-family:Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
      font-size:13px;
      line-height:1.5em;
      padding:1em;
      margin:auto;
      max-width:42em;
      background:#fefefe;
  }
   
  h1, h2, h3, h4, h5, h6 {
      font-weight: bold;
  }
   
  h1 {
      color: #000000;
      font-size: 28px;
  }
   
  h2 {
      border-bottom: 2px solid #CCCCCC;
      color: #000000;
      font-size: 24px;
  }
   
  h3 {
      border-bottom: 2px solid #CCCCCC;
      font-size: 18px;
  }
   
  h4 {
      font-size: 16px;
  }
   
  h5 {
      font-size: 14px;
  }
   
  h6 {
      color: #777777;
      background-color: inherit;
      font-size: 14px;
  }
   
  hr {
      height: 0.2em;
      border: 0;
      color: #CCCCCC;
      background-color: #CCCCCC;
  }
   
  p, blockquote, ul, ol, dl, li, table, pre {
      margin: 15px 0;
  }
   
  p{
      margin:1em 0;
  }
   
  pre { 
      background-color: #F8F8F8;    
      border: 1px solid #CCCCCC;
      border-radius: 3px;
      overflow: auto;
      padding: 5px;
  }
   
  pre code {
      background-color: #F8F8F8;
      border: none;    
      padding: 0;
  }
   
  code {
      font-family: Consolas, Monaco, Andale Mono, monospace;
      background-color:#F8F8F8;
      border: 1px solid #CCCCCC;
      border-radius: 3px;
      padding: 0 0.2em;
      line-height: 1;
  }
   
  pre > code {
      border: 0;
      margin: 0;
      padding: 0;
  }
   
   
  a{ color: #0645ad; text-decoration:none;}
  a:visited{ color: #0b0080; }
  a:hover{ color: #06e; }
  a:active{ color:#faa700; }
  a:focus{ outline: thin dotted; }
  a:hover, a:active{ outline: 0; }
   
  ::-moz-selection{background:rgba(255,255,0,0.3);color:#000}
  ::selection{background:rgba(255,255,0,0.3);color:#000}
   
  a::-moz-selection{background:rgba(255,255,0,0.3);color:#0645ad}
  a::selection{background:rgba(255,255,0,0.3);color:#0645ad}
   
  blockquote{
      color:#666666;
      margin:0;
      padding-left: 3em;
      border-left: 0.5em #EEE solid;
  }
   
  ul, ol { margin: 1em 0; padding: 0 0 0 2em; }
  li p:last-child { margin:0 }
  dd { margin: 0 0 0 2em; }
   
  img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; max-width:100%;}
   
  table { border-collapse: collapse; border-spacing: 0; }
  td { vertical-align: top; }
   
  @media only screen and (min-width: 480px) {
      body{font-size:14px;}
  }
   
  @media only screen and (min-width: 768px) {
      body{font-size:16px;}
  }
  </style>
</head>
<body>
<!-- title: &#24494;&#20449;&#25509;&#20837;&#32452;&#20214;  -->
<!-- type: app -->
<!-- author: cuifuqiang-->
<h2 id="&#32452;&#20214;&#20171;&#32461;">1. &#32452;&#20214;&#20171;&#32461;</h2>
<p>acooly-component-wechat &#20197;acooly&#26694;&#26550;&#20026;&#22522;&#30784;, &#38598;&#25104;&#24494;&#20449;&#20844;&#20247;&#21495;&#35748;&#35777;&#20307;&#31995;&#65307;&#26041;&#20415;&#30740;&#21457;&#22242;&#38431;&#20381;&#36182;&#27492;&#32452;&#20214;&#24555;&#36895;&#23545;&#25509;&#24494;&#20449;&#20844;&#20247;&#21495;&#65307;</p>
<p><a href="https://mp.weixin.qq.com">&#24494;&#20449;&#20844;&#20247;&#24179;&#21488;&#24320;&#21457;</a>;</p>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421135319">&#24494;&#20449;&#20844;&#20247;&#24179;&#21488;&#24320;&#21457;&#25351;&#21335;</a></p>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842">&#24494;&#20449;&#32593;&#39029;&#25480;&#26435;</a></p>
<h3 id="&#20248;&#21183;">1.1&#20248;&#21183;</h3>
<ul>
<li>&#24555;&#36895;&#23436;&#25104;&#24494;&#20449;&#20844;&#20247;&#21495;&#30340;&#23545;&#25509;</li>
<li>&#31616;&#21270;&#24494;&#20449;&#20844;&#20247;&#21495;&#22797;&#26434;&#30340;&#23545;&#25509;&#27969;&#31243;</li>
<li>&#25903;&#25345;&#25509;&#21475;&#35831;&#27714;access_token &#32531;&#23384;</li>
<li>&#25903;&#25345;&#26657;&#39564;&#29992;&#25143;&#26159;&#21542;&#20851;&#27880;&#24494;&#20449;&#20844;&#20247;&#21495;&#21028;&#26029;</li>
</ul>
<h2 id="&#20351;&#29992;&#35828;&#26126;">2. &#20351;&#29992;&#35828;&#26126;</h2>
<p>maven&#22352;&#26631;&#65306;</p>
<pre><code> &lt;dependency&gt;
    &lt;groupId&gt;com.acooly&lt;/groupId&gt;
    &lt;artifactId&gt;acooly-component-wechat&lt;/artifactId&gt;
    &lt;version&gt;${acooly-latest-version}&lt;/version&gt;
  &lt;/dependency&gt;</code></pre>
<p><code>${acooly-latest-version}</code>&#20026;&#26694;&#26550;&#26368;&#26032;&#29256;&#26412;&#25110;&#32773;&#36141;&#20080;&#30340;&#29256;&#26412;&#12290;</p>
<h2 id="&#24494;&#20449;&#23545;&#25509;&#25805;&#20316;&#35828;&#26126;">2.1 &#24494;&#20449;&#23545;&#25509;&#25805;&#20316;&#35828;&#26126;</h2>
<ul>
<li>step 1: &#30331;&#24405;&#24494;&#20449;&#20844;&#20247;&#21495;&#24179;&#21488; <a href="https://mp.weixin.qq.com/?token=&amp;lang=zh_CN">&#32593;&#22336;</a></li>
<li>step 2&#65306; &#24038;&#36793;&#33756;&#21333;&#65292;&#39318;&#39029;--&gt;&#24320;&#21457;--&gt;&#22522;&#26412;&#37197;&#32622;--&gt;&#20844;&#20247;&#21495;&#24320;&#21457;&#20449;&#24687;</li>
<li>step 3: &#21551;&#29992;-&#24320;&#21457;&#32773;&#23494;&#30721;(AppSecret) &#24182;&#20445;&#23384;&#23545;&#24212;&#30340;AppSecret</li>
<li>step 4: &#35774;&#32622;IP&#30333;&#21517;&#21333;, &#37197;&#32622;&#26381;&#21153;&#22120;&#20986;&#21475;IP</li>
<li>step 5: &#35774;&#32622;-&#26381;&#21153;&#22120;&#37197;&#32622;&#65292;URL&#65306;&#26381;&#21153;&#22120;&#22238;&#35843;&#22320;&#22336;&#65288;/wechat/webApi/callback.html&#65289;&#65307;Token&#65307;EncodingAESKey&#65288;&#38543;&#26426;&#29983;&#25104;&#65289;&#65307;&#28040;&#24687;&#21152;&#35299;&#23494;&#26041;&#24335; <a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421135319">&#21442;&#32771;</a></li>
<li>step 6: &#24038;&#36793;&#33756;&#21333;&#65292;&#39318;&#39029;--&gt;&#35774;&#32622;--&gt;&#20844;&#20247;&#21495;&#35774;&#32622;--&gt;&#32593;&#39029;&#25480;&#26435;&#22495;&#21517;</li>
<li>step 7: &#24038;&#36793;&#33756;&#21333;&#65292;&#39318;&#39029;--&gt;&#35774;&#32622;--&gt;&#21151;&#33021;--&gt;&#33258;&#23450;&#20041;&#33756;&#21333; &#32452;&#20214;&#40664;&#35748;&#35775;&#38382;&#22320;&#22336; &#65288; /wechat/webApi/index.html&#65289;</li>
</ul>
<h2 id="&#29256;&#26412;&#35828;&#26126;">3.&#29256;&#26412;&#35828;&#26126;</h2>
<h4 id="section">2019-02-27</h4>
<ul>
<li>1.&#24494;&#20449;&#20844;&#20247;&#21495;&#24555;&#36895;&#23545;&#25509;&#25480;&#26435;</li>
<li>2.&#25903;&#25345;&#25509;&#21475;&#35831;&#27714;access_token &#32531;&#23384;</li>
<li>3.&#25903;&#25345;&#26657;&#39564;&#29992;&#25143;&#26159;&#21542;&#20851;&#27880;&#24494;&#20449;&#20844;&#20247;&#21495;&#21028;&#26029;</li>
<li>3.&#25903;&#25345;&#33719;&#21462;&#25480;&#26435;&#29992;&#25143;&#29992;&#25143;&#22522;&#26412;&#20449;&#24687;&#65288;&#24050;&#32463;&#20851;&#27880;&#20102;&#20844;&#20247;&#21495;&#65292;&#24182;&#19988;&#24050;&#32463;&#25480;&#26435;&#65307;&#26410;&#20851;&#27880;&#20102;&#20844;&#20247;&#21495;&#65292;&#24050;&#32463;&#25480;&#26435;&#36807;&#65289;</li>
</ul>
<h2 id="&#22522;&#30784;&#33021;&#21147;&#35828;&#26126;">4.&#22522;&#30784;&#33021;&#21147;&#35828;&#26126;</h2>
<h3 id="&#25480;&#26435;&#35828;&#26126;">4.1 &#25480;&#26435;&#35828;&#26126;</h3>
<ul>
<li><p>&#21442;&#32771; com.acooly.module.wechat.portal.WechatWebApiControl</p></li>
<li>&#25480;&#26435;&#35775;&#38382;&#22320;&#22336;&#65306;/wechat/webApi/index.html</li>
<li><p>&#24494;&#20449;&#22238;&#35843;&#22320;&#22336;&#65306;/wechat/webApi/backRedirect.html</p></li>
</ul>
<h3 id="&#37197;&#32622;&#35828;&#26126;">4.2 &#37197;&#32622;&#35828;&#26126;</h3>
<ul>
<li>&#24494;&#20449;openapi&#35831;&#27714;&#22320;&#22336;</li>
<li>acooly.wechat.apiUrl=https://api.weixin.qq.com</li>
<li></li>
<li>&#32452;&#20214;&#24320;&#20851;</li>
<li>acooly.wechat.enable=true</li>
<li></li>
<li>&#24494;&#20449;&#20844;&#20247;&#21495;&#30340;appid &#35814;&#24773; step 3</li>
<li>acooly.wechat.appid=wxa6147f5ff0905222</li>
<li></li>
<li>&#24494;&#20449;&#20844;&#20247;&#21495;&#30340;secret &#35814;&#24773; step 3</li>
<li>acooly.wechat.secret=afbfe133f13cdec8d82c31340f1c1109</li>
<li></li>
<li>snsapi_base &#65288;&#19981;&#24377;&#20986;&#25480;&#26435;&#39029;&#38754;&#65292;&#30452;&#25509;&#36339;&#36716;&#65292;&#21482;&#33021;&#33719;&#21462;&#29992;&#25143;openid&#65289;<br />
</li>
<li>snsapi_userinfo &#65288;&#24377;&#20986;&#25480;&#26435;&#39029;&#38754;&#65292;&#21487;&#36890;&#36807;openid&#25343;&#21040;&#26165;&#31216;&#12289;&#24615;&#21035;&#12289;&#25152;&#22312;&#22320;&#12290;&#21363;&#20351;&#22312;&#26410;&#20851;&#27880;&#30340;&#24773;&#20917;&#19979;&#65292;&#21482;&#35201;&#29992;&#25143;&#25480;&#26435;&#65292;&#20063;&#33021;&#33719;&#21462;&#20854;&#20449;&#24687;</li>
<li>acooly.wechat.scope=snsapi_userinfo</li>
<li></li>
<li>&#20196;&#29260;(Token) &#35814;&#24773; step 5</li>
<li>acooly.wechat.serverToken=HelloWorld</li>
<li></li>
<li>&#24494;&#20449;&#25480;&#26435;&#21518;&#36339;&#36716;&#19994;&#21153;&#31995;&#32479;&#22320;&#22336;(URL);&#21487;&#20197;&#21442;&#32771; com.acooly.module.wechat.portal.WechatWebApiControl#backRedirect</li>
<li>acooly.wechat.redirectUri=http://www.xxx.com/wechat/webApi/backRedirect.html</li>
<li></li>
<li>&#24494;&#20449;&#37325;&#23450;&#21521;&#21518;&#20250;&#24102;&#19978;state&#21442;&#25968;</li>
<li>acooly.wechat.state=hello,world</li>
</ul>
<h3 id="&#25552;&#20379;&#22522;&#30784;&#21151;&#33021;&#35828;&#26126;">4.3 &#25552;&#20379;&#22522;&#30784;&#21151;&#33021;&#35828;&#26126;</h3>
<ul>
<li><p>&#21442;&#32771; com.acooly.module.wechat.oauth.service.WechatClientService</p>
/**
<ul>
<li>&#38750;&#29992;&#25143;&#25480;&#26435; access_token</li>
<li></li>
<li>access_token&#26159;&#20844;&#20247;&#21495;&#30340;&#20840;&#23616;&#21807;&#19968;&#25509;&#21475;&#35843;&#29992;&#20973;&#25454;&#65307; &#20844;&#20247;&#21495;&#35843;&#29992;&#21508;&#25509;&#21475;&#26102;&#37117;&#38656;&#20351;&#29992;access_token</li>
<li></li>
<li><span class="citation">@return</span> */ public String getAccessToken();</li>
</ul>
/**
<ul>
<li>&#28165;&#38500;&#31995;&#32479;&#32531;&#23384; access_token */ public void cleanAccessToken();</li>
</ul>
/**
<ul>
<li>&#21047;&#26032; &#31995;&#32479;&#32531;&#23384; access_token&#65288;&#27599;&#26085;2000&#27425;&#65289; */ public String refreshAccessToken();</li>
</ul>
/**
<ul>
<li>&#26159;&#21542;&#24050;&#32463;&#20851;&#27880;&#20844;&#20247;&#21495;</li>
<li></li>
<li><li>
true &#24050;&#20851;&#27880;</li>
<li><li>
false &#26410;&#20851;&#27880;</li>
<li></li>
<li><span class="citation">@param</span> openId</li>
<li><span class="citation">@return</span> */ public boolean isSubscribe(String openId);</li>
</ul>
/**
<ul>
<li>&#33719;&#21462;&#29992;&#25143;&#29992;&#25143;&#22522;&#26412;&#20449;&#24687;</li>
<li><li>
&#24050;&#32463;&#20851;&#27880;&#20102;&#20844;&#20247;&#21495;&#65292;&#24182;&#19988;&#24050;&#32463;&#25480;&#26435;</li>
<li></li>
<li><span class="citation">@param</span> openId</li>
<li><span class="citation">@return</span> */ public WechatUserInfoDto getUserInfoBySubscribe(String openId);</li>
</ul>
/**
<ul>
<li>&#33719;&#21462;&#29992;&#25143;&#29992;&#25143;&#22522;&#26412;&#20449;&#24687;</li>
<li><li>
&#26410;&#20851;&#27880;&#20102;&#20844;&#20247;&#21495;&#65292;&#24050;&#32463;&#25480;&#26435;&#36807;</li>
<li></li>
<li><span class="citation">@param</span> openId</li>
<li><span class="citation">@return</span> */ public WechatUserInfoDto getUserInfoByOpenId(String openId);</li>
</ul></li>
</ul>
</body>
</html>
