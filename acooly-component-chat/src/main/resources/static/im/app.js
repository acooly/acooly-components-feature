webpackJsonp([5],{

/***/ 104:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(781), exports);


/***/ }),

/***/ 107:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(786), exports);


/***/ }),

/***/ 1118:
/***/ (function(module, exports, __webpack_require__) {


        var result = __webpack_require__(771);

        if (typeof result === "string") {
            module.exports = result;
        } else {
            module.exports = result.toString();
        }
    

/***/ }),

/***/ 1119:
/***/ (function(module, exports, __webpack_require__) {


        var result = __webpack_require__(772);

        if (typeof result === "string") {
            module.exports = result;
        } else {
            module.exports = result.toString();
        }
    

/***/ }),

/***/ 1120:
/***/ (function(module, exports) {

﻿/**
 * 收录常用汉字6763个，不支持声调，支持多音字，并按照汉字使用频率由低到高排序
 */
window.pinyin_dict_notone = {"a":"阿啊呵腌嗄吖锕","e":"额阿俄恶鹅遏鄂厄饿峨扼娥鳄哦蛾噩愕讹锷垩婀鹗萼谔莪腭锇颚呃阏屙苊轭","ai":"爱埃艾碍癌哀挨矮隘蔼唉皑哎霭捱暧嫒嗳瑷嗌锿砹","ei":"诶","xi":"系西席息希习吸喜细析戏洗悉锡溪惜稀袭夕洒晰昔牺腊烯熙媳栖膝隙犀蹊硒兮熄曦禧嬉玺奚汐徙羲铣淅嘻歙熹矽蟋郗唏皙隰樨浠忾蜥檄郄翕阋鳃舾屣葸螅咭粞觋欷僖醯鼷裼穸饩舄禊诶菥蓰","yi":"一以已意议义益亿易医艺食依移衣异伊仪宜射遗疑毅谊亦疫役忆抑尾乙译翼蛇溢椅沂泄逸蚁夷邑怡绎彝裔姨熠贻矣屹颐倚诣胰奕翌疙弈轶蛾驿壹猗臆弋铱旖漪迤佚翊诒怿痍懿饴峄揖眙镒仡黟肄咿翳挹缢呓刈咦嶷羿钇殪荑薏蜴镱噫癔苡悒嗌瘗衤佾埸圯舣酏劓","an":"安案按岸暗鞍氨俺胺铵谙庵黯鹌桉埯犴揞厂广","han":"厂汉韩含旱寒汗涵函喊憾罕焊翰邯撼瀚憨捍酣悍鼾邗颔蚶晗菡旰顸犴焓撖","ang":"昂仰盎肮","ao":"奥澳傲熬凹鳌敖遨鏖袄坳翱嗷拗懊岙螯骜獒鏊艹媪廒聱","wa":"瓦挖娃洼袜蛙凹哇佤娲呙腽","yu":"于与育余预域予遇奥语誉玉鱼雨渔裕愈娱欲吁舆宇羽逾豫郁寓吾狱喻御浴愉禹俞邪榆愚渝尉淤虞屿峪粥驭瑜禺毓钰隅芋熨瘀迂煜昱汩於臾盂聿竽萸妪腴圄谕觎揄龉谀俣馀庾妤瘐鬻欤鹬阈嵛雩鹆圉蜮伛纡窬窳饫蓣狳肀舁蝓燠","niu":"牛纽扭钮拗妞忸狃","o":"哦噢喔","ba":"把八巴拔伯吧坝爸霸罢芭跋扒叭靶疤笆耙鲅粑岜灞钯捌菝魃茇","pa":"怕帕爬扒趴琶啪葩耙杷钯筢","pi":"被批副否皮坏辟啤匹披疲罢僻毗坯脾譬劈媲屁琵邳裨痞癖陂丕枇噼霹吡纰砒铍淠郫埤濞睥芘蚍圮鼙罴蜱疋貔仳庀擗甓陴","bi":"比必币笔毕秘避闭佛辟壁弊彼逼碧鼻臂蔽拂泌璧庇痹毙弼匕鄙陛裨贲敝蓖吡篦纰俾铋毖筚荸薜婢哔跸濞秕荜愎睥妣芘箅髀畀滗狴萆嬖襞舭","bai":"百白败摆伯拜柏佰掰呗擘捭稗","bo":"波博播勃拨薄佛伯玻搏柏泊舶剥渤卜驳簿脖膊簸菠礴箔铂亳钵帛擘饽跛钹趵檗啵鹁擗踣","bei":"北被备倍背杯勃贝辈悲碑臂卑悖惫蓓陂钡狈呗焙碚褙庳鞴孛鹎邶鐾","ban":"办版半班般板颁伴搬斑扮拌扳瓣坂阪绊钣瘢舨癍","pan":"判盘番潘攀盼拚畔胖叛拌蹒磐爿蟠泮袢襻丬","bin":"份宾频滨斌彬濒殡缤鬓槟摈膑玢镔豳髌傧","bang":"帮邦彭旁榜棒膀镑绑傍磅蚌谤梆浜蒡","pang":"旁庞乓磅螃彷滂逄耪","beng":"泵崩蚌蹦迸绷甭嘣甏堋","bao":"报保包宝暴胞薄爆炮饱抱堡剥鲍曝葆瀑豹刨褒雹孢苞煲褓趵鸨龅勹","bu":"不部步布补捕堡埔卜埠簿哺怖钚卟瓿逋晡醭钸","pu":"普暴铺浦朴堡葡谱埔扑仆蒲曝瀑溥莆圃璞濮菩蹼匍噗氆攵镨攴镤","mian":"面棉免绵缅勉眠冕娩腼渑湎沔黾宀眄","po":"破繁坡迫颇朴泊婆泼魄粕鄱珀陂叵笸泺皤钋钷","fan":"反范犯繁饭泛翻凡返番贩烦拚帆樊藩矾梵蕃钒幡畈蘩蹯燔","fu":"府服副负富复福夫妇幅付扶父符附腐赴佛浮覆辅傅伏抚赋辐腹弗肤阜袱缚甫氟斧孚敷俯拂俘咐腑孵芙涪釜脯茯馥宓绂讣呋罘麸蝠匐芾蜉跗凫滏蝮驸绋蚨砩桴赙菔呒趺苻拊阝鲋怫稃郛莩幞祓艴黻黼鳆","ben":"本体奔苯笨夯贲锛畚坌","feng":"风丰封峰奉凤锋冯逢缝蜂枫疯讽烽俸沣酆砜葑唪","bian":"变便边编遍辩鞭辨贬匾扁卞汴辫砭苄蝙鳊弁窆笾煸褊碥忭缏","pian":"便片篇偏骗翩扁骈胼蹁谝犏缏","zhen":"镇真针圳振震珍阵诊填侦臻贞枕桢赈祯帧甄斟缜箴疹砧榛鸩轸稹溱蓁胗椹朕畛浈","biao":"表标彪镖裱飚膘飙镳婊骠飑杓髟鳔灬瘭","piao":"票朴漂飘嫖瓢剽缥殍瞟骠嘌莩螵","huo":"和活或货获火伙惑霍祸豁嚯藿锪蠖钬耠镬夥灬劐攉","bie":"别鳖憋瘪蹩","min":"民敏闽闵皿泯岷悯珉抿黾缗玟愍苠鳘","fen":"分份纷奋粉氛芬愤粪坟汾焚酚吩忿棼玢鼢瀵偾鲼","bing":"并病兵冰屏饼炳秉丙摒柄槟禀枋邴冫","geng":"更耕颈庚耿梗埂羹哽赓绠鲠","fang":"方放房防访纺芳仿坊妨肪邡舫彷枋鲂匚钫","xian":"现先县见线限显险献鲜洗宪纤陷闲贤仙衔掀咸嫌掺羡弦腺痫娴舷馅酰铣冼涎暹籼锨苋蚬跹岘藓燹鹇氙莶霰跣猃彡祆筅","fou":"不否缶","ca":"拆擦嚓礤","cha":"查察差茶插叉刹茬楂岔诧碴嚓喳姹杈汊衩搽槎镲苴檫馇锸猹","cai":"才采财材菜彩裁蔡猜踩睬","can":"参残餐灿惨蚕掺璨惭粲孱骖黪","shen":"信深参身神什审申甚沈伸慎渗肾绅莘呻婶娠砷蜃哂椹葚吲糁渖诜谂矧胂","cen":"参岑涔","san":"三参散伞叁糁馓毵","cang":"藏仓苍沧舱臧伧","zang":"藏脏葬赃臧奘驵","chen":"称陈沈沉晨琛臣尘辰衬趁忱郴宸谌碜嗔抻榇伧谶龀肜","cao":"草操曹槽糙嘈漕螬艚屮","ce":"策测册侧厕栅恻","ze":"责则泽择侧咋啧仄箦赜笮舴昃迮帻","zhai":"债择齐宅寨侧摘窄斋祭翟砦瘵哜","dao":"到道导岛倒刀盗稻蹈悼捣叨祷焘氘纛刂帱忉","ceng":"层曾蹭噌","zha":"查扎炸诈闸渣咋乍榨楂札栅眨咤柞喳喋铡蚱吒怍砟揸痄哳齄","chai":"差拆柴钗豺侪虿瘥","ci":"次此差词辞刺瓷磁兹慈茨赐祠伺雌疵鹚糍呲粢","zi":"资自子字齐咨滋仔姿紫兹孜淄籽梓鲻渍姊吱秭恣甾孳訾滓锱辎趑龇赀眦缁呲笫谘嵫髭茈粢觜耔","cuo":"措错磋挫搓撮蹉锉厝嵯痤矬瘥脞鹾","chan":"产单阐崭缠掺禅颤铲蝉搀潺蟾馋忏婵孱觇廛谄谗澶骣羼躔蒇冁","shan":"山单善陕闪衫擅汕扇掺珊禅删膳缮赡鄯栅煽姗跚鳝嬗潸讪舢苫疝掸膻钐剡蟮芟埏彡骟","zhan":"展战占站崭粘湛沾瞻颤詹斩盏辗绽毡栈蘸旃谵搌","xin":"新心信辛欣薪馨鑫芯锌忻莘昕衅歆囟忄镡","lian":"联连练廉炼脸莲恋链帘怜涟敛琏镰濂楝鲢殓潋裢裣臁奁莶蠊蔹","chang":"场长厂常偿昌唱畅倡尝肠敞倘猖娼淌裳徜昶怅嫦菖鲳阊伥苌氅惝鬯","zhang":"长张章障涨掌帐胀彰丈仗漳樟账杖璋嶂仉瘴蟑獐幛鄣嫜","chao":"超朝潮炒钞抄巢吵剿绰嘲晁焯耖怊","zhao":"着照招找召朝赵兆昭肇罩钊沼嘲爪诏濯啁棹笊","zhou":"调州周洲舟骤轴昼宙粥皱肘咒帚胄绉纣妯啁诌繇碡籀酎荮","che":"车彻撤尺扯澈掣坼砗屮","ju":"车局据具举且居剧巨聚渠距句拒俱柜菊拘炬桔惧矩鞠驹锯踞咀瞿枸掬沮莒橘飓疽钜趄踽遽琚龃椐苣裾榘狙倨榉苴讵雎锔窭鞫犋屦醵","cheng":"成程城承称盛抢乘诚呈净惩撑澄秤橙骋逞瞠丞晟铛埕塍蛏柽铖酲裎枨","rong":"容荣融绒溶蓉熔戎榕茸冗嵘肜狨蝾","sheng":"生声升胜盛乘圣剩牲甸省绳笙甥嵊晟渑眚","deng":"等登邓灯澄凳瞪蹬噔磴嶝镫簦戥","zhi":"制之治质职只志至指织支值知识直致执置止植纸拓智殖秩旨址滞氏枝芝脂帜汁肢挚稚酯掷峙炙栉侄芷窒咫吱趾痔蜘郅桎雉祉郦陟痣蛭帙枳踯徵胝栀贽祗豸鸷摭轵卮轾彘觯絷跖埴夂黹忮骘膣踬","zheng":"政正证争整征郑丁症挣蒸睁铮筝拯峥怔诤狰徵钲","tang":"堂唐糖汤塘躺趟倘棠烫淌膛搪镗傥螳溏帑羰樘醣螗耥铴瑭","chi":"持吃池迟赤驰尺斥齿翅匙痴耻炽侈弛叱啻坻眙嗤墀哧茌豉敕笞饬踟蚩柢媸魑篪褫彳鸱螭瘛眵傺","shi":"是时实事市十使世施式势视识师史示石食始士失适试什泽室似诗饰殖释驶氏硕逝湿蚀狮誓拾尸匙仕柿矢峙侍噬嗜栅拭嘘屎恃轼虱耆舐莳铈谥炻豕鲥饣螫酾筮埘弑礻蓍鲺贳","qi":"企其起期气七器汽奇齐启旗棋妻弃揭枝歧欺骑契迄亟漆戚岂稽岐琦栖缉琪泣乞砌祁崎绮祺祈凄淇杞脐麒圻憩芪伎俟畦耆葺沏萋骐鳍綦讫蕲屺颀亓碛柒啐汔綮萁嘁蛴槭欹芑桤丌蜞","chuai":"揣踹啜搋膪","tuo":"托脱拓拖妥驼陀沱鸵驮唾椭坨佗砣跎庹柁橐乇铊沲酡鼍箨柝","duo":"多度夺朵躲铎隋咄堕舵垛惰哆踱跺掇剁柁缍沲裰哚隳","xue":"学血雪削薛穴靴谑噱鳕踅泶彐","chong":"重种充冲涌崇虫宠忡憧舂茺铳艟","chou":"筹抽绸酬愁丑臭仇畴稠瞅踌惆俦瘳雠帱","qiu":"求球秋丘邱仇酋裘龟囚遒鳅虬蚯泅楸湫犰逑巯艽俅蝤赇鼽糗","xiu":"修秀休宿袖绣臭朽锈羞嗅岫溴庥馐咻髹鸺貅","chu":"出处础初助除储畜触楚厨雏矗橱锄滁躇怵绌搐刍蜍黜杵蹰亍樗憷楮","tuan":"团揣湍疃抟彖","zhui":"追坠缀揣椎锥赘惴隹骓缒","chuan":"传川船穿串喘椽舛钏遄氚巛舡","zhuan":"专转传赚砖撰篆馔啭颛","yuan":"元员院原源远愿园援圆缘袁怨渊苑宛冤媛猿垣沅塬垸鸳辕鸢瑗圜爰芫鼋橼螈眢箢掾","cuan":"窜攒篡蹿撺爨汆镩","chuang":"创床窗闯幢疮怆","zhuang":"装状庄壮撞妆幢桩奘僮戆","chui":"吹垂锤炊椎陲槌捶棰","chun":"春纯醇淳唇椿蠢鹑朐莼肫蝽","zhun":"准屯淳谆肫窀","cu":"促趋趣粗簇醋卒蹴猝蹙蔟殂徂","dun":"吨顿盾敦蹲墩囤沌钝炖盹遁趸砘礅","qu":"区去取曲趋渠趣驱屈躯衢娶祛瞿岖龋觑朐蛐癯蛆苣阒诎劬蕖蘧氍黢蠼璩麴鸲磲","xu":"需许续须序徐休蓄畜虚吁绪叙旭邪恤墟栩絮圩婿戌胥嘘浒煦酗诩朐盱蓿溆洫顼勖糈砉醑","chuo":"辍绰戳淖啜龊踔辶","zu":"组族足祖租阻卒俎诅镞菹","ji":"济机其技基记计系期际及集级几给积极己纪即继击既激绩急奇吉季齐疾迹鸡剂辑籍寄挤圾冀亟寂暨脊跻肌稽忌饥祭缉棘矶汲畸姬藉瘠骥羁妓讥稷蓟悸嫉岌叽伎鲫诘楫荠戟箕霁嵇觊麂畿玑笈犄芨唧屐髻戢佶偈笄跽蒺乩咭赍嵴虮掎齑殛鲚剞洎丌墼蕺彐芰哜","cong":"从丛匆聪葱囱琮淙枞骢苁璁","zong":"总从综宗纵踪棕粽鬃偬枞腙","cou":"凑辏腠楱","cui":"衰催崔脆翠萃粹摧璀瘁悴淬啐隹毳榱","wei":"为位委未维卫围违威伟危味微唯谓伪慰尾魏韦胃畏帷喂巍萎蔚纬潍尉渭惟薇苇炜圩娓诿玮崴桅偎逶倭猥囗葳隗痿猬涠嵬韪煨艉隹帏闱洧沩隈鲔軎","cun":"村存寸忖皴","zuo":"作做座左坐昨佐琢撮祚柞唑嘬酢怍笮阼胙","zuan":"钻纂攥缵躜","da":"大达打答搭沓瘩惮嗒哒耷鞑靼褡笪怛妲","dai":"大代带待贷毒戴袋歹呆隶逮岱傣棣怠殆黛甙埭诒绐玳呔迨","tai":"大台太态泰抬胎汰钛苔薹肽跆邰鲐酞骀炱","ta":"他它她拓塔踏塌榻沓漯獭嗒挞蹋趿遢铊鳎溻闼","dan":"但单石担丹胆旦弹蛋淡诞氮郸耽殚惮儋眈疸澹掸膻啖箪聃萏瘅赕","lu":"路六陆录绿露鲁卢炉鹿禄赂芦庐碌麓颅泸卤潞鹭辘虏璐漉噜戮鲈掳橹轳逯渌蓼撸鸬栌氇胪镥簏舻辂垆","tan":"谈探坦摊弹炭坛滩贪叹谭潭碳毯瘫檀痰袒坍覃忐昙郯澹钽锬","ren":"人任认仁忍韧刃纫饪妊荏稔壬仞轫亻衽","jie":"家结解价界接节她届介阶街借杰洁截姐揭捷劫戒皆竭桔诫楷秸睫藉拮芥诘碣嗟颉蚧孑婕疖桀讦疥偈羯袷哜喈卩鲒骱","yan":"研严验演言眼烟沿延盐炎燕岩宴艳颜殷彦掩淹阎衍铅雁咽厌焰堰砚唁焉晏檐蜒奄俨腌妍谚兖筵焱偃闫嫣鄢湮赝胭琰滟阉魇酽郾恹崦芫剡鼹菸餍埏谳讠厣罨","dang":"当党档荡挡宕砀铛裆凼菪谠","tao":"套讨跳陶涛逃桃萄淘掏滔韬叨洮啕绦饕鼗","tiao":"条调挑跳迢眺苕窕笤佻啁粜髫铫祧龆蜩鲦","te":"特忑忒铽慝","de":"的地得德底锝","dei":"得","di":"的地第提低底抵弟迪递帝敌堤蒂缔滴涤翟娣笛棣荻谛狄邸嘀砥坻诋嫡镝碲骶氐柢籴羝睇觌","ti":"体提题弟替梯踢惕剔蹄棣啼屉剃涕锑倜悌逖嚏荑醍绨鹈缇裼","tui":"推退弟腿褪颓蜕忒煺","you":"有由又优游油友右邮尤忧幼犹诱悠幽佑釉柚铀鱿囿酉攸黝莠猷蝣疣呦蚴莸莜铕宥繇卣牖鼬尢蚰侑","dian":"电点店典奠甸碘淀殿垫颠滇癫巅惦掂癜玷佃踮靛钿簟坫阽","tian":"天田添填甜甸恬腆佃舔钿阗忝殄畋栝掭","zhu":"主术住注助属逐宁著筑驻朱珠祝猪诸柱竹铸株瞩嘱贮煮烛苎褚蛛拄铢洙竺蛀渚伫杼侏澍诛茱箸炷躅翥潴邾槠舳橥丶瘃麈疰","nian":"年念酿辗碾廿捻撵拈蔫鲶埝鲇辇黏","diao":"调掉雕吊钓刁貂凋碉鲷叼铫铞","yao":"要么约药邀摇耀腰遥姚窑瑶咬尧钥谣肴夭侥吆疟妖幺杳舀窕窈曜鹞爻繇徭轺铫鳐崾珧","die":"跌叠蝶迭碟爹谍牒耋佚喋堞瓞鲽垤揲蹀","she":"设社摄涉射折舍蛇拾舌奢慑赦赊佘麝歙畲厍猞揲滠","ye":"业也夜叶射野液冶喝页爷耶邪咽椰烨掖拽曳晔谒腋噎揶靥邺铘揲","xie":"些解协写血叶谢械鞋胁斜携懈契卸谐泄蟹邪歇泻屑挟燮榭蝎撷偕亵楔颉缬邂鲑瀣勰榍薤绁渫廨獬躞","zhe":"这者着著浙折哲蔗遮辙辄柘锗褶蜇蛰鹧谪赭摺乇磔螫","ding":"定订顶丁鼎盯钉锭叮仃铤町酊啶碇腚疔玎耵","diu":"丢铥","ting":"听庭停厅廷挺亭艇婷汀铤烃霆町蜓葶梃莛","dong":"动东董冬洞懂冻栋侗咚峒氡恫胴硐垌鸫岽胨","tong":"同通统童痛铜桶桐筒彤侗佟潼捅酮砼瞳恸峒仝嗵僮垌茼","zhong":"中重种众终钟忠仲衷肿踵冢盅蚣忪锺舯螽夂","dou":"都斗读豆抖兜陡逗窦渎蚪痘蔸钭篼","du":"度都独督读毒渡杜堵赌睹肚镀渎笃竺嘟犊妒牍蠹椟黩芏髑","duan":"断段短端锻缎煅椴簖","dui":"对队追敦兑堆碓镦怼憝","rui":"瑞兑锐睿芮蕊蕤蚋枘","yue":"月说约越乐跃兑阅岳粤悦曰钥栎钺樾瀹龠哕刖","tun":"吞屯囤褪豚臀饨暾氽","hui":"会回挥汇惠辉恢徽绘毁慧灰贿卉悔秽溃荟晖彗讳诲珲堕诙蕙晦睢麾烩茴喙桧蛔洄浍虺恚蟪咴隳缋哕","wu":"务物无五武午吴舞伍污乌误亡恶屋晤悟吾雾芜梧勿巫侮坞毋诬呜钨邬捂鹜兀婺妩於戊鹉浯蜈唔骛仵焐芴鋈庑鼯牾怃圬忤痦迕杌寤阢","ya":"亚压雅牙押鸭呀轧涯崖邪芽哑讶鸦娅衙丫蚜碣垭伢氩桠琊揠吖睚痖疋迓岈砑","he":"和合河何核盖贺喝赫荷盒鹤吓呵苛禾菏壑褐涸阂阖劾诃颌嗬貉曷翮纥盍","wo":"我握窝沃卧挝涡斡渥幄蜗喔倭莴龌肟硪","en":"恩摁蒽","n":"嗯唔","er":"而二尔儿耳迩饵洱贰铒珥佴鸸鲕","fa":"发法罚乏伐阀筏砝垡珐","quan":"全权券泉圈拳劝犬铨痊诠荃醛蜷颧绻犭筌鬈悛辁畎","fei":"费非飞肥废菲肺啡沸匪斐蜚妃诽扉翡霏吠绯腓痱芾淝悱狒榧砩鲱篚镄","pei":"配培坏赔佩陪沛裴胚妃霈淠旆帔呸醅辔锫","ping":"平评凭瓶冯屏萍苹乒坪枰娉俜鲆","fo":"佛","hu":"和护许户核湖互乎呼胡戏忽虎沪糊壶葫狐蝴弧瑚浒鹄琥扈唬滹惚祜囫斛笏芴醐猢怙唿戽槲觳煳鹕冱瓠虍岵鹱烀轷","ga":"夹咖嘎尬噶旮伽尕钆尜","ge":"个合各革格歌哥盖隔割阁戈葛鸽搁胳舸疙铬骼蛤咯圪镉颌仡硌嗝鬲膈纥袼搿塥哿虼","ha":"哈蛤铪","xia":"下夏峡厦辖霞夹虾狭吓侠暇遐瞎匣瑕唬呷黠硖罅狎瘕柙","gai":"改该盖概溉钙丐芥赅垓陔戤","hai":"海还害孩亥咳骸骇氦嗨胲醢","gan":"干感赶敢甘肝杆赣乾柑尴竿秆橄矸淦苷擀酐绀泔坩旰疳澉","gang":"港钢刚岗纲冈杠缸扛肛罡戆筻","jiang":"将强江港奖讲降疆蒋姜浆匠酱僵桨绛缰犟豇礓洚茳糨耩","hang":"行航杭巷夯吭桁沆绗颃","gong":"工公共供功红贡攻宫巩龚恭拱躬弓汞蚣珙觥肱廾","hong":"红宏洪轰虹鸿弘哄烘泓訇蕻闳讧荭黉薨","guang":"广光逛潢犷胱咣桄","qiong":"穷琼穹邛茕筇跫蛩銎","gao":"高告搞稿膏糕镐皋羔锆杲郜睾诰藁篙缟槁槔","hao":"好号毫豪耗浩郝皓昊皋蒿壕灏嚎濠蚝貉颢嗥薅嚆","li":"理力利立里李历例离励礼丽黎璃厉厘粒莉梨隶栗荔沥犁漓哩狸藜罹篱鲤砺吏澧俐骊溧砾莅锂笠蠡蛎痢雳俪傈醴栎郦俚枥喱逦娌鹂戾砬唳坜疠蜊黧猁鬲粝蓠呖跞疬缡鲡鳢嫠詈悝苈篥轹","jia":"家加价假佳架甲嘉贾驾嫁夹稼钾挟拮迦伽颊浃枷戛荚痂颉镓笳珈岬胛袈郏葭袷瘕铗跏蛱恝哿","luo":"落罗络洛逻螺锣骆萝裸漯烙摞骡咯箩珞捋荦硌雒椤镙跞瘰泺脶猡倮蠃","ke":"可科克客刻课颗渴壳柯棵呵坷恪苛咳磕珂稞瞌溘轲窠嗑疴蝌岢铪颏髁蚵缂氪骒钶锞","qia":"卡恰洽掐髂袷咭葜","gei":"给","gen":"根跟亘艮哏茛","hen":"很狠恨痕哏","gou":"构购够句沟狗钩拘勾苟垢枸篝佝媾诟岣彀缑笱鞲觏遘","kou":"口扣寇叩抠佝蔻芤眍筘","gu":"股古顾故固鼓骨估谷贾姑孤雇辜菇沽咕呱锢钴箍汩梏痼崮轱鸪牯蛊诂毂鹘菰罟嘏臌觚瞽蛄酤牿鲴","pai":"牌排派拍迫徘湃俳哌蒎","gua":"括挂瓜刮寡卦呱褂剐胍诖鸹栝呙","tou":"投头透偷愉骰亠","guai":"怪拐乖","kuai":"会快块筷脍蒯侩浍郐蒉狯哙","guan":"关管观馆官贯冠惯灌罐莞纶棺斡矜倌鹳鳏盥掼涫","wan":"万完晚湾玩碗顽挽弯蔓丸莞皖宛婉腕蜿惋烷琬畹豌剜纨绾脘菀芄箢","ne":"呢哪呐讷疒","gui":"规贵归轨桂柜圭鬼硅瑰跪龟匮闺诡癸鳜桧皈鲑刽晷傀眭妫炅庋簋刿宄匦","jun":"军均俊君峻菌竣钧骏龟浚隽郡筠皲麇捃","jiong":"窘炯迥炅冂扃","jue":"决绝角觉掘崛诀獗抉爵嚼倔厥蕨攫珏矍蹶谲镢鳜噱桷噘撅橛孓觖劂爝","gun":"滚棍辊衮磙鲧绲丨","hun":"婚混魂浑昏棍珲荤馄诨溷阍","guo":"国过果郭锅裹帼涡椁囗蝈虢聒埚掴猓崞蜾呙馘","hei":"黑嘿嗨","kan":"看刊勘堪坎砍侃嵌槛瞰阚龛戡凵莰","heng":"衡横恒亨哼珩桁蘅","mo":"万没么模末冒莫摩墨默磨摸漠脉膜魔沫陌抹寞蘑摹蓦馍茉嘿谟秣蟆貉嫫镆殁耱嬷麽瘼貊貘","peng":"鹏朋彭膨蓬碰苹棚捧亨烹篷澎抨硼怦砰嘭蟛堋","hou":"后候厚侯猴喉吼逅篌糇骺後鲎瘊堠","hua":"化华划话花画滑哗豁骅桦猾铧砉","huai":"怀坏淮徊槐踝","huan":"还环换欢患缓唤焕幻痪桓寰涣宦垸洹浣豢奂郇圜獾鲩鬟萑逭漶锾缳擐","xun":"讯训迅孙寻询循旬巡汛勋逊熏徇浚殉驯鲟薰荀浔洵峋埙巽郇醺恂荨窨蕈曛獯","huang":"黄荒煌皇凰慌晃潢谎惶簧璜恍幌湟蝗磺隍徨遑肓篁鳇蟥癀","nai":"能乃奶耐奈鼐萘氖柰佴艿","luan":"乱卵滦峦鸾栾銮挛孪脔娈","qie":"切且契窃茄砌锲怯伽惬妾趄挈郄箧慊","jian":"建间件见坚检健监减简艰践兼鉴键渐柬剑尖肩舰荐箭浅剪俭碱茧奸歼拣捡煎贱溅槛涧堑笺谏饯锏缄睑謇蹇腱菅翦戬毽笕犍硷鞯牮枧湔鲣囝裥踺搛缣鹣蒹谫僭戋趼楗","nan":"南难男楠喃囡赧腩囝蝻","qian":"前千钱签潜迁欠纤牵浅遣谦乾铅歉黔谴嵌倩钳茜虔堑钎骞阡掮钤扦芊犍荨仟芡悭缱佥愆褰凵肷岍搴箝慊椠","qiang":"强抢疆墙枪腔锵呛羌蔷襁羟跄樯戕嫱戗炝镪锖蜣","xiang":"向项相想乡象响香降像享箱羊祥湘详橡巷翔襄厢镶飨饷缃骧芗庠鲞葙蟓","jiao":"教交较校角觉叫脚缴胶轿郊焦骄浇椒礁佼蕉娇矫搅绞酵剿嚼饺窖跤蛟侥狡姣皎茭峤铰醮鲛湫徼鹪僬噍艽挢敫","zhuo":"着著缴桌卓捉琢灼浊酌拙茁涿镯淖啄濯焯倬擢斫棹诼浞禚","qiao":"桥乔侨巧悄敲俏壳雀瞧翘窍峭锹撬荞跷樵憔鞘橇峤诮谯愀鞒硗劁缲","xiao":"小效销消校晓笑肖削孝萧俏潇硝宵啸嚣霄淆哮筱逍姣箫骁枭哓绡蛸崤枵魈","si":"司四思斯食私死似丝饲寺肆撕泗伺嗣祀厮驷嘶锶俟巳蛳咝耜笥纟糸鸶缌澌姒汜厶兕","kai":"开凯慨岂楷恺揩锴铠忾垲剀锎蒈","jin":"进金今近仅紧尽津斤禁锦劲晋谨筋巾浸襟靳瑾烬缙钅矜觐堇馑荩噤廑妗槿赆衿卺","qin":"亲勤侵秦钦琴禽芹沁寝擒覃噙矜嗪揿溱芩衾廑锓吣檎螓","jing":"经京精境竞景警竟井惊径静劲敬净镜睛晶颈荆兢靖泾憬鲸茎腈菁胫阱旌粳靓痉箐儆迳婧肼刭弪獍","ying":"应营影英景迎映硬盈赢颖婴鹰荧莹樱瑛蝇萦莺颍膺缨瀛楹罂荥萤鹦滢蓥郢茔嘤璎嬴瘿媵撄潆","jiu":"就究九酒久救旧纠舅灸疚揪咎韭玖臼柩赳鸠鹫厩啾阄桕僦鬏","zui":"最罪嘴醉咀蕞觜","juan":"卷捐圈眷娟倦绢隽镌涓鹃鄄蠲狷锩桊","suan":"算酸蒜狻","yun":"员运云允孕蕴韵酝耘晕匀芸陨纭郧筠恽韫郓氲殒愠昀菀狁","qun":"群裙逡麇","ka":"卡喀咖咔咯佧胩","kang":"康抗扛慷炕亢糠伉钪闶","keng":"坑铿吭","kao":"考靠烤拷铐栲尻犒","ken":"肯垦恳啃龈裉","yin":"因引银印音饮阴隐姻殷淫尹荫吟瘾寅茵圻垠鄞湮蚓氤胤龈窨喑铟洇狺夤廴吲霪茚堙","kong":"空控孔恐倥崆箜","ku":"苦库哭酷裤枯窟挎骷堀绔刳喾","kua":"跨夸垮挎胯侉","kui":"亏奎愧魁馈溃匮葵窥盔逵睽馗聩喟夔篑岿喹揆隗傀暌跬蒉愦悝蝰","kuan":"款宽髋","kuang":"况矿框狂旷眶匡筐邝圹哐贶夼诳诓纩","que":"确却缺雀鹊阙瘸榷炔阕悫","kun":"困昆坤捆琨锟鲲醌髡悃阃","kuo":"扩括阔廓蛞","la":"拉落垃腊啦辣蜡喇剌旯砬邋瘌","lai":"来莱赖睐徕籁涞赉濑癞崃疠铼","lan":"兰览蓝篮栏岚烂滥缆揽澜拦懒榄斓婪阑褴罱啉谰镧漤","lin":"林临邻赁琳磷淋麟霖鳞凛拎遴蔺吝粼嶙躏廪檩啉辚膦瞵懔","lang":"浪朗郎廊狼琅榔螂阆锒莨啷蒗稂","liang":"量两粮良辆亮梁凉谅粱晾靓踉莨椋魉墚","lao":"老劳落络牢捞涝烙姥佬崂唠酪潦痨醪铑铹栳耢","mu":"目模木亩幕母牧莫穆姆墓慕牟牡募睦缪沐暮拇姥钼苜仫毪坶","le":"了乐勒肋叻鳓嘞仂泐","lei":"类累雷勒泪蕾垒磊擂镭肋羸耒儡嫘缧酹嘞诔檑","sui":"随岁虽碎尿隧遂髓穗绥隋邃睢祟濉燧谇眭荽","lie":"列烈劣裂猎冽咧趔洌鬣埒捩躐","leng":"冷愣棱楞塄","ling":"领令另零灵龄陵岭凌玲铃菱棱伶羚苓聆翎泠瓴囹绫呤棂蛉酃鲮柃","lia":"俩","liao":"了料疗辽廖聊寥缪僚燎缭撂撩嘹潦镣寮蓼獠钌尥鹩","liu":"流刘六留柳瘤硫溜碌浏榴琉馏遛鎏骝绺镏旒熘鹨锍","lun":"论轮伦仑纶沦抡囵","lv":"率律旅绿虑履吕铝屡氯缕滤侣驴榈闾偻褛捋膂稆","lou":"楼露漏陋娄搂篓喽镂偻瘘髅耧蝼嵝蒌","mao":"贸毛矛冒貌茂茅帽猫髦锚懋袤牦卯铆耄峁瑁蟊茆蝥旄泖昴瞀","long":"龙隆弄垄笼拢聋陇胧珑窿茏咙砻垅泷栊癃","nong":"农浓弄脓侬哝","shuang":"双爽霜孀泷","shu":"术书数属树输束述署朱熟殊蔬舒疏鼠淑叔暑枢墅俞曙抒竖蜀薯梳戍恕孰沭赎庶漱塾倏澍纾姝菽黍腧秫毹殳疋摅","shuai":"率衰帅摔甩蟀","lve":"略掠锊","ma":"么马吗摩麻码妈玛嘛骂抹蚂唛蟆犸杩","me":"么麽","mai":"买卖麦迈脉埋霾荬劢","man":"满慢曼漫埋蔓瞒蛮鳗馒幔谩螨熳缦镘颟墁鞔","mi":"米密秘迷弥蜜谜觅靡泌眯麋猕谧咪糜宓汨醚嘧弭脒冖幂祢縻蘼芈糸敉","men":"们门闷瞒汶扪焖懑鞔钔","mang":"忙盲茫芒氓莽蟒邙硭漭","meng":"蒙盟梦猛孟萌氓朦锰檬勐懵蟒蜢虻黾蠓艨甍艋瞢礞","miao":"苗秒妙描庙瞄缪渺淼藐缈邈鹋杪眇喵","mou":"某谋牟缪眸哞鍪蛑侔厶","miu":"缪谬","mei":"美没每煤梅媒枚妹眉魅霉昧媚玫酶镁湄寐莓袂楣糜嵋镅浼猸鹛","wen":"文问闻稳温纹吻蚊雯紊瘟汶韫刎璺玟阌","mie":"灭蔑篾乜咩蠛","ming":"明名命鸣铭冥茗溟酩瞑螟暝","na":"内南那纳拿哪娜钠呐捺衲镎肭","nei":"内那哪馁","nuo":"难诺挪娜糯懦傩喏搦锘","ruo":"若弱偌箬","nang":"囊馕囔曩攮","nao":"脑闹恼挠瑙淖孬垴铙桡呶硇猱蛲","ni":"你尼呢泥疑拟逆倪妮腻匿霓溺旎昵坭铌鲵伲怩睨猊","nen":"嫩恁","neng":"能","nin":"您恁","niao":"鸟尿溺袅脲茑嬲","nie":"摄聂捏涅镍孽捻蘖啮蹑嗫臬镊颞乜陧","niang":"娘酿","ning":"宁凝拧泞柠咛狞佞聍甯","nu":"努怒奴弩驽帑孥胬","nv":"女钕衄恧","ru":"入如女乳儒辱汝茹褥孺濡蠕嚅缛溽铷洳薷襦颥蓐","nuan":"暖","nve":"虐疟","re":"热若惹喏","ou":"区欧偶殴呕禺藕讴鸥瓯沤耦怄","pao":"跑炮泡抛刨袍咆疱庖狍匏脬","pou":"剖掊裒","pen":"喷盆湓","pie":"瞥撇苤氕丿","pin":"品贫聘频拼拚颦姘嫔榀牝","se":"色塞瑟涩啬穑铯槭","qing":"情青清请亲轻庆倾顷卿晴氢擎氰罄磬蜻箐鲭綮苘黥圊檠謦","zan":"赞暂攒堑昝簪糌瓒錾趱拶","shao":"少绍召烧稍邵哨韶捎勺梢鞘芍苕劭艄筲杓潲","sao":"扫骚嫂梢缫搔瘙臊埽缲鳋","sha":"沙厦杀纱砂啥莎刹杉傻煞鲨霎嗄痧裟挲铩唼歃","xuan":"县选宣券旋悬轩喧玄绚渲璇炫萱癣漩眩暄煊铉楦泫谖痃碹揎镟儇","ran":"然染燃冉苒髯蚺","rang":"让壤攘嚷瓤穰禳","rao":"绕扰饶娆桡荛","reng":"仍扔","ri":"日","rou":"肉柔揉糅鞣蹂","ruan":"软阮朊","run":"润闰","sa":"萨洒撒飒卅仨脎","suo":"所些索缩锁莎梭琐嗦唆唢娑蓑羧挲桫嗍睃","sai":"思赛塞腮噻鳃","shui":"说水税谁睡氵","sang":"桑丧嗓搡颡磉","sen":"森","seng":"僧","shai":"筛晒","shang":"上商尚伤赏汤裳墒晌垧觞殇熵绱","xing":"行省星腥猩惺兴刑型形邢饧醒幸杏性姓陉荇荥擤悻硎","shou":"收手受首售授守寿瘦兽狩绶艏扌","shuo":"说数硕烁朔铄妁槊蒴搠","su":"速素苏诉缩塑肃俗宿粟溯酥夙愫簌稣僳谡涑蔌嗉觫","shua":"刷耍唰","shuan":"栓拴涮闩","shun":"顺瞬舜吮","song":"送松宋讼颂耸诵嵩淞怂悚崧凇忪竦菘","sou":"艘搜擞嗽嗖叟馊薮飕嗾溲锼螋瞍","sun":"损孙笋荪榫隼狲飧","teng":"腾疼藤滕誊","tie":"铁贴帖餮萜","tu":"土突图途徒涂吐屠兔秃凸荼钍菟堍酴","wai":"外歪崴","wang":"王望往网忘亡旺汪枉妄惘罔辋魍","weng":"翁嗡瓮蓊蕹","zhua":"抓挝爪","yang":"样养央阳洋扬杨羊详氧仰秧痒漾疡泱殃恙鸯徉佯怏炀烊鞅蛘","xiong":"雄兄熊胸凶匈汹芎","yo":"哟唷","yong":"用永拥勇涌泳庸俑踊佣咏雍甬镛臃邕蛹恿慵壅痈鳙墉饔喁","za":"杂扎咱砸咋匝咂拶","zai":"在再灾载栽仔宰哉崽甾","zao":"造早遭枣噪灶燥糟凿躁藻皂澡蚤唣","zei":"贼","zen":"怎谮","zeng":"增曾综赠憎锃甑罾缯","zhei":"这","zou":"走邹奏揍诹驺陬楱鄹鲰","zhuai":"转拽","zun":"尊遵鳟樽撙","dia":"嗲","nou":"耨"};

/***/ }),

/***/ 1121:
/***/ (function(module, exports) {

﻿/**
 * 汉字与拼音互转工具，根据导入的字典文件的不同支持不同
 * 对于多音字目前只是将所有可能的组合输出，准确识别多音字需要完善的词库，而词库文件往往比字库还要大，所以不太适合web环境。
 * @start 2016-09-26
 * @last 2016-09-29
 */
;(function()
{
	var dict = {}; // 存储所有字典数据
	var pinyinUtil =
	{
		/**
		 * 解析各种字典文件，所需的字典文件必须在本JS之前导入
		 */
		parseDict: function()
		{
			// 如果导入了 pinyin_dict_firstletter.js
			if(window.pinyin_dict_firstletter)
			{
				dict.firstletter = pinyin_dict_firstletter;
			}
			// 如果导入了 pinyin_dict_notone.js
			if(window.pinyin_dict_notone)
			{
				dict.notone = {};
				dict.py2hz = pinyin_dict_notone; // 拼音转汉字
				for(var i in pinyin_dict_notone)
				{
					var temp = pinyin_dict_notone[i];
					for(var j=0, len=temp.length; j<len; j++)
					{
						dict.notone[temp[j]] = i; // 不考虑多音字
					}
				}
			}
			// 如果导入了 pinyin_dict_withtone.js
			if(window.pinyin_dict_withtone)
			{
				dict.withtone = {};
				var temp = pinyin_dict_withtone.split(',');
				for(var i=0, len = temp.length; i<len; i++)
				{
					// 这段代码耗时28毫秒左右，对性能影响不大，所以一次性处理完毕
					dict.withtone[String.fromCharCode(i + 19968)] = temp[i]; // 这里先不进行split(' ')，因为一次性循环2万次split比较消耗性能
				}

				// 拼音 -> 汉字
				if(window.pinyin_dict_notone)
				{
					// 对于拼音转汉字，我们优先使用pinyin_dict_notone字典文件
					// 因为这个字典文件不包含生僻字，且已按照汉字使用频率排序
					dict.py2hz = pinyin_dict_notone; // 拼音转汉字
				}
				else
				{
					// 将字典文件解析成拼音->汉字的结构
					// 与先分割后逐个去掉声调相比，先一次性全部去掉声调然后再分割速度至少快了3倍，前者大约需要120毫秒，后者大约只需要30毫秒（Chrome下）
					var notone = pinyinUtil.removeTone(pinyin_dict_withtone).split(',');
					var py2hz = {}, py, hz;
					for(var i=0, len = notone.length; i<len; i++)
					{
						hz = String.fromCharCode(i + 19968); // 汉字
						// = aaa[i];
						py = notone[i].split(' '); // 去掉了声调的拼音数组
						for(var j=0; j<py.length; j++)
						{
							py2hz[py[j]] = (py2hz[py[j]] || '') + hz;
						}
					}
					dict.py2hz = py2hz;
				}
			}
		},
		/**
		 * 根据汉字获取拼音，如果不是汉字直接返回原字符
		 * @param chinese 要转换的汉字
		 * @param splitter 分隔字符，默认用空格分隔
		 * @param withtone 返回结果是否包含声调，默认是
		 * @param polyphone 是否支持多音字，默认否
		 */
		getPinyin: function(chinese, splitter, withtone, polyphone)
		{
			if(!chinese || /^ +$/g.test(chinese)) return '';
			splitter = splitter == undefined ? ' ' : splitter;
			withtone = withtone == undefined ? true : withtone;
			polyphone = polyphone == undefined ? false : polyphone;
			var result = [];
			if(dict.withtone) // 优先使用带声调的字典文件
			{
				for (var i=0, len = chinese.length; i < len; i++)
				{
					var pinyin = dict.withtone[chinese[i]];
					if(pinyin)
					{
						if(!polyphone) pinyin = pinyin.replace(/ .*$/g, ''); // 如果不需要多音字
						if(!withtone) pinyin = this.removeTone(pinyin); // 如果不需要声调
					}
					result.push(pinyin || chinese[i]); 
				}
			}
			else if(dict.notone) // 使用没有声调的字典文件
			{
				if(withtone) console.warn('pinyin_dict_notone 字典文件不支持声调！');
				if(polyphone) console.warn('pinyin_dict_notone 字典文件不支持多音字！');
				for (var i=0, len = chinese.length; i < len; i++)
				{
					var temp = chinese.charAt(i);
					result.push(dict.notone[temp] || temp); 
				}
			}
			else
			{
				throw '抱歉，未找到合适的拼音字典文件！';
			}
			if(!polyphone) return result.join(splitter);
			else
			{
				if(window.pinyin_dict_polyphone) return parsePolyphone(chinese, result, splitter, withtone);
				else return handlePolyphone(result, ' ', splitter);
			}
		},
		/**
		 * 获取汉字的拼音首字母
		 * @param str 汉字字符串，如果遇到非汉字则原样返回
		 * @param polyphone 是否支持多音字，默认false，如果为true，会返回所有可能的组合数组
		 */
		getFirstLetter: function(str, polyphone)
		{
			polyphone = polyphone == undefined ? false : polyphone;
			if(!str || /^ +$/g.test(str)) return '';
			if(dict.firstletter) // 使用首字母字典文件
			{
				var result = [];
				for(var i=0; i<str.length; i++)
				{
					var unicode = str.charCodeAt(i);
					var ch = str.charAt(i);
					if(unicode >= 19968 && unicode <= 40869)
					{
						ch = dict.firstletter.all.charAt(unicode-19968);
						if(polyphone) ch = dict.firstletter.polyphone[unicode] || ch;
					}
					result.push(ch);
				}
				if(!polyphone) return result.join(''); // 如果不用管多音字，直接将数组拼接成字符串
				else return handlePolyphone(result, '', ''); // 处理多音字，此时的result类似于：['D', 'ZC', 'F']
			}
			else
			{
				var py = this.getPinyin(str, ' ', false, polyphone);
				py = py instanceof Array ? py : [py];
				var result = [];
				for(var i=0; i<py.length; i++)
				{
					result.push(py[i].replace(/(^| )(\w)\w*/g, (function(m,$1,$2){return $2.toUpperCase();})));
				}
				if(!polyphone) return result[0];
				else return simpleUnique(result);
			}
		},
		/**
		 * 拼音转汉字，只支持单个汉字，返回所有匹配的汉字组合
		 * @param pinyin 单个汉字的拼音，不能包含声调
		 */
		getHanzi: function(pinyin)
		{
			if(!dict.py2hz)
			{
				throw '抱歉，未找到合适的拼音字典文件！';
			}
			return dict.py2hz[pinyin] || '';
		},
		/**
		 * 去除拼音中的声调，比如将 xiǎo míng tóng xué 转换成 xiao ming tong xue
		 * @param pinyin 需要转换的拼音
		 */
		removeTone: function(pinyin)
		{
			var toneMap = 
			{
				"ā": "a1",
				"á": "a2",
				"ǎ": "a3",
				"à": "a4",
				"ō": "o1",
				"ó": "o2",
				"ǒ": "o3",
				"ò": "o4",
				"ē": "e1",
				"é": "e2",
				"ě": "e3",
				"è": "e4",
				"ī": "i1",
				"í": "i2",
				"ǐ": "i3",
				"ì": "i4",
				"ū": "u1",
				"ú": "u2",
				"ǔ": "u3",
				"ù": "u4",
				"ü": "v0",
				"ǖ": "v1",
				"ǘ": "v2",
				"ǚ": "v3",
				"ǜ": "v4",
				"ń": "n2",
				"ň": "n3",
				"": "m2"
			};
			return pinyin.replace(/[āáǎàōóǒòēéěèīíǐìūúǔùüǖǘǚǜńň]/g, (function(m){ return toneMap[m][0]; }));
		}
	};


	/**
	 * 处理多音字，将类似['D', 'ZC', 'F']转换成['DZF', 'DCF']
	 * 或者将 ['chang zhang', 'cheng'] 转换成 ['chang cheng', 'zhang cheng']
	 */
	function handlePolyphone(array, splitter, joinChar)
	{
		splitter = splitter || '';
		var result = [''], temp = [];
		for(var i=0; i<array.length; i++)
		{
			temp = [];
			var t = array[i].split(splitter);
			for(var j=0; j<t.length; j++)
			{
				for(var k=0; k<result.length; k++)
					temp.push(result[k] + (result[k]?joinChar:'') + t[j]);
			}
			result = temp;
		}
		return simpleUnique(result);
	}

	/**
	 * 根据词库找出多音字正确的读音
	 * 这里只是非常简单的实现，效率和效果都有一些问题
	 * 推荐使用第三方分词工具先对句子进行分词，然后再匹配多音字
	 * @param chinese 需要转换的汉字
	 * @param result 初步匹配出来的包含多个发音的拼音结果
	 * @param splitter 返回结果拼接字符
	 */
	function parsePolyphone(chinese, result, splitter, withtone)
	{
		var poly = window.pinyin_dict_polyphone;
		var max = 7; // 最多只考虑7个汉字的多音字词，虽然词库里面有10个字的，但是数量非常少，为了整体效率暂时忽略之
		var temp = poly[chinese];
		if(temp) // 如果直接找到了结果
		{
			temp = temp.split(' ');
			for(var i=0; i<temp.length; i++)
			{
				result[i] = temp[i] || result[i];
				if(!withtone) result[i] = pinyinUtil.removeTone(result[i]);
			}
			return result.join(splitter);
		}
		for(var i=0; i<chinese.length; i++)
		{
			temp = '';
			for(var j=0; j<max && (i+j)<chinese.length; j++)
			{
				if(!/^[\u2E80-\u9FFF]+$/.test(chinese[i+j])) break; // 如果碰到非汉字直接停止本次查找
				temp += chinese[i+j];
				var res = poly[temp];
				if(res) // 如果找到了多音字词语
				{
					res = res.split(' ');
					for(var k=0; k<=j; k++)
					{
						if(res[k]) result[i+k] = withtone ? res[k] : pinyinUtil.removeTone(res[k]);
					}
					break;
				}
			}
		}
		// 最后这一步是为了防止出现词库里面也没有包含的多音字词语
		for(var i=0; i<result.length; i++)
		{
			result[i] = result[i].replace(/ .*$/g, '');
		}
		return result.join(splitter);
	}

	// 简单数组去重
	function simpleUnique(array)
	{
		var result = [];
		var hash = {};
		for(var i=0; i<array.length; i++)
		{
			var key = (typeof array[i]) + array[i];
			if(!hash[key])
			{
				result.push(array[i]);
				hash[key] = true;
			}
		}
		return result;
	}

	pinyinUtil.parseDict();
	pinyinUtil.dict = dict;
	window.pinyinUtil = pinyinUtil;
})();

/***/ }),

/***/ 1122:
/***/ (function(module, exports, __webpack_require__) {

!(function(t,e){ true?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.io=e():t.io=e()})(this,(function(){return (function(t){function e(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return t[o].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)})([(function(t,e,n){var o=n(27);window.JMessage=t.exports=o}),(function(t,e,n){function o(t){if(t)return r(t)}function r(t){for(var e in o.prototype)t[e]=o.prototype[e];return t}t.exports=o,o.prototype.on=o.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},o.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o,r=0;r<n.length;r++)if(o=n[r],o===e||o.fn===e){n.splice(r,1);break}return this},o.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n){n=n.slice(0);for(var o=0,r=n.length;o<r;++o)n[o].apply(this,e)}return this},o.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},o.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),(function(t,e,n){(function(t){function o(t,n){var o="b"+e.packets[t.type]+t.data.data;return n(o)}function r(t,n,o){if(!n)return e.encodeBase64Packet(t,o);var r=t.data,i=new Uint8Array(r),s=new Uint8Array(1+r.byteLength);s[0]=m[t.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return o(s.buffer)}function i(t,n,o){if(!n)return e.encodeBase64Packet(t,o);var r=new FileReader;return r.onload=function(){t.data=r.result,e.encodePacket(t,n,!0,o)},r.readAsArrayBuffer(t.data)}function s(t,n,o){if(!n)return e.encodeBase64Packet(t,o);if(g)return i(t,n,o);var r=new Uint8Array(1);r[0]=m[t.type];var s=new k([r.buffer,t.data]);return o(s)}function a(t){try{t=d.decode(t)}catch(t){return!1}return t}function c(t,e,n){for(var o=new Array(t.length),r=l(t.length,n),i=function(t,n,r){e(n,(function(e,n){o[t]=n,r(e,o)}))},s=0;s<t.length;s++)i(s,t[s],r)}var u,p=n(49),h=n(16),f=n(35),l=n(34),d=n(63);t&&t.ArrayBuffer&&(u=n(37));var _="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),y="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),g=_||y;e.protocol=3;var m=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},v=p(m),E={type:"error",data:"parser error"},k=n(38);e.encodePacket=function(e,n,i,a){"function"==typeof n&&(a=n,n=!1),"function"==typeof i&&(a=i,i=null);var c=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&c instanceof ArrayBuffer)return r(e,n,a);if(k&&c instanceof t.Blob)return s(e,n,a);if(c&&c.base64)return o(e,a);var u=m[e.type];return void 0!==e.data&&(u+=i?d.encode(String(e.data)):String(e.data)),a(""+u)},e.encodeBase64Packet=function(n,o){var r="b"+e.packets[n.type];if(k&&n.data instanceof t.Blob){var i=new FileReader;return i.onload=function(){var t=i.result.split(",")[1];o(r+t)},i.readAsDataURL(n.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(t){for(var a=new Uint8Array(n.data),c=new Array(a.length),u=0;u<a.length;u++)c[u]=a[u];s=String.fromCharCode.apply(null,c)}return r+=t.btoa(s),o(r)},e.decodePacket=function(t,n,o){if(void 0===t)return E;if("string"==typeof t){if("b"==t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(o&&(t=a(t),t===!1))return E;var r=t.charAt(0);return Number(r)==r&&v[r]?t.length>1?{type:v[r],data:t.substring(1)}:{type:v[r]}:E}var i=new Uint8Array(t),r=i[0],s=f(t,1);return k&&"blob"===n&&(s=new k([s])),{type:v[r],data:s}},e.decodeBase64Packet=function(t,e){var n=v[t.charAt(0)];if(!u)return{type:n,data:{base64:!0,data:t.substr(1)}};var o=u.decode(t.substr(1));return"blob"===e&&k&&(o=new k([o])),{type:n,data:o}},e.encodePayload=function(t,n,o){function r(t){return t.length+":"+t}function i(t,o){e.encodePacket(t,!!s&&n,!0,(function(t){o(null,r(t))}))}"function"==typeof n&&(o=n,n=null);var s=h(t);return n&&s?k&&!g?e.encodePayloadAsBlob(t,o):e.encodePayloadAsArrayBuffer(t,o):t.length?void c(t,i,(function(t,e){return o(e.join(""))})):o("0:")},e.decodePayload=function(t,n,o){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,o);"function"==typeof n&&(o=n,n=null);var r;if(""==t)return o(E,0,1);for(var i,s,a="",c=0,u=t.length;c<u;c++){var p=t.charAt(c);if(":"!=p)a+=p;else{if(""==a||a!=(i=Number(a)))return o(E,0,1);if(s=t.substr(c+1,i),a!=s.length)return o(E,0,1);if(s.length){if(r=e.decodePacket(s,n,!0),E.type==r.type&&E.data==r.data)return o(E,0,1);var h=o(r,c+i,u);if(!1===h)return}c+=i,a=""}}return""!=a?o(E,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){function o(t,n){e.encodePacket(t,!0,!0,(function(t){return n(null,t)}))}return t.length?void c(t,o,(function(t,e){var o=e.reduce((function(t,e){var n;return n="string"==typeof e?e.length:e.byteLength,t+n.toString().length+n+2}),0),r=new Uint8Array(o),i=0;return e.forEach((function(t){var e="string"==typeof t,n=t;if(e){for(var o=new Uint8Array(t.length),s=0;s<t.length;s++)o[s]=t.charCodeAt(s);n=o.buffer}e?r[i++]=0:r[i++]=1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)r[i++]=parseInt(a[s]);r[i++]=255;for(var o=new Uint8Array(n),s=0;s<o.length;s++)r[i++]=o[s]})),n(r.buffer)})):n(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,n){function o(t,n){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var o=new Uint8Array(t.length),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);t=o.buffer,e[0]=0}for(var i=t instanceof ArrayBuffer?t.byteLength:t.size,s=i.toString(),a=new Uint8Array(s.length+1),r=0;r<s.length;r++)a[r]=parseInt(s[r]);if(a[s.length]=255,k){var c=new k([e.buffer,a.buffer,t]);n(null,c)}}))}c(t,o,(function(t,e){return n(new k(e))}))},e.decodePayloadAsBinary=function(t,n,o){"function"==typeof n&&(o=n,n=null);for(var r=t,i=[],s=!1;r.byteLength>0;){for(var a=new Uint8Array(r),c=0===a[0],u="",p=1;255!=a[p];p++){if(u.length>310){s=!0;break}u+=a[p]}if(s)return o(E,0,1);r=f(r,2+u.length),u=parseInt(u);var h=f(r,0,u);if(c)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var l=new Uint8Array(h);h="";for(var p=0;p<l.length;p++)h+=String.fromCharCode(l[p])}i.push(h),r=f(r,u)}var d=i.length;i.forEach((function(t,r){o(e.decodePacket(t,n,!0),r,d)}))}}).call(e,(function(){return this})())}),(function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),(function(t,e,n){(function(o){function r(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var o="color: "+this.color;t=[t[0],o,"color: inherit"].concat(Array.prototype.slice.call(t,1));var r=0,i=0;return t[0].replace(/%[a-z%]/g,(function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,o),t}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}}function c(){try{return e.storage.debug}catch(t){}if("undefined"!=typeof o&&"env"in o)return o.env.DEBUG}function u(){try{return window.localStorage}catch(t){}}e=t.exports=n(47),e.log=s,e.formatArgs=i,e.save=a,e.load=c,e.useColors=r,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(c())}).call(e,n(10))}),(function(t,e,n){(function(o){function r(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var o="color: "+this.color;t=[t[0],o,"color: inherit"].concat(Array.prototype.slice.call(t,1));var r=0,i=0;return t[0].replace(/%[a-z%]/g,(function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,o),t}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}}function c(){try{return e.storage.debug}catch(t){}if("undefined"!=typeof o&&"env"in o)return o.env.DEBUG}function u(){try{return window.localStorage}catch(t){}}e=t.exports=n(56),e.log=s,e.formatArgs=i,e.save=a,e.load=c,e.useColors=r,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:u(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(c())}).call(e,n(10))}),(function(t,e){var n={SDK_VERSION:"2.5.0",WSS_ADDRESS:"wss://ws.im.jiguang.cn",UPLOAD_FILE:"https://sdk.im.jiguang.cn/resource",DOWNLOAD_FILE:"http://10.10.2.12:8888",ALLOW_MSG_TYPE:["text","image","file","location","custom"],LOGIN_OUT_EVENT:[1,2],FROM_PLATFORM:"j",ACK_TIMEOUT:5e3,RESP_TIMEOUT:3e4,RETRY_TIMES:5,SYNC_INTERVAL:15e4,RECEIPT_REPORT_INTERVAL:2e3,RECEIPT_REPORT_MAX_SIZE:50,EVENT_KEY:"eve-k-",CONVERSATION_KEY:"conversations-",SYNC_TYPE_OPEN:1,SYNC_TYPE_CLOSE:0,FRIEND_INVITE:1,FRIEND_INVITED:2,PLAT_CHANNEL:"w",EVENTS:{ACK:"ack",INIT:"c_init",LOGIN:"login",REGISTER:"register",GET_USER_INFO:"get_across_user_info",GET_ACROSS_USER_INFO:"get_across_user_info",S_SINGLE_TEXT:"s_across_single_text",S_SINGLE_TEXT_:"s_single_text",MSG_SYNC:"msg_sync",MSG_RECV:"msg_recv",MSG_RECV_V2:"msg_recv_v2",SEND_GROUP_MSG:"send_group_msg",CREATE_GROUP:"create_group",GET_GROUPS_LIST:"get_groups_list",GET_GROUP_INFO:"get_group_info",ADD_GROUP_MEMBER:"add_group_member",ADD_ACROSS_GROUP_MEMBER:"add_across_group_member",DEL_GROUP_MEMBER:"del_group_member",DEL_ACROSS_GROUP_MEMBER:"del_across_group_member",GET_GROUP_MEMBERS:"get_group_members",UPDATE_GROUP_INFO:"update_group_info",EXIT_GROUP:"exit_group",EVENT_NOTIFICATION:"event_notification",GET_CONVERSATIONS:"get_conversations",GET_UPLOAD_TOKEN:"get_upload_token",NO_DISTURB:"no_disturb",ADD_MSG_NO_DISTURB_SINGLE:"add_msg_no_disturb_single",DELETE_MSG_NO_DISTURB_SINGLE:"delete_msg_no_disturb_single",ADD_MSG_NO_DISTURB_GROUP:"add_msg_no_disturb_group",DELETE_MSG_NO_DISTURB_GROUP:"delete_msg_no_disturb_group",ADD_MSG_NO_DISTURB_GLOBAL:"add_msg_no_disturb_global",DELETE_MSG_NO_DISTURB_GLOBAL:"delete_msg_no_disturb_global",DISCONNECT:"disconnect",GET_BLACK_LIST:"get_black_list",ADD_BLACK_LIST:"add_black_list",DEL_BLACK_LIST:"del_black_list",UPDATE_SELF_INFO:"update_user_inf",UPDATE_SELF_PWD:"update_user_pwd",ADD_MSG_SHIELD_GROUP:"add_msg_shield_group",DEL_MSG_SHIELD_GROUP:"del_msg_shield_group",ADD_FRIEND:"add_friend",DEL_FRIEND:"del_friend",UPDATE_FRIEND_MEMO:"update_friend_memo",GET_FRIEND_LIST:"get_friend_list",SYNC_CHECK:"sync_check",SYNC_CONVERSATION:"sync_conversation",SYNC_CONVERSATION_ACK:"sync_conversation_ack",MSG_RETRACT:"msg_retract",GET_RESOURCE:"get_resource",LIST_SHIELD_GROUP:"list_shield_group",SYNC_EVENT_CHECK:"sync_event_check",SYNC_EVENT:"sync_event",SYNC_EVENT_ACK:"sync_event_ack",RECEIPT_REPORT:"receipt_report",SYNC_RECEIPT_ACK:"sync_receipt_ack",SYNC_RECEIPT:"sync_receipt",RECEIPT_CHANGE:"receipt_change",UNREAD_GROUP_COUNT:"unread_group_count",UNREAD_SINGLE_COUNT:"unread_single_count",MSG_UNREAD_LIST:"msg_unread_list",TRANS_MSG_SINGLE:"trans_msg_single",TRANS_MSG_GROUP:"trans_msg_group",TRANS_MSG_REC:"trans_msg_rec",ADMIN_ADD_GROUP_MEMBER:"admin_add_group_member",APPLY_JOIN_GROUP:"apply_join_group",ROOM_LIST:"room_list",ROOM_LIST_SELF:"room_list_self",JOIN_ROOM:"join_room",EXIT_ROOM:"exit_room",ROOM_INFO:"room_info",SEND_ROOM_MSG:"send_room_msg",ROOM_MSG_SYNC:"room_msg_sync",GROUP_MEM_SILENCE:"group_mem_silence",ROOM_MSG_SYNC_HIS:"room_msg_sync_his"}};t.exports=n}),(function(t,e,n){function o(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var r=n(2),i=n(1);t.exports=o,i(o.prototype),o.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(t){var e=r.decodePacket(t,this.socket.binaryType);this.onPacket(e)},o.prototype.onPacket=function(t){this.emit("packet",t)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}}),(function(t,e,n){(function(e){var o=n(50);t.exports=function(t){var n=t.xdomain,r=t.xscheme,i=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||o))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!r&&i)return new XDomainRequest}catch(t){}if(!n)try{return new(e[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}).call(e,(function(){return this})())}),(function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),o=0,r=n.length;o<r;o++){var i=n[o].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}}),(function(t,e){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function r(t){if(p===setTimeout)return setTimeout(t,0);if((p===n||!p)&&setTimeout)return p=setTimeout,setTimeout(t,0);try{return p(t,0)}catch(e){try{return p.call(null,t,0)}catch(e){return p.call(this,t,0)}}}function i(t){if(h===clearTimeout)return clearTimeout(t);if((h===o||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){_&&l&&(_=!1,l.length?d=l.concat(d):y=-1,d.length&&a())}function a(){if(!_){var t=r(s);_=!0;for(var e=d.length;e;){for(l=d,d=[];++y<e;)l&&l[y].run();y=-1,e=d.length}l=null,_=!1,i(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var p,h,f=t.exports={};!(function(){try{p="function"==typeof setTimeout?setTimeout:n}catch(t){p=n}try{h="function"==typeof clearTimeout?clearTimeout:o}catch(t){h=o}})();var l,d=[],_=!1,y=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new c(t,e)),1!==d.length||_||r(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}}),(function(t,e,n){function o(){}function r(t){var n="",o=!1;return n+=t.type,e.BINARY_EVENT!=t.type&&e.BINARY_ACK!=t.type||(n+=t.attachments,n+="-"),t.nsp&&"/"!=t.nsp&&(o=!0,n+=t.nsp),null!=t.id&&(o&&(n+=",",o=!1),n+=t.id),null!=t.data&&(o&&(n+=","),n+=f.stringify(t.data)),h("encoded %j as %s",t,n),n}function i(t,e){function n(t){var n=d.deconstructPacket(t),o=r(n.packet),i=n.buffers;i.unshift(o),e(i)}d.removeBlobs(t,n)}function s(){this.reconstructor=null}function a(t){var n={},o=0;if(n.type=Number(t.charAt(0)),null==e.types[n.type])return p();if(e.BINARY_EVENT==n.type||e.BINARY_ACK==n.type){for(var r="";"-"!=t.charAt(++o)&&(r+=t.charAt(o),o!=t.length););if(r!=Number(r)||"-"!=t.charAt(o))throw new Error("Illegal attachments");n.attachments=Number(r)}if("/"==t.charAt(o+1))for(n.nsp="";++o;){var i=t.charAt(o);if(","==i)break;if(n.nsp+=i,o==t.length)break}else n.nsp="/";var s=t.charAt(o+1);if(""!==s&&Number(s)==s){for(n.id="";++o;){var i=t.charAt(o);if(null==i||Number(i)!=i){--o;break}if(n.id+=t.charAt(o),o==t.length)break}n.id=Number(n.id)}return t.charAt(++o)&&(n=c(n,t.substr(o))),h("decoded %s as %j",t,n),n}function c(t,e){try{t.data=f.parse(e)}catch(t){return p()}return t}function u(t){this.reconPack=t,this.buffers=[]}function p(t){return{type:e.ERROR,data:"parser error"}}var h=n(39)("socket.io-parser"),f=n(51),l=n(59),d=n(58),_=n(23);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=o,e.Decoder=s,o.prototype.encode=function(t,n){if(h("encoding packet %j",t),e.BINARY_EVENT==t.type||e.BINARY_ACK==t.type)i(t,n);else{var o=r(t);n([o])}},l(s.prototype),s.prototype.add=function(t){var n;if("string"==typeof t)n=a(t),e.BINARY_EVENT==n.type||e.BINARY_ACK==n.type?(this.reconstructor=new u(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!_(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,this.emit("decoded",n))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length==this.reconPack.attachments){var e=d.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),(function(t,e,n){(function(t,o){function r(t,e){this._id=t,this._clearFn=e}var i=n(10).nextTick,s=Function.prototype.apply,a=Array.prototype.slice,c={},u=0;e.setTimeout=function(){return new r(s.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new r(s.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},e.setImmediate="function"==typeof t?t:function(t){var n=u++,o=!(arguments.length<2)&&a.call(arguments,1);return c[n]=!0,i((function(){c[n]&&(o?t.apply(null,o):t.call(null),e.clearImmediate(n))})),n},e.clearImmediate="function"==typeof o?o:function(t){delete c[t]}}).call(e,n(12).setImmediate,n(12).clearImmediate)}),(function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var o=n.call(arguments,2);return function(){return e.apply(t,o.concat(n.call(arguments)))}}}),(function(t,e,n){(function(t){function o(e){var n,o=!1,a=!1,c=!1!==e.jsonp;if(t.location){var u="https:"===location.protocol,p=location.port;p||(p=u?443:80),o=e.hostname!==location.hostname||p!==e.port,a=e.secure!==u}if(e.xdomain=o,e.xscheme=a,n=new r(e),"open"in n&&!e.forceJSONP)return new i(e);if(!c)throw new Error("JSONP disabled");return new s(e)}var r=n(8),i=n(45),s=n(44),a=n(46);e.polling=o,e.websocket=a}).call(e,(function(){return this})())}),(function(t,e,n){function o(t){var e=t&&t.forceBase64;p&&!e||(this.supportsBinary=!1),r.call(this,t)}var r=n(7),i=n(9),s=n(2),a=n(3),c=n(25),u=n(4)("engine.io-client:polling");t.exports=o;var p=(function(){var t=n(8),e=new t({xdomain:!1});return null!=e.responseType})();a(o,r),o.prototype.name="polling",o.prototype.doOpen=function(){this.poll()},o.prototype.pause=function(t){function e(){u("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(u("we are currently polling - waiting to pause"),o++,this.once("pollComplete",(function(){u("pre-pause polling complete"),--o||e()}))),this.writable||(u("we are currently writing - waiting to pause"),o++,this.once("drain",(function(){u("pre-pause writing complete"),--o||e()})))}else e()},o.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},o.prototype.onData=function(t){var e=this;u("polling got data %s",t);var n=function(t,n,o){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)};s.decodePayload(t,this.socket.binaryType,n),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},o.prototype.doClose=function(){function t(){u("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(u("transport open - closing"),t()):(u("transport not open - deferring close"),this.once("open",t))},o.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,n)}))},o.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";!1!==this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t);var o=this.hostname.indexOf(":")!==-1;return e+"://"+(o?"["+this.hostname+"]":this.hostname)+n+this.path+t}}),(function(t,e,n){(function(e){function o(t){function n(t){if(!t)return!1;if(e.Buffer&&e.Buffer.isBuffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer||e.Blob&&t instanceof Blob||e.File&&t instanceof File)return!0;if(r(t)){for(var o=0;o<t.length;o++)if(n(t[o]))return!0}else if(t&&"object"==typeof t){t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON());for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&n(t[i]))return!0}return!1}return n(t)}var r=n(18);t.exports=o}).call(e,(function(){return this})())}),(function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var o=0;o<t.length;++o)if(t[o]===e)return o;return-1}}),(function(t,e){t.exports=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)}}),(function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,r=t.indexOf("["),i=t.indexOf("]");r!=-1&&i!=-1&&(t=t.substring(0,r)+t.substring(r,i).replace(/:/g,";")+t.substring(i,t.length));for(var s=n.exec(t||""),a={},c=14;c--;)a[o[c]]=s[c]||"";return r!=-1&&i!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}}),(function(t,e,n){function o(t,e){return this instanceof o?(t&&"object"==typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new f({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=e.autoConnect!==!1,void(this.autoConnect&&this.open())):new o(t,e)}var r=n(41),i=n(22),s=n(1),a=n(11),c=n(21),u=n(13),p=n(5)("socket.io-client:manager"),h=n(17),f=n(36),l=Object.prototype.hasOwnProperty;t.exports=o,o.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var t in this.nsps)l.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},o.prototype.updateSocketIds=function(){for(var t in this.nsps)l.call(this.nsps,t)&&(this.nsps[t].id=this.engine.id)},s(o.prototype),o.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},o.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},o.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},o.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},o.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},o.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},o.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},o.prototype.open=o.prototype.connect=function(t,e){if(p("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;p("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var i=c(n,"open",(function(){o.onopen(),t&&t()})),s=c(n,"error",(function(e){if(p("connect_error"),o.cleanup(),o.readyState="closed",o.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else o.maybeReconnectOnOpen()}));if(!1!==this._timeout){var a=this._timeout;p("connect attempt will timeout after %d",a);var u=setTimeout((function(){p("connect attempt timed out after %d",a),i.destroy(),n.close(),n.emit("error","timeout"),o.emitAll("connect_timeout",a)}),a);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(i),this.subs.push(s),this},o.prototype.onopen=function(){p("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(c(t,"data",u(this,"ondata"))),this.subs.push(c(t,"ping",u(this,"onping"))),this.subs.push(c(t,"pong",u(this,"onpong"))),this.subs.push(c(t,"error",u(this,"onerror"))),this.subs.push(c(t,"close",u(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",u(this,"ondecoded")))},o.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},o.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},o.prototype.ondata=function(t){this.decoder.add(t)},o.prototype.ondecoded=function(t){this.emit("packet",t)},o.prototype.onerror=function(t){p("error",t),this.emitAll("error",t)},o.prototype.socket=function(t,e){function n(){~h(r.connecting,o)||r.connecting.push(o)}var o=this.nsps[t];if(!o){o=new i(this,t,e),this.nsps[t]=o;var r=this;o.on("connecting",n),o.on("connect",(function(){o.id=r.engine.id})),this.autoConnect&&n()}return o},o.prototype.destroy=function(t){var e=h(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},o.prototype.packet=function(t){p("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(n){for(var o=0;o<n.length;o++)e.engine.write(n[o],t.options);e.encoding=!1,e.processPacketQueue()})))},o.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},o.prototype.cleanup=function(){p("cleanup");for(var t=this.subs.length,e=0;e<t;e++){var n=this.subs.shift();n.destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},o.prototype.close=o.prototype.disconnect=function(){p("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},o.prototype.onclose=function(t){p("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},o.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)p("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();p("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout((function(){t.skipReconnect||(p("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(p("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(p("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(n)}})}},o.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}}),(function(t,e){function n(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}t.exports=n}),(function(t,e,n){function o(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}var r=n(11),i=n(1),s=n(61),a=n(21),c=n(13),u=n(5)("socket.io-client:socket"),p=n(16);t.exports=e=o;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;i(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[a(t,"open",c(this,"onopen")),a(t,"packet",c(this,"onpacket")),a(t,"close",c(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},o.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},o.prototype.emit=function(t){if(h.hasOwnProperty(t))return f.apply(this,arguments),this;
var e=s(arguments),n=r.EVENT;p(e)&&(n=r.BINARY_EVENT);var o={type:n,data:e};return o.options={},o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),delete this.flags,this},o.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},o.prototype.onopen=function(){u("transport is open - connecting"),"/"!==this.nsp&&(this.query?this.packet({type:r.CONNECT,query:this.query}):this.packet({type:r.CONNECT}))},o.prototype.onclose=function(t){u("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},o.prototype.onpacket=function(t){if(t.nsp===this.nsp)switch(t.type){case r.CONNECT:this.onconnect();break;case r.EVENT:this.onevent(t);break;case r.BINARY_EVENT:this.onevent(t);break;case r.ACK:this.onack(t);break;case r.BINARY_ACK:this.onack(t);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",t.data)}},o.prototype.onevent=function(t){var e=t.data||[];u("emitting event %j",e),null!=t.id&&(u("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?f.apply(this,e):this.receiveBuffer.push(e)},o.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var o=s(arguments);u("sending ack %j",o);var i=p(o)?r.BINARY_ACK:r.ACK;e.packet({type:i,id:t,data:o})}}},o.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(u("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):u("bad ack %s",t.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)f.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this}}),(function(t,e){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(e,(function(){return this})())}),(function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}}),(function(t,e){"use strict";function n(t){var e="";do e=s[t%a]+e,t=Math.floor(t/a);while(t>0);return e}function o(t){var e=0;for(p=0;p<t.length;p++)e=e*a+c[t.charAt(p)];return e}function r(){var t=n(+new Date);return t!==i?(u=0,i=t):t+"."+n(u++)}for(var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,c={},u=0,p=0;p<a;p++)c[s[p]]=p;r.encode=n,r.decode=o,t.exports=r}),(function(t,e,n){var o=n(1),r=n(54),i=n(6),s=function(t){this.init(t)};s.prototype.init=function(t){this.opts=t,this.dataCache={},this.memStore={},this.sync_key=0,this.sync_type=0,this.client=r(this.opts.address,{transports:["websocket","polling"]});var e=this,n=o.prototype.emit,i=this.client.onevent;this.client.onevent=function(t){var o=t.data||[];i.call(e.client,t),n.apply(e.client,["*"].concat(o))},this.client.on("*",(function(t,n){e.onReceive(t,n)}))},s.prototype.onReceive=function(t,e){if(this.opts.debug&&console.info("---<- event:%s, data:%s",t,JSON.stringify(e)),t!==i.EVENTS.EVENT_NOTIFICATION&&t!==i.EVENTS.MSG_SYNC&&t!==i.EVENTS.SYNC_CONVERSATION&&t!==i.EVENTS.SYNC_EVENT&&t!==i.EVENTS.SYNC_RECEIPT&&t!==i.EVENTS.RECEIPT_CHANGE&&t!==i.ROOM_MSG_SYNC&&t!==i.ROOM_MSG_SYNC_HIS){var n=this.dataCache[e.rid];delete e.rid,n&&(0===e.code&&t===i.EVENTS.GET_GROUP_MEMBERS?e.member_list.forEach((function(t){n.userInfoGet&&n.userInfoGet(t.uid,t.mtime),delete t.uid,delete t.mtime})):0===e.code&&t===i.EVENTS.GET_FRIEND_LIST?e.friend_list.forEach((function(t){n.userInfoGet&&n.userInfoGet(t.uid,1e3*t.mtime),delete t.uid})):0===e.code&&t===i.EVENTS.GET_BLACK_LIST?e.black_list.forEach((function(t){delete t.uid})):0===e.code&&t===i.EVENTS.GET_ACROSS_USER_INFO&&delete e.user_info.uid,t===i.EVENTS.ACK?(n.ack&&n.ack({rid:e.rid,data:n.data}),n.cleanAckTimeout()):(n.cleanRespTimeout(),delete this.dataCache[n.rid],e.code&&0!==e.code?n.fail&&n.fail(e):t!=i.EVENTS.S_SINGLE_TEXT_&&t!=i.EVENTS.SEND_GROUP_MSG&&t!=i.EVENTS.SEND_ROOM_MSG?n.hook?n.hook(e,n.success):n.success&&n.success(e):(n.data.msg_id=e.msg_id,t===i.EVENTS.S_SINGLE_TEXT_&&(e.target_username=n.data.target_id,e.appkey=n.data.appkey),n.success&&n.success(e,n.data),n.innerCall&&n.innerCall(e.msg_id))))}},s.prototype.generateRid=function(){for(var t=Math.floor(Math.random()*-2147483646+2147483647);this.dataCache[t];)t=Math.floor(Math.random()*-2147483646+2147483647);return t},s.prototype.send=function(t,e){this.opts.debug&&console.info("--->- event:%s, data:%s",t,JSON.stringify(e)),this.client.emit(t,e)},t.exports=s}),(function(t,e,n){var o=n(60),r=n(33),i=n(26),s=n(6),a=n(29),c=n(31),u=n(30),p=n(28)(),h=n(32),f=function(t){var e=t?t:{};this.opts={address:e.address?e.address:s.WSS_ADDRESS,upload_file:e.upload_file?e.upload_file:s.UPLOAD_FILE,download_file:e.download_file?e.download_file:s.DOWNLOAD_FILE,debug:!!e.debug},this.channel=new i(this.opts),this.syncTask=0,this.msgReceipTask=0};f.prototype.init=function(t){var e=this;return e.autoDiscon=!0,t.flag!==s.SYNC_TYPE_OPEN&&t.flag!==s.SYNC_TYPE_CLOSE||(e.channel.sync_type=t.flag),t.fromPlatForm=s.FROM_PLATFORM,new a(this.channel).setEvent(s.EVENTS.INIT).setData(t).send().addHook((function(n,o){e.current_appkey=t.appkey,o&&o(n)}))},f.prototype.loginOut=function(){if(this.current_user){this.autoDiscon=!1,this.channel.client.close();var t=this.channel.dataCache;for(var e in t)t[e].cleanAckTimeout(),t[e].cleanRespTimeout();this.current_user=null,this.current_appkey=null,this.channel.init(this.channel.opts)}},f.prototype.login=function(t){this.__checkInit(),t.is_md5||(t.password=p(t.password)),t.version=s.SDK_VERSION;var e=this,n=new a(this.channel).setEvent(s.EVENTS.LOGIN).setData(t).addHook((function(n,o){e.current_user=t.username,h.StorageUtils.removeItems(e.current_user),e.channel.sync_key=0,e.channel.sync_event_key=0,e.channel.msg_receipt_key=0,e.channel.ses_key=s.SESSION_KEY+e.current_appkey+"-"+e.current_user,e.channel.conversations_key=s.CONVERSATION_KEY+e.current_appkey+"-"+e.current_user,e.channel.event_key=s.EVENT_KEY+e.current_appkey+"-"+e.current_user,e._syncCheckTask(),e._receiptReportTask(),e._initConversation(),e.lastMsgs={},e.channel.client.removeListener(s.EVENTS.LOGIN),e._addEventListen(),e.firstLogin=!1,o&&o(n)}));return setTimeout((function(){n.send()}),500),n},f.prototype._initConversation=function(){var t=this,e=h.StorageUtils.getItem(t.channel.conversations_key);null===e&&(e=JSON.stringify({}),h.StorageUtils.addItem(t.channel.conversations_key,e)),t.conversations=JSON.parse(e)},f.prototype._receiptReportTask=function(){var t=this;t.report=[],t.msgReceipTask=setInterval((function(){t._receiptReport()}),s.RECEIPT_REPORT_INTERVAL)},f.prototype._syncCheckTask=function(){var t=this,e=h.StorageUtils.getItem(t.channel.event_key);null!=e&&(t.channel.sync_event_key=e),t._syncCheck({sync_key:t.channel.sync_key,sync_type:t.channel.sync_type,sync_event_key:t.channel.sync_event_key,msg_receipt_key:t.channel.msg_receipt_key}).onSuccess((function(e){e&&0===e.code&&(t.channel.sync_key=e.sync_key,t.channel.sync_type=e.sync_type,t.channel.sync_event_key=e.sync_event_key,t.channel.msg_receipt_key=e.msg_receipt_key,h.StorageUtils.addItem(t.channel.event_key,e.sync_event_key))})),t.syncTask=setInterval((function(){t._syncCheck({sync_key:t.channel.sync_key,sync_type:t.channel.sync_type,sync_event_key:t.channel.sync_event_key,msg_receipt_key:t.channel.msg_receipt_key}).onSuccess((function(e){e&&0===e.code&&(t.channel.sync_key=e.sync_key,t.channel.sync_type=e.sync_type,t.channel.sync_event_key=e.sync_event_key,t.channel.msg_receipt_key=e.msg_receipt_key,h.StorageUtils.addItem(t.channel.event_key,e.sync_event_key))}))}),s.SYNC_INTERVAL)},f.prototype._syncCheck=function(t){return new a(this.channel).setEvent(s.EVENTS.SYNC_CHECK).setData(t).send()},f.prototype.register=function(t){return this.__checkInit(),t.is_md5||(t.password=p(t.password)),new a(this.channel).setEvent(s.EVENTS.REGISTER).setData(t).send()},f.prototype.getUserInfo=function(t){return this.__checkLogin(),h.StringUtils.isBlack(t.appkey)&&(t.appkey=this.current_appkey),new a(this.channel).setEvent(s.EVENTS.GET_ACROSS_USER_INFO).setData(t).send()},f.prototype.updateSelfInfo=function(t){return this.__checkLogin(),h.StringUtils.isBlack(t.avatar)||delete t.avatar,new a(this.channel).setEvent(s.EVENTS.UPDATE_SELF_INFO).setData(t).send()},f.prototype.updateSelfAvatar=function(t){this.__checkLogin();var e=new a(this.channel).setEvent(s.EVENTS.UPDATE_SELF_INFO),n=this;return this.__uploadFile({appkey:n.current_appkey,username:n.current_user,file:t.avatar,type:"image"},(function(t,n){return t?t.is_timeout?e.timeout&&e.timeout(t.data):e.fail&&e.fail(t.data):void e.setData({avatar:n.media_id}).send()})),e},f.prototype.updateSelfPwd=function(t){return this.__checkLogin(),t.is_md5||(t.old_pwd=p(t.old_pwd),t.new_pwd=p(t.new_pwd)),new a(this.channel).setEvent(s.EVENTS.UPDATE_SELF_PWD).setData(t).send()},f.prototype.getConversation=function(){this.__checkLogin();var t=this;return new a(this.channel).setEvent(s.EVENTS.GET_CONVERSATIONS).setData({}).send().addHook((function(e,n){e.conversations.forEach((function(e){var n;3===e.type?(t[e.key]=e.utime,delete e.utime,n=e.appkey+e.username):(n=e.key,e.gid=e.key),t.conversations[n]?(t.conversations[n].extras?e.extras=t.conversations[n].extras:e.extras={},e.unread_msg_count=t.conversations[n].unread_msg_count):(e.extras={},e.unread_msg_count=0,t.conversations[n]={},t.conversations[n].extras={},t.conversations[n].unread_msg_count=0,t.conversations[n].msg_time=[])})),h.StorageUtils.addItem(t.channel.conversations_key,JSON.stringify(t.conversations)),n&&n(e)}))},f.prototype.resetUnreadCount=function(t){this.__checkLogin();var e,n=this;t.gid?e=String(t.gid):(t.appkey||(t.appkey=n.current_appkey),e=t.appkey+t.username),n.conversations[e]=void 0===n.conversations[e]?{}:n.conversations[e],t.gid?n._updateGroupUnreadCount({gid:t.gid}):n._updateSingleUnreadCount({appkey:t.appkey,username:t.username}),n.conversations[e].unread_msg_count=0,n.conversations[e].msg_time=[];var o=(new Date).getTime();n.lastMsgs[e]&&(o=n.lastMsgs[e].last_msg_time),n.conversations[e].recent_time=o,n.current_conversation=e,h.StorageUtils.addItem(n.channel.conversations_key,JSON.stringify(n.conversations))},f.prototype.getUnreadMsgCnt=function(t){this.__checkLogin();var e,n=this;return t.gid?e=String(t.gid):(t.appkey||(t.appkey=n.current_appkey),e=t.appkey+t.username),n.conversations[e]||(n.conversations[e]={}),n.conversations[e].unread_msg_count?n.conversations[e].unread_msg_count:0},f.prototype.msgRetract=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.MSG_RETRACT).setData(t).send()},f.prototype.sendSingleMsg=function(t){return this.__sendMsg({type:"single",target_id:t.target_username,target_name:t.target_nickname,content:t.content,extras:t.extras,msg_body:t.msg_body,appkey:t.appkey,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendGroupMsg=function(t){return this.__sendMsg({type:"group",target_id:t.target_gid,target_name:t.target_gname,content:t.content,extras:t.extras,msg_body:t.msg_body,at_list:t.at_list,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendSinglePic=function(t){return this.__sendPic({type:"single",target_id:t.target_username,target_name:t.target_nickname,file:t.image,msg_body:t.msg_body,extras:t.extras,appkey:t.appkey,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendGroupPic=function(t){return this.__sendPic({type:"group",target_id:t.target_gid,target_name:t.target_gname,file:t.image,msg_body:t.msg_body,extras:t.extras,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendSingleFile=function(t){return this.__sendFile({type:"single",target_id:t.target_username,target_name:t.target_nickname,file:t.file,msg_body:t.msg_body,extras:t.extras,appkey:t.appkey,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendGroupFile=function(t){return this.__sendFile({type:"group",target_id:t.target_gid,target_name:t.target_gname,file:t.file,msg_body:t.msg_body,extras:t.extras,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendSingleLocation=function(t){return this.__sendLocation({type:"single",target_id:t.target_username,target_name:t.target_nickname,latitude:t.latitude,longitude:t.longitude,scale:t.scale,label:t.label,msg_body:t.msg_body,extras:t.extras,appkey:t.appkey,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendGroupLocation=function(t){return this.__sendLocation({type:"group",target_id:t.target_gid,target_name:t.target_gname,latitude:t.latitude,longitude:t.longitude,scale:t.scale,label:t.label,msg_body:t.msg_body,extras:t.extras,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendSingleCustom=function(t){return this.__sendCustom({type:"single",target_id:t.target_username,target_name:t.target_nickname,custom:t.custom,extras:t.extras,msg_body:t.msg_body,appkey:t.appkey,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.sendGroupCustom=function(t){return this.__sendCustom({type:"group",target_id:t.target_gid,target_name:t.target_gname,custom:t.custom,msg_body:t.msg_body,extras:t.extras,no_offline:t.no_offline,no_notification:t.no_notification,custom_notification:t.custom_notification,need_receipt:t.need_receipt})},f.prototype.createGroup=function(t){this.__checkLogin();var e=this,n=new a(this.channel).setEvent(s.EVENTS.CREATE_GROUP);return t.avatar?this.__uploadFile({appkey:e.current_appkey,username:e.current_user,file:t.avatar,type:"image"},(function(e,o){return e?e.is_timeout?n.timeout&&n.timeout(e.data):n.fail&&n.fail(e.data):(delete t.avatar,t.media_id=o.media_id,void n.setData(t).send())})):n.setData(t).send(),n},f.prototype.exitGroup=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.EXIT_GROUP).setData(t).send()},f.prototype.getGroups=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.GET_GROUPS_LIST).setData({}).send().addHook((function(t,e){t.group_list.forEach((function(t){t.group_type=t.flag,delete t.flag})),e&&e(t)}))},f.prototype.getGroupInfo=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.GET_GROUP_INFO).setData(t).send().addHook((function(t,e){t.group_info.group_type=t.group_info.flag,delete t.group_info.flag,e&&e(t)}))},f.prototype.updateGroupInfo=function(t){this.__checkLogin();var e=this,n=new a(this.channel).setEvent(s.EVENTS.UPDATE_GROUP_INFO);return t.avatar?this.__uploadFile({appkey:e.current_appkey,username:e.current_user,file:t.avatar,type:"image"},(function(e,o){return e?e.is_timeout?n.timeout&&n.timeout(e.data):n.fail&&n.fail(e.data):(delete t.avatar,t.media_id=o.media_id,void n.setData(t).send())})):n.setData(t).send(),n},f.prototype.getGroupMembers=function(t){this.__checkLogin();var e=this;return new a(this.channel).setEvent(s.EVENTS.GET_GROUP_MEMBERS).setData(t).send().onUserInfoGet((function(t,n){e[t]=n}))},f.prototype.addGroupMembers=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.ADD_ACROSS_GROUP_MEMBER).setData(t).send()},f.prototype.delGroupMembers=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.DEL_ACROSS_GROUP_MEMBER).setData(t).send()},f.prototype.getNoDisturb=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.NO_DISTURB).setData({version:0}).send()},f.prototype.addSingleNoDisturb=function(t){return this.__checkLogin(),t.version=0,new a(this.channel).setEvent(s.EVENTS.ADD_MSG_NO_DISTURB_SINGLE).setData(t).send()},f.prototype.delSingleNoDisturb=function(t){return this.__checkLogin(),t.version=0,new a(this.channel).setEvent(s.EVENTS.DELETE_MSG_NO_DISTURB_SINGLE).setData(t).send()},f.prototype.addGroupNoDisturb=function(t){return this.__checkLogin(),t.version=0,new a(this.channel).setEvent(s.EVENTS.ADD_MSG_NO_DISTURB_GROUP).setData(t).send()},f.prototype.delGroupNoDisturb=function(t){return this.__checkLogin(),t.version=0,new a(this.channel).setEvent(s.EVENTS.DELETE_MSG_NO_DISTURB_GROUP).setData(t).send()},f.prototype.addGlobalNoDisturb=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.ADD_MSG_NO_DISTURB_GLOBAL).setData({version:0}).send()},f.prototype.delGlobalNoDisturb=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.DELETE_MSG_NO_DISTURB_GLOBAL).setData({version:0}).send()},f.prototype.getBlacks=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.GET_BLACK_LIST).setData({version:0}).send()},f.prototype.addSingleBlacks=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.ADD_BLACK_LIST).setData(t).send()},f.prototype.delSingleBlacks=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.DEL_BLACK_LIST).setData(t).send()},f.prototype.getFriendList=function(){this.__checkLogin();var t=this;return new a(this.channel).setEvent(s.EVENTS.GET_FRIEND_LIST).setData({}).send().onUserInfoGet((function(e,n){t[e]=n}))},f.prototype.addFriend=function(t){return this.__checkLogin(),t.from_type=s.FRIEND_INVITE,new a(this.channel).setEvent(s.EVENTS.ADD_FRIEND).setData(t).send()},f.prototype.acceptFriend=function(t){return this.__checkLogin(),t.why="yes",t.from_type=s.FRIEND_INVITED,new a(this.channel).setEvent(s.EVENTS.ADD_FRIEND).setData(t).send()},f.prototype.declineFriend=function(t){return this.__checkLogin(),t.why&&""!=t.why.trim()||(t.why="no"),t.from_type=s.FRIEND_INVITED,new a(this.channel).setEvent(s.EVENTS.ADD_FRIEND).setData(t).send()},f.prototype.delFriend=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.DEL_FRIEND).setData(t).send()},f.prototype.updateFriendMemo=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.UPDATE_FRIEND_MEMO).setData(t).send()},f.prototype.addGroupShield=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.ADD_MSG_SHIELD_GROUP).setData(t).send()},f.prototype.delGroupShield=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.DEL_MSG_SHIELD_GROUP).setData(t).send()},f.prototype.groupShieldList=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.LIST_SHIELD_GROUP).setData({}).send()},f.prototype.getResource=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.GET_RESOURCE).setData(t).send()},f.prototype._updateGroupUnreadCount=function(t){this.__checkLogin(),t.type=4,new a(this.channel).setEvent(s.EVENTS.UNREAD_GROUP_COUNT).setData(t).send()},f.prototype._updateSingleUnreadCount=function(t){this.__checkLogin(),t.type=3,new a(this.channel).setEvent(s.EVENTS.UNREAD_SINGLE_COUNT).setData(t).send()},f.prototype.msgUnreadList=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.MSG_UNREAD_LIST).setData(t).send()},f.prototype.addGroupReceiptReport=function(t){this.__checkLogin();var e=this;if(!(t.msg_ids instanceof Array)||0===t.msg_ids.length)return void console.error("msg_ids is not Array type or msg_ids size=0");t.key=t.gid,t.type=4;var n=new c(t);return e.report.push(n),setTimeout((function(){e._checkReportSize()>=s.RECEIPT_REPORT_MAX_SIZE&&e._receiptReport()}),50),n},f.prototype.addSingleReceiptReport=function(t){this.__checkLogin();var e=this;if(!(t.msg_ids instanceof Array)||0===t.msg_ids.length)return void console.error("msg_ids is not Array type or msg_ids size=0");t.appkey||(t.appkey=e.current_appkey),t.type=3,t.key=t.appkey+t.username;var n=new c(t);return e.report.push(n),setTimeout((function(){e._checkReportSize()>=s.RECEIPT_REPORT_MAX_SIZE&&e._receiptReport()}),50),n},f.prototype._checkReportSize=function(){var t=this,e=0;return t.report.forEach((function(t){e+=t.args.msg_ids.length})),e},f.prototype.transSingleMsg=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.TRANS_MSG_SINGLE).setData(t).send()},f.prototype.transGroupMsg=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.TRANS_MSG_GROUP).setData(t).send()},f.prototype.updateConversation=function(t){this.__checkLogin();var e=this;t.appkey||(t.appkey=e.current_appkey);var n;t.gid?n=t.gid:t.username&&(n=t.appkey+t.username),n&&t.extras&&(e.conversations[n]||(e.conversations[n]={}),e.conversations[n].extras=t.extras),h.StorageUtils.addItem(e.channel.conversations_key,JSON.stringify(e.conversations))},f.prototype.addGroupMemberResp=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.ADMIN_ADD_GROUP_MEMBER).setData(t).send()},f.prototype.joinGroup=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.APPLY_JOIN_GROUP).setData(t).send()},f.prototype.getAppkeyChatrooms=function(t){return this.__checkLogin(),!t&&(t={}),new a(this.channel).setEvent(s.EVENTS.ROOM_LIST).setData(t).send().addHook((function(t,e){t.result.rooms.forEach((function(t){h.Cache.rooms[t.id]=t})),e&&e(t)}))},f.prototype.getSelfChatrooms=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.ROOM_LIST_SELF).setData({}).send().addHook((function(t,e){t.chat_rooms.forEach((function(t){h.Cache.rooms[t.id]=t})),e&&e(t)}))},f.prototype.getChatroomInfo=function(t){this.__checkLogin();var e=new a(this.channel);return h.Cache.rooms[t.id]?setTimeout((function(){var n={};n.code=0,n.message="success",n.info=h.Cache.rooms[t.id],e.cleanRespTimeout(),e.success&&e.success(n)}),100):e.setEvent(s.EVENTS.ROOM_INFO).setData(t).send().addHook((function(t,e){h.Cache.rooms[t.info.id]=t.info,e&&e(t)})),e},f.prototype.enterChatroom=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.JOIN_ROOM).setData(t).send()},f.prototype.exitChatroom=function(t){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.EXIT_ROOM).setData(t).send()},f.prototype.sendChatroomMsg=function(t){return this.__checkLogin(),t.target_rname||(t.target_rname=void 0===h.Cache.rooms[t.target_rid]?"":h.Cache.rooms[t.target_rid].name),this.__sendMsg({type:"chatroom",target_id:t.target_rid,target_name:t.target_rname,content:t.content,extras:t.extras,msg_body:t.msg_body})},f.prototype.sendChatroomPic=function(t){return this.__checkLogin(),t.target_rname||(t.target_rname=void 0===h.Cache.rooms[t.target_rid]?"":h.Cache.rooms[t.target_rid].name),this.__sendPic({type:"chatroom",target_id:t.target_rid,target_name:t.target_rname,file:t.image,extras:t.extras,msg_body:t.msg_body})},f.prototype.sendChatroomFile=function(t){return this.__checkLogin(),t.target_rname||(t.target_rname=void 0===h.Cache.rooms[t.target_rid]?"":h.Cache.rooms[t.target_rid].name),this.__sendFile({type:"chatroom",target_id:t.target_rid,target_name:t.target_rname,file:t.file,extras:t.extras,msg_body:t.msg_body})},f.prototype.sendChatroomCustom=function(t){return this.__checkLogin(),t.target_rname||(t.target_rname=void 0===h.Cache.rooms[t.target_rid]?"":h.Cache.rooms[t.target_rid].name),this.__sendCustom({type:"chatroom",target_id:t.target_rid,target_name:t.target_rname,custom:t.custom,extras:t.extras,msg_body:t.msg_body})},f.prototype.sendChatroomLocation=function(t){return this.__checkLogin(),t.target_rname||(t.target_rname=void 0===h.Cache.rooms[t.target_rid]?"":h.Cache.rooms[t.target_rid].name),this.__sendLocation({type:"chatroom",target_id:t.target_rid,target_name:t.target_rname,latitude:t.latitude,longitude:t.longitude,scale:t.scale,label:t.label,extras:t.extras,msg_body:t.msg_body})},f.prototype.addGroupMemSilence=function(t){return this.__checkLogin(),t.keep_silence=!0,new a(this.channel).setEvent(s.EVENTS.GROUP_MEM_SILENCE).setData(t).send()},f.prototype.delGroupMemSilence=function(t){return this.__checkLogin(),t.keep_silence=!1,new a(this.channel).setEvent(s.EVENTS.GROUP_MEM_SILENCE).setData(t).send()},f.prototype.isInit=function(){return!!this.current_appkey},f.prototype.isLogin=function(){return!!this.current_user},f.prototype.isConnect=function(){return!!this.channel.client.connected},f.prototype._addEventListen=function(){var t=this;t.channel.client.on(s.EVENTS.MSG_SYNC,(function(e){t._onMsgReceive(e)})),t.channel.client.on(s.EVENTS.EVENT_NOTIFICATION,(function(e){t._onEventNotification(e)})),t.channel.client.on(s.EVENTS.SYNC_CONVERSATION,(function(e){t._onSyncConversation(e)})),t.channel.client.on(s.EVENTS.SYNC_EVENT,(function(e){t._onSyncEvent(e)})),t.channel.client.on(s.EVENTS.SYNC_RECEIPT,(function(e){t._onSyncMsgReceipt(e)})),t.channel.client.on(s.EVENTS.RECEIPT_CHANGE,(function(e){t._onMsgReceiptChange(e)})),t.channel.client.on(s.EVENTS.TRANS_MSG_REC,(function(e){t._onTransMsgRec(e)})),t.channel.client.on(s.EVENTS.ROOM_MSG_SYNC,(function(e){t._onRoomMsg(e)})),t.channel.client.on(s.EVENTS.ROOM_MSG_SYNC_HIS,(function(e){t._onSyncRoomMsg(e)})),t.channel.client.on("disconnect",(function(){t._onDisconnect()}))},f.prototype.onRoomMsg=function(t){this._onRoomMsgFn=t},f.prototype._onRoomMsg=function(t){this._onRoomMsgFn&&this._onRoomMsgFn(t)},f.prototype._onSyncRoomMsg=function(t){var e=this;t.messages.forEach((function(n){h.Cache.rooms[n.room_id]||e.getChatroomInfo({id:t.room_id}),n.msgs&&n.msgs.forEach((function(t){e._onRoomMsgFn&&e._onRoomMsgFn(t)}))}))},f.prototype.onMsgReceive=function(t){this._onMsgReceiveFn=t},f.prototype._onMsgReceive=function(t){var e=[],n=this;Array.prototype.push.apply(e,t.messages.map((function(t){return{msg_id:t.msg_id,msg_type:t.msg_type,from_uid:t.from_uid,from_gid:t.from_gid}}))),t.messages.forEach((function(t){if(t.content.sui_mtime&&n[t.from_uid]&&t.content.sui_mtime>new Date(n[t.from_uid]).getTime()/1e3){n[t.from_uid]=1e3*t.content.sui_mtime;var e={};e.from_username=t.content.from_id,e.from_appkey=t.content.from_appkey,e.mtime=t.content.sui_mtime,delete t.content.sui_mtime,n._updateInfoEventFun&&n._updateInfoEventFun(e)}var o;3===t.msg_type?(t.key=t.from_uid,t.from_username=t.content.from_id,t.from_appkey=t.content.from_appkey,o=t.from_appkey+t.from_username):(t.key=t.from_gid,o=String(t.from_gid)),0===t.msg_level?t.msg_level="normal":1===t.msg_level&&(t.msg_level="across");var r=!1;if(t.from_appkey===n.current_appkey&&t.from_username===n.current_user){r=!0;var i=void 0===t.content.target_appkey||""===t.content.target_appkey?t.content.from_appkey:t.content.target_appkey;o=i+t.content.target_id}n.lastMsgs[o]={last_msg_time:t.ctime_ms},n.conversations[o]||(n.conversations[o]={},n.conversations[o].extras={},n.conversations[o].unread_msg_count=0,n.conversations[o].msg_time=[]),n.current_conversation===o||r?(n.conversations[o].recent_time=t.ctime_ms,n.conversations[o].unread_msg_count=0,n.conversations[o].msg_time=[]):(n.conversations[o].unread_msg_count=n.conversations[o].unread_msg_count+1,n.conversations[o].msg_time.push(t.ctime_ms)),new a(n.channel).setEvent(s.EVENTS.MSG_RECV_V2).setData({msg_id:t.msg_id,msg_type:t.msg_type,from_uid:t.from_uid,from_gid:t.from_gid}).send()})),h.StorageUtils.addItem(n.channel.conversations_key,JSON.stringify(n.conversations)),this._onMsgReceiveFn&&this._onMsgReceiveFn(t)},f.prototype.onEventNotification=function(t){this._onEventNotificationFn=t},f.prototype._onEventNotification=function(t){var e=this;if(200===t.event_type)return void(3===t.description.type?e._dealMutlReadEvent(t.description.type,t.ctime_ms,t.description.appkey,t.description.username):e._dealMutlReadEvent(t.description.type,t.ctime_ms,t.description.gid));var n=e.__eventDateFilter(t);if(56===t.event_type&&10==t.extra?(n.by_self=!1,delete n.extra):56===t.event_type&&59==t.extra&&(n.by_self=!0,delete n.extra),1===t.event_type){var o={event_id:t.event_id,event_type:t.event_type,from_uid:t.from_uid,gid:t.gid};new a(e.channel).setEvent(s.EVENTS.EVENT_NOTIFICATION).setData(o).send()}e._onEventNotificationFn&&e._onEventNotificationFn(n),s.LOGIN_OUT_EVENT.indexOf(t.event_type)!=-1&&e.loginOut()},f.prototype.onSyncConversation=function(t){this._onSyncConversationFn=t},f.prototype._onSyncConversation=function(t){var e=this;e.channel.sync_key=t.sync_key,t.messages&&(t.messages.forEach((function(t){var n,o=0;n=3===t.msg_type?t.from_appkey+t.from_username:String(t.from_gid);var r=t.msgs[t.msgs.length-1].ctime_ms;if(e.current_conversation===n)e.conversations[n]=void 0===e.conversations[n]?{}:e.conversations[n],e.conversations[n].unread_msg_count=o,e.conversations[n].recent_time=r,e.conversations[n].msg_time=[];else if(e.conversations[n]&&e.conversations[n].recent_time){var i=e.conversations[n].recent_time;t.msgs.forEach((function(t){t.ctime_ms<=i||t.content.from_appkey===e.current_appkey&&t.content.from_id===e.current_user?(o=0,e.conversations[n].msg_time=[]):(o++,e.conversations[n].msg_time.push(t.ctime_ms))})),e.channel.sync_type===s.SYNC_TYPE_OPEN?e.conversations[n].unread_msg_count=o:e.conversations[n].unread_msg_count+=o}else o=t.unsync_count,e.conversations[n]=void 0===e.conversations[n]?{}:e.conversations[n],e.conversations[n].unread_msg_count=o,t.msgs.length-1-o<0?e.conversations[n].recent_time=-1:e.conversations[n].recent_time=t.msgs[t.msgs.length-1-o].ctime_ms,e.conversations[n].msg_time=[];e.lastMsgs[n]={last_msg_time:r},delete t.unsync_count,t.unread_msg_count=e.conversations[n].unread_msg_count})),h.StorageUtils.addItem(e.channel.conversations_key,JSON.stringify(e.conversations)),e._onSyncConversationFn&&t.messages.length>0&&e._onSyncConversationFn(t.messages));var n={sync_key:e.channel.sync_key};new a(e.channel).setEvent(s.EVENTS.SYNC_CONVERSATION_ACK).setData(n).send()},f.prototype.onSyncEvent=function(t){this._onSyncEventFn=t},f.prototype._onSyncEvent=function(t){var e=this;e.channel.sync_event_key=t.sync_key,h.StorageUtils.addItem(e.channel.event_key,t.sync_key);var n={sync_key:e.channel.sync_event_key};new a(e.channel).setEvent(s.EVENTS.SYNC_EVENT_ACK).setData(n).send(),setTimeout((function(){if(e._onSyncEventFn&&t.events&&t.events.length>0){var n=[];t.events.forEach((function(o){if(200===o.event_type)3===o.description.type?e._dealMutlReadEvent(o.description.type,o.ctime_ms,o.description.appkey,o.description.username):e._dealMutlReadEvent(o.description.type,o.ctime_ms,o.description.gid);else{var r=e.__eventDateFilter(o);56===t.event_type&&10==t.extra?(delete r.extra,r.by_self=!1):56===t.event_type&&59==t.extra&&(delete r.extra,r.by_self=!0),n.push(r)}})),e._onSyncEventFn(n)}}),1700)},f.prototype.onSyncMsgReceipt=function(t){this._onSyncMsgReceiptFn=t},f.prototype._onSyncMsgReceipt=function(t){var e=this;if(e.channel.msg_receipt_key=t.sync_key,e._onSyncMsgReceiptFn&&t.receipts&&t.receipts.length>0){var n={},o=[];t.receipts.forEach((function(t){var e=t.gid;if(3===t.type&&(e=t.appkey+t.username),n[e]){var r=Number(n[e]);Array.prototype.push.apply(o[r].receipt_msgs,t.receipt_msgs)}else t.receipt_msgs.length>0&&(n[e]=String(o.length),o.push(t));
})),setTimeout((function(){e._onSyncMsgReceiptFn&&o.length>0&&e._onSyncMsgReceiptFn(o)}),1500)}var r={sync_key:e.channel.msg_receipt_key};new a(e.channel).setEvent(s.EVENTS.SYNC_RECEIPT_ACK).setData(r).send()},f.prototype.onMsgReceiptChange=function(t){this._onMsgReceiptChangeFn=t},f.prototype._onMsgReceiptChange=function(t){this._onMsgReceiptChangeFn&&this._onMsgReceiptChangeFn(t)},f.prototype.onUserInfUpdate=function(t){this._updateInfoEventFun=t},f.prototype.onMutiUnreadMsgUpdate=function(t){this._conversationUpdateFun=t},f.prototype.onTransMsgRec=function(t){this._onTransMsgRecFn=t},f.prototype._onTransMsgRec=function(t){this._onTransMsgRecFn&&this._onTransMsgRecFn(t)},f.prototype.onDisconnect=function(t){this._onDisconnectFn=t},f.prototype._onDisconnect=function(){var t=this;clearTimeout(t.syncTask),clearTimeout(t.msgReceipTask),t.autoDiscon&&(t.current_appkey=null,t.current_user=null,t._onDisconnectFn&&t._onDisconnectFn())},f.prototype._dealMutlReadEvent=function(t,e,n,o){var r,i=this,s={};if(s.type=t,3===t?(r=n+o,s.username=o,s.appkey=n):(r=String(n),s.gid=n),i.conversations[r]=void 0===i.conversations[r]?{msg_time:[],unread_msg_count:0}:i.conversations[r],i.conversations[r].recent_time=e,i.current_conversation===r)i.conversations[r].unread_msg_count=0,i.conversations[r].msg_time=[];else{var a=i.conversations[r].unread_msg_count,c=i.conversations[r].msg_time,u=[],p=0;c.forEach((function(t){t>e&&(p++,u.push(t))})),i.conversations[r].msg_time=u,p<a&&(i.conversations[r].unread_msg_count=p,s.unreadCount=p,h.StorageUtils.addItem(i.channel.conversations_key,JSON.stringify(i.conversations)),i._conversationUpdateFun&&i._conversationUpdateFun(s))}},f.prototype._receiptReport=function(){var t=this;if(t.report.length>0){var e={},n=[];t.report.forEach((function(t){if(e[t.args.key]){var o=Number(e[t.args.key]);Array.prototype.push.apply(n[o].result.msg_ids,t.args.msg_ids),n[o].msg_reports.push(t)}else e[t.args.key]=String(n.length),n.push({result:t.args,msg_reports:[t]})})),t.report=[];for(var o=0;o<n.length;o++)n[o].result.msg_ids=h.ArrayUtils.delRepeatItem(n[o].result.msg_ids),delete n[o].result.key,t._msgReceipt(n[o])}},f.prototype._msgReceipt=function(t){new a(this.channel).setEvent(s.EVENTS.RECEIPT_REPORT).setData({sessions:[t.result]}).send().onSuccess((function(e){t.msg_reports.forEach((function(t){t.success&&t.success(e,t.args.msg_ids)}))})).onFail((function(e){t.msg_reports.forEach((function(t){t.fail&&t.fail(e,t.args.msg_ids)}))})).onAck((function(e){t.msg_reports.forEach((function(t){t.ack&&t.ack(e,t.args.msg_ids)}))})).onTimeout((function(e){t.msg_reports.forEach((function(t){t.timeout&&t.timeout(e,t.args.msg_ids)}))}))},f.prototype.__eventDateFilter=function(t){var e={};return e.event_id=t.event_id,e.event_type=t.event_type,e.from_username=t.from_username,e.gid=t.gid,e.to_usernames=t.to_usernames,e.ctime=t.ctime,e.extra=t.extra,e.return_code=t.return_code,e.from_appkey=t.from_appkey,e.msg_ids=t.msg_ids,e.from_gid=t.from_gid,e.msgid_list=t.msgid_list,e.to_groups=t.to_groups,e.new_owner=t.new_owner,e.group_name=t.group_name,e.ctime_ms=t.ctime_ms,e.media_id=t.media_id,e.from_nickname=t.from_nickname,100===t.event_type&&7===t.extra?e.description=JSON.parse(t.description):e.description=t.description,55===t.event_type&&0===t.from_gid?e.type=0:55===t.event_type&&0!=t.from_gid&&(e.type=1),e},f.prototype.__checkConnect=function(){if(!this.channel.client.connected)throw new Error("wss socket not connect")},f.prototype.__checkInit=function(){if(!this.current_appkey)throw new Error("must init first")},f.prototype.__checkLogin=function(){if(!this.current_user)throw new Error("must login first")},f.prototype.__getUploadToken=function(){return this.__checkLogin(),new a(this.channel).setEvent(s.EVENTS.GET_UPLOAD_TOKEN).setData({}).send()},f.prototype.__uploadFile0=function(t,e){var n=this,o=new XMLHttpRequest;o.open("POST",n.opts.upload_file+"?type="+t.type),o.setRequestHeader("X-App-Key",t.appkey),o.setRequestHeader("jm-channel",s.PLAT_CHANNEL),o.setRequestHeader("Authorization","Basic "+r.btoa(t.username+":"+t.token)),o.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var t=JSON.parse(this.responseText);e(null,t)}else try{var n=JSON.parse(this.responseText);e(898061===n.error.code?{code:880210,message:"file size exceed limit"}:n)}catch(t){e({code:880210,message:"file size exceed the limit"})}},o.send(t.file)},f.prototype.__uploadFile=function(t,e){var n=this;o((function(t){n.__getUploadToken().onSuccess((function(e){t(null,e.uptoken)})).onFail((function(e){t(e)})).onTimeout((function(t){e({is_timeout:!0,data:t})}))})).then((function(e,o){n.__uploadFile0({type:t.type,file:t.file,appkey:t.appkey,username:t.username,token:o},e)})).then((function(t,n){e(null,n)})).fail((function(t,n){e({data:n})}))},f.prototype.__sendMsg=function(t){return this.__checkLogin(),new a(this.channel).setEvent("single"===t.type?s.EVENTS.S_SINGLE_TEXT:"group"===t.type?s.EVENTS.SEND_GROUP_MSG:s.EVENTS.SEND_ROOM_MSG).setData(new u(this.current_user,this.current_appkey).setType(t.type).setAppkey(t.appkey).setNeedReceipt(t.need_receipt).setTarget(t.target_id,t.target_name).setText(t.content?t.content:t.msg_body.text,t.content?t.extras:t.msg_body.extras).setAtList(t.at_list).setNoOffline(t.no_offline===!0).setNoNotification(t.no_notification===!0).setCustomNotification(t.custom_notification).build()).send()},f.prototype.__sendPic=function(t){this.__checkLogin();var e=new a(this.channel).setEvent("single"===t.type?s.EVENTS.S_SINGLE_TEXT:"group"===t.type?s.EVENTS.SEND_GROUP_MSG:s.EVENTS.SEND_ROOM_MSG),n=this,o=new u(n.current_user,n.current_appkey).setType(t.type).setAppkey(t.appkey).setNeedReceipt(t.need_receipt).setTarget(t.target_id,t.target_name).setNoOffline(t.no_offline===!0).setNoNotification(t.no_notification===!0).setCustomNotification(t.custom_notification);return t.file?this.__uploadFile({appkey:n.current_appkey,username:n.current_user,file:t.file,type:"image"},(function(n,r){return n?n.is_timeout?e.timeout&&e.timeout(n.data):e.fail&&e.fail(n.data):void e.setData(o.setImage(r,t.extras).build()).send()})):e.setData(o.setImage(t.msg_body,t.msg_body.extras).build()).send(),e},f.prototype.__sendFile=function(t){this.__checkLogin();var e=new a(this.channel).setEvent("single"===t.type?s.EVENTS.S_SINGLE_TEXT:"group"===t.type?s.EVENTS.SEND_GROUP_MSG:s.EVENTS.SEND_ROOM_MSG),n=this,o=new u(n.current_user,n.current_appkey).setType(t.type).setAppkey(t.appkey).setNeedReceipt(t.need_receipt).setTarget(t.target_id,t.target_name).setNoOffline(t.no_offline===!0).setNoNotification(t.no_notification===!0).setCustomNotification(t.custom_notification);return t.file?this.__uploadFile({appkey:n.current_appkey,username:n.current_user,file:t.file,type:"file"},(function(n,r){return n?n.is_timeout?e.timeout&&e.timeout(n.data):e.fail&&e.fail(n.data):void e.setData(o.setFile(r,t.extras).build()).send()})):e.setData(o.setFile(t.msg_body,t.msg_body.extras).build()).send(),e},f.prototype.__sendLocation=function(t){return this.__checkLogin(),new a(this.channel).setEvent("single"===t.type?s.EVENTS.S_SINGLE_TEXT:"group"===t.type?s.EVENTS.SEND_GROUP_MSG:s.EVENTS.SEND_ROOM_MSG).setData(new u(this.current_user,this.current_appkey).setType(t.type).setAppkey(t.appkey).setNeedReceipt(t.need_receipt).setTarget(t.target_id,t.target_name).setLocation(t.latitude?t:t.msg_body,t.latitude?t.extras:t.msg_body.extras).setNoOffline(t.no_offline===!0).setNoNotification(t.no_notification===!0).setCustomNotification(t.custom_notification).build()).send()},f.prototype.__sendCustom=function(t){return this.__checkLogin(),new a(this.channel).setEvent("single"===t.type?s.EVENTS.S_SINGLE_TEXT:"group"===t.type?s.EVENTS.SEND_GROUP_MSG:s.EVENTS.SEND_ROOM_MSG).setData(new u(this.current_user,this.current_appkey).setType(t.type).setAppkey(t.appkey).setNeedReceipt(t.need_receipt).setTarget(t.target_id,t.target_name).setCustom(t.custom?t.custom:t.msg_body,t.custom?t.extras:t.msg_body.extras).setNoOffline(t.no_offline===!0).setNoNotification(t.no_notification===!0).setCustomNotification(t.custom_notification).build()).send()},t.exports=f}),(function(t,e){"use strict";t.exports=function(){function t(t,e){var n=(65535&t)+(65535&e),o=(t>>16)+(e>>16)+(n>>16);return o<<16|65535&n}function e(t,e){return t<<e|t>>>32-e}function n(n,o,r,i,s,a){return t(e(t(t(o,n),t(i,a)),s),r)}function o(t,e,o,r,i,s,a){return n(e&o|~e&r,t,e,i,s,a)}function r(t,e,o,r,i,s,a){return n(e&r|o&~r,t,e,i,s,a)}function i(t,e,o,r,i,s,a){return n(e^o^r,t,e,i,s,a)}function s(t,e,o,r,i,s,a){return n(o^(e|~r),t,e,i,s,a)}function a(e,n){e[n>>5]|=128<<n%32,e[(n+64>>>9<<4)+14]=n;var a,c,u,p,h,f=1732584193,l=-271733879,d=-1732584194,_=271733878;for(a=0;a<e.length;a+=16)c=f,u=l,p=d,h=_,f=o(f,l,d,_,e[a],7,-680876936),_=o(_,f,l,d,e[a+1],12,-389564586),d=o(d,_,f,l,e[a+2],17,606105819),l=o(l,d,_,f,e[a+3],22,-1044525330),f=o(f,l,d,_,e[a+4],7,-176418897),_=o(_,f,l,d,e[a+5],12,1200080426),d=o(d,_,f,l,e[a+6],17,-1473231341),l=o(l,d,_,f,e[a+7],22,-45705983),f=o(f,l,d,_,e[a+8],7,1770035416),_=o(_,f,l,d,e[a+9],12,-1958414417),d=o(d,_,f,l,e[a+10],17,-42063),l=o(l,d,_,f,e[a+11],22,-1990404162),f=o(f,l,d,_,e[a+12],7,1804603682),_=o(_,f,l,d,e[a+13],12,-40341101),d=o(d,_,f,l,e[a+14],17,-1502002290),l=o(l,d,_,f,e[a+15],22,1236535329),f=r(f,l,d,_,e[a+1],5,-165796510),_=r(_,f,l,d,e[a+6],9,-1069501632),d=r(d,_,f,l,e[a+11],14,643717713),l=r(l,d,_,f,e[a],20,-373897302),f=r(f,l,d,_,e[a+5],5,-701558691),_=r(_,f,l,d,e[a+10],9,38016083),d=r(d,_,f,l,e[a+15],14,-660478335),l=r(l,d,_,f,e[a+4],20,-405537848),f=r(f,l,d,_,e[a+9],5,568446438),_=r(_,f,l,d,e[a+14],9,-1019803690),d=r(d,_,f,l,e[a+3],14,-187363961),l=r(l,d,_,f,e[a+8],20,1163531501),f=r(f,l,d,_,e[a+13],5,-1444681467),_=r(_,f,l,d,e[a+2],9,-51403784),d=r(d,_,f,l,e[a+7],14,1735328473),l=r(l,d,_,f,e[a+12],20,-1926607734),f=i(f,l,d,_,e[a+5],4,-378558),_=i(_,f,l,d,e[a+8],11,-2022574463),d=i(d,_,f,l,e[a+11],16,1839030562),l=i(l,d,_,f,e[a+14],23,-35309556),f=i(f,l,d,_,e[a+1],4,-1530992060),_=i(_,f,l,d,e[a+4],11,1272893353),d=i(d,_,f,l,e[a+7],16,-155497632),l=i(l,d,_,f,e[a+10],23,-1094730640),f=i(f,l,d,_,e[a+13],4,681279174),_=i(_,f,l,d,e[a],11,-358537222),d=i(d,_,f,l,e[a+3],16,-722521979),l=i(l,d,_,f,e[a+6],23,76029189),f=i(f,l,d,_,e[a+9],4,-640364487),_=i(_,f,l,d,e[a+12],11,-421815835),d=i(d,_,f,l,e[a+15],16,530742520),l=i(l,d,_,f,e[a+2],23,-995338651),f=s(f,l,d,_,e[a],6,-198630844),_=s(_,f,l,d,e[a+7],10,1126891415),d=s(d,_,f,l,e[a+14],15,-1416354905),l=s(l,d,_,f,e[a+5],21,-57434055),f=s(f,l,d,_,e[a+12],6,1700485571),_=s(_,f,l,d,e[a+3],10,-1894986606),d=s(d,_,f,l,e[a+10],15,-1051523),l=s(l,d,_,f,e[a+1],21,-2054922799),f=s(f,l,d,_,e[a+8],6,1873313359),_=s(_,f,l,d,e[a+15],10,-30611744),d=s(d,_,f,l,e[a+6],15,-1560198380),l=s(l,d,_,f,e[a+13],21,1309151649),f=s(f,l,d,_,e[a+4],6,-145523070),_=s(_,f,l,d,e[a+11],10,-1120210379),d=s(d,_,f,l,e[a+2],15,718787259),l=s(l,d,_,f,e[a+9],21,-343485551),f=t(f,c),l=t(l,u),d=t(d,p),_=t(_,h);return[f,l,d,_]}function c(t){var e,n="";for(e=0;e<32*t.length;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function u(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;for(e=0;e<8*t.length;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function p(t){return c(a(u(t),8*t.length))}function h(t,e){var n,o,r=u(t),i=[],s=[];for(i[15]=s[15]=void 0,r.length>16&&(r=a(r,8*t.length)),n=0;n<16;n+=1)i[n]=909522486^r[n],s[n]=1549556828^r[n];return o=a(i.concat(u(e)),512+8*e.length),c(a(s.concat(o),640))}function f(t){var e,n,o="0123456789abcdef",r="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),r+=o.charAt(e>>>4&15)+o.charAt(15&e);return r}function l(t){return unescape(encodeURIComponent(t))}function d(t){return p(l(t))}function _(t){return f(d(t))}function y(t,e){return h(l(t),l(e))}function g(t,e){return f(y(t,e))}function m(t,e,n){return e?n?y(e,t):g(e,t):n?d(t):_(t)}return m}}),(function(t,e,n){var o=n(6),r=function(t){this.channel=t,this.rid=this.channel.generateRid(),this.times=1};r.prototype.setEvent=function(t){return this.event=t,this},r.prototype.setData=function(t){return this.data=t,this},r.prototype.onSuccess=function(t){return"function"==typeof t&&(this.success=t),this},r.prototype.onFail=function(t){return"function"==typeof t&&(this.fail=t),this},r.prototype.onTimeout=function(t){if("function"==typeof t){this.timeout=t;var e=this;this.respTimeoutTaskId=setTimeout((function(){e.respTimeoutTask()}),o.RESP_TIMEOUT)}return this},r.prototype.onAck=function(t){return"function"==typeof t&&(this.ack=t),this},r.prototype.onInnerCall=function(t){return"function"==typeof t&&(this.innerCall=t),this},r.prototype.onUserInfoGet=function(t){return"function"==typeof t&&(this.userInfoGet=t),this},r.prototype.addHook=function(t){return"function"==typeof t&&(this.hook=t),this},r.prototype.ackTimeoutTask=function(){if(this.times<o.RETRY_TIMES){this.channel.send(this.event,this._data),this.times++;var t=this;this.ackTimeoutTaskId=setTimeout((function(){t.ackTimeoutTask()}),o.ACK_TIMEOUT)}else this.timeout&&this.timeout({rid:this.rid,data:this.data,response_timeout:!1}),delete this.channel.dataCache[this.rid];return this},r.prototype.respTimeoutTask=function(){if(this.times<o.RETRY_TIMES){this.channel.send(this.event,this._data),this.times++;var t=this;this.respTimeoutTaskId=setTimeout((function(){t.respTimeoutTask()}),o.RESP_TIMEOUT)}else this.timeout&&this.timeout({rid:this.rid,data:this.data,response_timeout:!0}),delete this.channel.dataCache[this.rid];return this},r.prototype.cleanAckTimeout=function(){return this.ackTimeoutTaskId&&clearTimeout(this.ackTimeoutTaskId),this},r.prototype.cleanRespTimeout=function(){return this.respTimeoutTaskId&&clearTimeout(this.respTimeoutTaskId),this},r.prototype.send=function(){if(!this.event||!this.data)return void console.error("send fail，event and data can not empty");var t=this;return this.ackTimeoutTaskId=setTimeout((function(){t.ackTimeoutTask()}),o.ACK_TIMEOUT),this._data=JSON.parse(JSON.stringify(this.data)),this._data.rid=this.rid,this.channel.send(this.event,this._data),this.channel.dataCache[this.rid]=this,this},t.exports=r}),(function(t,e){var n=function(t,e){this.current_user=t,this.current_appkey=e,this.version=1,this.from_platform="web"};n.prototype.setNeedReceipt=function(t){return this.need_receipt=t,this},n.prototype.setNoOffline=function(t){return this.no_offline=t,this},n.prototype.setNoNotification=function(t){return this.no_notification=t,this},n.prototype.setType=function(t){return this.type=t,this},n.prototype.setAtList=function(t){return this.at_list=t,this},n.prototype.setAppkey=function(t){return t&&(this.appkey=t),this},n.prototype.setTarget=function(t,e){return this.target_id=t.toString(),this.target_name=e,this},n.prototype.setFromName=function(t){return this.from_name=t,this},n.prototype.setText=function(t,e){return this.msg_type="text",this.msg_body={text:t},e&&(this.msg_body.extras=e),this},n.prototype.setImage=function(t,e){return this.msg_type="image",this.msg_body={media_id:t.media_id,media_crc32:t.media_crc32,width:t.width,height:t.height,format:t.format,fsize:t.fsize},e&&(this.msg_body.extras=e),this},n.prototype.setFile=function(t,e){return this.msg_type="file",this.msg_body={media_id:t.media_id,media_crc32:t.media_crc32,hash:t.hash,fsize:t.fsize,fname:t.fname},e&&(this.msg_body.extras=e),this},n.prototype.setCustomNotification=function(t){return t&&(this.custom_notification=t),this},n.prototype.setLocation=function(t,e){return this.msg_type="location",this.msg_body={latitude:t.latitude,longitude:t.longitude,scale:t.scale,label:t.label},e&&(this.msg_body.extras=e),this},n.prototype.setCustom=function(t,e){return this.msg_type="custom",this.msg_body=t,e&&(this.msg_body.extras=e),this},n.prototype.build=function(){var t=this.current_user;if("single"!=this.type&&"group"!=this.type&&"across_single"!=this.type&&"chatroom"!=this.type)return console.log("type must be single or group or chatroom");if(!this.target_id)return console.error("target_id must not null");if("text"==this.msg_type){if(!this.msg_body.text&&this.at_list&&"single"!=this.type)this.msg_body.text=" ";else if(!this.msg_body.text&&!this.at_list)return console.error("未设置文本消息内容")}else if("custom"==this.msg_type){if(!this.msg_body)return console.error("custom对象不能为空")}else if("image"==this.msg_type){if(!this.msg_body.media_id)return console.error("未设置image消息media_id字段");if(!this.msg_body.media_crc32)return console.error("未设置image消息media_crc32字段");if(!this.msg_body.width)return console.error("未设置image消息width字段");if(!this.msg_body.height)return console.error("未设置image消息height字段")}else if("file"==this.msg_type){if(!this.msg_body.media_id)return console.error("未设置file消息media_id字段");if(!this.msg_body.media_crc32)return console.error("未设置file消息media_crc32字段");if(!this.msg_body.fsize)return console.error("未设置file消息fsize字段");if(!this.msg_body.fname)return console.error("未设置file消息fname字段")}else{if("location"!=this.msg_type)return console.error("请设置合法的msg_type");if(!this.msg_body.latitude)return console.error("未设置location消息latitude字段");if(!this.msg_body.longitude)return console.error("未设置location消息longitude字段");if(!this.msg_body.scale)return console.error("未设置location消息scale字段");if(!this.msg_body.label)return console.error("未设置location消息label字段")}var e={version:this.version,target_type:this.type,from_platform:this.from_platform,target_id:this.target_id,target_name:this.target_name,from_id:t,from_name:this.from_name,create_time:(new Date).getTime(),msg_type:this.msg_type,msg_body:this.msg_body};this.appkey&&(e.target_appkey=this.appkey,e.from_appkey=this.current_appkey);var n={content:e};if(n.no_offline=this.no_offline,n.no_notification=this.no_notification,n.custom_notification=this.custom_notification,n.target_name=e.target_name,n.need_receipt=this.need_receipt,"single"==e.target_type)n.target_id=e.target_id;else if(n.target_gid=e.target_id,this.at_list&&this.at_list instanceof Array)n.users=this.at_list;else if(this.at_list&&!(this.at_list instanceof Array))return console.error("参数值不合法，at_list必须为数组类型");return this.appkey?n.appkey=this.appkey:n.appkey=this.current_appkey,n},t.exports=n}),(function(t,e){var n=function(t){this.args=t};n.prototype.onSuccess=function(t){return"function"==typeof t&&(this.success=t),this},n.prototype.onFail=function(t){return"function"==typeof t&&(this.fail=t),this},n.prototype.onTimeout=function(t){return"function"==typeof t&&(this.timeout=t),this},n.prototype.onAck=function(t){return"function"==typeof t&&(this.ack=t),this},t.exports=n}),(function(t,e){"use strict";var n={};n.isBlack=function(t){return!(t&&"string"==typeof t&&t.length>0)};var o={};o.addItem=function(t,e){window.localStorage&&localStorage.setItem(t,e)},o.removeItems=function(t){if(window.localStorage){for(var e=localStorage.length,n=[],o=0;o<e;o++)localStorage.getItem(localStorage.key(o))===t&&n.push(localStorage.key(o));n.forEach((function(t){localStorage.removeItem(t)}))}},o.getItem=function(t){return window.localStorage?localStorage.getItem(t):null};var r={};r.delRepeatItem=function(t){var e=[];return t.forEach((function(t){e.indexOf(t)===-1&&null!=t&&e.push(t)})),e};var i={};i.rooms={},t.exports={StringUtils:n,StorageUtils:o,ArrayUtils:r,Cache:i}}),(function(t,e,n){!(function(){function t(t){this.message=t}var n=e,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=new Error,t.prototype.name="InvalidCharacterError",n.btoa||(n.btoa=function(e){for(var n,r,i=String(e),s=0,a=o,c="";i.charAt(0|s)||(a="=",s%1);c+=a.charAt(63&n>>8-s%1*8)){if(r=i.charCodeAt(s+=.75),r>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");n=n<<8|r}return c}),n.atob||(n.atob=function(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,i,s=0,a=0,c="";i=n.charAt(a++);~i&&(r=s%4?64*r+i:i,s++%4)?c+=String.fromCharCode(255&r>>(-2*s&6)):0)i=o.indexOf(i);return c})})()}),(function(t,e){function n(t,e,n){function r(t,o){if(r.count<=0)throw new Error("after called too many times");--r.count,t?(i=!0,e(t),e=n):0!==r.count||i||e(null,o)}var i=!1;return n=n||o,r.count=t,0===t?e():r}function o(){}t.exports=n}),(function(t,e){t.exports=function(t,e,n){var o=t.byteLength;if(e=e||0,n=n||o,t.slice)return t.slice(e,n);if(e<0&&(e+=o),n<0&&(n+=o),n>o&&(n=o),e>=o||e>=n||0===o)return new ArrayBuffer(0);for(var r=new Uint8Array(t),i=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)i[a]=r[s];return i.buffer}}),(function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}}),(function(t,e){!(function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),o=0;o<t.length;o++)n[t.charCodeAt(o)]=o;e.encode=function(e){var n,o=new Uint8Array(e),r=o.length,i="";for(n=0;n<r;n+=3)i+=t[o[n]>>2],i+=t[(3&o[n])<<4|o[n+1]>>4],i+=t[(15&o[n+1])<<2|o[n+2]>>6],i+=t[63&o[n+2]];return r%3===2?i=i.substring(0,i.length-1)+"=":r%3===1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,o,r,i,s,a=.75*t.length,c=t.length,u=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var p=new ArrayBuffer(a),h=new Uint8Array(p);for(e=0;e<c;e+=4)o=n[t.charCodeAt(e)],r=n[t.charCodeAt(e+1)],i=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],h[u++]=o<<2|r>>4,h[u++]=(15&r)<<4|i>>2,h[u++]=(3&i)<<6|63&s;return p}})()}),(function(t,e){(function(e){function n(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.buffer instanceof ArrayBuffer){var o=n.buffer;if(n.byteLength!==o.byteLength){var r=new Uint8Array(n.byteLength);r.set(new Uint8Array(o,n.byteOffset,n.byteLength)),o=r.buffer}t[e]=o}}}function o(t,e){e=e||{};var o=new i;n(t);for(var r=0;r<t.length;r++)o.append(t[r]);return e.type?o.getBlob(e.type):o.getBlob()}function r(t,e){return n(t),new Blob(t,e||{})}var i=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,s=(function(){try{var t=new Blob(["hi"]);return 2===t.size}catch(t){return!1}})(),a=s&&(function(){try{var t=new Blob([new Uint8Array([1,2])]);return 2===t.size}catch(t){return!1}})(),c=i&&i.prototype.append&&i.prototype.getBlob;t.exports=(function(){return s?a?e.Blob:r:c?o:void 0})()}).call(e,(function(){return this})())}),(function(t,e,n){function o(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function r(){var t=arguments,n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return t;var o="color: "+this.color;t=[t[0],o,"color: inherit"].concat(Array.prototype.slice.call(t,1));var r=0,i=0;return t[0].replace(/%[a-z%]/g,(function(t){"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,o),t}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}}function a(){var t;try{t=e.storage.debug}catch(t){}return t}function c(){try{return window.localStorage}catch(t){}}e=t.exports=n(40),e.log=i,e.formatArgs=r,e.save=s,e.load=a,e.useColors=o,e.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){return JSON.stringify(t)},e.enable(a())}),(function(t,e,n){function o(){return e.colors[p++%e.colors.length]}function r(t){function n(){}function r(){var t=r,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=o());var s=Array.prototype.slice.call(arguments);s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,(function(n,o){if("%%"===n)return n;a++;var r=e.formatters[o];if("function"==typeof r){var i=s[a];n=r.call(t,i),s.splice(a,1),a--}return n})),"function"==typeof e.formatArgs&&(s=e.formatArgs.apply(t,s));var c=r.log||e.log||console.log.bind(console);c.apply(t,s)}n.enabled=!1,r.enabled=!0;var i=e.enabled(t)?r:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),o=n.length,r=0;r<o;r++)n[r]&&(t=n[r].replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,o;for(n=0,o=e.skips.length;n<o;n++)if(e.skips[n].test(t))return!1;for(n=0,o=e.names.length;n<o;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=r,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(52),e.names=[],e.skips=[],e.formatters={};var u,p=0}),(function(t,e,n){t.exports=n(42)}),(function(t,e,n){t.exports=n(43),t.exports.parser=n(2)}),(function(t,e,n){(function(e){function o(t,n){if(!(this instanceof o))return new o(t,n);n=n||{},t&&"object"==typeof t&&(n=t,t=null),t?(t=p(t),n.hostname=t.host,n.secure="https"===t.protocol||"wss"===t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=p(n.host).host),this.secure=null!=n.secure?n.secure:e.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(e.location?location.hostname:"localhost"),this.port=n.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=f.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized?null:n.rejectUnauthorized,this.forceNode=!!n.forceNode;var r="object"==typeof e&&e;r.global===r&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}function r(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i=n(14),s=n(1),a=n(4)("engine.io-client:socket"),c=n(17),u=n(2),p=n(19),h=n(53),f=n(9);t.exports=o,o.priorWebsocketSuccess=!1,s(o.prototype),o.protocol=u.protocol,o.Socket=o,o.Transport=n(7),o.transports=n(14),o.parser=n(2),o.prototype.createTransport=function(t){a('creating transport "%s"',t);var e=r(this.query);e.EIO=u.protocol,e.transport=t,this.id&&(e.sid=this.id);var n=new i[t]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress});return n},o.prototype.open=function(){var t;if(this.rememberUpgrade&&o.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},o.prototype.setTransport=function(t){a("setting transport %s",t.name);var e=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},o.prototype.probe=function(t){function e(){if(f.onlyBinaryUpgrades){var e=!this.supportsBinary&&f.transport.supportsBinary;h=h||e}h||(a('probe transport "%s" opened',t),p.send([{type:"ping",data:"probe"}]),p.once("packet",(function(e){if(!h)if("pong"===e.type&&"probe"===e.data){if(a('probe transport "%s" pong',t),f.upgrading=!0,f.emit("upgrading",p),!p)return;o.priorWebsocketSuccess="websocket"===p.name,a('pausing current transport "%s"',f.transport.name),f.transport.pause((function(){h||"closed"!==f.readyState&&(a("changing transport and sending upgrade packet"),u(),f.setTransport(p),p.send([{type:"upgrade"}]),f.emit("upgrade",p),p=null,f.upgrading=!1,f.flush())}))}else{a('probe transport "%s" failed',t);var n=new Error("probe error");n.transport=p.name,f.emit("upgradeError",n)}})))}function n(){h||(h=!0,u(),p.close(),p=null)}function r(e){var o=new Error("probe error: "+e);o.transport=p.name,n(),a('probe transport "%s" failed because of error: %s',t,e),f.emit("upgradeError",o)}function i(){r("transport closed")}function s(){r("socket closed")}function c(t){p&&t.name!==p.name&&(a('"%s" works - aborting "%s"',t.name,p.name),n())}function u(){p.removeListener("open",e),p.removeListener("error",r),p.removeListener("close",i),f.removeListener("close",s),f.removeListener("upgrading",c)}a('probing transport "%s"',t);var p=this.createTransport(t,{probe:1}),h=!1,f=this;o.priorWebsocketSuccess=!1,p.once("open",e),p.once("error",r),p.once("close",i),this.once("close",s),this.once("upgrading",c),p.open()},o.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",o.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},o.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(h(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else a('packet received with socket readyState "%s"',this.readyState)},o.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},o.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){
"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},o.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){a("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},o.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},o.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},o.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},o.prototype.write=o.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},o.prototype.sendPacket=function(t,e,n,o){if("function"==typeof e&&(o=e,e=void 0),"function"==typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){n=n||{},n.compress=!1!==n.compress;var r={type:t,data:e,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}},o.prototype.close=function(){function t(){o.onClose("forced close"),a("socket closing - telling transport to close"),o.transport.close()}function e(){o.removeListener("upgrade",e),o.removeListener("upgradeError",e),t()}function n(){o.once("upgrade",e),o.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var o=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():t()})):this.upgrading?n():t()}return this},o.prototype.onError=function(t){a("socket error %j",t),o.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},o.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),n.writeBuffer=[],n.prevBufferLen=0}},o.prototype.filterUpgrades=function(t){for(var e=[],n=0,o=t.length;n<o;n++)~c(this.transports,t[n])&&e.push(t[n]);return e}}).call(e,(function(){return this})())}),(function(t,e,n){(function(e){function o(){}function r(t){i.call(this,t),this.query=this.query||{},a||(e.___eio||(e.___eio=[]),a=e.___eio),this.index=a.length;var n=this;a.push((function(t){n.onData(t)})),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=o)}),!1)}var i=n(15),s=n(3);t.exports=r;var a,c=/\n/g,u=/\\n/g;s(r,i),r.prototype.supportsBinary=!1,r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},r.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e;var o="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);o&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},r.prototype.doWrite=function(t,e){function n(){o(),e()}function o(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+r.iframeId+'">';i=document.createElement(t)}catch(t){i=document.createElement("iframe"),i.name=r.iframeId,i.src="javascript:0"}i.id=r.iframeId,r.form.appendChild(i),r.iframe=i}var r=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),p=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=p,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),o(),t=t.replace(u,"\\\n"),this.area.value=t.replace(c,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&n()}:this.iframe.onload=n}}).call(e,(function(){return this})())}),(function(t,e,n){(function(e){function o(){}function r(t){if(c.call(this,t),this.requestTimeout=t.requestTimeout,e.location){var n="https:"===location.protocol,o=location.port;o||(o=n?443:80),this.xd=t.hostname!==e.location.hostname||o!==t.port,this.xs=t.secure!==n}else this.extraHeaders=t.extraHeaders}function i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function s(){for(var t in i.requests)i.requests.hasOwnProperty(t)&&i.requests[t].abort()}var a=n(8),c=n(15),u=n(1),p=n(3),h=n(4)("engine.io-client:polling-xhr");t.exports=r,t.exports.Request=i,p(r,c),r.prototype.supportsBinary=!0,r.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new i(t)},r.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,o=this.request({method:"POST",data:t,isBinary:n}),r=this;o.on("success",e),o.on("error",(function(t){r.onError("xhr post error",t)})),this.sendXhr=o},r.prototype.doPoll=function(){h("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},u(i.prototype),i.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new a(t),o=this;try{h("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck(!0);for(var r in this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.extraHeaders[r])}}catch(t){}if(this.supportsBinary&&(n.responseType="arraybuffer"),"POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{n.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){o.onLoad()},n.onerror=function(){o.onError(n.responseText)}):n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?o.onLoad():setTimeout((function(){o.onError(n.status)}),0))},h("xhr data %s",this.data),n.send(this.data)}catch(t){return void setTimeout((function(){o.onError(t)}),0)}e.document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},i.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},i.prototype.cleanup=function(t){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=o:this.xhr.onreadystatechange=o,t)try{this.xhr.abort()}catch(t){}e.document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(t){}if("application/octet-stream"===e)t=this.xhr.response||this.xhr.responseText;else if(this.supportsBinary)try{t=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(e){for(var n=new Uint8Array(this.xhr.response),o=[],r=0,i=n.length;r<i;r++)o.push(n[r]);t=String.fromCharCode.apply(null,o)}else t=this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},i.prototype.hasXDR=function(){return"undefined"!=typeof e.XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},i.requestsCount=0,i.requests={},e.document&&(e.attachEvent?e.attachEvent("onunload",s):e.addEventListener&&e.addEventListener("beforeunload",s,!1))}).call(e,(function(){return this})())}),(function(t,e,n){(function(e){function o(t){var e=t&&t.forceBase64;e&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=h&&!t.forceNode,this.usingBrowserWebSocket||(f=r),i.call(this,t)}var r,i=n(7),s=n(2),a=n(9),c=n(3),u=n(25),p=n(4)("engine.io-client:websocket"),h=e.WebSocket||e.MozWebSocket;if("undefined"==typeof window)try{r=n(64)}catch(t){}var f=h;f||"undefined"!=typeof window||(f=r),t.exports=o,c(o,i),o.prototype.name="websocket",o.prototype.supportsBinary=!0,o.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=void 0,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?new f(t):new f(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},o.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},o.prototype.write=function(t){function n(){o.emit("flush"),setTimeout((function(){o.writable=!0,o.emit("drain")}),0)}var o=this;this.writable=!1;for(var r=t.length,i=0,a=r;i<a;i++)!(function(t){s.encodePacket(t,o.supportsBinary,(function(i){if(!o.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),o.perMessageDeflate){var a="string"==typeof i?e.Buffer.byteLength(i):i.length;a<o.perMessageDeflate.threshold&&(s.compress=!1)}}try{o.usingBrowserWebSocket?o.ws.send(i):o.ws.send(i,s)}catch(t){p("websocket closed before onclose event")}--r||n()}))})(t[i])},o.prototype.onClose=function(){i.prototype.onClose.call(this)},o.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},o.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=u()),this.supportsBinary||(t.b64=1),t=a.encode(t),t.length&&(t="?"+t);var o=this.hostname.indexOf(":")!==-1;return e+"://"+(o?"["+this.hostname+"]":this.hostname)+n+this.path+t},o.prototype.check=function(){return!(!f||"__initialize"in f&&this.name===o.prototype.name)}}).call(e,(function(){return this})())}),(function(t,e,n){function o(){return e.colors[p++%e.colors.length]}function r(t){function n(){}function r(){var t=r,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=o());for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,(function(n,o){if("%%"===n)return n;c++;var r=e.formatters[o];if("function"==typeof r){var i=s[c];n=r.call(t,i),s.splice(c,1),c--}return n})),s=e.formatArgs.apply(t,s);var p=r.log||e.log||console.log.bind(console);p.apply(t,s)}n.enabled=!1,r.enabled=!0;var i=e.enabled(t)?r:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),o=n.length,r=0;r<o;r++)n[r]&&(t=n[r].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,o;for(n=0,o=e.skips.length;n<o;n++)if(e.skips[n].test(t))return!1;for(n=0,o=e.names.length;n<o;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=r.debug=r,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(48),e.names=[],e.skips=[],e.formatters={};var u,p=0}),(function(t,e){function n(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*p;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function o(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function r(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,p=365.25*u;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e.long?r(t):o(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}),(function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var o in t)n.call(t,o)&&e.push(o);return e}}),(function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}}),(function(t,e,n){var o;(function(t,r){(function(){function i(t,e){function n(t){if(n[t]!==y)return n[t];var i;if("bug-string-char-index"==t)i="a"!="a"[0];else if("json"==t)i=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var u=e.stringify,p="function"==typeof u&&v;if(p){(s=function(){return 1}).toJSON=s;try{p="0"===u(0)&&"0"===u(new o)&&'""'==u(new r)&&u(m)===y&&u(y)===y&&u()===y&&"1"===u(s)&&"[1]"==u([s])&&"[null]"==u([y])&&"null"==u(null)&&"[null,null,null]"==u([y,m,null])&&u({a:[s,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===u(null,s)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new c(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==u(new c(864e13))&&'"-000001-01-01T00:00:00.000Z"'==u(new c(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==u(new c(-1))}catch(t){p=!1}}i=p}if("json-parse"==t){var h=e.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){s=h(a);var f=5==s.a.length&&1===s.a[0];if(f){try{f=!h('"\t"')}catch(t){}if(f)try{f=1!==h("01")}catch(t){}if(f)try{f=1!==h("1.")}catch(t){}}}}catch(t){f=!1}i=f}}return n[t]=!!i}t||(t=u.Object()),e||(e=u.Object());var o=t.Number||u.Number,r=t.String||u.String,s=t.Object||u.Object,c=t.Date||u.Date,p=t.SyntaxError||u.SyntaxError,h=t.TypeError||u.TypeError,f=t.Math||u.Math,l=t.JSON||u.JSON;"object"==typeof l&&l&&(e.stringify=l.stringify,e.parse=l.parse);var d,_,y,g=s.prototype,m=g.toString,v=new c(-0xc782b5b800cec);try{v=v.getUTCFullYear()==-109252&&0===v.getUTCMonth()&&1===v.getUTCDate()&&10==v.getUTCHours()&&37==v.getUTCMinutes()&&6==v.getUTCSeconds()&&708==v.getUTCMilliseconds()}catch(t){}if(!n("json")){var E="[object Function]",k="[object Date]",S="[object Number]",T="[object String]",b="[object Array]",N="[object Boolean]",w=n("bug-string-char-index");if(!v)var R=f.floor,C=[0,31,59,90,120,151,181,212,243,273,304,334],A=function(t,e){return C[e]+365*(t-1970)+R((t-1969+(e=+(e>1)))/4)-R((t-1901+e)/100)+R((t-1601+e)/400)};if((d=g.hasOwnProperty)||(d=function(t){var e,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=m?d=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,d=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,d.call(this,t)}),_=function(t,e){var n,o,r,i=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,o=new n;for(r in o)d.call(o,r)&&i++;return n=o=null,i?_=2==i?function(t,e){var n,o={},r=m.call(t)==E;for(n in t)r&&"prototype"==n||d.call(o,n)||!(o[n]=1)||!d.call(t,n)||e(n)}:function(t,e){var n,o,r=m.call(t)==E;for(n in t)r&&"prototype"==n||!d.call(t,n)||(o="constructor"===n)||e(n);(o||d.call(t,n="constructor"))&&e(n)}:(o=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],_=function(t,e){var n,r,i=m.call(t)==E,s=!i&&"function"!=typeof t.constructor&&a[typeof t.hasOwnProperty]&&t.hasOwnProperty||d;for(n in t)i&&"prototype"==n||!s.call(t,n)||e(n);for(r=o.length;n=o[--r];s.call(t,n)&&e(n));}),_(t,e)},!n("json-stringify")){var O={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},I="000000",x=function(t,e){return(I+(e||0)).slice(-t)},D="\\u00",L=function(t){for(var e='"',n=0,o=t.length,r=!w||o>10,i=r&&(w?t.split(""):t);n<o;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=O[s];break;default:if(s<32){e+=D+x(2,s.toString(16));break}e+=r?i[n]:t.charAt(n)}}return e+'"'},M=function(t,e,n,o,r,i,s){var a,c,u,p,f,l,g,v,E,w,C,O,I,D,U,P;try{a=e[t]}catch(t){}if("object"==typeof a&&a)if(c=m.call(a),c!=k||d.call(a,"toJSON"))"function"==typeof a.toJSON&&(c!=S&&c!=T&&c!=b||d.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&a<1/0){if(A){for(f=R(a/864e5),u=R(f/365.2425)+1970-1;A(u+1,0)<=f;u++);for(p=R((f-A(u,0))/30.42);A(u,p+1)<=f;p++);f=1+f-A(u,p),l=(a%864e5+864e5)%864e5,g=R(l/36e5)%24,v=R(l/6e4)%60,E=R(l/1e3)%60,w=l%1e3}else u=a.getUTCFullYear(),p=a.getUTCMonth(),f=a.getUTCDate(),g=a.getUTCHours(),v=a.getUTCMinutes(),E=a.getUTCSeconds(),w=a.getUTCMilliseconds();a=(u<=0||u>=1e4?(u<0?"-":"+")+x(6,u<0?-u:u):x(4,u))+"-"+x(2,p+1)+"-"+x(2,f)+"T"+x(2,g)+":"+x(2,v)+":"+x(2,E)+"."+x(3,w)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if(c=m.call(a),c==N)return""+a;if(c==S)return a>-1/0&&a<1/0?""+a:"null";if(c==T)return L(""+a);if("object"==typeof a){for(D=s.length;D--;)if(s[D]===a)throw h();if(s.push(a),C=[],U=i,i+=r,c==b){for(I=0,D=a.length;I<D;I++)O=M(I,a,n,o,r,i,s),C.push(O===y?"null":O);P=C.length?r?"[\n"+i+C.join(",\n"+i)+"\n"+U+"]":"["+C.join(",")+"]":"[]"}else _(o||a,(function(t){var e=M(t,a,n,o,r,i,s);e!==y&&C.push(L(t)+":"+(r?" ":"")+e)})),P=C.length?r?"{\n"+i+C.join(",\n"+i)+"\n"+U+"}":"{"+C.join(",")+"}":"{}";return s.pop(),P}};e.stringify=function(t,e,n){var o,r,i,s;if(a[typeof e]&&e)if((s=m.call(e))==E)r=e;else if(s==b){i={};for(var c,u=0,p=e.length;u<p;c=e[u++],s=m.call(c),(s==T||s==S)&&(i[c]=1));}if(n)if((s=m.call(n))==S){if((n-=n%1)>0)for(o="",n>10&&(n=10);o.length<n;o+=" ");}else s==T&&(o=n.length<=10?n:n.slice(0,10));return M("",(c={},c[""]=t,c),r,i,o,"",[])}}if(!n("json-parse")){var U,P,B=r.fromCharCode,G={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},V=function(){throw U=P=null,p()},F=function(){for(var t,e,n,o,r,i=P,s=i.length;U<s;)switch(r=i.charCodeAt(U)){case 9:case 10:case 13:case 32:U++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=w?i.charAt(U):i[U],U++,t;case 34:for(t="@",U++;U<s;)if(r=i.charCodeAt(U),r<32)V();else if(92==r)switch(r=i.charCodeAt(++U)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=G[r],U++;break;case 117:for(e=++U,n=U+4;U<n;U++)r=i.charCodeAt(U),r>=48&&r<=57||r>=97&&r<=102||r>=65&&r<=70||V();t+=B("0x"+i.slice(e,U));break;default:V()}else{if(34==r)break;for(r=i.charCodeAt(U),e=U;r>=32&&92!=r&&34!=r;)r=i.charCodeAt(++U);t+=i.slice(e,U)}if(34==i.charCodeAt(U))return U++,t;V();default:if(e=U,45==r&&(o=!0,r=i.charCodeAt(++U)),r>=48&&r<=57){for(48==r&&(r=i.charCodeAt(U+1),r>=48&&r<=57)&&V(),o=!1;U<s&&(r=i.charCodeAt(U),r>=48&&r<=57);U++);if(46==i.charCodeAt(U)){for(n=++U;n<s&&(r=i.charCodeAt(n),r>=48&&r<=57);n++);n==U&&V(),U=n}if(r=i.charCodeAt(U),101==r||69==r){for(r=i.charCodeAt(++U),43!=r&&45!=r||U++,n=U;n<s&&(r=i.charCodeAt(n),r>=48&&r<=57);n++);n==U&&V(),U=n}return+i.slice(e,U)}if(o&&V(),"true"==i.slice(U,U+4))return U+=4,!0;if("false"==i.slice(U,U+5))return U+=5,!1;if("null"==i.slice(U,U+4))return U+=4,null;V()}return"$"},j=function(t){var e,n;if("$"==t&&V(),"string"==typeof t){if("@"==(w?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=F(),"]"!=t;n||(n=!0))n&&(","==t?(t=F(),"]"==t&&V()):V()),","==t&&V(),e.push(j(t));return e}if("{"==t){for(e={};t=F(),"}"!=t;n||(n=!0))n&&(","==t?(t=F(),"}"==t&&V()):V()),","!=t&&"string"==typeof t&&"@"==(w?t.charAt(0):t[0])&&":"==F()||V(),e[t.slice(1)]=j(F());return e}V()}return t},q=function(t,e,n){var o=H(t,e,n);o===y?delete t[e]:t[e]=o},H=function(t,e,n){var o,r=t[e];if("object"==typeof r&&r)if(m.call(r)==b)for(o=r.length;o--;)q(r,o,n);else _(r,(function(t){q(r,t,n)}));return n.call(t,e,r)};e.parse=function(t,e){var n,o;return U=0,P=""+t,n=j(F()),"$"!=F()&&V(),U=P=null,e&&m.call(e)==E?H((o={},o[""]=n,o),"",e):n}}}return e.runInContext=i,e}var s=n(62),a={function:!0,object:!0},c=a[typeof e]&&e&&!e.nodeType&&e,u=a[typeof window]&&window||this,p=c&&a[typeof t]&&t&&!t.nodeType&&"object"==typeof r&&r;if(!p||p.global!==p&&p.window!==p&&p.self!==p||(u=p),c&&!s)i(u,c);else{var h=u.JSON,f=u.JSON3,l=!1,d=i(u,u.JSON3={noConflict:function(){return l||(l=!0,u.JSON=h,u.JSON3=f,h=f=null),d}});u.JSON={parse:d.parse,stringify:d.stringify}}s&&(o=function(){return d}.call(e,n,e,t),!(void 0!==o&&(t.exports=o)))}).call(this)}).call(e,n(24)(t),(function(){return this})())}),(function(t,e){function n(t){if(t=""+t,!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*p;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}}function o(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function r(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,p=365.25*u;t.exports=function(t,e){return e=e||{},"string"==typeof t?n(t):e.long?r(t):o(t)}}),(function(t,e){(function(e){var n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,r=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(a,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(o,"@").replace(r,"]").replace(i,""))?new Function("return "+t)():void 0):null}}).call(e,(function(){return this})())}),(function(t,e,n){function o(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,o=i(t),s=o.source,p=o.id,h=o.path,f=u[p]&&h in u[p].nsps,l=e.forceNew||e["force new connection"]||!1===e.multiplex||f;return l?(c("ignoring socket cache for %s",s),n=a(s,e)):(u[p]||(c("new io instance for %s",s),u[p]=a(s,e)),n=u[p]),o.query&&!e.query?e.query=o.query:e&&"object"==typeof e.query&&(e.query=r(e.query)),n.socket(o.path,e)}function r(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}var i=n(55),s=n(11),a=n(20),c=n(5)("socket.io-client");t.exports=e=o;var u=e.managers={};e.protocol=s.protocol,e.connect=o,e.Manager=n(20),e.Socket=n(22)}),(function(t,e,n){(function(e){function o(t,n){var o=t;n=n||e.location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t="undefined"!=typeof n?n.protocol+"//"+t:"https://"+t),i("parse %s",t),o=r(t)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var s=o.host.indexOf(":")!==-1,a=s?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+a+":"+o.port,o.href=o.protocol+"://"+a+(n&&n.port===o.port?"":":"+o.port),o}var r=n(19),i=n(5)("socket.io-client:url");t.exports=o}).call(e,(function(){return this})())}),(function(t,e,n){function o(){return e.colors[p++%e.colors.length]}function r(t){function n(){}function r(){var t=r,n=+new Date,i=n-(u||n);t.diff=i,t.prev=u,t.curr=n,u=n,null==t.useColors&&(t.useColors=e.useColors()),null==t.color&&t.useColors&&(t.color=o());for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var c=0;s[0]=s[0].replace(/%([a-z%])/g,(function(n,o){if("%%"===n)return n;c++;var r=e.formatters[o];if("function"==typeof r){var i=s[c];n=r.call(t,i),s.splice(c,1),c--}return n})),s=e.formatArgs.apply(t,s);var p=r.log||e.log||console.log.bind(console);p.apply(t,s)}n.enabled=!1,r.enabled=!0;var i=e.enabled(t)?r:n;return i.namespace=t,i}function i(t){e.save(t);for(var n=(t||"").split(/[\s,]+/),o=n.length,r=0;r<o;r++)n[r]&&(t=n[r].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"),"-"===t[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function s(){e.enable("")}function a(t){var n,o;for(n=0,o=e.skips.length;n<o;n++)if(e.skips[n].test(t))return!1;for(n=0,o=e.names.length;n<o;n++)if(e.names[n].test(t))return!0;return!1}function c(t){return t instanceof Error?t.stack||t.message:t}e=t.exports=r.debug=r,e.coerce=c,e.disable=s,e.enable=i,e.enabled=a,e.humanize=n(57),e.names=[],e.skips=[],e.formatters={};var u,p=0}),(function(t,e){function n(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var n=parseFloat(e[1]),o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return n*p;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*a;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function o(t){return t>=u?Math.round(t/u)+"d":t>=c?Math.round(t/c)+"h":t>=a?Math.round(t/a)+"m":t>=s?Math.round(t/s)+"s":t+"ms"}function r(t){return i(t,u,"day")||i(t,c,"hour")||i(t,a,"minute")||i(t,s,"second")||t+" ms"}function i(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var s=1e3,a=60*s,c=60*a,u=24*c,p=365.25*u;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return n(t);if("number"===i&&isNaN(t)===!1)return e.long?r(t):o(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}),(function(t,e,n){(function(t){var o=n(18),r=n(23);e.deconstructPacket=function(t){function e(t){if(!t)return t;if(r(t)){var i={_placeholder:!0,num:n.length};return n.push(t),i}if(o(t)){for(var s=new Array(t.length),a=0;a<t.length;a++)s[a]=e(t[a]);return s}if("object"==typeof t&&!(t instanceof Date)){var s={};for(var c in t)s[c]=e(t[c]);return s}return t}var n=[],i=t.data,s=t;return s.data=e(i),s.attachments=n.length,{packet:s,buffers:n}},e.reconstructPacket=function(t,e){function n(t){if(t&&t._placeholder){var r=e[t.num];return r}if(o(t)){for(var i=0;i<t.length;i++)t[i]=n(t[i]);return t}if(t&&"object"==typeof t){for(var s in t)t[s]=n(t[s]);return t}return t}return t.data=n(t.data),t.attachments=void 0,t},e.removeBlobs=function(e,n){function i(e,c,u){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var p=new FileReader;p.onload=function(){u?u[c]=this.result:a=this.result,--s||n(a)},p.readAsArrayBuffer(e)}else if(o(e))for(var h=0;h<e.length;h++)i(e[h],h,e);else if(e&&"object"==typeof e&&!r(e))for(var f in e)i(e[f],f,e)}var s=0,a=e;i(a),s||n(a)}}).call(e,(function(){return this})())}),(function(t,e){function n(t){if(t)return o(t)}function o(t){for(var e in n.prototype)t[e]=n.prototype[e];return t}t.exports=n,n.prototype.on=n.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},n.prototype.once=function(t,e){function n(){o.off(t,n),e.apply(this,arguments)}var o=this;return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var o,r=0;r<n.length;r++)if(o=n[r],o===e||o.fn===e){n.splice(r,1);break}return this},n.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var o=0,r=n.length;o<r;++o)n[o].apply(this,e)}return this},n.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},n.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),(function(t,e,n){var o,r,i;(function(n){!(function(n,s){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=s():(r=[],o=s,i="function"==typeof o?o.apply(e,r):o,!(void 0!==i&&(t.exports=i)))})("object"==typeof window?window:this,(function(){"use strict";function t(t,e){if(e=e||0,e>=t.length)return[];for(var n=t.length,o=Array(n-e);n-- >e;)o[n-e]=t[n];return o}function e(t,e){for(var n=[],o=0,r=t.length;o<r;o++)n.push(e(t[o],o,t));return n}function o(e,n){try{n.apply(null,t(arguments,2))}catch(t){e(t)}}function r(t,e){var n=arguments;S((function(){o.apply(null,n)}))}function i(t){return null==t?t:"function"==typeof t.toThunk?t.toThunk():"function"==typeof t.then?function(e){t.then((function(t){e(null,t)}),e)}:t}function s(t,n){return e(t,(function(t,e,o){return function(r){n(r,t,e,o)}}))}function a(t,e){var n,o=this;return t instanceof a?t:o instanceof a?(o._chain=0,o._success=o._parallel=o._series=null,o._finally=o._error=o._result=o._nextThen=null,arguments.length?(n=h(o,e),t=i(t),void(void 0===t?n():"function"==typeof t?r(n,t,n):n(null,t))):o):new a(t,e)}function c(){var e=this,n=t(arguments);e._result!==!1&&(!e._result&&e._chain&&e.debug.apply(e,["\nChain "+e._chain+": "].concat(t(n))),e._result=!1,o((function(t){t===n[0]?p(e,t):c.call(e._nextThen,t)}),u,e,n))}function u(e,n){if(null==n[0])n[0]=null;else if(n=[n[0]],!e._finally)throw n[0];if(e._finally)return e._finally.apply(null,n);
var o=e._success||e._parallel||e._series;return o?o.apply(null,t(n,1)):void(e._result=n)}function p(t,e){for(var n=t,r=t._error||t._finally;!r&&n._nextThen;)n=n._nextThen,r=n._error||n._finally;if(r)return o((function(t){c.call(n._nextThen,t)}),r,e);if(a.onerror)return a.onerror(e);for(;n._nextThen;)n=n._nextThen;n._result=[e]}function h(t,e){function n(){return c.apply(t,arguments)}return n._isCont=!0,e&&(b.debug="function"==typeof e?e:g,t._chain=1),n}function f(t,e,n){var o=new a,r=h(o,n);return t(r,e),e?(e._nextThen=o,e._chain&&(o._chain=e._chain+1),e._result&&S((function(){c.apply(e,e._result)})),o):o}function l(e,n){return n._isCont?n:function(){var o=t(arguments);o.unshift(e),n.apply(null,o)}}function d(t,e){function n(e){function n(n,i){if(!(o<=0))return null==n?(r[e]=i,!--o&&t(null,r)):(o=0,void t(n))}return n._isCont=!0,n}if(!T(e))return t(m(e,"parallel"));var o=e.length,r=[];if(o<=0)return t(null,r);for(var i=0,s=o;i<s;i++)e[i](n(i))}function _(t,e){function n(p,h){return null!=p?t(p):(c[s]=h,++s>a?t(null,c):(i=--u>0?o:(u=v,r),void i(t,e[s],n)))}if(!T(e))return t(m(e,"series"));var i,s=0,a=e.length-1,c=[],u=v;return a<0?t(null,c):(n._isCont=!0,void e[0](n))}function y(t,e,n){function o(){if(!p)return i>=c?(p=!0,d(t,u)):void(s>=n||(s++,u.push(r())))}function r(){return new a(e[i++]).fin((function(e,n,r){return null!=n?(p=!0,t(n)):(s--,o(),void e(null,r))})).toThunk()}var i=0,s=0,c=e.length,u=[],p=!1;n=n>=1?Math.floor(n):Number.MAX_VALUE;do o();while(i<c&&s<n)}function g(){console.log.apply(console,arguments)}function m(t,e){return new Error("The argument "+(t&&t.toString())+' in "'+e+'" is not Array!')}var v=100,E=Object.prototype.toString,k=Object.prototype.hasOwnProperty,S="function"==typeof n?n:function(t){setTimeout(t,0)},T=Array.isArray||function(t){return"[object Array]"===E.call(t)};a.defer=r,a.parallel=function(t,e){return new a(function(e){o(e,d,e,t)},e)},a.series=function(t,e){return new a(function(e){o(e,_,e,t)},e)},a.each=function(t,e,n){return new a(function(n){o(n,d,n,s(t,e))},n)},a.eachSeries=function(t,e,n){return new a(function(n){o(n,_,n,s(t,e))},n)},a.parallelLimit=function(t,e,n){return new a(function(n){y(n,t,e)},n)},a.eachLimit=function(t,e,n,o){return new a(function(o){y(o,s(t,e),n)},o)},a.nextTick=function(e){var n=t(arguments,1);S((function(){e.apply(null,n)}))},a.onerror=function(t){throw console.error("Thenjs caught error: ",t),t};var b=a.prototype;return b.fin=b.finally=function(t){return f((function(e,n){n._finally=l(e,t)}),this)},b.then=function(t,e){return f((function(n,o){t&&(o._success=l(n,t)),e&&(o._error=l(n,e))}),this)},b.fail=b.catch=function(e){return f((function(n,o){o._error=l(n,e),o._success=function(){var e=t(arguments);e.unshift(null),n.apply(null,e)}}),this)},b.parallel=function(t){return f((function(e,n){n._parallel=function(n){d(e,t||n)}}),this)},b.series=function(t){return f((function(e,n){n._series=function(n){_(e,t||n)}}),this)},b.each=function(t,e){return f((function(n,o){o._parallel=function(o,r){d(n,s(t||o,e||r))}}),this)},b.eachSeries=function(t,e){return f((function(n,o){o._series=function(o,r){_(n,s(t||o,e||r))}}),this)},b.parallelLimit=function(t,e){return f((function(n,o){o._parallel=function(o){y(n,t||o,e)}}),this)},b.eachLimit=function(t,e,n){return f((function(o,r){r._series=function(r,i){y(o,s(t||r,e||i),n)}}),this)},b.toThunk=function(){var t=this;return function(e){t._result?(e.apply(null,t._result),t._result=!1):t._result!==!1&&(t._finally=t._error=e)}},b.inspect=function(){var t={};for(var e in this)k.call(this,e)&&(t[e]="_nextThen"===e?this[e]&&this[e]._chain:this[e]);return t},a.NAME="Thenjs",a.VERSION="2.0.3",a}))}).call(e,n(12).setImmediate)}),(function(t,e){function n(t,e){var n=[];e=e||0;for(var o=e||0;o<t.length;o++)n[o-e]=t[o];return n}t.exports=n}),(function(t,e){(function(e){t.exports=e}).call(e,{})}),(function(t,e,n){var o;(function(t,r){!(function(i){function s(t){for(var e,n,o=[],r=0,i=t.length;r<i;)e=t.charCodeAt(r++),e>=55296&&e<=56319&&r<i?(n=t.charCodeAt(r++),56320==(64512&n)?o.push(((1023&e)<<10)+(1023&n)+65536):(o.push(e),r--)):o.push(e);return o}function a(t){for(var e,n=t.length,o=-1,r="";++o<n;)e=t[o],e>65535&&(e-=65536,r+=v(e>>>10&1023|55296),e=56320|1023&e),r+=v(e);return r}function c(t,e){return v(t>>e&63|128)}function u(t){if(0==(4294967168&t))return v(t);var e="";return 0==(4294965248&t)?e=v(t>>6&31|192):0==(4294901760&t)?(e=v(t>>12&15|224),e+=c(t,6)):0==(4292870144&t)&&(e=v(t>>18&7|240),e+=c(t,12),e+=c(t,6)),e+=v(63&t|128)}function p(t){for(var e,n=s(t),o=n.length,r=-1,i="";++r<o;)e=n[r],i+=u(e);return i}function h(){if(m>=g)throw Error("Invalid byte index");var t=255&y[m];if(m++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function f(){var t,e,n,o,r;if(m>g)throw Error("Invalid byte index");if(m==g)return!1;if(t=255&y[m],m++,0==(128&t))return t;if(192==(224&t)){var e=h();if(r=(31&t)<<6|e,r>=128)return r;throw Error("Invalid continuation byte")}if(224==(240&t)){if(e=h(),n=h(),r=(15&t)<<12|e<<6|n,r>=2048)return r;throw Error("Invalid continuation byte")}if(240==(248&t)&&(e=h(),n=h(),o=h(),r=(15&t)<<18|e<<12|n<<6|o,r>=65536&&r<=1114111))return r;throw Error("Invalid WTF-8 detected")}function l(t){y=s(t),g=y.length,m=0;for(var e,n=[];(e=f())!==!1;)n.push(e);return a(n)}var d="object"==typeof e&&e,_=("object"==typeof t&&t&&t.exports==d&&t,"object"==typeof r&&r);_.global!==_&&_.window!==_||(i=_);var y,g,m,v=String.fromCharCode,E={version:"1.0.0",encode:p,decode:l};o=function(){return E}.call(e,n,e,t),!(void 0!==o&&(t.exports=o))})(this)}).call(e,n(24)(t),(function(){return this})())}),(function(t,e){})])}));

/***/ }),

/***/ 1123:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/images/modal-close.67ba7cda.svg";

/***/ }),

/***/ 1124:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/images/modal-close-active2.92866c99.svg";

/***/ }),

/***/ 1129:
/***/ (function(module, exports) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
var stylesInDom = {},
	memoize = function(fn) {
		var memo;
		return function () {
			if (typeof memo === "undefined") memo = fn.apply(this, arguments);
			return memo;
		};
	},
	isOldIE = memoize((function() {
		return /msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase());
	})),
	getHeadElement = memoize((function () {
		return document.head || document.getElementsByTagName("head")[0];
	})),
	singletonElement = null,
	singletonCounter = 0,
	styleElementsInsertedAtTop = [];

module.exports = function(list, options) {
	if(typeof DEBUG !== "undefined" && DEBUG) {
		if(typeof document !== "object") throw new Error("The style-loader cannot be used in a non-browser environment");
	}

	options = options || {};
	// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>
	// tags it will allow on a page
	if (typeof options.singleton === "undefined") options.singleton = isOldIE();

	// By default, add <style> tags to the bottom of <head>.
	if (typeof options.insertAt === "undefined") options.insertAt = "bottom";

	var styles = listToStyles(list);
	addStylesToDom(styles, options);

	return function update(newList) {
		var mayRemove = [];
		for(var i = 0; i < styles.length; i++) {
			var item = styles[i];
			var domStyle = stylesInDom[item.id];
			domStyle.refs--;
			mayRemove.push(domStyle);
		}
		if(newList) {
			var newStyles = listToStyles(newList);
			addStylesToDom(newStyles, options);
		}
		for(var i = 0; i < mayRemove.length; i++) {
			var domStyle = mayRemove[i];
			if(domStyle.refs === 0) {
				for(var j = 0; j < domStyle.parts.length; j++)
					domStyle.parts[j]();
				delete stylesInDom[domStyle.id];
			}
		}
	};
}

function addStylesToDom(styles, options) {
	for(var i = 0; i < styles.length; i++) {
		var item = styles[i];
		var domStyle = stylesInDom[item.id];
		if(domStyle) {
			domStyle.refs++;
			for(var j = 0; j < domStyle.parts.length; j++) {
				domStyle.parts[j](item.parts[j]);
			}
			for(; j < item.parts.length; j++) {
				domStyle.parts.push(addStyle(item.parts[j], options));
			}
		} else {
			var parts = [];
			for(var j = 0; j < item.parts.length; j++) {
				parts.push(addStyle(item.parts[j], options));
			}
			stylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};
		}
	}
}

function listToStyles(list) {
	var styles = [];
	var newStyles = {};
	for(var i = 0; i < list.length; i++) {
		var item = list[i];
		var id = item[0];
		var css = item[1];
		var media = item[2];
		var sourceMap = item[3];
		var part = {css: css, media: media, sourceMap: sourceMap};
		if(!newStyles[id])
			styles.push(newStyles[id] = {id: id, parts: [part]});
		else
			newStyles[id].parts.push(part);
	}
	return styles;
}

function insertStyleElement(options, styleElement) {
	var head = getHeadElement();
	var lastStyleElementInsertedAtTop = styleElementsInsertedAtTop[styleElementsInsertedAtTop.length - 1];
	if (options.insertAt === "top") {
		if(!lastStyleElementInsertedAtTop) {
			head.insertBefore(styleElement, head.firstChild);
		} else if(lastStyleElementInsertedAtTop.nextSibling) {
			head.insertBefore(styleElement, lastStyleElementInsertedAtTop.nextSibling);
		} else {
			head.appendChild(styleElement);
		}
		styleElementsInsertedAtTop.push(styleElement);
	} else if (options.insertAt === "bottom") {
		head.appendChild(styleElement);
	} else {
		throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");
	}
}

function removeStyleElement(styleElement) {
	styleElement.parentNode.removeChild(styleElement);
	var idx = styleElementsInsertedAtTop.indexOf(styleElement);
	if(idx >= 0) {
		styleElementsInsertedAtTop.splice(idx, 1);
	}
}

function createStyleElement(options) {
	var styleElement = document.createElement("style");
	styleElement.type = "text/css";
	insertStyleElement(options, styleElement);
	return styleElement;
}

function createLinkElement(options) {
	var linkElement = document.createElement("link");
	linkElement.rel = "stylesheet";
	insertStyleElement(options, linkElement);
	return linkElement;
}

function addStyle(obj, options) {
	var styleElement, update, remove;

	if (options.singleton) {
		var styleIndex = singletonCounter++;
		styleElement = singletonElement || (singletonElement = createStyleElement(options));
		update = applyToSingletonTag.bind(null, styleElement, styleIndex, false);
		remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true);
	} else if(obj.sourceMap &&
		typeof URL === "function" &&
		typeof URL.createObjectURL === "function" &&
		typeof URL.revokeObjectURL === "function" &&
		typeof Blob === "function" &&
		typeof btoa === "function") {
		styleElement = createLinkElement(options);
		update = updateLink.bind(null, styleElement);
		remove = function() {
			removeStyleElement(styleElement);
			if(styleElement.href)
				URL.revokeObjectURL(styleElement.href);
		};
	} else {
		styleElement = createStyleElement(options);
		update = applyToTag.bind(null, styleElement);
		remove = function() {
			removeStyleElement(styleElement);
		};
	}

	update(obj);

	return function updateStyle(newObj) {
		if(newObj) {
			if(newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap)
				return;
			update(obj = newObj);
		} else {
			remove();
		}
	};
}

var replaceText = (function () {
	var textStore = [];

	return function (index, replacement) {
		textStore[index] = replacement;
		return textStore.filter(Boolean).join('\n');
	};
})();

function applyToSingletonTag(styleElement, index, remove, obj) {
	var css = remove ? "" : obj.css;

	if (styleElement.styleSheet) {
		styleElement.styleSheet.cssText = replaceText(index, css);
	} else {
		var cssNode = document.createTextNode(css);
		var childNodes = styleElement.childNodes;
		if (childNodes[index]) styleElement.removeChild(childNodes[index]);
		if (childNodes.length) {
			styleElement.insertBefore(cssNode, childNodes[index]);
		} else {
			styleElement.appendChild(cssNode);
		}
	}
}

function applyToTag(styleElement, obj) {
	var css = obj.css;
	var media = obj.media;

	if(media) {
		styleElement.setAttribute("media", media)
	}

	if(styleElement.styleSheet) {
		styleElement.styleSheet.cssText = css;
	} else {
		while(styleElement.firstChild) {
			styleElement.removeChild(styleElement.firstChild);
		}
		styleElement.appendChild(document.createTextNode(css));
	}
}

function updateLink(linkElement, obj) {
	var css = obj.css;
	var sourceMap = obj.sourceMap;

	if(sourceMap) {
		// http://stackoverflow.com/a/26603875
		css += "\n/*# sourceMappingURL=data:application/json;base64," + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + " */";
	}

	var blob = new Blob([css], { type: "text/css" });

	var oldSrc = linkElement.href;

	linkElement.href = URL.createObjectURL(blob);

	if(oldSrc)
		URL.revokeObjectURL(oldSrc);
}


/***/ }),

/***/ 124:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(793), exports);


/***/ }),

/***/ 158:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/**
 * 全局对象
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.global = {
    injector: null,
    JIM: null,
    user: '',
    password: '',
    conversationKey: 0
};


/***/ }),

/***/ 160:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(830), exports);
tslib_1.__exportStar(__webpack_require__(829), exports);


/***/ }),

/***/ 222:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(817), exports);


/***/ }),

/***/ 28:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(445), exports);
tslib_1.__exportStar(__webpack_require__(826), exports);
tslib_1.__exportStar(__webpack_require__(158), exports);
tslib_1.__exportStar(__webpack_require__(827), exports);
tslib_1.__exportStar(__webpack_require__(447), exports);
tslib_1.__exportStar(__webpack_require__(828), exports);
tslib_1.__exportStar(__webpack_require__(444), exports);
tslib_1.__exportStar(__webpack_require__(446), exports);


/***/ }),

/***/ 314:
/***/ (function(module, exports) {

/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
// css base code, injected by the css-loader
module.exports = function() {
	var list = [];

	// return the list of modules as css string
	list.toString = function toString() {
		var result = [];
		for(var i = 0; i < this.length; i++) {
			var item = this[i];
			if(item[2]) {
				result.push("@media " + item[2] + "{" + item[1] + "}");
			} else {
				result.push(item[1]);
			}
		}
		return result.join("");
	};

	// import a list of modules into the list
	list.i = function(modules, mediaQuery) {
		if(typeof modules === "string")
			modules = [[null, modules, ""]];
		var alreadyImportedModules = {};
		for(var i = 0; i < this.length; i++) {
			var id = this[i][0];
			if(typeof id === "number")
				alreadyImportedModules[id] = true;
		}
		for(i = 0; i < modules.length; i++) {
			var item = modules[i];
			// skip already imported module
			// this implementation is not 100% perfect for weird media query combinations
			//  when a module is imported multiple times with different media queries.
			//  I hope this will never occur (Hey this way we have smaller bundles)
			if(typeof item[0] !== "number" || !alreadyImportedModules[item[0]]) {
				if(mediaQuery && !item[2]) {
					item[2] = mediaQuery;
				} else if(mediaQuery) {
					item[2] = "(" + item[2] + ") and (" + mediaQuery + ")";
				}
				list.push(item);
			}
		}
	};
	return list;
};


/***/ }),

/***/ 317:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(800), exports);


/***/ }),

/***/ 318:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(812), exports);


/***/ }),

/***/ 4:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony export (immutable) */ __webpack_exports__["__extends"] = __extends;
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "__assign", (function() { return __assign; }));
/* harmony export (immutable) */ __webpack_exports__["__rest"] = __rest;
/* harmony export (immutable) */ __webpack_exports__["__decorate"] = __decorate;
/* harmony export (immutable) */ __webpack_exports__["__param"] = __param;
/* harmony export (immutable) */ __webpack_exports__["__metadata"] = __metadata;
/* harmony export (immutable) */ __webpack_exports__["__awaiter"] = __awaiter;
/* harmony export (immutable) */ __webpack_exports__["__generator"] = __generator;
/* harmony export (immutable) */ __webpack_exports__["__exportStar"] = __exportStar;
/* harmony export (immutable) */ __webpack_exports__["__values"] = __values;
/* harmony export (immutable) */ __webpack_exports__["__read"] = __read;
/* harmony export (immutable) */ __webpack_exports__["__spread"] = __spread;
/* harmony export (immutable) */ __webpack_exports__["__await"] = __await;
/* harmony export (immutable) */ __webpack_exports__["__asyncGenerator"] = __asyncGenerator;
/* harmony export (immutable) */ __webpack_exports__["__asyncDelegator"] = __asyncDelegator;
/* harmony export (immutable) */ __webpack_exports__["__asyncValues"] = __asyncValues;
/* harmony export (immutable) */ __webpack_exports__["__makeTemplateObject"] = __makeTemplateObject;
/* harmony export (immutable) */ __webpack_exports__["__importStar"] = __importStar;
/* harmony export (immutable) */ __webpack_exports__["__importDefault"] = __importDefault;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __exportStar(m, exports) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}

function __values(o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", (function (e) { throw e; })), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then((function(v) { resolve({ value: v, done: d }); }), reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result.default = mod;
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}


/***/ }),

/***/ 444:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var index_1 = __webpack_require__(28);
var timeoutData = { code: -2 };
var ApiService = /** @class */ (function () {
    function ApiService() {
    }
    // 登出
    ApiService.prototype.loginOut = function (success) {
        return new Promise(function (resolve) {
            index_1.global.JIM.loginOut();
            if (success && success instanceof Function) {
                success();
            }
            resolve();
        });
    };
    // 更新会话extra字段
    ApiService.prototype.updateConversation = function (conversationObj, success) {
        return new Promise(function (resolve) {
            index_1.global.JIM.updateConversation(conversationObj);
            if (success && success instanceof Function) {
                success();
            }
            resolve();
        });
    };
    // 重置会话徽标未读数
    ApiService.prototype.resetUnreadCount = function (conversationObj, success) {
        return new Promise(function (resolve) {
            index_1.global.JIM.resetUnreadCount(conversationObj);
            if (success && success instanceof Function) {
                success();
            }
            resolve();
        });
    };
    // JIM初始化
    ApiService.prototype.init = function (initObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.init(initObj), success, error, timeout);
    };
    // 登录
    ApiService.prototype.login = function (loginObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.login(loginObj), success, error, timeout);
    };
    // 注册
    ApiService.prototype.register = function (registerObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.register(registerObj), success, error, timeout);
    };
    // 获取静态资源路径
    ApiService.prototype.getResource = function (urlObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.getResource(urlObj), success, error, timeout);
    };
    // 获取用户资料
    ApiService.prototype.getUserInfo = function (userObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.getUserInfo(userObj), success, error, timeout);
    };
    // 获取好友列表
    ApiService.prototype.getFriendList = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.getFriendList(), success, error, timeout);
    };
    // 获取会话列表
    ApiService.prototype.getConversation = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.getConversation(), success, error, timeout);
    };
    // 获取群屏蔽列表
    ApiService.prototype.groupShieldList = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.groupShieldList(), success, error, timeout);
    };
    // 获取免打扰列表
    ApiService.prototype.getNoDisturb = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.getNoDisturb(), success, error, timeout);
    };
    // 获取群组信息
    ApiService.prototype.getGroupInfo = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.getGroupInfo(groupObj), success, error, timeout);
    };
    // 获取群成员
    ApiService.prototype.getGroupMembers = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.getGroupMembers(groupObj), success, error, timeout);
    };
    // 更新群组信息
    ApiService.prototype.updateGroupInfo = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.updateGroupInfo(groupObj), success, error, timeout);
    };
    // 删除群屏蔽
    ApiService.prototype.delGroupShield = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delGroupShield(groupObj), success, error, timeout);
    };
    // 添加群屏蔽
    ApiService.prototype.addGroupShield = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addGroupShield(groupObj), success, error, timeout);
    };
    // 删除群免打扰
    ApiService.prototype.delGroupNoDisturb = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delGroupNoDisturb(groupObj), success, error, timeout);
    };
    // 添加群免打扰
    ApiService.prototype.addGroupNoDisturb = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addGroupNoDisturb(groupObj), success, error, timeout);
    };
    // 消息撤回
    ApiService.prototype.msgRetract = function (msgObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.msgRetract(msgObj), success, error, timeout);
    };
    // 添加好友
    ApiService.prototype.addFriend = function (friendObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addFriend(friendObj), success, error, timeout);
    };
    // 删除单聊黑名单
    ApiService.prototype.delSingleBlacks = function (blackObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delSingleBlacks(blackObj), success, error, timeout);
    };
    // 删除单聊免打扰
    ApiService.prototype.delSingleNoDisturb = function (disturbObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delSingleNoDisturb(disturbObj), success, error, timeout);
    };
    // 修改好友备注名
    ApiService.prototype.updateFriendMemo = function (friendObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.updateFriendMemo(friendObj), success, error, timeout);
    };
    // 上报单聊已读回执
    ApiService.prototype.addSingleReceiptReport = function (msgObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addSingleReceiptReport(msgObj), success, error, timeout);
    };
    // 上报群聊已读回执
    ApiService.prototype.addGroupReceiptReport = function (msgObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addGroupReceiptReport(msgObj), success, error, timeout);
    };
    // 添加群成员禁言
    ApiService.prototype.addGroupMemSilence = function (memberObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addGroupMemSilence(memberObj), success, error, timeout);
    };
    // 删除群成员禁言
    ApiService.prototype.delGroupMemSilence = function (memberObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delGroupMemSilence(memberObj), success, error, timeout);
    };
    // 获取群列表
    ApiService.prototype.getGroups = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.getGroups(), success, error, timeout);
    };
    // 拒绝好友请求
    ApiService.prototype.declineFriend = function (friendObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.declineFriend(friendObj), success, error, timeout);
    };
    // 同意好友请求
    ApiService.prototype.acceptFriend = function (friendObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.acceptFriend(friendObj), success, error, timeout);
    };
    // 同意或者拒绝入群请求
    ApiService.prototype.addGroupMemberResp = function (memberObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addGroupMemberResp(memberObj), success, error, timeout);
    };
    // 更新个人资料
    ApiService.prototype.updateSelfInfo = function (selfInfoObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.updateSelfInfo(selfInfoObj), success, error, timeout);
    };
    // 创建群组
    ApiService.prototype.createGroup = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.createGroup(groupObj), success, error, timeout);
    };
    // 添加群成员
    ApiService.prototype.addGroupMembers = function (memberObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addGroupMembers(memberObj), success, error, timeout);
    };
    // 修改密码
    ApiService.prototype.updateSelfPwd = function (passwordObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.updateSelfPwd(passwordObj), success, error, timeout);
    };
    // 获取黑名单
    ApiService.prototype.getBlacks = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.getBlacks(), success, error, timeout);
    };
    // 添加单聊黑名单
    ApiService.prototype.addSingleBlacks = function (blackObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addSingleBlacks(blackObj), success, error, timeout);
    };
    // 退出群组
    ApiService.prototype.exitGroup = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.exitGroup(groupObj), success, error, timeout);
    };
    // 删除群成员
    ApiService.prototype.delGroupMembers = function (memberObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delGroupMembers(memberObj), success, error, timeout);
    };
    // 添加单聊免打扰
    ApiService.prototype.addSingleNoDisturb = function (singleObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.addSingleNoDisturb(singleObj), success, error, timeout);
    };
    // 删除好友
    ApiService.prototype.delFriend = function (friendObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.delFriend(friendObj), success, error, timeout);
    };
    // 获取聊天室资料
    ApiService.prototype.getChatroomInfo = function (roomObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.getChatroomInfo(roomObj), success, error, timeout);
    };
    // 加入群组
    ApiService.prototype.joinGroup = function (groupObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.joinGroup(groupObj), success, error, timeout);
    };
    // 更新个人头像
    ApiService.prototype.updateSelfAvatar = function (selfObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.updateSelfAvatar(selfObj), success, error, timeout);
    };
    // 获取本人所在聊天室列表
    ApiService.prototype.getSelfChatrooms = function (success, error, timeout) {
        return this.callback(index_1.global.JIM.getSelfChatrooms(), success, error, timeout);
    };
    // 获取appkey下的聊天室
    ApiService.prototype.getAppkeyChatrooms = function (roomObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.getAppkeyChatrooms(roomObj), success, error, timeout);
    };
    // 进入聊天室
    ApiService.prototype.enterChatroom = function (roomObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.enterChatroom(roomObj), success, error, timeout);
    };
    // 退出聊天室
    ApiService.prototype.exitChatroom = function (roomObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.exitChatroom(roomObj), success, error, timeout);
    };
    // 发送透传消息
    ApiService.prototype.transSingleMsg = function (msgObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.transSingleMsg(msgObj), success, error, timeout);
    };
    // 查看未读列表
    ApiService.prototype.msgUnreadList = function (msgObj, success, error, timeout) {
        return this.callback(index_1.global.JIM.msgUnreadList(msgObj), success, error, timeout);
    };
    // 发送聊天室文本消息
    ApiService.prototype.sendChatroomMsg = function (msgObj, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendChatroomMsg(msgObj), success, error, timeout);
    };
    // 发送聊天室文件消息
    ApiService.prototype.sendChatroomFile = function (fileObj, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendChatroomFile(fileObj), success, error, timeout);
    };
    // 发送聊天室图片
    ApiService.prototype.sendChatroomPic = function (picObj, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendChatroomPic(picObj), success, error, timeout);
    };
    // 发送或者转发单聊文本
    ApiService.prototype.sendSingleMsg = function (singleMsg, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendSingleMsg(singleMsg), success, error, timeout);
    };
    // 发送或者转发群聊文本
    ApiService.prototype.sendGroupMsg = function (groupleMsg, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendGroupMsg(groupleMsg), success, error, timeout);
    };
    // 发送或者转发单聊图片
    ApiService.prototype.sendSinglePic = function (singlePic, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendSinglePic(singlePic), success, error, timeout);
    };
    // 发送或者转发群聊图片
    ApiService.prototype.sendGroupPic = function (groupPic, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendGroupPic(groupPic), success, error, timeout);
    };
    // 发送或者转发单聊文件
    ApiService.prototype.sendSingleFile = function (singleFile, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendSingleFile(singleFile), success, error, timeout);
    };
    // 发送或者转发群聊文件
    ApiService.prototype.sendGroupFile = function (groupFile, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendGroupFile(groupFile), success, error, timeout);
    };
    // 发送或者转发单聊位置
    ApiService.prototype.sendSingleLocation = function (singleLocation, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendSingleLocation(singleLocation), success, error, timeout);
    };
    // 发送或者转发群聊位置
    ApiService.prototype.sendGroupLocation = function (groupLocation, success, error, timeout) {
        return this.msgCallback(index_1.global.JIM.sendGroupLocation(groupLocation), success, error, timeout);
    };
    // 回调函数
    ApiService.prototype.callback = function (obj) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        return new Promise(function (resolve) {
            if (obj && obj.onSuccess) {
                obj.onSuccess((function (successData) {
                    if (successData.code) {
                        delete successData.code;
                    }
                    if (args[0] && args[0] instanceof Function) {
                        args[0](successData);
                    }
                    resolve(successData);
                })).onFail((function (errorData) {
                    if (args[1] && args[1] instanceof Function) {
                        args[1](errorData);
                    }
                    resolve(errorData);
                })).onTimeout((function () {
                    if (args[2] && args[2] instanceof Function) {
                        args[2]();
                    }
                    resolve(timeoutData);
                }));
            }
        });
    };
    // 发送消息回调函数
    ApiService.prototype.msgCallback = function (obj) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        return new Promise(function (resolve) {
            if (obj && obj.onSuccess) {
                obj.onSuccess((function (successData, msgs) {
                    if (successData.key) {
                        msgs.key = successData.key;
                    }
                    msgs.unread_count = successData.unread_count || 0;
                    if (args[0] && args[0] instanceof Function) {
                        args[0](msgs);
                    }
                    resolve(msgs);
                })).onFail((function (errorData) {
                    if (args[1] && args[1] instanceof Function) {
                        args[1](errorData);
                    }
                    resolve(errorData);
                })).onTimeout((function () {
                    if (args[2] && args[2] instanceof Function) {
                        args[2]();
                    }
                    resolve(timeoutData);
                }));
            }
        });
    };
    ApiService = tslib_1.__decorate([
        core_1.Injectable()
    ], ApiService);
    return ApiService;
}());
exports.ApiService = ApiService;


/***/ }),

/***/ 445:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

/**
 * 前端自动生成签名，配置指南
 * step 1、填写好appkey以及对应的masterSecret
 * step 2、isFrontSignature改为true
 */
/**
 * 服务端生成签名，配置指南
 * step 1、填写好appkey，不填masterSecret，masterSecret放在服务端
 * step 2、isFrontSignature改为false
 * step 3、填写signatureApiUrl
 * step 4、在自己的服务端上开发出生成签名的post类型接口
 */
/**
 * 服务端生成签名的api详解：
 * 前端接口的调用相关的代码已经写好，开发者只需要配置好signatureApiUrl，并在服务端提供签名api接口即可
 * 服务端接收post请求，收到json数据，json数据结构如下:
 * {
 *   timestamp: new Date().getTime(),
 *   appkey: authPayload.appkey,
 *   randomStr: authPayload.randomStr
 * }
 * 根据json数据及masterSecret生成签名，返回string类型格式的response给前端:
 * 如: '7db047a67a9d7293850ac69d14cc82bf'
 */
/**
 * 注意:
 * 签名的生成有前端和服务端两种方式，任选其中之一即可
 * 建议在生产环境中使用服务端生成签名，否则masterSecret有暴露的风险
 */
Object.defineProperty(exports, "__esModule", { value: true });


// randomStr : 随机字符串, 作为签名加 salt 使用
var randomStr = '404';
// appkey : 开发者在极光平台注册的 IM 应用 appkey
var appkey = '1111';
// masterSecret : 密钥，由前端生成签名时需要填写，有暴露的风险
var masterSecret = '2222';
// isFrontSignature : 是否由前端生成签名，值为true则由前端自动生成签名，值为false则由服务端生成签名，开发者需要在服务端提供post类型接口
var isFrontSignature = true;
// signatureApiUrl : 由服务端生成签名时，前端调用服务端post类型接口的url，仅在isFrontSignature为false时可用
var signatureApiUrl = '/portal/chat/im/signature.json';

//创建异步对象  
var xhr = new XMLHttpRequest();
xhr.open('POST', '/portal/chat/im/signature.json',false);
//需要设置请求报文
xhr.setRequestHeader('Content-Type', 'application/json');
xhr.send();

if (xhr.readyState == 4 && xhr.status == 200) {
  var obj = JSON.parse(xhr.responseText); 
  appkey= obj.data.appKey;
  masterSecret= obj.data.masterSecret;
} ;

// JIM 应用配置
exports.authPayload = {
    appkey: appkey,
    masterSecret: masterSecret,
    randomStr: randomStr,
    // flag : 是否启用消息漫游，值为0不开启，值为1开启
    flag: 1,
    isFrontSignature: isFrontSignature,
    signatureApiUrl: signatureApiUrl
};


exports.PERFECT_SCROLLBAR_CONFIG = {
    suppressScrollX: true,
    minScrollbarLength: 40
};
// js中静态资源的路径
exports.imgRouter = '/im/assets/images/emoji/';
exports.jpushRouter = '/im/assets/images/jpush/';
// 消息列表中滚动加载的每页消息的条数
exports.pageNumber = 20;
// demo 签名配置项，开发者不用理会
var signature = '7db047a67a9d7293850ac69d14cc82bf';
var timestamp = 1507882399401;
exports.demoInitConfig = {
    signature: signature,
    timestamp: timestamp
};


/***/ }),

/***/ 446:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var http_1 = __webpack_require__(220);
var core_1 = __webpack_require__(1);
var SignatureService = /** @class */ (function () {
    function SignatureService(http) {
        this.http = http;
    }
    
    //获取服务器的验签规则
    SignatureService.prototype.requestSignature = function (url, data) {
        var headers = new http_1.Headers();
        headers.append('Content-Type', 'application/json');
        var options = new http_1.RequestOptions({ headers: headers });
        return this.http.post(url, data, options)
            .map((function (res) { return res._body ? res._body : res; }))
            .toPromise().catch((function (error) {
            // 请求服务端签名接口错误
            console.log('请求服务端签名接口错误', error);
        }));
    };
    SignatureService = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [http_1.Http])
    ], SignatureService);
    return SignatureService;
}());
exports.SignatureService = SignatureService;


/***/ }),

/***/ 447:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
/**
 * 前端存储（cookie和localStorage）服务
 */
var StorageService = /** @class */ (function () {
    function StorageService() {
        // pass
    }
    StorageService.prototype.set = function (key, data, useCookie, time, path) {
        if (localStorage && !useCookie) {
            try {
                localStorage.setItem(key, data);
                return;
            }
            catch (err) { // 在safari的匿名模式的时候会报错
                // go ahead
            }
        }
        var exp = new Date();
        if (time) {
            exp.setTime(exp.getTime() + time);
        }
        else {
            exp.setTime(exp.getTime() + 23.9 * 60 * 60 * 1000);
        }
        if (path) {
            document.cookie = key + '=' + data + ';expires=' + exp.toUTCString() + ';path=' + path;
            return null;
        }
        document.cookie = key + '=' + data + ';expires=' + exp.toUTCString();
    };
    StorageService.prototype.get = function (key, useCookie) {
        if (localStorage && !useCookie) {
            var value = localStorage.getItem(key);
            if (value) {
                return value;
            }
        }
        // 从cookie里面取
        var reg = new RegExp(key + '=([^;]*)');
        var m = document.cookie.match(reg);
        if (m && m.length > 1) {
            return m[1];
        }
        return null;
    };
    StorageService.prototype.remove = function (key, useCookie, path) {
        if (localStorage && !useCookie) {
            var value_1 = localStorage.getItem(key);
            if (value_1) {
                localStorage.removeItem(key);
                return value_1;
            }
        }
        // 从localstorage里没发现这个key
        var exp = new Date();
        exp.setTime(exp.getTime() - 1);
        var value = this.get(key);
        if (path) {
            document.cookie = key + '=' + value + ';expires=' + exp.toUTCString() + ';path=' + path;
        }
        else {
            document.cookie = key + '=' + value + ';expires=' + exp.toUTCString();
        }
        return value;
    };
    StorageService = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [])
    ], StorageService);
    return StorageService;
}());
exports.StorageService = StorageService;


/***/ }),

/***/ 489:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var forms_1 = __webpack_require__(159);
var http_1 = __webpack_require__(220);
var platform_browser_1 = __webpack_require__(114);
var store_1 = __webpack_require__(32);
var effects_1 = __webpack_require__(70);
// import { StoreDevtoolsModule } from '@ngrx/store-devtools';
var reducers_1 = __webpack_require__(825);
var reducers_2 = __webpack_require__(803);
var effects_2 = __webpack_require__(801);
var reducers_3 = __webpack_require__(815);
var effects_3 = __webpack_require__(813);
var reducers_4 = __webpack_require__(810);
var effects_4 = __webpack_require__(806);
var reducers_5 = __webpack_require__(792);
var effects_5 = __webpack_require__(788);
var reducers_6 = __webpack_require__(799);
var effects_6 = __webpack_require__(795);
var reducers_7 = __webpack_require__(822);
var effects_7 = __webpack_require__(818);
var common_1 = __webpack_require__(28);
var tip_modal_1 = __webpack_require__(493);
var hmr_1 = __webpack_require__(832);
var app_router_1 = __webpack_require__(783);
var app_component_1 = __webpack_require__(782);
var common_2 = __webpack_require__(28);
__webpack_require__(775);
var AppModule = /** @class */ (function (_super) {
    tslib_1.__extends(AppModule, _super);
    function AppModule(appRef) {
        var _this = _super.call(this, appRef) || this;
        _this.appRef = appRef;
        return _this;
    }
    AppModule = tslib_1.__decorate([
        core_1.NgModule({
            imports: [
                platform_browser_1.BrowserModule,
                forms_1.FormsModule,
                http_1.HttpModule,
                app_router_1.routing,
                store_1.StoreModule.provideStore({
                    appReducer: reducers_1.appReducer,
                    loginReducer: reducers_2.loginReducer,
                    registerReducer: reducers_3.registerReducer,
                    mainReducer: reducers_4.mainReducer,
                    chatReducer: reducers_5.chatReducer,
                    contactReducer: reducers_6.contactReducer,
                    roomReducer: reducers_7.roomReducer
                }),
                effects_1.EffectsModule.run(effects_2.LoginEffect),
                effects_1.EffectsModule.run(effects_3.RegisterEffect),
                effects_1.EffectsModule.run(effects_4.MainEffect),
                effects_1.EffectsModule.run(effects_5.ChatEffect),
                effects_1.EffectsModule.run(effects_6.ContactEffect),
                effects_1.EffectsModule.run(effects_7.RoomEffect),
                tip_modal_1.TipModalModule
                // 是否启用ngrx调试工具
                // StoreDevtoolsModule.instrumentOnlyWithExtension(),
            ],
            declarations: [
                app_component_1.AppComponent
            ],
            bootstrap: [app_component_1.AppComponent],
            providers: [
                common_1.MainCanActivate,
                common_2.StorageService,
                common_2.PreloadService,
                common_2.ApiService,
                common_2.SignatureService
            ]
        }),
        tslib_1.__metadata("design:paramtypes", [core_1.ApplicationRef])
    ], AppModule);
    return AppModule;
}(hmr_1.HMR));
exports.AppModule = AppModule;


/***/ }),

/***/ 492:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/images/send-message-error.86daa63e.svg";

/***/ }),

/***/ 493:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
// 提示模态框组件
tslib_1.__exportStar(__webpack_require__(785), exports);


/***/ }),

/***/ 606:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Hot Module Replacement
function bootloader(main) {
    if (document.readyState === 'complete') {
        main();
    }
    else {
        document.addEventListener('DOMContentLoaded', main);
    }
}
exports.bootloader = bootloader;
// create new elements
function createNewHosts(cmps) {
    var components = cmps.map((function (componentNode) {
        var newNode = document.createElement(componentNode.tagName);
        // display none
        var currentDisplay = newNode.style.display;
        newNode.style.display = 'none';
        var parentNode = componentNode.parentNode;
        parentNode.insertBefore(newNode, componentNode);
        return { currentDisplay: currentDisplay, newNode: newNode };
    }));
    return function () {
        components.forEach((function (cmp) {
            cmp.newNode.style.display = cmp.currentDisplay;
            cmp.newNode = null;
            cmp.currentDisplay = null;
        }));
    };
}
exports.createNewHosts = createNewHosts;
// remove old styles
function removeNgStyles() {
    Array.prototype.slice.call(document.head.querySelectorAll('style'), 0)
        .filter((function (style) { return style.innerText.indexOf('_ng') !== -1; }))
        .map((function (el) { return el.remove(); }));
}
exports.removeNgStyles = removeNgStyles;
// get input values
function getInputValues() {
    var inputs = document.querySelectorAll('input');
    return Array.prototype.slice.call(inputs).map((function (input) { return input.value; }));
}
exports.getInputValues = getInputValues;
// set input values
function setInputValues($inputs) {
    var inputs = document.querySelectorAll('input');
    if ($inputs && inputs.length === $inputs.length) {
        $inputs.forEach((function (value, i) {
            var el = inputs[i];
            el.value = value;
            el.dispatchEvent(new CustomEvent('input', { detail: el.value }));
        }));
    }
}
exports.setInputValues = setInputValues;
// get/set input values
function createInputTransfer() {
    var $inputs = getInputValues();
    return function restoreInputValues() {
        setInputValues($inputs);
    };
}
exports.createInputTransfer = createInputTransfer;
//# sourceMappingURL=helpers.js.map

/***/ }),

/***/ 607:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
// Hot Module Replacement
__export(__webpack_require__(606));
//# sourceMappingURL=index.js.map

/***/ }),

/***/ 72:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
// 工具函数类
tslib_1.__exportStar(__webpack_require__(831), exports);


/***/ }),

/***/ 771:
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(314)();
// imports


// module
exports.push([module.i, "", ""]);

// exports


/***/ }),

/***/ 772:
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(314)();
// imports


// module
exports.push([module.i, ".tip-modal {\n  z-index: 9999999; }\n  .tip-modal .paddingBottomNone {\n    padding-bottom: 0 !important; }\n  .tip-modal .tip-modal-success, .tip-modal .tip-modal-error {\n    vertical-align: middle;\n    margin-right: 6px;\n    position: relative;\n    top: -2px; }\n  .tip-modal .modal-warn-tip {\n    line-height: 28px; }\n    .tip-modal .modal-warn-tip .sub-tip {\n      font-size: 14px;\n      color: #808080;\n      line-height: 22px; }\n", ""]);

// exports


/***/ }),

/***/ 775:
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ 776:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__.p + "assets/images/success-tip.c64974b8.svg";

/***/ }),

/***/ 779:
/***/ (function(module, exports) {

module.exports = "<router-outlet></router-outlet>\n<tip-modal-component *ngIf=\"tipModal.show\" [info]=\"tipModal.info\" (modalTipEmit)=\"modalTipEmit()\"></tip-modal-component>\n";

/***/ }),

/***/ 780:
/***/ (function(module, exports, __webpack_require__) {

module.exports = "<div class=\"modal-shadow tip-modal\" (click)=\"stopPropagation($event)\">\n    <div class=\"modal-content\" [ngClass]=\"{'paddingBottomNone': info && info.success}\">\n        <h2 class=\"modal-title\">\n            {{info && info.title ? info.title : ''}}\n            <span class=\"modal-close\" (click)=\"modalTip($event)\"></span>\n        </h2>\n        <div class=\"modal-warn-tip\">\n            <img src=\"" + __webpack_require__(776) + "\" class=\"tip-modal-success\" *ngIf=\"info && info.success && info.success === 1\">\n            <img src=\"" + __webpack_require__(492) + "\" class=\"tip-modal-error\" *ngIf=\"info && info.success && info.success === 2\">\n            {{info && info.tip ? info.tip : ''}}\n            <p class=\"sub-tip\" *ngIf=\"info && info.subTip\">{{info && info.subTip}}</p>\n        </div>\n        <p class=\"modal-btn\" *ngIf=\"!info || !info.success\">\n            <button *ngIf=\"!info.cancel\" type=\"button\" (click)=\"modalTip($event)\" class=\"btn-cancel btn-white\">取消</button>\n            <button type=\"button\" (click)=\"modalTip($event, info)\" class=\"btn-confirm btn-active\">确定</button>            \n        </p>\n    </div>\n</div>";

/***/ }),

/***/ 781:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.appAction = {
    errorApiTip: '[app] error api tip',
    tipModal: '[app] tip modal'
};


/***/ }),

/***/ 782:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var store_1 = __webpack_require__(32);
var actions_1 = __webpack_require__(104);
var global_1 = __webpack_require__(158);
__webpack_require__(1122);
var AppComponent = /** @class */ (function () {
    function AppComponent(store$) {
        this.store$ = store$;
        this.tipModal = {
            show: false,
            info: {}
        };
    }
    AppComponent.prototype.ngOnInit = function () {
        var _this = this;
        // 创建JIM 对象
        global_1.global.JIM = new JMessage();
        this.appStream$ = this.store$.select((function (state) {
            var appState = state['appReducer'];
            switch (appState.actionType) {
                case actions_1.appAction.errorApiTip:
                    _this.errorApiTip(appState.errorApiTip);
                    break;
                case actions_1.appAction.tipModal:
                    _this.tipModal = appState.tipModal;
                    break;
                default:
            }
            return state;
        })).subscribe((function (state) {
            // pass
        }));
    };
    AppComponent.prototype.ngOnDestroy = function () {
        this.appStream$.unsubscribe();
    };
    AppComponent.prototype.modalTipEmit = function () {
        this.store$.dispatch({
            type: actions_1.appAction.tipModal,
            payload: {
                show: false,
                info: {}
            }
        });
    };
    // api调用错误提示统一处理
    AppComponent.prototype.errorApiTip = function (errorMsg) {
        if (errorMsg.hasOwnProperty('error')) {
            errorMsg = errorMsg.error;
        }
        var tip = errorMsg.text ? errorMsg.text + ' : ' : '';
        switch (errorMsg.code) {
            // 自定义提示语
            case -1:
                tip += errorMsg.myText ? errorMsg.myText : '';
                break;
            // 请求超时
            case -2:
                tip += '请求超时';
                break;
            case 880001:
                tip += '未知错误码';
                break;
            case 880002:
                tip += '参数不合法';
                break;
            case 880003:
                tip += '非法内容格式';
                break;
            case 880004:
                tip += '非法内容格式';
                break;
            case 880005:
                tip += '文件不存在';
                break;
            case 880006:
                tip += '注册之前先退出';
                break;
            case 880007:
                tip += '被限制注册';
                break;
            case 880008:
                tip += 'msg_id 非法';
                break;
            case 880101:
                tip += 'appkey不存在';
                break;
            case 880102:
                tip += '签名错误';
                break;
            case 880103:
                tip += '该用户不存在';
                break;
            case 880104:
                tip += '密码错误';
                break;
            case 880106:
                tip += '签名过期';
                break;
            case 880107:
                tip += '已经是登录状态';
                break;
            case 880109:
                tip += '重复登录操作';
                break;
            case 880110:
                tip += '多通道错误，更新sdk版本';
                break;
            case 880111:
                tip += '用户被禁用';
                break;
            case 880203:
                tip += '该用户不存在';
                break;
            case 880204:
                tip += '该群组不存在';
                break;
            case 880205:
                tip += '您不在该群组内';
                break;
            case 880206:
                tip += '消息大小超过限制';
                break;
            case 880207:
                tip += '您已被对方拉黑';
                break;
            case 880208:
                tip += '发送失败，此消息包含敏感词';
                break;
            case 880209:
                tip += '发送速度超过限制';
                break;
            case 880210:
                tip += '文件大小超过限制';
                break;
            case 880212:
                tip += '您被禁言了';
                break;
            case 880402:
                tip += '您没有创建群组的权限';
                break;
            case 880403:
                tip += '群数量到达上限';
                break;
            case 880404:
                tip += '群名字超过长度限制，创建失败';
                break;
            case 880405:
                tip += '群描述长度超过限制';
                break;
            case 880502:
                tip += '您不在该群组内';
                break;
            case 880602:
                tip += '添加的群成员为空';
                break;
            case 880603:
                tip += '您不在该群组内';
                break;
            case 880604:
                tip += '您没权限添加群成员';
                break;
            case 880606:
                tip += '成员列表中有用户没有被添加到群组的权限';
                break;
            case 880607:
                tip += '重复添加群成员';
                break;
            case 880608:
                tip += '群成员数量超过限制';
                break;
            case 880609:
                tip += '成员列表中存在成员的群组数量超过限制';
                break;
            case 880703:
                tip += '删除的群成员列表存在成员不属于该群组';
                break;
            case 880704:
                tip += '您没有删除群成员的权限';
                break;
            case 880705:
                tip += '成员列表中存在成员用户没权限删除';
                break;
            case 880803:
                tip += '群组名称长度超过限制';
                break;
            case 880804:
                tip += '群组描述长度超过限制';
                break;
            case 880903:
                tip += '成员列表中有成员不能被添加，添加失败';
                break;
            case 880904:
                tip += '重复添加';
                break;
            case 881002:
                tip += '成员列表中有不存在的成员';
                break;
            case 881101:
                tip += '该成员已处于免打扰状态';
                break;
            case 881102:
                tip += '该成员不处于免打扰状态';
                break;
            case 881103:
                tip += '该群组不存在';
                break;
            case 881104:
                tip += '用户不存在该群组中';
                break;
            case 881105:
                tip += '该群组已处于免打扰状态';
                break;
            case 881106:
                tip += '该群组不处于免打扰状态';
                break;
            case 881107:
                tip += '您已经设置了免打扰';
                break;
            case 881108:
                tip += '您没有设置免打扰';
                break;
            case 881201:
                tip += '群不存在，不能设置屏蔽';
                break;
            case 881202:
                tip += '您不在群里面，不能设置屏蔽';
                break;
            case 881203:
                tip += '您已经设置了屏蔽';
                break;
            case 881204:
                tip += '群未设置屏蔽';
                break;
            case 881301:
                tip += '该用户不存在';
                break;
            case 881302:
                tip += '你们已经是好友';
                break;
            case 881303:
                tip += '你们是非好友关系';
                break;
            case 881304:
                tip += '非法备注';
                break;
            case 881305:
                tip += '添加好友失败，邀请事件无效';
                break;
            case 881401:
                tip += '时间过长，不能撤回';
                break;
            case 881402:
                tip += '请求撤回方不是消息发送方';
                break;
            case 881403:
                tip += '消息不存在';
                break;
            case 881404:
                tip += '消息已经撤回';
                break;
            case 881501:
                tip += '用户不在聊天室';
                break;
            case 881502:
                tip += '用户被禁止发消息';
                break;
            case 881503:
                tip += '聊天室不存在';
                break;
            case 881504:
                tip += '消息长度超出限制';
                break;
            case 881507:
                tip += '用户已经在聊天室';
                break;
            case 881508:
                tip += '超过聊天室人数限制';
                break;
            case 881602:
                tip += '目标用户未登录';
                break;
            case 881604:
                tip += '消息长度超出限制';
                break;
            case 882001:
                tip += '系统内部错误';
                break;
            case 882003:
                tip += '参数不合法';
                break;
            case 882004:
                tip += '无效授权';
                break;
            case 882005:
                tip += '系统繁忙，稍后重试';
                break;
            case 898000:
                tip += '服务器内部错误';
                break;
            case 898003:
                tip += '无效的参数';
                break;
            default:
                tip += '操作失败';
        }
        this.store$.dispatch({
            type: actions_1.appAction.tipModal,
            payload: {
                show: true,
                info: {
                    title: '操作失败',
                    tip: tip,
                    actionType: '[app] error api tip show',
                    success: 2
                }
            }
        });
    };
    AppComponent = tslib_1.__decorate([
        core_1.Component({
            selector: 'my-app',
            template: __webpack_require__(779),
            styles: [__webpack_require__(1118)]
        }),
        tslib_1.__metadata("design:paramtypes", [store_1.Store])
    ], AppComponent);
    return AppComponent;
}());
exports.AppComponent = AppComponent;


/***/ }),

/***/ 783:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var router_1 = __webpack_require__(89);
var common_1 = __webpack_require__(28);
exports.ROUTES = [
    {
        path: 'login',
        loadChildren: function() { return __webpack_require__.e/* import() */(1).then(__webpack_require__.bind(null, 1125))  .then( (function(module) { return module['LoginModule']; }) ); }
    },
    {
        path: 'register',
        loadChildren: function() { return __webpack_require__.e/* import() */(2).then(__webpack_require__.bind(null, 1128))  .then( (function(module) { return module['RegisterModule']; }) ); }
    },
    {
        path: 'main',
        canActivate: [common_1.MainCanActivate],
        loadChildren: function() { return __webpack_require__.e/* import() */(0).then(__webpack_require__.bind(null, 1126))  .then( (function(module) { return module['MainModule']; }) ); },
        data: {
            preload: true
        }
    },
    {
        path: 'map/:pointer',
        loadChildren: function() { return __webpack_require__.e/* import() */(3).then(__webpack_require__.bind(null, 1127))  .then( (function(module) { return module['MapModule']; }) ); }
    },
    {
        path: '',
        redirectTo: '/login',
        pathMatch: 'full'
    },
    {
        path: '**',
        redirectTo: '/login',
        pathMatch: 'full'
    }
];
exports.routing = router_1.RouterModule.forRoot(exports.ROUTES, {
    useHash: true,
    preloadingStrategy: common_1.PreloadService
});


/***/ }),

/***/ 784:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var TipModalComponent = /** @class */ (function () {
    function TipModalComponent() {
        this.modalTipEmit = new core_1.EventEmitter();
        // pass
    }
    TipModalComponent.prototype.ngOnInit = function () {
        // pass
    };
    TipModalComponent.prototype.ngDoCheck = function () {
        var _this = this;
        // 自动消失
        if (this.info && this.info.success) {
            setTimeout((function () {
                _this.modalTipEmit.emit();
            }), 2000);
        }
    };
    TipModalComponent.prototype.stopPropagation = function (event) {
        event.stopPropagation();
    };
    TipModalComponent.prototype.modalTip = function (event, info) {
        event.stopPropagation();
        if (info) {
            this.modalTipEmit.emit(info);
        }
        else {
            this.modalTipEmit.emit();
        }
    };
    tslib_1.__decorate([
        core_1.Input(),
        tslib_1.__metadata("design:type", Object)
    ], TipModalComponent.prototype, "info", void 0);
    tslib_1.__decorate([
        core_1.Output(),
        tslib_1.__metadata("design:type", core_1.EventEmitter)
    ], TipModalComponent.prototype, "modalTipEmit", void 0);
    TipModalComponent = tslib_1.__decorate([
        core_1.Component({
            selector: 'tip-modal-component',
            template: __webpack_require__(780),
            styles: [__webpack_require__(1119)]
        }),
        tslib_1.__metadata("design:paramtypes", [])
    ], TipModalComponent);
    return TipModalComponent;
}());
exports.TipModalComponent = TipModalComponent;


/***/ }),

/***/ 785:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var common_1 = __webpack_require__(71);
var forms_1 = __webpack_require__(159);
var core_1 = __webpack_require__(1);
var tip_modal_component_1 = __webpack_require__(784);
var TipModalModule = /** @class */ (function () {
    function TipModalModule() {
    }
    TipModalModule = tslib_1.__decorate([
        core_1.NgModule({
            declarations: [
                tip_modal_component_1.TipModalComponent
            ],
            imports: [
                common_1.CommonModule,
                forms_1.FormsModule
            ],
            exports: [
                tip_modal_component_1.TipModalComponent
            ],
            providers: []
        })
    ], TipModalModule);
    return TipModalModule;
}());
exports.TipModalModule = TipModalModule;


/***/ }),

/***/ 786:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.chatAction = {
    changeActivePerson: '[chat] change active person',
    deleteConversationItem: '[chat] delete conversation item',
    receiveSingleMessage: '[chat] receive single message',
    receiveGroupMessage: '[chat] receive group message',
    receiveMessageSuccess: '[chat] receive message success',
    sendSinglePic: '[chat] send single picture',
    sendGroupPic: '[chat] send group pic',
    sendSingleFile: '[chat send single file',
    sendGroupFile: 'send group file',
    sendSingleMessage: '[chat] send single message',
    sendGroupMessage: '[chat] send group message',
    sendMsgComplete: 'send message complete',
    getConversation: '[chat] get conversation',
    getConversationSuccess: '[chat] get conversation success',
    getAllMessage: '[chat] get all message',
    getAllMessageSuccess: '[chat] get all message success',
    saveDraft: '[chat] save draft',
    watchOtherInfo: '[chat] watch other info',
    watchOtherInfoSuccess: '[chat] watch other info success',
    hideOtherInfo: '[chat] hide other info',
    groupSetting: '[chat] group setting',
    groupInfo: '[chat] group info',
    searchUserSuccess: '[chat] search user success',
    getSourceUrl: '[chat] get source url',
    groupDescription: '[chat] group description',
    groupName: '[chat] group name',
    updateGroupInfo: '[chat] update group info',
    getMemberAvatarUrl: '[chat] get member avatar url',
    getSingleAvatarUrl: '[chat] get single avatar url',
    changeGroupShield: '[chat] change shield',
    changeGroupShieldSuccess: '[chat] change shield success',
    changeGroupNoDisturb: '[chat] change no disturb',
    changeGroupNoDisturbSuccess: '[chat] change no disturb success',
    createOtherChat: '[chat] create other chat',
    addGroupMembersEvent: '[chat] add group members event',
    addGroupMembersEventSuccess: '[chat] add group members event success',
    getVoiceState: '[chat] get voice state',
    getVoiceStateSuccess: '[chat] get voice state success',
    playVideoShow: '[chat] play video show',
    updateGroupMembersEvent: '[chat] update group members',
    deleteGroupMembersEvent: '[chat] delete group members event',
    exitGroupEvent: '[chat] exit group event',
    createGroupEvent: '[chat] create group event',
    createGroupSuccessEvent: '[chat] create group success event',
    friendEvent: '[chat] friend invitation event',
    friendInvitationEventSuccess: '[chat] friend invitation event success',
    friendReplyEventSuccess: '[chat] friend reply event success',
    init: '[chat] init state',
    msgRetract: '[chat] message retract',
    msgRetractSuccess: '[chat] message retract success',
    msgRetractEvent: '[chat] message retract event',
    msgTransmit: '[chat] message transmit',
    msgTransmitSuccess: '[chat] message transmit success',
    searchMessageTransmit: '[chat] search message transmit',
    transmitSingleMessage: '[chat] transmit single message',
    transmitGroupMessage: '[chat] transmit group message',
    transmitSinglePic: '[chat] transmit single picture',
    transmitGroupPic: '[chat] transmit group picture',
    transmitSingleFile: '[chat] transmit single file',
    transmitGroupFile: '[chat] transmit group file',
    transmitSingleLocation: '[chat] transmit single location',
    transmitGroupLocation: '[chat] transmit group location',
    transmitMessageComplete: '[chat] transmit message complete',
    showVerifyModal: '[chat] show verify modal',
    addFriendConfirm: '[chat] add friend confirm',
    deleteSingleBlack: '[chat] delete single black',
    deleteSingleBlackSuccess: '[chat] delete single black success',
    deleteSingleNoDisturb: '[chat] delete single no disturb',
    deleteSingleNoDisturbSuccess: '[chat] delete single no disturb success',
    saveMemoName: '[chat] save memo name',
    saveMemoNameSuccess: '[chat] save memo name success',
    dispatchFriendList: '[chat] dispatch friend list',
    loadViewerImage: '[chat] load viewer image',
    loadViewerImageSuccess: '[chat] load viewer image success',
    getGroupMembers: '[chat] get group members',
    msgFile: '[chat] msg file',
    msgFileSuccess: '[chat] msg file success',
    fileImageLoad: '[chat] file image load',
    groupAvatar: '[chat] group avatar',
    conversationToTop: '[chat] conversation to top',
    conversationToTopSuccess: '[chat] conversation to top success',
    watchUnreadList: '[chat] watch unread list',
    watchUnreadListSuccess: '[chat] watch unread list success',
    addReceiptReportAction: '[chat] add receipt report action',
    addReceiptReport: '[chat] add receipt report',
    msgReceiptChangeEvent: '[chat] msg receipt change event',
    getFriendList: '[chat] get friend list',
    getFriendListSuccess: '[chat] get friend list success',
    updateGroupInfoEvent: '[chat] update group info event',
    updateGroupInfoEventSuccess: '[chat] update group info event success',
    deleteFriendSyncEvent: '[chat] delete friend sync event',
    addFriendSyncEvent: '[chat] add friend sync event',
    emptyUnreadNumSyncEvent: '[chat] empty unread num sync event',
    addSingleNoDisturbSyncEvent: '[chat] add single no disturb sync event',
    deleteSingleNoDisturbSyncEvent: '[chat] delete single no disturb sync event',
    addGroupNoDisturbSyncEvent: '[chat] add group no disturb sync event',
    deleteGroupNoDisturbSyncEvent: '[chat] delete group no disturb sync event',
    addGroupShieldSyncEvent: '[chat] add group shield sync event',
    deleteGroupShieldSyncEvent: '[chat] delete group shield sync event',
    addSingleBlackSyncEvent: '[chat] add single black sync event',
    deleteSingleBlackSyncEvent: '[chat] delete single black sync event',
    syncReceiveMessage: '[chat] sync receive message',
    userInfUpdateEvent: '[chat] user inf update event',
    userInfUpdateEventSuccess: '[chat] user inf update event success',
    updateUnreadCount: '[chat] update unread count',
    dispatchGroupList: '[chat] dispatch group list',
    createGroupSearchComplete: '[chat] create group search complete',
    emptyUnreadNum: '[chat] empty unread number',
    changeHideAll: '[chat] change hide all',
    inputMessage: '[chat] input message',
    receiveInputMessage: '[chat] receive input message',
    deleteGroupMemberSilence: '[chat] delete group member silence',
    addGroupMemberSilence: '[chat] add group member silence',
    deleteGroupMemberSilenceEvent: '[chat] delete group member silence event',
    addGroupMemberSilenceEvent: '[chat] add group member silence event',
    receiveGroupInvitationEvent: '[chat] receive group invitation event',
    receiveGroupInvitationEventSuccess: '[chat] receive group invitation event success',
    dispatchReceiveGroupInvitationEvent: '[chat] dispatch receive group invitation event',
    receiveGroupRefuseEvent: '[chat] receive group refuse event',
    receiveGroupRefuseEventSuccess: '[chat] receive group refuse event success',
    dispatchReceiveGroupRefuseEvent: '[chat] dispatch receive group refuse event',
    dispatchConversationUnreadNum: '[chat] dispatch conversation unread number'
};


/***/ }),

/***/ 787:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
__webpack_require__(453);
__webpack_require__(454);
__webpack_require__(452);
var core_1 = __webpack_require__(1);
var rxjs_1 = __webpack_require__(43);
var effects_1 = __webpack_require__(70);
var store_1 = __webpack_require__(32);
var router_1 = __webpack_require__(89);
var actions_1 = __webpack_require__(104);
var common_1 = __webpack_require__(28);
var actions_2 = __webpack_require__(107);
var actions_3 = __webpack_require__(90);
var util_1 = __webpack_require__(72);
var actions_4 = __webpack_require__(124);
var ChatEffect = /** @class */ (function () {
    function ChatEffect(actions$, store$, router, storageService, apiService) {
        var _this = this;
        this.actions$ = actions$;
        this.store$ = store$;
        this.router = router;
        this.storageService = storageService;
        this.apiService = apiService;
        // 同步自己发送的消息
        this.syncReceiveMessage$ = this.actions$
            .ofType(actions_2.chatAction.syncReceiveMessage)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var content, promises;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        content = info.data.messages[0].content;
                        promises = [];
                        // 如果是文件或者图片
                        this.getMediaUrl(info, promises);
                        // 如果是名片
                        this.getCardResource(content, info, promises);
                        return [4 /*yield*/, Promise.all(promises)];
                    case 1:
                        _a.sent();
                        this.store$.dispatch({
                            type: actions_2.chatAction.receiveMessageSuccess,
                            payload: info.data
                        });
                        return [2 /*return*/, { type: '[chat] sync receive message useless' }];
                }
            }));
        })); }));
        // 接收到单聊新消息
        this.receiveSingleMessage$ = this.actions$
            .ofType(actions_2.chatAction.receiveSingleMessage)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var promises, content, result, messages;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        promises = [];
                        content = info.data.messages[0].content;
                        // 如果接收的是图片或者文件
                        this.getMediaUrl(info, promises);
                        result = info.conversation.filter((function (conversation) {
                            return info.data.messages[0].content.from_id === conversation.name;
                        }));
                        if (result.length === 0) {
                            messages = info.data.messages[0];
                            this.getMsgAvatarUrl(messages, promises);
                        }
                        else {
                            // 给已有的单聊用户添加头像
                            content.avatarUrl = result[0].avatarUrl;
                        }
                        // 如果接收的是名片
                        this.getCardResource(content, info, promises);
                        return [4 /*yield*/, Promise.all(promises)];
                    case 1:
                        _a.sent();
                        this.store$.dispatch({
                            type: actions_2.chatAction.receiveMessageSuccess,
                            payload: info.data
                        });
                        return [2 /*return*/, { type: '[chat] receive single message useless' }];
                }
            }));
        })); }));
        // 接收到群聊新消息
        this.receiveGroupMessage$ = this.actions$
            .ofType(actions_2.chatAction.receiveGroupMessage)
            .map(effects_1.toPayload)
            .switchMap((function (obj) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var promises, messages, messageList, flag, content, _i, messageList_1, list, i, hasLoadAvatar;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        promises = [];
                        messages = obj.data.messages[0];
                        messageList = obj.messageList;
                        flag = false;
                        content = messages.content;
                        // 如果接收的是图片或者文件
                        this.getMediaUrl(obj, promises);
                        // 如果接收的是名片
                        this.getCardResource(content, obj, promises);
                        // 判断是否消息列表中已经加载过头像
                        for (_i = 0, messageList_1 = messageList; _i < messageList_1.length; _i++) {
                            list = messageList_1[_i];
                            if (list.type === 4 && Number(list.key) === Number(messages.key)
                                && list.msgs.length > 0) {
                                for (i = list.msgs.length - 1; i >= 0; i--) {
                                    hasLoadAvatar = list.msgs[i].content.hasOwnProperty('avatarUrl');
                                    if (list.msgs[i].content.from_id === messages.content.from_id
                                        && hasLoadAvatar) {
                                        messages.content.avatarUrl = list.msgs[i].content.avatarUrl;
                                        flag = true;
                                        break;
                                    }
                                }
                                break;
                            }
                        }
                        if (!flag) {
                            this.getMsgAvatarUrl(messages, promises);
                        }
                        return [4 /*yield*/, Promise.all(promises)];
                    case 1:
                        _a.sent();
                        this.store$.dispatch({
                            type: actions_2.chatAction.receiveMessageSuccess,
                            payload: obj.data
                        });
                        return [2 /*return*/, { type: '[chat] receive message useless' }];
                }
            }));
        })); }));
        // 获取storage里的voice状态
        this.getVoiceState$ = this.actions$
            .ofType(actions_2.chatAction.getVoiceState)
            .map(effects_1.toPayload)
            .switchMap((function (key) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var voiceState;
            return tslib_1.__generator(this, (function (_a) {
                voiceState = this.storageService.get(key);
                if (voiceState) {
                    this.store$.dispatch({
                        type: actions_2.chatAction.getVoiceStateSuccess,
                        payload: JSON.parse(voiceState)
                    });
                }
                return [2 /*return*/, { type: '[chat] get voice state useless' }];
            }));
        })); }));
        // 获取好友列表
        this.getFriendList$ = this.actions$
            .ofType(actions_2.chatAction.getFriendList)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var data, payload, _loop_1, this_1, _i, _a, friend;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.apiService.getFriendList()];
                    case 1:
                        data = _b.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            payload = void 0;
                            if (info === 'api') {
                                payload = {
                                    friendList: data.friend_list,
                                    type: info
                                };
                            }
                            else {
                                payload = data.friend_list;
                            }
                            this.store$.dispatch({
                                type: actions_2.chatAction.getFriendListSuccess,
                                payload: payload
                            });
                            _loop_1 = function (friend) {
                                if (friend.avatar && friend.avatar !== '') {
                                    var urlObj = { media_id: friend.avatar };
                                    this_1.apiService.getResource(urlObj).then((function (urlInfo) {
                                        if (!urlInfo.code) {
                                            friend.avatarUrl = urlInfo.url;
                                        }
                                    }));
                                }
                            };
                            this_1 = this;
                            for (_i = 0, _a = data.friend_list; _i < _a.length; _i++) {
                                friend = _a[_i];
                                _loop_1(friend);
                            }
                        }
                        return [2 /*return*/, { type: '[chat] get friend list useless' }];
                }
            }));
        })); }));
        // 获取messageList 图片消息url
        this.getSourceUrl$ = this.actions$
            .ofType(actions_2.chatAction.getSourceUrl)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var resourceArray, msgs, end, _loop_2, this_2, i;
            var _this = this;
            return tslib_1.__generator(this, (function (_a) {
                resourceArray = [];
                msgs = info.messageList[info.active.activeIndex].msgs;
                end = msgs.length - (info.loadingCount - 1) * common_1.pageNumber;
                this.store$.dispatch({
                    type: actions_2.chatAction.getAllMessageSuccess,
                    payload: info.messageList
                });
                // 滚动加载资源路径
                if (end >= 1) {
                    _loop_2 = function (i) {
                        if (msgs[i].hasLoad) {
                            return "continue";
                        }
                        msgs[i].hasLoad = true;
                        var msgBody = msgs[i].content.msg_body;
                        if (msgBody.media_id && !msgBody.media_url) {
                            var urlObj = { media_id: msgBody.media_id };
                            this_2.apiService.getResource(urlObj).then((function (urlInfo) {
                                if (urlInfo.code) {
                                    msgs[i].content.msg_body.media_url = '';
                                }
                                else {
                                    msgs[i].content.msg_body.media_url = urlInfo.url;
                                    _this.store$.dispatch({
                                        type: actions_2.chatAction.getAllMessageSuccess,
                                        payload: info.messageList
                                    });
                                }
                            }));
                        }
                        else if (msgBody.extras && msgBody.extras.businessCard) {
                            var userObj = {
                                username: msgBody.extras.userName
                            };
                            this_2.apiService.getUserInfo(userObj).then((function (data) {
                                if (!data.code) {
                                    msgBody.extras.nickName = data.user_info.nickname;
                                    msgBody.extras.media_url = '';
                                    if (data.user_info.avatar !== '') {
                                        var urlObj = { media_id: data.user_info.avatar };
                                        _this.apiService.getResource(urlObj).then((function (urlInfo) {
                                            if (!urlInfo.code) {
                                                msgBody.extras.media_url = urlInfo.url;
                                            }
                                        }));
                                    }
                                }
                            }));
                        }
                    };
                    this_2 = this;
                    for (i = end - 1; i >= end - common_1.pageNumber && i >= 0; i--) {
                        _loop_2(i);
                    }
                }
                return [2 /*return*/, { type: '[chat] get source url useless' }];
            }));
        })); }));
        // 获取messageList avatar url
        this.getMemberAvatarUrl$ = this.actions$
            .ofType(actions_2.chatAction.getMemberAvatarUrl)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userArr, msgs, end, i, flag, j, _loop_3, this_3, _i, userArr_1, user;
            var _this = this;
            return tslib_1.__generator(this, (function (_a) {
                userArr = [];
                msgs = info.messageList[info.active.activeIndex].msgs;
                end = msgs.length - (info.loadingCount - 1) * common_1.pageNumber;
                this.store$.dispatch({
                    type: actions_2.chatAction.getAllMessageSuccess,
                    payload: info.messageList
                });
                for (i = end - 1; i >= end - common_1.pageNumber && i >= 0 && end >= 1; i--) {
                    // 如果是已经加载过头像的用户
                    if (info.loadingCount !== 1) {
                        flag = false;
                        for (j = end; j < msgs.length; j++) {
                            if (msgs[i].content.from_id === msgs[j].content.from_id) {
                                if (msgs[j].content.avatarUrl) {
                                    msgs[i].content.avatarUrl = msgs[j].content.avatarUrl;
                                    flag = true;
                                }
                                break;
                            }
                        }
                        if (flag) {
                            continue;
                        }
                    }
                    msgs[i].content.avatarUrl = '';
                    // 第一次加载头像的用户
                    if (msgs[i].content.from_id !== common_1.global.user &&
                        userArr.indexOf(msgs[i].content.from_id) < 0) {
                        userArr.push(msgs[i].content.from_id);
                    }
                }
                _loop_3 = function (user) {
                    var userObj = {
                        username: user
                    };
                    this_3.apiService.getUserInfo(userObj).then((function (data) {
                        if (!data.code && data.user_info.avatar !== '') {
                            var urlObj = { media_id: data.user_info.avatar };
                            _this.apiService.getResource(urlObj).then((function (urlInfo) {
                                if (!urlInfo.code) {
                                    for (var i = end - 1; i >= end - common_1.pageNumber && i >= 0 && end >= 1; i--) {
                                        if (msgs[i].content.from_id === user) {
                                            msgs[i].content.avatarUrl = urlInfo.url;
                                        }
                                    }
                                }
                            }));
                        }
                    }));
                };
                this_3 = this;
                for (_i = 0, userArr_1 = userArr; _i < userArr_1.length; _i++) {
                    user = userArr_1[_i];
                    _loop_3(user);
                }
                return [2 /*return*/, { type: '[chat] get member avatar url useless' }];
            }));
        })); }));
        // 获取所有漫游同步消息、获取群屏蔽列表、获取免打扰列表
        this.getAllMessage$ = this.actions$
            .ofType(actions_2.chatAction.getAllMessage)
            .map(effects_1.toPayload)
            .switchMap((function (data) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var _i, data_1, dataItem, j, _a, _b, receiptMsg, _c, _d, message, info, i, topArr, notopArr, _e, _f, conversation, i, j, temp, promises, _loop_4, this_4, _g, _h, conversation, noDisturb_1, pro1, shield_1, pro2, _loop_5, this_5, _j, _k, conversation;
            var _this = this;
            return tslib_1.__generator(this, (function (_l) {
                switch (_l.label) {
                    case 0:
                        for (_i = 0, data_1 = data; _i < data_1.length; _i++) {
                            dataItem = data_1[_i];
                            for (j = 0; j < dataItem.msgs.length; j++) {
                                if (j + 1 < dataItem.msgs.length || dataItem.msgs.length === 1) {
                                    if (j === 0) {
                                        dataItem.msgs[j].time_show =
                                            util_1.Util.reducerDate(dataItem.msgs[j].ctime_ms);
                                    }
                                    if (j + 1 !== dataItem.msgs.length) {
                                        if (util_1.Util.fiveMinutes(dataItem.msgs[j].ctime_ms, dataItem.msgs[j + 1].ctime_ms)) {
                                            dataItem.msgs[j + 1].time_show =
                                                util_1.Util.reducerDate(dataItem.msgs[j + 1].ctime_ms);
                                        }
                                    }
                                }
                            }
                            for (_a = 0, _b = dataItem.receipt_msgs; _a < _b.length; _a++) {
                                receiptMsg = _b[_a];
                                for (_c = 0, _d = dataItem.msgs; _c < _d.length; _c++) {
                                    message = _d[_c];
                                    if (receiptMsg.msg_id === message.msg_id) {
                                        message.unread_count = receiptMsg.unread_count;
                                        break;
                                    }
                                }
                            }
                            if (dataItem.msgs.length > 0) {
                                if (dataItem.msgs[0].msg_type === 3) {
                                    dataItem.type = 3;
                                    if (dataItem.msgs[0].content.from_id === common_1.global.user) {
                                        dataItem.name = dataItem.msgs[0].content.target_id;
                                        dataItem.appkey = dataItem.msgs[0].content.target_appkey;
                                    }
                                    else if (dataItem.msgs[0].content.target_id === common_1.global.user) {
                                        dataItem.name = dataItem.msgs[0].content.from_id;
                                        dataItem.appkey = dataItem.msgs[0].content.from_appkey;
                                    }
                                }
                                else if (dataItem.msgs[0].msg_type === 4) {
                                    dataItem.type = 4;
                                }
                            }
                        }
                        return [4 /*yield*/, this.apiService.getConversation()];
                    case 1:
                        info = _l.sent();
                        if (!info.code) return [3 /*break*/, 2];
                        this.errorFn(info);
                        return [3 /*break*/, 4];
                    case 2:
                        // 删除feedBack_
                        for (i = 0; i < info.conversations.length; i++) {
                            info.conversations[i].unreadNum = info.conversations[i].unread_msg_count;
                            if (info.conversations[i].name.match(/^feedback_/g)) {
                                info.conversations.splice(i, 1);
                            }
                        }
                        info.conversations.reverse();
                        topArr = [];
                        notopArr = [];
                        for (_e = 0, _f = info.conversations; _e < _f.length; _e++) {
                            conversation = _f[_e];
                            if (conversation.extras && conversation.extras.top_time_ms) {
                                topArr.push(conversation);
                            }
                            else {
                                notopArr.push(conversation);
                            }
                        }
                        for (i = 0; i < topArr.length; i++) {
                            for (j = i + 1; j < topArr.length; j++) {
                                if (topArr[i].extras.top_time_ms > topArr[j].extras.top_time_ms) {
                                    temp = topArr[i];
                                    topArr[i] = topArr[j];
                                    topArr[j] = temp;
                                }
                            }
                        }
                        info.conversations = topArr.concat(notopArr);
                        promises = [];
                        _loop_4 = function (conversation) {
                            if (conversation.type === 4 && conversation.name === '') {
                                var groupObj = { gid: conversation.key };
                                var pro = this_4.apiService.getGroupMembers(groupObj).then((function (group) {
                                    if (group.code) {
                                        conversation.name = '#群名获取失败？？';
                                        _this.errorFn(group);
                                    }
                                    else {
                                        var name_1 = '';
                                        for (var _i = 0, _a = group.member_list; _i < _a.length; _i++) {
                                            var member = _a[_i];
                                            name_1 += (member.nickName || member.nickname ||
                                                member.username || member.name) + '、';
                                        }
                                        if (name_1.length > 20) {
                                            conversation.name = name_1.substr(0, 20);
                                        }
                                        else {
                                            conversation.name = name_1.substr(0, name_1.length - 1);
                                        }
                                        conversation.target_name = conversation.name;
                                        conversation.group_name = conversation.name;
                                    }
                                }));
                                promises.push(pro);
                            }
                        };
                        this_4 = this;
                        for (_g = 0, _h = info.conversations; _g < _h.length; _g++) {
                            conversation = _h[_g];
                            _loop_4(conversation);
                        }
                        pro1 = this.apiService.getNoDisturb().then((function (noDisturbList) {
                            if (noDisturbList.code) {
                                _this.errorFn(noDisturbList);
                            }
                            else {
                                noDisturb_1 = noDisturbList.no_disturb;
                            }
                        }));
                        pro2 = this.apiService.groupShieldList().then((function (groupList) {
                            if (groupList.code) {
                                _this.errorFn(groupList);
                            }
                            else {
                                shield_1 = groupList.groups;
                            }
                        }));
                        promises.push(pro1);
                        promises.push(pro2);
                        return [4 /*yield*/, Promise.all(promises)];
                    case 3:
                        _l.sent();
                        this.store$.dispatch({
                            type: actions_2.chatAction.getConversationSuccess,
                            payload: {
                                conversation: info.conversations,
                                storage: true,
                                messageList: data,
                                noDisturb: noDisturb_1,
                                shield: shield_1
                            }
                        });
                        this.store$.dispatch({
                            type: actions_2.chatAction.getFriendList,
                            payload: 'first'
                        });
                        this.store$.dispatch({
                            type: actions_4.contactAction.getGroupList,
                            payload: 'first'
                        });
                        _loop_5 = function (conversation) {
                            if (conversation.avatar && conversation.avatar !== '') {
                                var urlObj = { media_id: conversation.avatar };
                                this_5.apiService.getResource(urlObj).then((function (urlInfo) {
                                    if (!urlInfo.code) {
                                        conversation.avatarUrl = urlInfo.url;
                                    }
                                }));
                            }
                        };
                        this_5 = this;
                        // 加载会话头像
                        for (_j = 0, _k = info.conversations; _j < _k.length; _j++) {
                            conversation = _k[_j];
                            _loop_5(conversation);
                        }
                        _l.label = 4;
                    case 4: return [2 /*return*/, { type: '[chat] get all messageList useless' }];
                }
            }));
        })); }));
        // 发送单人文本消息
        this.sendMessage$ = this.actions$
            .ofType(actions_2.chatAction.sendSingleMessage)
            .map(effects_1.toPayload)
            .filter((function (data) {
            if (!data.singleMsg.content) {
                return false;
            }
            return data;
        })).switchMap((function (text) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendSingleMsg(text.singleMsg)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.key,
                                    success: 3,
                                    name: text.active.name,
                                    type: 3
                                }
                            });
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.key,
                                    success: 2,
                                    msgs: msgs,
                                    name: text.active.name,
                                    type: 3
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] send single message useless' }];
                }
            }));
        })); }));
        // 转发单人文本消息
        this.transmitMessage$ = this.actions$
            .ofType(actions_2.chatAction.transmitSingleMessage)
            .map(effects_1.toPayload)
            .switchMap((function (text) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        msgBody = {
                            text: text.msgs.content.msg_body.text,
                            extras: text.msgs.content.msg_body.extras
                        };
                        msgObj = {
                            target_username: text.select.name,
                            target_nickname: text.select.nickName,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendSingleMsg(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.select.key,
                                    success: 3,
                                    name: text.select.name,
                                    type: 3
                                }
                            });
                            if (text.transmitMsg) {
                                msgs.text = text.select.memo_name || text.select.nickName || text.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.select.key,
                                    success: 2,
                                    msgs: msgs,
                                    name: text.select.name,
                                    type: 3
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit single message useless' }];
                }
            }));
        })); }));
        // 发送群组文本消息
        this.sendGroupMessage$ = this.actions$
            .ofType(actions_2.chatAction.sendGroupMessage)
            .map(effects_1.toPayload)
            .filter((function (data) {
            if (!data.groupMsg.content) {
                return false;
            }
            return data;
        })).switchMap((function (text) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendGroupMsg(text.groupMsg)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] send group message useless' }];
                }
            }));
        })); }));
        // 转发群组文本消息
        this.transmitGroupMessage$ = this.actions$
            .ofType(actions_2.chatAction.transmitGroupMessage)
            .map(effects_1.toPayload)
            .switchMap((function (text) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        msgBody = {
                            text: text.msgs.content.msg_body.text,
                            extras: text.msgs.content.msg_body.extras
                        };
                        msgObj = {
                            target_gid: text.select.key,
                            target_gname: text.select.name,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendGroupMsg(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.select.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            if (text.transmitMsg) {
                                msgs.text = text.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: text.msgs.msgKey,
                                    key: text.select.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit group message useless' }];
                }
            }));
        })); }));
        // 发送单聊图片消息
        this.sendSinglePic$ = this.actions$
            .ofType(actions_2.chatAction.sendSinglePic)
            .map(effects_1.toPayload)
            .switchMap((function (img) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendSinglePic(img.singlePicFormData)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 3,
                                    name: img.active.name,
                                    type: 3
                                }
                            });
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 2,
                                    msgs: msgs,
                                    name: img.active.name,
                                    type: 3
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] send single picture useless' }];
                }
            }));
        })); }));
        // 转发单聊图片消息
        this.transmitSinglePic$ = this.actions$
            .ofType(actions_2.chatAction.transmitSinglePic)
            .map(effects_1.toPayload)
            .switchMap((function (img) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var body, msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        body = img.msgs.content.msg_body;
                        msgBody = {
                            media_id: body.media_id,
                            media_crc32: body.media_crc32,
                            width: body.width,
                            height: body.height,
                            format: body.format,
                            fsize: body.fsize,
                            extras: body.extras
                        };
                        msgObj = {
                            target_username: img.select.name,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendSinglePic(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 3,
                                    name: img.select.name,
                                    type: 3
                                }
                            });
                            if (img.transmitMsg) {
                                msgs.text = img.select.memo_name || img.select.nickName || img.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 2,
                                    msgs: msgs,
                                    name: img.select.name,
                                    type: 3
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit single picture useless' }];
                }
            }));
        })); }));
        // 发送群组图片消息
        this.sendGroupPic$ = this.actions$
            .ofType(actions_2.chatAction.sendGroupPic)
            .map(effects_1.toPayload)
            .switchMap((function (img) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendGroupPic(img.groupPicFormData)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] send group pic useless' }];
                }
            }));
        })); }));
        // 转发群组图片消息
        this.transmitGroupPic$ = this.actions$
            .ofType(actions_2.chatAction.transmitGroupPic)
            .map(effects_1.toPayload)
            .switchMap((function (img) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var body, msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        body = img.msgs.content.msg_body;
                        msgBody = {
                            media_id: body.media_id,
                            media_crc32: body.media_crc32,
                            width: body.width,
                            height: body.height,
                            format: body.format,
                            fsize: body.fsize,
                            extras: body.extras
                        };
                        msgObj = {
                            target_gid: img.select.key,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendGroupPic(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            if (img.transmitMsg) {
                                msgs.text = img.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: img.msgs.msgKey,
                                    key: img.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit group pic useless' }];
                }
            }));
        })); }));
        // 发送单聊文件消息
        this.sendSingleFile$ = this.actions$
            .ofType(actions_2.chatAction.sendSingleFile)
            .map(effects_1.toPayload)
            .switchMap((function (file) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendSingleFile(file.singleFile)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 3,
                                    type: 3,
                                    name: file.active.name
                                }
                            });
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 3,
                                    name: file.active.name
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] send single file useless' }];
                }
            }));
        })); }));
        // 转发单聊文件消息
        this.transmitSingleFile$ = this.actions$
            .ofType(actions_2.chatAction.transmitSingleFile)
            .map(effects_1.toPayload)
            .switchMap((function (file) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var body, msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        body = file.msgs.content.msg_body;
                        msgBody = {
                            media_id: body.media_id,
                            media_crc32: body.media_crc32,
                            hash: body.hash,
                            fname: body.fname,
                            fsize: body.fsize,
                            extras: body.extras
                        };
                        msgObj = {
                            target_username: file.select.name,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendSingleFile(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 3,
                                    name: file.select.name,
                                    type: 3
                                }
                            });
                            if (file.transmitMsg) {
                                msgs.text = file.select.memo_name || file.select.nickName || file.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 2,
                                    msgs: msgs,
                                    name: file.select.name,
                                    type: 3
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit single file useless' }];
                }
            }));
        })); }));
        // 发送群组文件消息
        this.sendGroupFile$ = this.actions$
            .ofType(actions_2.chatAction.sendGroupFile)
            .map(effects_1.toPayload)
            .switchMap((function (file) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendGroupFile(file.groupFile)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.sendMsgComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] send group file useless' }];
                }
            }));
        })); }));
        // 转发群组文件消息
        this.transmitGroupFile$ = this.actions$
            .ofType(actions_2.chatAction.transmitGroupFile)
            .map(effects_1.toPayload)
            .switchMap((function (file) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var body, msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        body = file.msgs.content.msg_body;
                        msgBody = {
                            media_id: body.media_id,
                            media_crc32: body.media_crc32,
                            hash: body.hash,
                            fname: body.fname,
                            fsize: body.fsize,
                            extras: body.extras
                        };
                        msgObj = {
                            target_gid: file.select.key,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendGroupFile(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            if (file.transmitMsg) {
                                msgs.text = file.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: file.msgs.msgKey,
                                    key: file.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit group file useless' }];
                }
            }));
        })); }));
        // 转发单聊位置消息
        this.transmitSingleLocation$ = this.actions$
            .ofType(actions_2.chatAction.transmitSingleLocation)
            .map(effects_1.toPayload)
            .switchMap((function (location) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var body, msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        body = location.msgs.content.msg_body;
                        msgBody = {
                            latitude: body.latitude,
                            longitude: body.longitude,
                            scale: body.scale,
                            label: body.label,
                            fsize: body.fsize,
                            extras: body.extras
                        };
                        msgObj = {
                            target_username: location.select.name,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendSingleLocation(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: location.msgs.msgKey,
                                    key: location.key,
                                    success: 3,
                                    name: location.select.name,
                                    type: 3
                                }
                            });
                            if (location.transmitMsg) {
                                msgs.text = location.select.memo_name ||
                                    location.select.nickName || location.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.unread_count = 1;
                            msgs.msg_type = 3;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: location.msgs.msgKey,
                                    key: location.key,
                                    success: 2,
                                    msgs: msgs,
                                    name: location.select.name,
                                    type: 3
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit single location useless' }];
                }
            }));
        })); }));
        // 转发群组位置消息
        this.transmitGroupLocation$ = this.actions$
            .ofType(actions_2.chatAction.transmitGroupLocation)
            .map(effects_1.toPayload)
            .switchMap((function (location) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var body, msgBody, msgObj, msgs;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        body = location.msgs.content.msg_body;
                        msgBody = {
                            latitude: body.latitude,
                            longitude: body.longitude,
                            scale: body.scale,
                            label: body.label,
                            fsize: body.fsize,
                            extras: body.extras
                        };
                        msgObj = {
                            target_gid: location.select.key,
                            msg_body: msgBody,
                            need_receipt: true
                        };
                        return [4 /*yield*/, this.apiService.sendGroupLocation(msgObj)];
                    case 1:
                        msgs = _a.sent();
                        if (msgs.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: location.msgs.msgKey,
                                    key: location.key,
                                    success: 3,
                                    type: 4
                                }
                            });
                            if (location.transmitMsg) {
                                msgs.text = location.select.name;
                            }
                            this.errorFn(msgs);
                        }
                        else {
                            msgs.msg_type = 4;
                            this.store$.dispatch({
                                type: actions_2.chatAction.transmitMessageComplete,
                                payload: {
                                    msgKey: location.msgs.msgKey,
                                    key: location.key,
                                    success: 2,
                                    msgs: msgs,
                                    type: 4
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] transmit group location useless' }];
                }
            }));
        })); }));
        // 查看别人的资料
        this.watchOtherInfo$ = this.actions$
            .ofType(actions_2.chatAction.watchOtherInfo)
            .map(effects_1.toPayload)
            .switchMap((function (other) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = {
                            username: other.username
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 6];
                    case 2:
                        data.user_info.name = data.user_info.username;
                        data.user_info.nickName = data.user_info.nickname;
                        data.user_info.infoType = 'watchOtherInfo';
                        if (!(other.hasOwnProperty('avatarUrl') || data.user_info.avatar === '')) return [3 /*break*/, 3];
                        data.user_info.avatarUrl = other.avatarUrl ? other.avatarUrl : '';
                        return [3 /*break*/, 5];
                    case 3:
                        urlObj = { media_id: data.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 4:
                        urlInfo = _a.sent();
                        if (!urlInfo.code) {
                            data.user_info.avatarUrl = urlInfo.url;
                        }
                        _a.label = 5;
                    case 5:
                        this.store$.dispatch({
                            type: actions_2.chatAction.watchOtherInfoSuccess,
                            payload: {
                                info: data.user_info,
                                show: true
                            }
                        });
                        _a.label = 6;
                    case 6: return [2 /*return*/, { type: '[chat] watch other info useless' }];
                }
            }));
        })); }));
        // 获取群组信息
        this.groupInfo$ = this.actions$
            .ofType(actions_2.chatAction.groupSetting)
            .map(effects_1.toPayload)
            .filter((function (data) {
            if (data.show === false || data.active.type === 3 || data.isCache) {
                return false;
            }
            return data;
        })).switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var activeObj, data, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        activeObj = { gid: info.active.key };
                        return [4 /*yield*/, this.apiService.getGroupInfo(activeObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.store$.dispatch({
                            type: actions_2.chatAction.groupInfo,
                            payload: {
                                groupInfo: {}
                            }
                        });
                        this.errorFn(data);
                        return [3 /*break*/, 5];
                    case 2:
                        if (!(data.group_info.avatar && data.group_info.avatar !== '')) return [3 /*break*/, 4];
                        urlObj = { media_id: data.group_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        urlInfo = _a.sent();
                        if (!urlInfo.code) {
                            data.group_info.avatarUrl = urlInfo.url;
                        }
                        _a.label = 4;
                    case 4:
                        this.store$.dispatch({
                            type: actions_2.chatAction.groupInfo,
                            payload: {
                                groupInfo: data.group_info
                            }
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[chat] group setting useless' }];
                }
            }));
        })); }));
        // 获取群成员信息
        this.getGroupMembers$ = this.actions$
            .ofType(actions_2.chatAction.getGroupMembers)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var infoObj, data, _loop_6, this_6, _i, _a, member;
            var _this = this;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0:
                        infoObj = { gid: info.key };
                        return [4 /*yield*/, this.apiService.getGroupMembers(infoObj)];
                    case 1:
                        data = _b.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            util_1.Util.getMembersFirstLetter(data.member_list);
                            this.store$.dispatch({
                                type: actions_2.chatAction.groupInfo,
                                payload: {
                                    memberList: data.member_list,
                                    key: info.key
                                }
                            });
                            _loop_6 = function (member) {
                                if (member.avatar !== '') {
                                    var urlObj = { media_id: member.avatar };
                                    this_6.apiService.getResource(urlObj).then((function (result) {
                                        if (!result.code) {
                                            member.avatarUrl = result.url;
                                            _this.store$.dispatch({
                                                type: actions_2.chatAction.groupInfo,
                                                payload: {
                                                    memberList: data.member_list,
                                                    key: info.key
                                                }
                                            });
                                        }
                                    }));
                                }
                            };
                            this_6 = this;
                            for (_i = 0, _a = data.member_list; _i < _a.length; _i++) {
                                member = _a[_i];
                                _loop_6(member);
                            }
                        }
                        return [2 /*return*/, { type: '[chat] get group memebers useless' }];
                }
            }));
        })); }));
        // 更新群组资料
        this.updateGroupInfo$ = this.actions$
            .ofType(actions_2.chatAction.updateGroupInfo)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var requestObj, data;
            return tslib_1.__generator(this, (function (_a) {
                requestObj = {
                    gid: info.gid
                };
                if (info.actionType) {
                    if (info.actionType === 'modifyName') {
                        requestObj.group_name = info.name;
                    }
                    else if (info.actionType === 'modifyDescription') {
                        requestObj.group_description = info.desc;
                    }
                    else if (info.actionType === 'modifyGroupAvatar') {
                        requestObj.avatar = info.avatar;
                    }
                }
                data = this.apiService.updateGroupInfo(requestObj);
                if (data.code) {
                    this.errorFn(data);
                }
                else {
                    if (info.actionType && info.actionType === 'modifyDescription') {
                        this.store$.dispatch({
                            type: actions_2.chatAction.groupDescription,
                            payload: {
                                data: data,
                                show: false
                            }
                        });
                    }
                    else if (info.actionType && info.actionType === 'modifyGroupAvatar') {
                        this.store$.dispatch({
                            type: actions_3.mainAction.showModalTip,
                            payload: {
                                show: true,
                                info: {
                                    title: '修改群头像',
                                    tip: '修改群头像成功',
                                    actionType: '[chat] modify group avatar success useless',
                                    success: 1
                                }
                            }
                        });
                    }
                }
                return [2 /*return*/, { type: '[chat] update group info useless' }];
            }));
        })); }));
        // 切换群屏蔽
        this.changeGroupShield$ = this.actions$
            .ofType(actions_2.chatAction.changeGroupShield)
            .map(effects_1.toPayload)
            .switchMap((function (active) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var activeObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        activeObj = { gid: active.key };
                        if (!active.shield) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.apiService.delGroupShield(activeObj)];
                    case 1:
                        data = _a.sent();
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, this.apiService.addGroupShield(activeObj)];
                    case 3:
                        data = _a.sent();
                        _a.label = 4;
                    case 4:
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            active.shield = !active.shield;
                            this.store$.dispatch({
                                type: actions_2.chatAction.changeGroupShieldSuccess,
                                payload: active
                            });
                        }
                        return [2 /*return*/, { type: '[chat] change group shield useless' }];
                }
            }));
        })); }));
        // 切换群免打扰
        this.changeGroupNoDisturb$ = this.actions$
            .ofType(actions_2.chatAction.changeGroupNoDisturb)
            .map(effects_1.toPayload)
            .switchMap((function (active) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var activeObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        activeObj = { gid: active.key };
                        if (!active.noDisturb) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.apiService.delGroupNoDisturb(activeObj)];
                    case 1:
                        data = _a.sent();
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, this.apiService.addGroupNoDisturb(activeObj)];
                    case 3:
                        data = _a.sent();
                        _a.label = 4;
                    case 4:
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            active.noDisturb = !active.noDisturb;
                            this.store$.dispatch({
                                type: actions_2.chatAction.changeGroupNoDisturbSuccess,
                                payload: active
                            });
                        }
                        return [2 /*return*/, { type: '[chat] change group no disturb useless' }];
                }
            }));
        })); }));
        // 被添加进群时获取群信息
        this.addGroupMembersEvent$ = this.actions$
            .ofType(actions_2.chatAction.addGroupMembersEvent)
            .map(effects_1.toPayload)
            .switchMap((function (eventData) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var promises, _loop_7, this_7, _i, _a, userList, groupObj, data, name_2, promises, _b, _c, member, _loop_8, this_8, _d, _e, userList, state_1, urlObj;
            var _this = this;
            return tslib_1.__generator(this, (function (_f) {
                switch (_f.label) {
                    case 0:
                        if (!(eventData.group_name && eventData.group_name !== '')) return [3 /*break*/, 1];
                        eventData.name = eventData.group_name;
                        promises = [];
                        _loop_7 = function (userList) {
                            if (userList.avatar && userList.avatar !== '') {
                                var avatarObj = { media_id: userList.avatar };
                                var pro = this_7.apiService.getResource(avatarObj).then((function (urlInfo) {
                                    if (!urlInfo.code) {
                                        userList.avatarUrl = urlInfo.url;
                                    }
                                }));
                                promises.push(pro);
                            }
                        };
                        this_7 = this;
                        for (_i = 0, _a = eventData.to_usernames; _i < _a.length; _i++) {
                            userList = _a[_i];
                            _loop_7(userList);
                        }
                        Promise.all(promises).then((function () {
                            _this.store$.dispatch({
                                type: actions_2.chatAction.updateGroupMembersEvent,
                                payload: {
                                    eventData: eventData
                                }
                            });
                        }));
                        return [3 /*break*/, 3];
                    case 1:
                        groupObj = { gid: eventData.gid };
                        return [4 /*yield*/, this.apiService.getGroupMembers(groupObj)];
                    case 2:
                        data = _f.sent();
                        if (data.code) {
                            this.errorFn(data);
                            eventData.name = '#群名获取失败？？';
                        }
                        else {
                            name_2 = '';
                            promises = [];
                            for (_b = 0, _c = data.member_list; _b < _c.length; _b++) {
                                member = _c[_b];
                                name_2 += (member.nickName || member.nickname ||
                                    member.username || member.name) + '、';
                                _loop_8 = function (userList) {
                                    if (userList.username === member.username) {
                                        var urlObj_1 = { media_id: member.avatar };
                                        var pro = this_8.apiService.getResource(urlObj_1)
                                            .then((function (urlInfo) {
                                            if (!urlInfo.code) {
                                                userList.avatarUrl = urlInfo.url;
                                            }
                                        }));
                                        promises.push(pro);
                                        return "break";
                                    }
                                };
                                this_8 = this;
                                for (_d = 0, _e = eventData.to_usernames; _d < _e.length; _d++) {
                                    userList = _e[_d];
                                    state_1 = _loop_8(userList);
                                    if (state_1 === "break")
                                        break;
                                }
                            }
                            Promise.all(promises).then((function () {
                                _this.store$.dispatch({
                                    type: actions_2.chatAction.updateGroupMembersEvent,
                                    payload: {
                                        eventData: eventData
                                    }
                                });
                            }));
                            if (name_2.length > 20) {
                                eventData.name = name_2.substr(0, 20);
                            }
                            else {
                                eventData.name = name_2.substr(0, name_2.length - 1);
                            }
                            eventData.target_name = eventData.name;
                            eventData.group_name = eventData.name;
                        }
                        _f.label = 3;
                    case 3:
                        urlObj = { media_id: eventData.media_id };
                        this.apiService.getResource(urlObj).then((function (result) {
                            if (result.code) {
                                eventData.avatarUrl = '';
                            }
                            else {
                                eventData.avatarUrl = result.url;
                            }
                            _this.store$.dispatch({
                                type: actions_2.chatAction.addGroupMembersEventSuccess,
                                payload: eventData
                            });
                        }));
                        return [2 /*return*/, { type: '[chat] add group members event useless' }];
                }
            }));
        })); }));
        // 创建群组事件
        this.createGroupEvent$ = this.actions$
            .ofType(actions_2.chatAction.createGroupEvent)
            .map(effects_1.toPayload)
            .switchMap((function (eventData) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var groupObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        groupObj = { gid: eventData.gid };
                        return [4 /*yield*/, this.apiService.getGroupInfo(groupObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            eventData.name = '#群名获取失败？？';
                        }
                        else {
                            eventData.name = data.group_info.name;
                        }
                        this.store$.dispatch({
                            type: actions_2.chatAction.createGroupSuccessEvent,
                            payload: eventData
                        });
                        return [2 /*return*/, { type: '[chat] create group event useless' }];
                }
            }));
        })); }));
        // 消息撤回
        this.msgRetract$ = this.actions$
            .ofType(actions_2.chatAction.msgRetract)
            .map(effects_1.toPayload)
            .switchMap((function (item) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        msgObj = {
                            msg_id: item.msg_id,
                        };
                        return [4 /*yield*/, this.apiService.msgRetract(msgObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_2.chatAction.msgRetractSuccess,
                                payload: item
                            });
                        }
                        return [2 /*return*/, { type: '[chat] msg eetract useless' }];
                }
            }));
        })); }));
        // 添加好友
        this.addFriendConfirm$ = this.actions$
            .ofType(actions_2.chatAction.addFriendConfirm)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var friendObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        friendObj = {
                            target_name: user.name,
                            from_type: 1,
                            why: user.verifyModalText
                        };
                        return [4 /*yield*/, this.apiService.addFriend(friendObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_3.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '好友申请',
                                        tip: '好友申请发送成功',
                                        actionType: '[chat] add friend success',
                                        success: 1
                                    }
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] add friend confirm useless' }];
                }
            }));
        })); }));
        // 个人资料中取消黑名单
        this.deleteSingleBlack$ = this.actions$
            .ofType(actions_2.chatAction.deleteSingleBlack)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = {
                            member_usernames: [{ username: user.name }]
                        };
                        return [4 /*yield*/, this.apiService.delSingleBlacks(userObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_3.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '取消黑名单',
                                        tip: '取消黑名单成功',
                                        actionType: '[chat] delete single black success useless',
                                        success: 1
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_2.chatAction.deleteSingleBlackSuccess,
                                payload: user
                            });
                        }
                        return [2 /*return*/, { type: '[chat] delete single black useless' }];
                }
            }));
        })); }));
        // 个人资料中取消免打扰
        this.deleteSingleNoDisturb$ = this.actions$
            .ofType(actions_2.chatAction.deleteSingleNoDisturb)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = {
                            target_name: user.name
                        };
                        return [4 /*yield*/, this.apiService.delSingleNoDisturb(userObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_3.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '取消免打扰',
                                        tip: '取消免打扰成功',
                                        actionType: '[chat] delete single no disturb success useless',
                                        success: 1
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_2.chatAction.deleteSingleNoDisturbSuccess,
                                payload: user
                            });
                        }
                        return [2 /*return*/, { type: '[chat] delete single no disturb useless' }];
                }
            }));
        })); }));
        // 修改备注名
        this.saveMemoName$ = this.actions$
            .ofType(actions_2.chatAction.saveMemoName)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var friendObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        friendObj = {
                            target_name: user.name,
                            memo_name: user.memo_name,
                            memo_others: 'a'
                        };
                        return [4 /*yield*/, this.apiService.updateFriendMemo(friendObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_2.chatAction.saveMemoNameSuccess,
                                payload: {
                                    to_usernames: [user]
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[chat] save memo name useless' }];
                }
            }));
        })); }));
        // 加载预览图片的图片url
        this.loadViewerImage$ = this.actions$
            .ofType(actions_2.chatAction.loadViewerImage)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var urlObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        urlObj = { media_id: info.mediaId };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            info.src = data.url;
                            this.store$.dispatch({
                                type: actions_2.chatAction.loadViewerImageSuccess,
                                payload: info
                            });
                        }
                        return [2 /*return*/, { type: '[chat] load viewer image useless' }];
                }
            }));
        })); }));
        // 加载聊天文件的url
        this.msgFile$ = this.actions$
            .ofType(actions_2.chatAction.msgFile)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgs_1, promises, _loop_9, this_9, i;
            var _this = this;
            return tslib_1.__generator(this, (function (_a) {
                if (info.show) {
                    msgs_1 = info.messageList[info.active.activeIndex].msgs;
                    promises = [];
                    _loop_9 = function (i) {
                        var type = '';
                        if (msgs_1[i].content.msg_type === 'file') {
                            if (msgs_1[i].content.msg_body.extras) {
                                if (msgs_1[i].content.msg_body.extras.video) {
                                    type = 'video';
                                }
                                else if (msgs_1[i].content.msg_body.extras.fileType) {
                                    type = util_1.Util.sortByExt(msgs_1[i].content.msg_body.extras.fileType);
                                }
                                else {
                                    type = 'other';
                                }
                            }
                        }
                        if ((type === info.type ||
                            (msgs_1[i].content.msg_type === info.type && info.type === 'image')) &&
                            !msgs_1[i].content.msg_body.media_url) {
                            var urlObj = { media_id: msgs_1[i].content.msg_body.media_id };
                            var pro = this_9.apiService.getResource(urlObj).then((function (result) {
                                if (!result.code) {
                                    msgs_1[i].content.msg_body.media_url = result.url;
                                }
                            }));
                            promises.push(pro);
                        }
                        if (promises.length > 0 && info.type === 'image') {
                            Promise.all(promises).then((function () {
                                _this.store$.dispatch({
                                    type: actions_2.chatAction.msgFileSuccess,
                                    payload: {
                                        messageList: info.messageList,
                                        type: info.type,
                                        isFirst: false
                                    }
                                });
                            }));
                        }
                    };
                    this_9 = this;
                    for (i = msgs_1.length - 1; i >= 0; i--) {
                        _loop_9(i);
                    }
                    this.store$.dispatch({
                        type: actions_2.chatAction.msgFileSuccess,
                        payload: {
                            messageList: info.messageList,
                            type: info.type,
                            isFirst: true
                        }
                    });
                }
                return [2 /*return*/, { type: '[chat] msg file useless' }];
            }));
        })); }));
        // 会话置顶和取消会话置顶
        this.conversationToTop$ = this.actions$
            .ofType(actions_2.chatAction.conversationToTop)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var extras, conversation;
            return tslib_1.__generator(this, (function (_a) {
                if (info.extras.top_time_ms) {
                    extras = {};
                }
                else {
                    extras = {
                        top_time_ms: new Date().getTime()
                    };
                }
                if (info.type === 3) {
                    conversation = {
                        appkey: info.appkey,
                        username: info.name,
                        extras: extras
                    };
                }
                else if (info.type === 4) {
                    conversation = {
                        gid: info.key,
                        extras: extras
                    };
                }
                if (conversation) {
                    this.apiService.updateConversation(conversation);
                    this.store$.dispatch({
                        type: actions_2.chatAction.conversationToTopSuccess,
                        payload: info
                    });
                }
                return [2 /*return*/, { type: '[chat] conversation to top useless' }];
            }));
        })); }));
        // 已读未读列表
        this.watchUnreadList$ = this.actions$
            .ofType(actions_2.chatAction.watchUnreadList)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgObj, data, _i, _a, unread, _b, _c, unread;
            return tslib_1.__generator(this, (function (_d) {
                switch (_d.label) {
                    case 0:
                        if (!info.message) return [3 /*break*/, 2];
                        msgObj = { msg_id: info.message.msg_id };
                        return [4 /*yield*/, this.apiService.msgUnreadList(msgObj)];
                    case 1:
                        data = _d.sent();
                        if (data.code) {
                            this.store$.dispatch({
                                type: actions_2.chatAction.watchUnreadList,
                                payload: {
                                    show: false
                                }
                            });
                            this.errorFn(data);
                        }
                        else {
                            if (info.message.unread_count !== data.msg_unread_list.unread_list.length) {
                                info.message.unread_count = data.msg_unread_list.unread_list.length;
                            }
                            this.store$.dispatch({
                                type: actions_2.chatAction.watchUnreadListSuccess,
                                payload: {
                                    info: data.msg_unread_list,
                                    loading: false
                                }
                            });
                            for (_i = 0, _a = data.msg_unread_list.unread_list; _i < _a.length; _i++) {
                                unread = _a[_i];
                                this.getUnreadListInfo(data, unread);
                            }
                            for (_b = 0, _c = data.msg_unread_list.read_list; _b < _c.length; _b++) {
                                unread = _c[_b];
                                this.getUnreadListInfo(data, unread);
                            }
                        }
                        _d.label = 2;
                    case 2: return [2 /*return*/, { type: '[chat] watch unread list useless' }];
                }
            }));
        })); }));
        // 已读回执
        this.addReceiptReport$ = this.actions$
            .ofType(actions_2.chatAction.addReceiptReport)
            .map(effects_1.toPayload)
            .switchMap((function (readObj) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var singleObj, groupObj;
            return tslib_1.__generator(this, (function (_a) {
                if (readObj && readObj.msg_id.length > 0) {
                    if (readObj.type === 3) {
                        singleObj = {
                            username: readObj.username,
                            msg_ids: readObj.msg_id
                        };
                        this.apiService.addSingleReceiptReport(singleObj);
                    }
                    else {
                        groupObj = {
                            gid: readObj.gid,
                            msg_ids: readObj.msg_id
                        };
                        this.apiService.addGroupReceiptReport(groupObj);
                    }
                }
                return [2 /*return*/, { type: '[chat] add receipt report useless' }];
            }));
        })); }));
        // 验证消息请求头像
        this.friendEvent$ = this.actions$
            .ofType(actions_2.chatAction.friendEvent)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var type, urlObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        info.type = 3;
                        if (info.extra === 1) {
                            type = actions_2.chatAction.friendInvitationEventSuccess;
                        }
                        else if (info.extra === 2) {
                            type = actions_2.chatAction.friendReplyEventSuccess;
                        }
                        info.avatarUrl = '';
                        if (!(info.media_id || info.media_id !== '')) return [3 /*break*/, 2];
                        urlObj = { media_id: info.media_id };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) {
                            info.avatarUrl = data.url;
                        }
                        _a.label = 2;
                    case 2:
                        this.store$.dispatch({
                            type: type,
                            payload: info
                        });
                        return [2 /*return*/, { type: '[chat] friend event useless' }];
                }
            }));
        })); }));
        // 更新群信息事件
        this.updateGroupInfoEvent$ = this.actions$
            .ofType(actions_2.chatAction.updateGroupInfoEvent)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var groupObj, data, urlObj, result;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        groupObj = { gid: info.gid };
                        return [4 /*yield*/, this.apiService.getGroupInfo(groupObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 5];
                    case 2:
                        data.group_info.avatarUrl = '';
                        if (!(data.group_info.avatar && data.group_info.avatar !== '')) return [3 /*break*/, 4];
                        urlObj = { media_id: data.group_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        result = _a.sent();
                        if (!result.code) {
                            data.group_info.avatarUrl = result.url;
                        }
                        _a.label = 4;
                    case 4:
                        this.store$.dispatch({
                            type: actions_2.chatAction.updateGroupInfoEventSuccess,
                            payload: {
                                groupInfo: data.group_info,
                                eventData: info
                            }
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[chat] update group info event useless' }];
                }
            }));
        })); }));
        // 更新用户的信息事件
        this.userInfUpdateEvent$ = this.actions$
            .ofType(actions_2.chatAction.userInfUpdateEvent)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data, urlObj, result;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        info.name = info.from_username;
                        info.type = 3;
                        userObj = {
                            username: info.from_username
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        data = _a.sent();
                        info.avatarUrl = '';
                        if (!!data.code) return [3 /*break*/, 3];
                        info.nickName = data.user_info.nickname;
                        info = Object.assign({}, info, data.user_info);
                        if (!(data.user_info.avatar && data.user_info.avatar !== '')) return [3 /*break*/, 3];
                        urlObj = { media_id: data.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 2:
                        result = _a.sent();
                        if (!result.code) {
                            info.avatarUrl = result.url;
                        }
                        _a.label = 3;
                    case 3:
                        this.store$.dispatch({
                            type: actions_2.chatAction.userInfUpdateEventSuccess,
                            payload: info
                        });
                        return [2 /*return*/, { type: '[chat] user inf update event useless' }];
                }
            }));
        })); }));
        // 清空会话未读数
        this.emptyUnreadNum$ = this.actions$
            .ofType(actions_2.chatAction.emptyUnreadNum)
            .map(effects_1.toPayload)
            .switchMap((function (unread) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var unreadObj;
            return tslib_1.__generator(this, (function (_a) {
                if (unread.type === 3 && unread.name) {
                    unreadObj = {
                        username: unread.name
                    };
                }
                else if (unread.type === 4 && unread.key) {
                    unreadObj = {
                        gid: unread.key
                    };
                }
                if (unreadObj) {
                    this.apiService.resetUnreadCount(unreadObj);
                }
                return [2 /*return*/, { type: '[chat] empty unread count useless' }];
            }));
        })); }));
        // 发送透传消息正在输入
        this.inputMessage$ = this.actions$
            .ofType(actions_2.chatAction.inputMessage)
            .map(effects_1.toPayload)
            .switchMap((function (message) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msgObj;
            return tslib_1.__generator(this, (function (_a) {
                msgObj = {
                    target_username: message.active.name,
                    cmd: JSON.stringify(message.input)
                };
                this.apiService.transSingleMsg(msgObj);
                return [2 /*return*/, { type: '[chat] input message useless' }];
            }));
        })); }));
        // 添加群组成员禁言
        this.addGroupMemberSilence$ = this.actions$
            .ofType(actions_2.chatAction.addGroupMemberSilence)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var memberObj, data, error;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        memberObj = {
                            gid: info.active.key,
                            target_username: info.item.username
                        };
                        return [4 /*yield*/, this.apiService.addGroupMemSilence(memberObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            error = {
                                code: -1,
                                myText: '禁言失败'
                            };
                            this.errorFn(error);
                        }
                        return [2 /*return*/, { type: '[chat] add group member silence useless' }];
                }
            }));
        })); }));
        // 删除群组成员禁言
        this.deleteGroupMemberSilence$ = this.actions$
            .ofType(actions_2.chatAction.deleteGroupMemberSilence)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var memberObj, data, error;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        memberObj = {
                            gid: info.active.key,
                            target_username: info.item.username
                        };
                        return [4 /*yield*/, this.apiService.delGroupMemSilence(memberObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            error = {
                                code: -1,
                                myText: '取消禁言失败'
                            };
                            this.errorFn(error);
                        }
                        return [2 /*return*/, { type: '[chat] delete group member silence useless' }];
                }
            }));
        })); }));
        // 群主或者管理员，收到用户申请入群事件请求头像
        this.receiveGroupInvitationEvent$ = this.actions$
            .ofType(actions_2.chatAction.receiveGroupInvitationEvent)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var promises, _loop_10, this_10, _i, _a, user;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0:
                        promises = [];
                        _loop_10 = function (user) {
                            var urlObj = { media_id: user.avatar };
                            var pro = this_10.apiService.getResource(urlObj).then((function (urlInfo) {
                                if (urlInfo.code) {
                                    user.avatarUrl = '';
                                }
                                else {
                                    user.avatarUrl = urlInfo.url;
                                }
                            }));
                            promises.push(pro);
                        };
                        this_10 = this;
                        for (_i = 0, _a = info.to_usernames; _i < _a.length; _i++) {
                            user = _a[_i];
                            _loop_10(user);
                        }
                        return [4 /*yield*/, Promise.all(promises)];
                    case 1:
                        _b.sent();
                        this.store$.dispatch({
                            type: actions_2.chatAction.receiveGroupInvitationEventSuccess,
                            payload: info
                        });
                        return [2 /*return*/, { type: '[chat] receive group invitation event useless' }];
                }
            }));
        })); }));
        // 被拒绝入群事件
        this.receiveGroupRefuseEvent$ = this.actions$
            .ofType(actions_2.chatAction.receiveGroupRefuseEvent)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        urlObj = { media_id: info.media_id };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 1:
                        urlInfo = _a.sent();
                        if (urlInfo.code) {
                            info.avatarUrl = '';
                        }
                        else {
                            info.avatarUrl = urlInfo.url;
                        }
                        this.store$.dispatch({
                            type: actions_2.chatAction.receiveGroupRefuseEventSuccess,
                            payload: info
                        });
                        return [2 /*return*/, { type: '[chat] receive group refuse event useless' }];
                }
            }));
        })); }));
    }
    ChatEffect.prototype.errorFn = function (error) {
        this.store$.dispatch({
            type: actions_1.appAction.errorApiTip,
            payload: error
        });
    };
    // 获取未读和已读列表
    ChatEffect.prototype.getUnreadListInfo = function (list, unread) {
        var _this = this;
        if (unread.avatar && unread.avatar !== '') {
            var urlObj = { media_id: unread.avatar };
            this.apiService.getResource(urlObj).then((function (result) {
                if (result.code) {
                    unread.avatarUrl = '';
                }
                else {
                    unread.avatarUrl = result.url;
                }
                _this.store$.dispatch({
                    type: actions_2.chatAction.watchUnreadListSuccess,
                    payload: {
                        info: list.msg_unread_list,
                        loading: false
                    }
                });
            }));
        }
    };
    // 接收消息获取media url
    ChatEffect.prototype.getMediaUrl = function (obj, promises) {
        if (obj.data.messages[0].content.msg_body.media_id) {
            var urlObj = { media_id: obj.data.messages[0].content.msg_body.media_id };
            var pro1 = this.apiService.getResource(urlObj).then((function (result) {
                if (result.code) {
                    obj.data.messages[0].content.msg_body.media_url = '';
                }
                else {
                    obj.data.messages[0].content.msg_body.media_url = result.url;
                }
            }));
            if (promises && promises instanceof Array) {
                promises.push(pro1);
            }
        }
    };
    // 名片消息获取资源
    ChatEffect.prototype.getCardResource = function (content, info, promises) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var userObj, data, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(content.msg_type === 'text' && content.msg_body.extras &&
                            content.msg_body.extras.businessCard)) return [3 /*break*/, 3];
                        userObj = {
                            username: info.data.messages[0].content.msg_body.extras.userName,
                            appkey: common_1.authPayload.appkey
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        data = _a.sent();
                        info.data.messages[0].content.msg_body.extras.nickName = data.user_info.nickname;
                        if (promises && promises instanceof Array) {
                            promises.push(data);
                        }
                        if (!!data.code) return [3 /*break*/, 3];
                        urlObj = { media_id: data.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 2:
                        urlInfo = _a.sent();
                        if (promises && promises instanceof Array) {
                            promises.push(urlInfo);
                        }
                        if (urlInfo.code) {
                            info.data.messages[0].content.msg_body.extras.media_url = '';
                        }
                        else {
                            info.data.messages[0].content.msg_body.extras.media_url = urlInfo.url;
                        }
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            }));
        }));
    };
    // 获取新消息的用户头像url
    ChatEffect.prototype.getMsgAvatarUrl = function (messages, promises) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var username, userObj, pro2, urlObj, pro3;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        username = messages.content.from_id !== common_1.global.user ?
                            messages.content.from_id : messages.content.target_id;
                        userObj = {
                            username: username
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        pro2 = _a.sent();
                        promises.push(pro2);
                        if (!(!pro2.user_info.avatar || pro2.user_info.avatar === '')) return [3 /*break*/, 2];
                        messages.content.avatarUrl = '';
                        return [3 /*break*/, 4];
                    case 2:
                        urlObj = { media_id: pro2.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        pro3 = _a.sent();
                        promises.push(pro3);
                        if (pro3.code) {
                            messages.content.avatarUrl = '';
                        }
                        else {
                            messages.content.avatarUrl = pro3.url;
                        }
                        _a.label = 4;
                    case 4: return [2 /*return*/];
                }
            }));
        }));
    };
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "syncReceiveMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "receiveSingleMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "receiveGroupMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "getVoiceState$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "getFriendList$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "getSourceUrl$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "getMemberAvatarUrl$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "getAllMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "sendMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "sendGroupMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitGroupMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "sendSinglePic$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitSinglePic$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "sendGroupPic$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitGroupPic$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "sendSingleFile$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitSingleFile$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "sendGroupFile$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitGroupFile$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitSingleLocation$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "transmitGroupLocation$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "watchOtherInfo$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "groupInfo$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "getGroupMembers$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "updateGroupInfo$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "changeGroupShield$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "changeGroupNoDisturb$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "addGroupMembersEvent$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "createGroupEvent$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "msgRetract$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "addFriendConfirm$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "deleteSingleBlack$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "deleteSingleNoDisturb$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "saveMemoName$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "loadViewerImage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "msgFile$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "conversationToTop$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "watchUnreadList$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "addReceiptReport$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "friendEvent$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "updateGroupInfoEvent$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "userInfUpdateEvent$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "emptyUnreadNum$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "inputMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "addGroupMemberSilence$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "deleteGroupMemberSilence$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "receiveGroupInvitationEvent$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ChatEffect.prototype, "receiveGroupRefuseEvent$", void 0);
    ChatEffect = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [effects_1.Actions,
            store_1.Store,
            router_1.Router,
            common_1.StorageService,
            common_1.ApiService])
    ], ChatEffect);
    return ChatEffect;
}());
exports.ChatEffect = ChatEffect;


/***/ }),

/***/ 788:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(787), exports);


/***/ }),

/***/ 789:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.chatInit = {
    conversation: [],
    messageList: [],
    newMessage: {},
    groupList: [],
    friendList: [],
    activePerson: {
        key: '',
        name: '',
        nickName: '',
        activeIndex: -1,
        noDisturb: false,
        avatarUrl: '',
        shield: false,
        memo_name: '',
        appkey: ''
    },
    defaultPanelIsShow: true,
    actionType: '',
    otherInfo: {
        info: {
            black: false,
            noDisturb: false,
            memo_name: '',
            name: '',
            isFriend: false,
            appkey: ''
        },
        show: false
    },
    blackMenu: [],
    searchUserResult: {
        result: {
            singleArr: [],
            groupArr: [],
            roomArr: []
        },
        isSearch: false
    },
    recentMsg: [],
    msgId: [],
    groupDeacriptionShow: false,
    selfInfo: {
        info: {
            avatarUrl: ''
        }
    },
    imageViewer: [],
    voiceState: [],
    playVideoShow: {
        url: '',
        show: false
    },
    isLoaded: false,
    currentIsActive: false,
    newMessageIsActive: false,
    newMessageIsDisturb: false,
    messageTransmit: {
        searchResult: {},
        list: []
    },
    transmitSuccess: 0,
    verifyModal: {
        info: {},
        show: false
    },
    noDisturb: {
        users: [],
        groups: []
    },
    viewerImageUrl: {},
    msgFile: {
        show: false,
        audio: [],
        document: [],
        video: [],
        image: [],
        other: []
    },
    msgFileImageViewer: [],
    sendBusinessCardSuccess: 0,
    unreadList: {
        show: false,
        info: {
            read: [],
            unread: []
        },
        loading: false
    },
    readObj: {},
    groupShield: [],
    createGroupSearch: [],
    unreadCount: {},
    roomTransmitMsg: {},
    isInput: false,
    conversationUnreadNum: 0,
    receiveGroupInvitationEventObj: {},
    receiveGroupRefuseEventObj: {}
};


/***/ }),

/***/ 790:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(789), exports);


/***/ }),

/***/ 791:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(90);
var actions_2 = __webpack_require__(107);
var actions_3 = __webpack_require__(222);
var model_1 = __webpack_require__(790);
var actions_4 = __webpack_require__(124);
var common_1 = __webpack_require__(28);
var util_1 = __webpack_require__(72);
exports.chatReducer = function (state, _a) {
    if (state === void 0) { state = model_1.chatInit; }
    var type = _a.type, payload = _a.payload;
    state.actionType = type;
    switch (type) {
        // 初始化state
        case actions_2.chatAction.init:
            state = util_1.Util.deepCopyObj(model_1.chatInit);
            break;
        // 初始化会话列表
        case actions_2.chatAction.getConversationSuccess:
            if (payload.storage) {
                state.conversation = payload.conversation;
                if (payload.messageList.length > 0) {
                    state.messageList = payload.messageList;
                }
                filterRecentMsg(state);
                filterAtList(state);
                state.isLoaded = true;
                completionMessageList(state);
            }
            if (payload.shield) {
                initGroupShield(state, payload.shield);
            }
            if (payload.noDisturb) {
                state.noDisturb = payload.noDisturb;
                initNoDisturb(state, payload.noDisturb);
            }
            if (state.friendList.length > 0) {
                filterConversationMemoName(state);
            }
            conversationUnreadNum(state);
            break;
        // 获取好友列表
        case actions_2.chatAction.getFriendListSuccess:
            if (payload && payload.type) {
                compareFriendList(state, payload.friendList);
                state.friendList = payload.friendList;
            }
            else {
                state.friendList = payload;
            }
            filterFriendList(state, payload);
            if (state.conversation.length > 0) {
                filterConversationMemoName(state);
            }
            break;
        // 登陆后，离线消息同步消息列表
        case actions_2.chatAction.getAllMessageSuccess:
            state.messageList = payload;
            state.imageViewer = filterImageViewer(state);
            break;
        // 接收消息
        case actions_2.chatAction.receiveMessageSuccess:
            addMessage(state, payload);
            newMessageIsActive(state, payload);
            conversationUnreadNum(state);
            break;
        // 发送单聊文本消息
        case actions_2.chatAction.sendSingleMessage:
        // 发送群组文本消息
        case actions_2.chatAction.sendGroupMessage:
        // 发送单聊图片消息
        case actions_2.chatAction.sendSinglePic:
        // 发送群组图片消息
        case actions_2.chatAction.sendGroupPic:
        // 发送单聊文件消息
        case actions_2.chatAction.sendSingleFile:
        // 发送群组文件消息
        case actions_2.chatAction.sendGroupFile:
            // 判断是否是重发消息
            if (!payload.msgs.repeatSend) {
                addMessage(state, payload);
            }
            var extras = payload.msgs.content.msg_body.extras;
            if (extras && extras.businessCard) {
                state.sendBusinessCardSuccess = 0;
            }
            break;
        // 发送消息完成（包括所有类型的消息）
        case actions_2.chatAction.sendMsgComplete:
            sendMsgComplete(state, payload);
            if (payload.msgs) {
                var bussinessExtras = payload.msgs.content.msg_body.extras;
                if (bussinessExtras && bussinessExtras.businessCard && payload.success !== 2) {
                    state.sendBusinessCardSuccess = 0;
                }
                else {
                    state.sendBusinessCardSuccess++;
                }
            }
            break;
        // 转发单聊文本消息
        case actions_2.chatAction.transmitSingleMessage:
        // 转发单聊图片消息
        case actions_2.chatAction.transmitSinglePic:
        // 转发单聊文件消息
        case actions_2.chatAction.transmitSingleFile:
        // 转发群聊文本消息
        case actions_2.chatAction.transmitGroupMessage:
        // 转发单聊图片消息
        case actions_2.chatAction.transmitGroupPic:
        // 转发单聊文件消息
        case actions_2.chatAction.transmitGroupFile:
        // 转发单聊位置
        case actions_2.chatAction.transmitSingleLocation:
        // 转发群聊位置
        case actions_2.chatAction.transmitGroupLocation:
            if (!payload.msgs.repeatSend) {
                state.transmitSuccess = 0;
                transmitMessage(state, payload);
                state.newMessage = payload.msgs;
            }
            break;
        // 转发消息完成
        case actions_2.chatAction.transmitMessageComplete:
            sendMsgComplete(state, payload);
            if (payload.success !== 2) {
                state.transmitSuccess = 0;
            }
            else {
                state.transmitSuccess++;
            }
            break;
        // 切换当前会话用户
        case actions_2.chatAction.changeActivePerson:
            clearVoiceTimer(state);
            state.activePerson = util_1.Util.deepCopyObj(payload.item);
            state.defaultPanelIsShow = payload.defaultPanelIsShow;
            emptyUnreadNum(state, payload.item);
            state.unreadCount = {
                key: state.activePerson.key,
                name: state.activePerson.name,
                type: state.activePerson.type
            };
            changeActivePerson(state);
            conversationUnreadNum(state);
            break;
        // 选择联系人
        case actions_4.contactAction.selectContactItem:
        // 选择搜索出来的本地用户
        case actions_1.mainAction.selectSearchUser:
            state.defaultPanelIsShow = false;
            clearVoiceTimer(state);
            selectUserResult(state, payload, 'search');
            changeActivePerson(state);
            emptyUnreadNum(state, payload);
            state.unreadCount = {
                key: state.activePerson.key,
                name: state.activePerson.name,
                type: state.activePerson.type
            };
            conversationUnreadNum(state);
            break;
        // 删除本地会话列表
        case actions_2.chatAction.deleteConversationItem:
            showGroupSetting(state, false);
            deleteConversationItem(state, payload);
            conversationUnreadNum(state);
            break;
        // 保存草稿
        case actions_2.chatAction.saveDraft:
            if (state.messageList[payload[1].activeIndex]) {
                state.messageList[payload[1].activeIndex].draft = payload[0];
            }
            for (var _i = 0, _b = state.conversation; _i < _b.length; _i++) {
                var item = _b[_i];
                if (Number(payload[1].key) === Number(item.key)) {
                    item.draft = payload[0];
                }
            }
            break;
        // 搜索本地用户
        case actions_1.mainAction.searchUserSuccess:
            state.searchUserResult = searchUser(state, payload.keywords);
            if (payload.room) {
                state.searchUserResult.result.roomArr.push(payload.room);
            }
            break;
        // 消息转发的搜索用户
        case actions_2.chatAction.searchMessageTransmit:
            state.messageTransmit.searchResult = searchUser(state, payload);
            break;
        // 成功查看别人的信息
        case actions_2.chatAction.watchOtherInfoSuccess:
            payload.info.isFriend = filterFriend(state, payload.info);
            filterSingleBlack(state, payload.info);
            filterSingleNoDisturb(state, payload.info);
            state.otherInfo.info = payload.info;
            state.otherInfo.show = payload.show;
            break;
        // 隐藏别人的信息框
        case actions_2.chatAction.hideOtherInfo:
            state.otherInfo = payload;
            break;
        // 获取群组信息
        case actions_2.chatAction.groupInfo:
            initGroupInfo(state, payload);
            break;
        // 显示隐藏群组设置
        case actions_2.chatAction.groupSetting:
            var msg = state.messageList[state.activePerson.activeIndex];
            if (msg && !msg.groupSetting) {
                state.messageList[state.activePerson.activeIndex] = Object.assign({}, msg, { groupSetting: {} });
            }
            if (msg && payload.loading &&
                (!msg.groupSetting || (msg.groupSetting && !msg.groupSetting.groupInfo))) {
                state.messageList[state.activePerson.activeIndex].groupSetting.loading = true;
            }
            showGroupSetting(state, payload.show);
            break;
        // 创建单聊/添加好友
        case actions_1.mainAction.createSingleChatSuccess:
            /**
             * info.showType
             * 1    发起单聊-非好友-非会话人
             * 2    发起单聊-好友
             * 3    发起单聊-非好友-会话人
             * 4    添加好友-非会话人
             * 5    添加好友-会话人
             * 6    查看资料-好友
             * 7    查看资料-非好友-会话人
             * 8    查看资料-非好友-非会话人
             */
            payload.isFriend = filterFriend(state, payload);
            filterSingleBlack(state, payload);
            filterSingleNoDisturb(state, payload);
            state.otherInfo.info = payload;
            state.otherInfo.show = true;
            break;
        // 从验证消息列表中查看对方的资料
        case actions_4.contactAction.watchVerifyUserSuccess:
            payload.isFriend = filterFriend(state, payload);
            filterSingleBlack(state, payload);
            filterSingleNoDisturb(state, payload);
            state.otherInfo.info = payload;
            state.otherInfo.show = true;
            break;
        // 创建群组成功
        case actions_1.mainAction.createGroupSuccess:
            clearVoiceTimer(state);
            state.activePerson = util_1.Util.deepCopyObj(payload);
            state.defaultPanelIsShow = false;
            selectUserResult(state, payload);
            changeActivePerson(state);
            state.groupList.push(payload);
            break;
        // 从用户的个人资料创建单聊联系人会话
        case actions_2.chatAction.createOtherChat:
            showGroupSetting(state, false);
            clearVoiceTimer(state);
            if (payload.username) {
                payload.name = payload.username;
            }
            if (payload.nickname) {
                payload.nickName = payload.nickname;
            }
            state.defaultPanelIsShow = false;
            filterFriend(state, payload);
            selectUserResult(state, payload);
            state.activePerson = util_1.Util.deepCopyObj(payload);
            changeActivePerson(state);
            emptyUnreadNum(state, payload);
            state.unreadCount = {
                key: state.activePerson.key,
                name: state.activePerson.name,
                type: state.activePerson.type
            };
            conversationUnreadNum(state);
            break;
        // 获取群组列表成功
        case actions_4.contactAction.getGroupListSuccess:
            state.groupList = payload;
            break;
        // 退群成功
        case actions_1.mainAction.exitGroupSuccess:
            var isActive = (payload.item.name === state.activePerson.name &&
                payload.item.type === 3 && state.activePerson.type === 3) ||
                (payload.item.type === 4 &&
                    Number(payload.item.key) === Number(state.activePerson.key));
            if (isActive) {
                showGroupSetting(state, false);
                state.defaultPanelIsShow = true;
            }
            exitGroup(state, payload.item);
            deleteConversationItem(state, payload);
            conversationUnreadNum(state);
            break;
        // 加入黑名单成功
        case actions_1.mainAction.addBlackListSuccess:
            state.otherInfo.info.black = true;
            updateBlackMenu(state, payload.deleteItem.item);
            break;
        // 更新群描述
        case actions_2.chatAction.groupDescription:
            state.groupDeacriptionShow = payload.show;
            break;
        // 显示个人信息
        case actions_1.mainAction.showSelfInfo:
            if (payload.info) {
                state.selfInfo.info = Object.assign({}, state.selfInfo.info, payload.info);
            }
            if (payload.avatar) {
                state.selfInfo.info.avatarUrl = payload.avatar.url;
            }
            break;
        // 获取用户信息头像url
        case actions_2.chatAction.getSingleAvatarUrl:
            var msgs = state.messageList[state.activePerson.activeIndex].msgs;
            for (var _c = 0, msgs_1 = msgs; _c < msgs_1.length; _c++) {
                var item = msgs_1[_c];
                if (item.content.from_id !== common_1.global.user) {
                    item.content.avatarUrl = state.activePerson.avatarUrl;
                }
            }
            break;
        // 切换群屏蔽
        case actions_2.chatAction.changeGroupShieldSuccess:
            changeGroupShield(state, payload);
            break;
        // 切换群组免打扰
        case actions_2.chatAction.changeGroupNoDisturbSuccess:
            changeGroupNoDisturb(state, payload);
            conversationUnreadNum(state);
            break;
        // 群聊事件
        case actions_2.chatAction.addGroupMembersEventSuccess:
            groupMembersEvent(state, payload, '被添加进群聊了');
            state.currentIsActive = currentIsActive(state, payload);
            for (var _d = 0, _e = payload.to_usernames; _d < _e.length; _d++) {
                var user = _e[_d];
                if (user.username === common_1.global.user) {
                    addToGroupList(state, payload);
                    break;
                }
            }
            break;
        // 更新群组成员事件
        case actions_2.chatAction.updateGroupMembersEvent:
            updateGroupMembers(state, payload.eventData);
            break;
        // 删除群组成员
        case actions_2.chatAction.deleteGroupMembersEvent:
            groupMembersEvent(state, payload, '被移出群聊了');
            state.currentIsActive = currentIsActive(state, payload);
            deleteGroupMembersEvent(state, payload);
            for (var _f = 0, _g = payload.to_usernames; _f < _g.length; _f++) {
                var user = _g[_f];
                if (user.username === common_1.global.user) {
                    exitGroup(state, payload);
                    break;
                }
            }
            break;
        // 退群事件
        case actions_2.chatAction.exitGroupEvent:
            groupMembersEvent(state, payload, '退出群聊了');
            state.currentIsActive = currentIsActive(state, payload);
            deleteGroupMembersEvent(state, payload);
            break;
        // 更新群组信息成功事件
        case actions_2.chatAction.updateGroupInfoEventSuccess:
            updateGroupInfoEventSuccess(state, payload);
            break;
        // 从localstorage获取已经播放的voice的列表
        case actions_2.chatAction.getVoiceStateSuccess:
            state.voiceState = payload;
            break;
        // 显示视频模态框
        case actions_2.chatAction.playVideoShow:
            state.playVideoShow = payload;
            break;
        // 创建群聊事件消息
        case actions_2.chatAction.createGroupSuccessEvent:
            createGroupSuccessEvent(state, payload);
            break;
        // 消息撤回
        case actions_2.chatAction.msgRetractEvent:
            msgRetract(state, payload);
            break;
        // 显示验证消息模态框
        case actions_2.chatAction.showVerifyModal:
            state.verifyModal = payload;
            break;
        // 在黑名单列表中删除黑名单
        case actions_1.mainAction.delSingleBlackSuccess:
            updateBlackMenu(state, payload);
            break;
        // 获取黑名单成功
        case actions_1.mainAction.blackMenuSuccess:
            state.blackMenu = payload.menu;
            break;
        // 在个人资料中删除黑名单
        case actions_2.chatAction.deleteSingleBlackSuccess:
            updateBlackMenu(state, payload);
            state.otherInfo.info.black = false;
            break;
        // 添加单聊用户免打扰成功
        case actions_1.mainAction.addSingleNoDisturbSuccess:
            state.otherInfo.info.noDisturb = true;
            changeSingleNoDisturb(state, payload);
            conversationUnreadNum(state);
            break;
        // 删除单聊用户免打扰成功
        case actions_2.chatAction.deleteSingleNoDisturbSuccess:
            state.otherInfo.info.noDisturb = false;
            changeSingleNoDisturb(state, payload);
            conversationUnreadNum(state);
            break;
        // 好友资料中保存备注名及备注名同步
        case actions_2.chatAction.saveMemoNameSuccess:
            saveMemoNameSuccess(state, payload);
            break;
        // 删除好友同步事件
        case actions_2.chatAction.deleteFriendSyncEvent:
            deleteFriendSyncEvent(state, payload);
            break;
        // 添加好友同步事件
        case actions_2.chatAction.addFriendSyncEvent:
            for (var _h = 0, _j = payload.to_usernames; _h < _j.length; _h++) {
                var user = _j[_h];
                friendSyncEvent(state, user, true);
            }
            break;
        // 删除好友
        case actions_1.mainAction.deleteFriendSuccess:
            otherInfoDeleteFriend(state, payload);
            break;
        // 同意添加好友
        case actions_4.contactAction.agreeAddFriendSuccess:
            addNewFriendToConversation(state, payload, 'agree');
            break;
        // 好友应答成功事件
        case actions_2.chatAction.friendReplyEventSuccess:
            // 如果在好友应答时正好打开了该好友的资料
            updateOtherInfo(state, payload);
            addNewFriendToConversation(state, payload, 'reply');
            break;
        // 加载图片预览没有加载的图片url
        case actions_2.chatAction.loadViewerImageSuccess:
            state.viewerImageUrl = payload;
            break;
        // 聊天文件模态框显示隐藏
        case actions_2.chatAction.msgFile:
            state.msgFile.show = payload.show;
            break;
        // 聊天文件显示成功
        case actions_2.chatAction.msgFileSuccess:
            if (payload.isFirst) {
                state.messageList = payload.messageList;
                filterMsgFile(state, payload.type);
            }
            filterMsgFileImageViewer(state, payload.type);
            break;
        // 聊天文件中的文件中的图片加载成功
        case actions_2.chatAction.fileImageLoad:
            fileImageLoad(state, payload);
            break;
        // 置顶成功
        case actions_2.chatAction.conversationToTopSuccess:
            conversationToTop(state, payload);
            break;
        // 显示未读列表
        case actions_2.chatAction.watchUnreadList:
            state.unreadList = {
                show: payload.show,
                info: {
                    read: [],
                    unread: []
                },
                loading: true
            };
            break;
        // 加载未读列表成功
        case actions_2.chatAction.watchUnreadListSuccess:
            if (payload.info) {
                filterUnreadListMemoName(state, payload);
                state.unreadList.info.read = payload.info.read_list;
                state.unreadList.info.unread = payload.info.unread_list;
            }
            state.unreadList.loading = payload.loading;
            break;
        // 已读消息回执事件
        case actions_2.chatAction.msgReceiptChangeEvent:
            msgReceiptChangeEvent(state, payload);
            break;
        // 上报消息已读
        case actions_2.chatAction.addReceiptReportAction:
            state.readObj = filterReceiptReport(state, payload);
            break;
        // 清空未读数的同步事件
        case actions_2.chatAction.emptyUnreadNumSyncEvent:
            emptyUnreadNumSyncEvent(state, payload);
            conversationUnreadNum(state);
            break;
        // 添加单聊免打扰同步事件
        case actions_2.chatAction.addSingleNoDisturbSyncEvent:
            addSingleNoDisturbSyncEvent(state, payload);
            conversationUnreadNum(state);
            break;
        // 删除单聊免打扰同步事件
        case actions_2.chatAction.deleteSingleNoDisturbSyncEvent:
            deleteSingleNoDisturbSyncEvent(state, payload);
            conversationUnreadNum(state);
            break;
        // 添加群组免打扰同步事件
        case actions_2.chatAction.addGroupNoDisturbSyncEvent:
            addGroupNoDisturbSyncEvent(state, payload);
            conversationUnreadNum(state);
            break;
        // 删除群组免打扰同步事件
        case actions_2.chatAction.deleteGroupNoDisturbSyncEvent:
            deleteGroupNoDisturbSyncEvent(state, payload);
            conversationUnreadNum(state);
            break;
        // 添加群组屏蔽同步事件
        case actions_2.chatAction.addGroupShieldSyncEvent:
            addGroupShieldSyncEvent(state, payload);
            break;
        // 删除群组屏蔽同步事件
        case actions_2.chatAction.deleteGroupShieldSyncEvent:
            deleteGroupShieldSyncEvent(state, payload);
            break;
        //  添加单聊黑名单同步事件
        case actions_2.chatAction.addSingleBlackSyncEvent:
            singleBlackSyncEvent(state, payload, true);
            break;
        // 删除单聊黑名单同步事件
        case actions_2.chatAction.deleteSingleBlackSyncEvent:
            singleBlackSyncEvent(state, payload, false);
            break;
        // 用户信息更新事件
        case actions_2.chatAction.userInfUpdateEventSuccess:
            userInfUpdateEventSuccess(state, payload);
            break;
        // 创建群聊、多人会话、添加群成员搜索成功
        case actions_2.chatAction.createGroupSearchComplete:
            state.createGroupSearch = searchSingleUser(state, payload);
            break;
        // 转发聊天室的消息
        case actions_3.roomAction.transmitAllMsg:
            state.roomTransmitMsg = payload;
            break;
        // 收到正在输入的透传消息
        case actions_2.chatAction.receiveInputMessage:
            state.isInput = payload;
            break;
        // 添加群成员禁言事件
        case actions_2.chatAction.addGroupMemberSilenceEvent:
            addGroupMemberSilenceEvent(state, payload);
            state.currentIsActive = currentIsActive(state, payload);
            break;
        // 移除群成员禁言事件
        case actions_2.chatAction.deleteGroupMemberSilenceEvent:
            deleteGroupMemberSilenceEvent(state, payload);
            state.currentIsActive = currentIsActive(state, payload);
            break;
        // 收到入群邀请事件
        case actions_2.chatAction.receiveGroupInvitationEventSuccess:
            filterInvitationEventMeMoName(state, payload);
            state.receiveGroupInvitationEventObj = payload;
            break;
        // 收到被拒绝入群事件
        case actions_2.chatAction.receiveGroupRefuseEventSuccess:
            filterInvitationEventMeMoName(state, payload);
            state.receiveGroupRefuseEventObj = payload;
            break;
        default:
    }
    return state;
};
// 登录时处理会话at提示
function filterAtList(state) {
    if (state.messageList.length > 0) {
        for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
            var conversation = _a[_i];
            var num = conversation.unreadNum;
            if (num > 0) {
                for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
                    var messageList = _c[_b];
                    var group = messageList.type === 4 && conversation.type === 4 &&
                        Number(messageList.key) === Number(conversation.key);
                    if (messageList.msgs && messageList.msgs.length > 0 && group) {
                        var length_1 = messageList.msgs.length;
                        for (var i = length_1 - 1; i >= length_1 - 1 - num && i >= 0; i--) {
                            var atUser = messageHasAtList(messageList.msgs[i].content.at_list);
                            if (atUser !== '') {
                                conversation.atUser = atUser;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
        }
    }
}
// 上报已读回执，防止漏报
function filterReceiptReport(state, payload) {
    if (payload.msg_id.length === 0) {
        return payload;
    }
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        var group = messageList.type === 4 && payload.type === 4 &&
            Number(messageList.key) === Number(payload.gid);
        var single = messageList.type === 3 && payload.type === 3 &&
            messageList.name === payload.username;
        if (group || single) {
            for (var _b = 0, _c = payload.msg_id; _b < _c.length; _b++) {
                var msgId = _c[_b];
                for (var _d = 0, _e = messageList.msgs; _d < _e.length; _d++) {
                    var message = _e[_d];
                    if (message.msg_id === msgId) {
                        message.hasRead = true;
                        break;
                    }
                }
            }
            for (var _f = 0, _g = messageList.msgs; _f < _g.length; _f++) {
                var message = _g[_f];
                if (message.msg_id === payload.msg_id[0]) {
                    for (var i = messageList.msgs.length - 1; i >= 0; i--) {
                        if (messageList.msgs[i].msg_id &&
                            messageList.msgs[i].msg_id !== payload.msg_id[0] &&
                            !messageList.msgs[i].hasRead &&
                            messageList.msgs[i].content.from_id !== common_1.global.user) {
                            messageList.msgs[i].hasRead = true;
                            payload.msg_id.push(messageList.msgs[i].msg_id);
                        }
                        if (messageList.msgs[i].msg_id === payload.msg_id[0]) {
                            break;
                        }
                    }
                    break;
                }
            }
            break;
        }
    }
    return payload;
}
// 处理好友列表数据
function filterFriendList(state, payload) {
    for (var _i = 0, payload_1 = payload; _i < payload_1.length; _i++) {
        var friend = payload_1[_i];
        if (friend.username && !friend.name) {
            friend.name = friend.username;
        }
        if (friend.nickname && !friend.nickName) {
            friend.nickName = friend.nickname;
        }
        friend.type = 3;
    }
}
// 客户端修改好友关系，对比删除了哪个好友，将整个应用中该好友的备注名换成昵称或者用户名
function compareFriendList(state, payload) {
    var _loop_1 = function (friend) {
        var result = payload.filter((function (newFriend) {
            return newFriend.username === friend.username && newFriend.appkey === friend.appkey;
        }));
        if (result.length === 0 && friend.memo_name) {
            friend.memo_name = '';
            modifyOtherInfoMemoName(state, friend);
            modifyConversationMemoName(state, friend);
            modifyActiveMessageList(state, friend);
            if (state.activePerson.type === 3 && state.activePerson.name === friend.username &&
                state.activePerson.appkey === friend.appkey) {
                state.activePerson.memo_name = '';
            }
        }
    };
    for (var _i = 0, _a = state.friendList; _i < _a.length; _i++) {
        var friend = _a[_i];
        _loop_1(friend);
    }
}
// 添加群到群组列表
function addToGroupList(state, payload) {
    state.groupList.push({
        appkey: payload.from_appkey,
        name: payload.group_name,
        gid: payload.gid,
        avatar: payload.avatar,
        avatarUrl: payload.avatarUrl || ''
    });
}
// 收到新消息，如果是当前会话，需要标识是否是当前会话
function newMessageIsActive(state, payload) {
    var singleFlag = Number(state.activePerson.key) === Number(state.newMessage.key)
        && state.newMessage.msg_type === 3 && state.activePerson.type === 3;
    var groupFlag = Number(state.activePerson.key) === Number(state.newMessage.key)
        && state.newMessage.msg_type === 4 && state.activePerson.type === 4;
    state.newMessageIsActive = (singleFlag || groupFlag) ? true : false;
}
// 保存备注名成功
function saveMemoNameSuccess(state, payload) {
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var user = _a[_i];
        if (user.username) {
            user.name = user.username;
        }
        if (user.nickname) {
            user.nickName = user.nickname;
        }
        if (payload.description && payload.description.memo_name) {
            user.memo_name = payload.description.memo_name;
        }
        modifyOtherInfoMemoName(state, user);
        modifyFriendListMemoName(state, user);
        modifyConversationMemoName(state, user);
        modifyActiveMessageList(state, user);
    }
}
// 删除好友同步事件
function deleteFriendSyncEvent(state, payload) {
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var user = _a[_i];
        user.name = user.username;
        user.nickName = user.nickname;
        modifyOtherInfoMemoName(state, user);
        modifyFriendListMemoName(state, user);
        modifyConversationMemoName(state, user);
        modifyActiveMessageList(state, user);
        friendSyncEvent(state, user, false);
    }
}
// 用户信息更新事件
function userInfUpdateEventSuccess(state, payload) {
    for (var _i = 0, _a = state.friendList; _i < _a.length; _i++) {
        var friend = _a[_i];
        if (payload.name === friend.name) {
            friend.nickName = payload.nickName;
            friend.avatarUrl = payload.avatarUrl;
            break;
        }
    }
    for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
        var conversation = _c[_b];
        if (conversation.type === 3 && conversation.name === payload.name) {
            conversation.nickName = payload.nickName;
            conversation.avatarUrl = payload.avatarUrl;
        }
        if (conversation.recentMsg && conversation.recentMsg.content.from_id === payload.name) {
            conversation.recentMsg.content.from_name = payload.nickName;
        }
    }
    for (var _d = 0, _e = state.messageList; _d < _e.length; _d++) {
        var messageList = _e[_d];
        for (var _f = 0, _g = messageList.msgs; _f < _g.length; _f++) {
            var msg = _g[_f];
            if (msg.content.from_id === payload.name) {
                msg.content.from_name = payload.nickName;
                msg.content.avatarUrl = payload.avatarUrl;
            }
        }
        if (messageList.groupSetting && messageList.groupSetting.memberList) {
            for (var _h = 0, _j = messageList.groupSetting.memberList; _h < _j.length; _h++) {
                var member = _j[_h];
                if (member.username === payload.name) {
                    member.avatarUrl = payload.avatarUrl;
                    member.nickName = payload.nickName;
                }
            }
        }
    }
    if (payload.name === state.otherInfo.info.name) {
        state.otherInfo.info = Object.assign({}, state.otherInfo.info, payload);
    }
}
// 好友关系同步事件
function friendSyncEvent(state, user, bool) {
    if (state.otherInfo.info.name === user.username &&
        state.otherInfo.info.appkey === user.appkey) {
        state.otherInfo.info.isFriend = bool;
    }
}
// 单聊黑名单同步事件
function singleBlackSyncEvent(state, payload, bool) {
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var addUser = _a[_i];
        if (addUser.username === state.otherInfo.info.name &&
            addUser.appkey === state.otherInfo.info.appkey) {
            state.otherInfo.info.black = bool;
        }
    }
}
// 添加群组屏蔽同步事件
function addGroupShieldSyncEvent(state, payload) {
    state.groupShield = state.groupShield.concat(payload.to_groups);
    for (var _i = 0, _a = payload.to_groups; _i < _a.length; _i++) {
        var addGroup = _a[_i];
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 4 && Number(addGroup.gid) === Number(conversation.key)) {
                conversation.shield = true;
                break;
            }
        }
        if (state.activePerson.type === 4 &&
            Number(state.activePerson.key) === Number(addGroup.gid)) {
            state.activePerson.shield = true;
        }
    }
}
// 删除群组屏蔽同步事件
function deleteGroupShieldSyncEvent(state, payload) {
    for (var _i = 0, _a = payload.to_groups; _i < _a.length; _i++) {
        var deleteGroup = _a[_i];
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 4 && Number(deleteGroup.gid) === Number(conversation.key)) {
                conversation.shield = false;
                break;
            }
        }
        for (var i = 0; i < state.groupShield.length; i++) {
            if (Number(state.groupShield[i].gid) === Number(deleteGroup.gid)) {
                state.groupShield.splice(i, 1);
                break;
            }
        }
        if (state.activePerson.type === 4 &&
            Number(state.activePerson.key) === Number(deleteGroup.gid)) {
            state.activePerson.shield = false;
        }
    }
}
//  添加群组免打扰同步事件
function addGroupNoDisturbSyncEvent(state, payload) {
    state.noDisturb.groups = state.noDisturb.groups.concat(payload.to_groups);
    for (var _i = 0, _a = payload.to_groups; _i < _a.length; _i++) {
        var addGroup = _a[_i];
        addGroup.key = addGroup.gid;
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 4 && Number(conversation.key) === Number(addGroup.gid)) {
                conversation.noDisturb = true;
                break;
            }
        }
        if (state.activePerson.type === 4 &&
            Number(state.activePerson.key) === Number(addGroup.gid)) {
            state.activePerson.noDisturb = true;
        }
    }
}
// 删除群组免打扰同步事件
function deleteGroupNoDisturbSyncEvent(state, payload) {
    for (var _i = 0, _a = payload.to_groups; _i < _a.length; _i++) {
        var deleteGroup = _a[_i];
        for (var i = 0; i < state.noDisturb.groups.length; i++) {
            if (Number(state.noDisturb.groups[i].gid) === Number(deleteGroup.gid)) {
                state.noDisturb.groups.splice(i, 1);
                break;
            }
        }
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 4 &&
                Number(conversation.key) === Number(deleteGroup.gid)) {
                conversation.noDisturb = false;
                break;
            }
        }
        if (state.activePerson.type === 4 &&
            Number(state.activePerson.key) === Number(deleteGroup.gid)) {
            state.activePerson.noDisturb = false;
        }
    }
}
// 删除单聊免打扰同步事件
function deleteSingleNoDisturbSyncEvent(state, payload) {
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var deleteUser = _a[_i];
        for (var i = 0; i < state.noDisturb.users.length; i++) {
            if (deleteUser.appkey === state.noDisturb.users[i].appkey &&
                deleteUser.username === state.noDisturb.users[i].username) {
                state.noDisturb.users.splice(i, 1);
                break;
            }
        }
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 3 && conversation.appkey === deleteUser.appkey &&
                conversation.name === deleteUser.username) {
                conversation.noDisturb = false;
                break;
            }
        }
        if (state.activePerson.type === 3 && deleteUser.appkey === state.activePerson.appkey &&
            deleteUser.username === state.activePerson.name) {
            state.activePerson.noDisturb = false;
        }
        if (state.otherInfo.info.name === deleteUser.username &&
            deleteUser.appkey === state.otherInfo.info.appkey) {
            state.otherInfo.info.noDisturb = false;
        }
    }
}
// 添加单聊免打扰同步事件
function addSingleNoDisturbSyncEvent(state, payload) {
    state.noDisturb.users = state.noDisturb.users.concat(payload.to_usernames);
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var addUser = _a[_i];
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 3 && conversation.appkey === addUser.appkey &&
                conversation.name === addUser.username) {
                conversation.noDisturb = true;
                break;
            }
        }
        if (state.activePerson.type === 3 && addUser.appkey === state.activePerson.appkey &&
            addUser.username === state.activePerson.name) {
            state.activePerson.noDisturb = true;
        }
        if (state.otherInfo.info.name === addUser.username &&
            addUser.appkey === state.otherInfo.info.appkey) {
            state.otherInfo.info.noDisturb = true;
        }
    }
}
// 清空未读数同步事件
function emptyUnreadNumSyncEvent(state, payload) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        var group = conversation.type === 4 && payload.type === 4 &&
            (Number(conversation.key) === Number(payload.gid));
        var single = conversation.type === 3 && payload.type === 3 &&
            conversation.name === payload.name;
        if (group || single) {
            conversation.unreadNum = 0;
            break;
        }
    }
}
// 获取群组信息
function initGroupInfo(state, payload) {
    if (payload.groupInfo) {
        if (payload.groupInfo.name === '') {
            for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
                var conversation = _a[_i];
                if (conversation.type === 4 &&
                    Number(conversation.key) === Number(payload.groupInfo.gid)) {
                    payload.groupInfo.name = conversation.name;
                    break;
                }
            }
        }
        for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
            var messageList = _c[_b];
            if (messageList.type === 4 &&
                Number(messageList.key) === Number(payload.groupInfo.gid)) {
                if (!messageList.groupSetting) {
                    messageList.groupSetting = {};
                }
                messageList.groupSetting.groupInfo = payload.groupInfo;
                messageList.groupSetting.loading = false;
                break;
            }
        }
    }
    if (payload.memberList) {
        sortGroupMember(payload.memberList);
        for (var _d = 0, _e = state.messageList; _d < _e.length; _d++) {
            var messageList = _e[_d];
            if (messageList.type === 4 &&
                Number(messageList.key) === Number(payload.key)) {
                for (var _f = 0, _g = payload.memberList; _f < _g.length; _f++) {
                    var member = _g[_f];
                    for (var _h = 0, _j = state.friendList; _h < _j.length; _h++) {
                        var friend = _j[_h];
                        if (friend.name === member.username) {
                            member.memo_name = friend.memo_name;
                            util_1.Util.getMemo_nameFirstLetter(member);
                            break;
                        }
                    }
                }
                if (!messageList.groupSetting) {
                    messageList.groupSetting = {};
                }
                messageList.groupSetting.memberList = payload.memberList;
                break;
            }
        }
    }
}
// 处理未读列表备注名
function filterUnreadListMemoName(state, payload) {
    for (var _i = 0, _a = payload.info.read_list; _i < _a.length; _i++) {
        var read = _a[_i];
        filterFriend(state, read);
    }
    for (var _b = 0, _c = payload.info.unread_list; _b < _c.length; _b++) {
        var unread = _c[_b];
        filterFriend(state, unread);
    }
}
// 更新群组信息事件
function updateGroupInfoEventSuccess(state, payload) {
    payload.eventData.key = payload.eventData.gid;
    payload.eventData.name = payload.eventData.username = payload.eventData.from_username;
    payload.eventData.nickName = payload.eventData.nickname = payload.eventData.from_nickname;
    filterFriend(state, payload.eventData);
    if (Number(payload.eventData.gid) === Number(state.activePerson.key)) {
        if (payload.groupInfo.name !== '') {
            state.activePerson.name = payload.groupInfo.name;
        }
        state.newMessageIsActive = true;
    }
    else {
        state.newMessageIsActive = false;
    }
    var item = null;
    var msg = {
        ctime_ms: payload.eventData.ctime_ms,
        msg_type: 5,
        content: {
            msg_body: {
                text: (payload.eventData.memo_name ||
                    payload.eventData.nickName || payload.eventData.name || '管理员') + "\u4FEE\u6539\u4E86\u7FA4\u4FE1\u606F"
            },
            msg_type: 'event'
        },
        time_show: '',
        conversation_time_show: 'today'
    };
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var list = _a[_i];
        if (list.type === 4 && Number(list.key) === Number(payload.eventData.key)) {
            if (list.msgs.length > 0) {
                if (util_1.Util.fiveMinutes(list.msgs[list.msgs.length - 1].ctime_ms, payload.eventData.ctime_ms)) {
                    msg.time_show = 'today';
                }
            }
            else {
                msg.time_show = 'today';
            }
            list.msgs.push(msg);
            if (list.groupSetting && list.groupSetting.groupInfo) {
                var name_1 = void 0;
                if (!payload.groupInfo.name || payload.groupInfo.name === '') {
                    name_1 = list.groupSetting.groupInfo.name;
                }
                list.groupSetting.groupInfo = payload.groupInfo;
                if (name_1) {
                    list.groupSetting.groupInfo.name = name_1;
                }
            }
            break;
        }
    }
    for (var i = 0; i < state.conversation.length; i++) {
        if (state.conversation[i].type === 4 &&
            Number(state.conversation[i].key) === Number(payload.eventData.key)) {
            item = state.conversation.splice(i, 1)[0];
            if (payload.groupInfo.avatarUrl && payload.groupInfo.avatarUrl !== '') {
                item.avatarUrl = payload.groupInfo.avatarUrl;
            }
            if (payload.groupInfo.name !== '') {
                item.name = payload.groupInfo.name;
            }
            break;
        }
    }
    for (var _b = 0, _c = state.groupList; _b < _c.length; _b++) {
        var group = _c[_b];
        if (Number(payload.eventData.key) === Number(group.gid)) {
            if (payload.groupInfo.avatarUrl !== '') {
                group.avatarUrl = payload.groupInfo.avatarUrl;
            }
            if (payload.groupInfo.name !== '') {
                group.name = payload.groupInfo.name;
            }
        }
    }
    if (item === null) {
        item = payload.groupInfo;
        item.type = 4;
        state.messageList.push({
            key: payload.eventData.key,
            msgs: [
                msg
            ],
            type: 4
        });
    }
    item.recentMsg = msg;
    filterTopConversation(state, item);
}
// 已读事件监听
function msgReceiptChangeEvent(state, payload) {
    if (payload instanceof Array) {
        for (var _i = 0, payload_2 = payload; _i < payload_2.length; _i++) {
            var item = payload_2[_i];
            msgReceiptChange(state, item);
        }
    }
    else {
        msgReceiptChange(state, payload);
    }
}
function msgReceiptChange(state, payload) {
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        if (payload.type === 3) {
            if (messageList.type === 3 && payload.username === messageList.name
                && payload.appkey === messageList.appkey) {
                updateUnreadCount(state, messageList, payload);
                for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
                    var conversation = _c[_b];
                    if (payload.type === 3 && conversation.type === 3 &&
                        payload.username === conversation.name &&
                        payload.appkey === conversation.appkey) {
                        emptyUnreadText(conversation, payload);
                    }
                }
            }
        }
        else if (payload.type === 4) {
            if (messageList.type === 4 && Number(payload.gid) === Number(messageList.key)) {
                updateUnreadCount(state, messageList, payload);
            }
        }
    }
}
// 更新未读数
function updateUnreadCount(state, messageList, payload) {
    for (var _i = 0, _a = payload.receipt_msgs; _i < _a.length; _i++) {
        var receipt = _a[_i];
        for (var i = messageList.msgs.length - 1; i >= 0; i--) {
            if (messageList.msgs[i].msg_id === receipt.msg_id) {
                if (messageList.msgs[i].unread_count > receipt.unread_count) {
                    messageList.msgs[i].unread_count = receipt.unread_count;
                }
                break;
            }
        }
    }
}
// 清空会话的未读标识
function emptyUnreadText(conversation, payload) {
    for (var _i = 0, _a = payload.receipt_msgs; _i < _a.length; _i++) {
        var receipt = _a[_i];
        if (conversation.recentMsg &&
            conversation.recentMsg.msg_id === receipt.msg_id) {
            conversation.recentMsg.unread_count = 0;
            break;
        }
    }
}
// 会话置顶和取消置顶
function conversationToTop(state, payload) {
    for (var i = 0; i < state.conversation.length; i++) {
        if (Number(state.conversation[i].key) === Number(payload.key)) {
            var item = state.conversation.splice(i, 1)[0];
            if (item.extras && item.extras.top_time_ms) {
                delete item.extras.top_time_ms;
            }
            else {
                item.extras.top_time_ms = new Date().getTime();
            }
            filterTopConversation(state, item);
            break;
        }
    }
}
// 聊天文件中的文件中的图片加载成功
function fileImageLoad(state, payload) {
    for (var _i = 0, _a = state.msgFileImageViewer; _i < _a.length; _i++) {
        var message = _a[_i];
        var msgIdFlag = payload.msg_id && message.msg_id === payload.msg_id;
        var msgKeyFlag = payload.msgKey && message.msgKey === payload.msgKey;
        if (msgIdFlag || msgKeyFlag) {
            message.width = payload.content.msg_body.width;
            message.height = payload.content.msg_body.height;
            break;
        }
    }
}
// 处理聊天文件中的图片预览对象
function filterMsgFileImageViewer(state, type) {
    state.msgFileImageViewer = [];
    for (var _i = 0, _a = state.messageList[state.activePerson.activeIndex].msgs; _i < _a.length; _i++) {
        var message = _a[_i];
        var fileType = '';
        if (message.content.msg_type === 'file') {
            if (message.content.msg_body.extras) {
                if (message.content.msg_body.extras.video) {
                    fileType = 'video';
                }
                else if (message.content.msg_body.extras.fileType) {
                    fileType = util_1.Util.sortByExt(message.content.msg_body.extras.fileType);
                }
                else {
                    fileType = 'other';
                }
            }
            else {
                fileType = 'other';
            }
        }
        if ((message.content.msg_type === 'image') || fileType === 'image') {
            state.msgFileImageViewer.push({
                src: message.content.msg_body.media_url,
                width: message.content.msg_body.width,
                height: message.content.msg_body.height,
                msgKey: message.msgKey,
                msg_id: message.msg_id
            });
        }
    }
    state.msgFileImageViewer.reverse();
}
// 处理聊天文件中的文件列表
function filterMsgFile(state, type) {
    var fileArr = [];
    var msgFile = [];
    for (var _i = 0, _a = state.messageList[state.activePerson.activeIndex].msgs; _i < _a.length; _i++) {
        var message = _a[_i];
        var fileType = '';
        if (message.content.msg_type === 'file') {
            if (message.content.msg_body.extras) {
                if (message.content.msg_body.extras.video) {
                    fileType = 'video';
                }
                else if (message.content.msg_body.extras.fileType) {
                    fileType = util_1.Util.sortByExt(message.content.msg_body.extras.fileType);
                }
                else {
                    fileType = 'other';
                }
            }
            else {
                fileType = 'other';
            }
        }
        if ((message.content.msg_type === type && type === 'image') || fileType === type) {
            fileArr.push(message);
            state.msgFileImageViewer.push({
                src: message.content.msg_body.media_url,
                width: message.content.msg_body.width,
                height: message.content.msg_body.height,
                msgKey: message.msgKey,
                msg_id: message.msg_id
            });
        }
    }
    for (var i = fileArr.length - 1; i >= 0; i--) {
        var time = new Date(fileArr[i].ctime_ms);
        var year = time.getFullYear();
        var month = util_1.Util.doubleNumber(time.getMonth() + 1);
        var flag = true;
        var showTime = year + '年' + month + '月';
        for (var _b = 0, msgFile_1 = msgFile; _b < msgFile_1.length; _b++) {
            var item = msgFile_1[_b];
            if (item.time === showTime) {
                item.msgs.push(fileArr[i]);
                flag = false;
                break;
            }
        }
        if (flag) {
            msgFile.push({
                time: showTime,
                msgs: [fileArr[i]]
            });
        }
    }
    state.msgFile[type] = msgFile;
}
// 给会话列表和当前消息列表添加备注名
function filterConversationMemoName(state) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        for (var _b = 0, _c = state.friendList; _b < _c.length; _b++) {
            var friend = _c[_b];
            if (conversation.name === friend.name && conversation.type === 3) {
                conversation.memo_name = friend.memo_name;
            }
            if (conversation.recentMsg && conversation.recentMsg.content.from_id === friend.name
                && conversation.type === 4) {
                conversation.recentMsg.content.memo_name = friend.memo_name;
            }
        }
    }
    if (state.activePerson.activeIndex >= 0 && state.activePerson.type === 4
        && state.messageList[state.activePerson.activeIndex]) {
        for (var _d = 0, _e = state.messageList[state.activePerson.activeIndex].msgs; _d < _e.length; _d++) {
            var message = _e[_d];
            for (var _f = 0, _g = state.friendList; _f < _g.length; _f++) {
                var friend = _g[_f];
                if (message.content.from_id === friend.name) {
                    message.content.memo_name = friend.memo_name;
                }
            }
        }
    }
}
// 更新其他用户资料
function updateOtherInfo(state, payload) {
    if (payload.return_code === 0 && state.otherInfo.info.name === payload.from_username) {
        state.otherInfo.info.isFriend = true;
    }
}
// 用户资料中删除好友
function otherInfoDeleteFriend(state, payload) {
    if (state.otherInfo.info.name === payload.name) {
        state.otherInfo.info.isFriend = false;
        state.otherInfo.show = false;
    }
    var hasMemoName = false;
    for (var i = 0; i < state.friendList.length; i++) {
        if (state.friendList[i].name === payload.name) {
            if (state.friendList[i].memo_name && state.friendList[i].memo_name !== '') {
                hasMemoName = true;
            }
            state.friendList.splice(i, 1);
            break;
        }
    }
    for (var i = 0; i < state.conversation.length; i++) {
        if (state.conversation[i].name === payload.name && state.conversation[i].type === 3) {
            state.conversation.splice(i, 1);
            break;
        }
    }
    if (state.activePerson.name === payload.name && state.activePerson.type === 3) {
        state.defaultPanelIsShow = true;
    }
    if (hasMemoName) {
        for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
            var messageList = _a[_i];
            if (messageList.type === 4) {
                for (var _b = 0, _c = messageList.msgs; _b < _c.length; _b++) {
                    var msg = _c[_b];
                    if (msg.content.from_id === payload.name) {
                        msg.content.memo_name = '';
                    }
                }
                if (messageList.groupSetting && messageList.groupSetting.memberList) {
                    for (var _d = 0, _e = messageList.groupSetting.memberList; _d < _e.length; _d++) {
                        var member = _e[_d];
                        if (member.username === payload.name) {
                            member.memo_name = '';
                            break;
                        }
                    }
                }
            }
        }
        for (var _f = 0, _g = state.conversation; _f < _g.length; _f++) {
            var conversation = _g[_f];
            if (conversation.type === 4 && conversation.recentMsg) {
                if (conversation.recentMsg.content.from_id === payload.name) {
                    conversation.recentMsg.content.memo_name = '';
                }
            }
        }
    }
}
// 修改会话列表的备注名
function modifyConversationMemoName(state, payload) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        if (conversation.name === payload.name && conversation.type === 3) {
            conversation.memo_name = payload.memo_name;
        }
        if (conversation.recentMsg &&
            conversation.recentMsg.content.from_id === payload.name) {
            conversation.recentMsg.content.memo_name = payload.memo_name;
        }
    }
    if (state.activePerson.type === 3 && state.activePerson.name === payload.name) {
        state.activePerson.memo_name = payload.memo_name;
    }
}
// 修改好友列表的备注名
function modifyFriendListMemoName(state, payload) {
    for (var _i = 0, _a = state.friendList; _i < _a.length; _i++) {
        var friend = _a[_i];
        if (friend.name === payload.name) {
            friend.memo_name = payload.memo_name;
            break;
        }
    }
}
// 修改用户信息的备注名
function modifyOtherInfoMemoName(state, payload) {
    if (payload.name === state.otherInfo.info.name) {
        state.otherInfo.info.memo_name = payload.memo_name;
    }
}
// 当前会话有修改了备注的用户时，修改消息列表的备注和群成员的备注
function modifyActiveMessageList(state, payload) {
    if (state.activePerson.activeIndex > 0 && state.activePerson.type === 4) {
        var messageList = state.messageList[state.activePerson.activeIndex];
        var msgs = messageList.msgs;
        for (var _i = 0, msgs_2 = msgs; _i < msgs_2.length; _i++) {
            var message = msgs_2[_i];
            if (message.content.from_id === payload.name ||
                message.content.from_id === payload.username) {
                message.content.memo_name = payload.memo_name;
            }
        }
        if (messageList.groupSetting && messageList.groupSetting.memberList) {
            for (var _a = 0, _b = messageList.groupSetting.memberList; _a < _b.length; _a++) {
                var member = _b[_a];
                if (member.username === payload.name || member.username === payload.username) {
                    member.memo_name = payload.memo_name;
                    util_1.Util.getMemo_nameFirstLetter(member);
                }
            }
        }
    }
}
// 更新（增加或删除）黑名单列表里的用户
function updateBlackMenu(state, payload) {
    var flag = true;
    for (var i = 0; i < state.blackMenu.length; i++) {
        if (state.blackMenu[i].username === payload.username) {
            state.blackMenu.splice(i, 1);
            flag = false;
            break;
        }
    }
    if (flag) {
        state.blackMenu.push({
            username: payload.username,
            appkey: payload.appkey
        });
    }
}
// 判断用户是否是黑名单
function filterSingleBlack(state, payload) {
    for (var _i = 0, _a = state.blackMenu; _i < _a.length; _i++) {
        var black = _a[_i];
        if (black.username === payload.name) {
            payload.black = true;
            break;
        }
    }
}
// 判断用户是否是免打扰
function filterSingleNoDisturb(state, payload) {
    for (var _i = 0, _a = state.noDisturb.users; _i < _a.length; _i++) {
        var user = _a[_i];
        if (user.username === payload.name) {
            payload.noDisturb = true;
            break;
        }
    }
}
// 判断是否是好友
function filterFriend(state, payload) {
    var result = state.friendList.filter((function (friend) {
        return friend.name === payload.name || friend.name === payload.username
            || friend.name === payload.from_username;
    }));
    if (result.length > 0) {
        payload.memo_name = result[0].memo_name;
    }
    return result.length > 0 ? true : false;
}
// 同意添加好友后添加好友到会话列表
function addNewFriendToConversation(state, payload, type) {
    if (payload.return_code !== 0 && type !== 'agree') {
        return;
    }
    if (payload.from_username) {
        payload.name = payload.from_username;
        payload.username = payload.from_username;
        payload.nickName = payload.from_nickname;
        payload.nickname = payload.from_nickname;
    }
    if (state.activePerson.type === 3 && payload.from_username === state.activePerson.name) {
        state.newMessageIsActive = true;
    }
    var result = state.friendList.filter((function (friend) {
        return friend.name === payload.name;
    }));
    if (result.length === 0) {
        state.friendList.push(payload);
    }
    var item = null;
    var msg = {
        ctime_ms: payload.ctime_ms,
        msg_type: 5,
        content: {
            msg_body: {
                text: '已成功添加为好友'
            },
            msg_type: 'event'
        },
        time_show: '',
        conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms)
    };
    for (var i = 0; i < state.conversation.length; i++) {
        if (state.conversation[i].type === 3 && state.conversation[i].name === payload.name) {
            for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
                var list = _a[_i];
                if (state.conversation[i].name === list.name &&
                    state.conversation[i].appkey === list.appkey) {
                    if (list.msgs.length > 0) {
                        if (util_1.Util.fiveMinutes(list.msgs[list.msgs.length - 1].ctime_ms, payload.ctime_ms)) {
                            msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                        }
                    }
                    else {
                        msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                    }
                    list.msgs.push(msg);
                    break;
                }
            }
            if (!state.conversation[i].extras || !state.conversation[i].extras.top_time_ms) {
                item = state.conversation.splice(i, 1)[0];
            }
            else {
                state.conversation[i].recentMsg = msg;
                return;
            }
            break;
        }
    }
    if (item === null) {
        item = payload;
        state.messageList.push({
            msgs: [
                msg
            ],
            appkey: payload.appkey || common_1.authPayload.appkey,
            name: payload.name,
            type: 3
        });
        msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
    }
    item.recentMsg = msg;
    filterTopConversation(state, item);
}
// 退群
function exitGroup(state, item) {
    if (item.gid) {
        item.key = item.gid;
    }
    for (var i = 0; i < state.groupList.length; i++) {
        if (Number(state.groupList[i].gid) === Number(item.key)) {
            state.groupList.splice(i, 1);
            break;
        }
    }
}
// 隐藏群设置
function showGroupSetting(state, show) {
    if (state.activePerson.activeIndex >= 0) {
        var groupSetting = state.messageList[state.activePerson.activeIndex].groupSetting;
        if (groupSetting) {
            groupSetting.show = show;
        }
    }
}
// 判断当前用户是否是目标用户
function currentIsActive(state, payload) {
    return state.activePerson.type === 4 &&
        Number(state.activePerson.key) === Number(payload.gid) ? true : false;
}
// 消息撤回
function msgRetract(state, payload) {
    var name = '';
    var recentMsg = {};
    var index;
    var singleSendName = '';
    if (payload.type === 0 && payload.from_username === common_1.global.user) {
        singleSendName = payload.to_usernames[0].username;
    }
    else if (payload.type === 0) {
        singleSendName = payload.from_username;
    }
    for (var i = 0; i < state.conversation.length; i++) {
        var isGroup = payload.type === 1 && state.conversation[i].type === 4 &&
            Number(payload.from_gid) === Number(state.conversation[i].key);
        var isSingle = payload.type === 0 && state.conversation[i].type === 3 &&
            state.conversation[i].name === singleSendName;
        if (isGroup || isSingle) {
            var msgType = isGroup ? 4 : 3;
            if (payload.from_username === common_1.global.user) {
                name = '您';
            }
            else if (msgType === 4) {
                payload.name = payload.from_username;
                if (filterFriend(state, payload) && payload.memo_name && payload.memo_name !== '') {
                    name = payload.memo_name;
                }
                else if (payload.from_nickname && payload.from_nickname !== '') {
                    name = payload.from_nickname;
                }
                else {
                    name = payload.from_username;
                }
            }
            else if (msgType === 3) {
                name = '对方';
            }
            recentMsg = {
                ctime_ms: payload.ctime_ms,
                content: {
                    msg_body: {
                        text: name + "\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"
                    },
                    msg_type: 'event'
                },
                conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms),
                msg_type: msgType
            };
            payload.key = state.conversation[i].key;
            index = i;
            if (!state.conversation[i].extras || !state.conversation[i].extras.top_time_ms) {
                var item = state.conversation.splice(i, 1);
                index = filterTopConversation(state, item[0]);
            }
            break;
        }
    }
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        var group = payload.type === 1 && messageList.type === 4 &&
            Number(payload.key) === Number(messageList.key);
        var single = payload.type === 0 && messageList.type === 3 &&
            singleSendName === messageList.name;
        if (single || group) {
            for (var i = 0; i < messageList.msgs.length; i++) {
                if (Number(messageList.msgs[i].msg_id) === Number(payload.msg_ids[0])) {
                    var eventMsg = {
                        ctime_ms: payload.ctime_ms,
                        msg_type: 5,
                        content: {
                            msg_body: {
                                text: name + "\u64A4\u56DE\u4E86\u4E00\u6761\u6D88\u606F"
                            }
                        },
                        time_show: ''
                    };
                    var item = messageList.msgs.splice(i, 1);
                    eventMsg.ctime_ms = item[0].ctime_ms;
                    messageList.msgs.splice(i, 0, eventMsg);
                    if (i === messageList.msgs.length - 1) {
                        state.conversation[index].recentMsg = recentMsg;
                    }
                    break;
                }
            }
            break;
        }
    }
}
// 删除群成员事件
function deleteGroupMembersEvent(state, payload) {
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        if (messageList.type === 4 && Number(messageList.key) === Number(payload.gid)) {
            if (messageList.groupSetting && messageList.groupSetting.memberList) {
                var memberList = messageList.groupSetting.memberList;
                for (var _b = 0, _c = payload.to_usernames; _b < _c.length; _b++) {
                    var user = _c[_b];
                    for (var i = 0; i < memberList.length; i++) {
                        if (user.username === memberList[i].username) {
                            memberList.splice(i, 1);
                            break;
                        }
                    }
                }
                if (payload.new_owner) {
                    for (var i = 0; i < memberList.length; i++) {
                        if (payload.new_owner.username === memberList[i].username) {
                            var item = memberList.splice(i, 1)[0];
                            item.flag = 1;
                            memberList.unshift(item);
                            break;
                        }
                    }
                }
            }
            break;
        }
    }
}
// 切换用户前清除语音的定时器
function clearVoiceTimer(state) {
    var activeIndex = state.activePerson.activeIndex;
    var activeMessageList = state.messageList[activeIndex];
    if (activeIndex < 0 || !activeMessageList) {
        return;
    }
    for (var _i = 0, _a = activeMessageList.msgs; _i < _a.length; _i++) {
        var msg = _a[_i];
        if (msg.content.msg_type === 'voice') {
            msg.content.playing = false;
        }
    }
}
// 被添加进群时更新群成员
function updateGroupMembers(state, eventData) {
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        if (messageList.type === 4 &&
            Number(messageList.key) === Number(eventData.gid)) {
            if (messageList.groupSetting) {
                for (var _b = 0, _c = eventData.to_usernames; _b < _c.length; _b++) {
                    var user = _c[_b];
                    user.flag = 0;
                }
                if (messageList.groupSetting.memberList) {
                    for (var _d = 0, _e = eventData.to_usernames; _d < _e.length; _d++) {
                        var user = _e[_d];
                        var flag = true;
                        for (var _f = 0, _g = messageList.groupSetting.memberList; _f < _g.length; _f++) {
                            var member = _g[_f];
                            if (user.username === member.username) {
                                flag = false;
                            }
                        }
                        if (flag) {
                            messageList.groupSetting.memberList.push(user);
                        }
                    }
                }
            }
            break;
        }
    }
}
// 接收到管理员建群时自动添加会话和消息
function createGroupSuccessEvent(state, payload) {
    var item = {
        key: payload.gid,
        name: payload.name,
        type: 4,
        unreadNum: 0,
        recentMsg: {
            ctime_ms: payload.ctime_ms,
            content: {
                msg_body: {
                    text: '创建群聊'
                },
                msg_type: 'event'
            },
            conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms),
            msg_type: 4
        }
    };
    filterTopConversation(state, item);
    state.groupList.push({
        appkey: payload.from_appkey,
        name: payload.group_name,
        gid: payload.gid,
        avatar: payload.avatar,
        avatarUrl: payload.avatarUrl || ''
    });
    state.messageList.push({
        key: payload.gid,
        msgs: [
            {
                ctime_ms: payload.ctime_ms,
                msg_type: 5,
                content: {
                    msg_body: {
                        text: '创建群聊'
                    }
                },
                time_show: util_1.Util.reducerDate(payload.ctime_ms)
            }
        ],
        type: 4
    });
    if (payload.isOffline) {
        sortConversationByRecentMsg(state);
    }
}
// 给群聊事件添加最近一条聊天消息
function isRecentmsg(state, payload, addGroupOther, operation, index) {
    var flag = false;
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        if (state.conversation[index].type === 4 &&
            Number(state.conversation[index].key) === Number(messageList.key)) {
            flag = true;
            var msg = messageList['msgs'];
            if (msg.length === 0 || payload.ctime_ms > msg[msg.length - 1].ctime_ms) {
                state.conversation[index].recentMsg = {
                    ctime_ms: payload.ctime_ms,
                    content: {
                        msg_body: {
                            text: addGroupOther + operation
                        },
                        msg_type: 'event'
                    },
                    conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms),
                    msg_type: 4
                };
            }
            break;
        }
    }
    if (!flag) {
        state.conversation[index].recentMsg = {
            ctime_ms: payload.ctime_ms,
            content: {
                msg_body: {
                    text: addGroupOther + operation
                },
                msg_type: 'event'
            },
            conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms),
            msg_type: 4
        };
    }
}
// 通过recentMsg去对conversation排序
function sortConversationByRecentMsg(state) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        if (conversation.recentMsg) {
            conversation.lastMsgTime = conversation.recentMsg.ctime_ms;
        }
        else {
            conversation.lastMsgTime = 0;
        }
    }
    var len = state.conversation.length;
    var maxIndex;
    var temp;
    var topIndex = 0;
    for (var i = 0; i < len; i++) {
        if (!state.conversation[i].extras || !state.conversation[i].extras.top_time_ms) {
            topIndex = i;
            break;
        }
    }
    for (var i = topIndex; i < len - 1; i++) {
        maxIndex = i;
        for (var j = i + 1; j < len; j++) {
            if (state.conversation[j].lastMsgTime >
                state.conversation[maxIndex].lastMsgTime) {
                maxIndex = j;
            }
        }
        temp = util_1.Util.deepCopyObj(state.conversation[i]);
        state.conversation[i] = util_1.Util.deepCopyObj(state.conversation[maxIndex]);
        state.conversation[maxIndex] = temp;
    }
}
// 被添加进群、移出群、退出群的事件
function groupMembersEvent(state, payload, operation) {
    for (var _i = 0, _a = state.groupShield; _i < _a.length; _i++) {
        var shield = _a[_i];
        if (Number(shield.gid) === Number(payload.gid)) {
            return;
        }
    }
    var usernames = payload.to_usernames;
    var addGroupOther = '';
    for (var _b = 0, usernames_1 = usernames; _b < usernames_1.length; _b++) {
        var user = usernames_1[_b];
        if (user.nickname) {
            user.nickName = user.nickname;
        }
        if (user.username) {
            user.name = user.username;
        }
        filterFriend(state, user);
        if (user.username === common_1.global.user) {
            addGroupOther = '您' + '、';
        }
        else {
            var name_2 = '';
            if (filterFriend(state, user) && user.memo_name && user.memo_name !== '') {
                name_2 = user.memo_name;
            }
            else if (user.nickname && user.nickname !== '') {
                name_2 = user.nickname;
            }
            else {
                name_2 = user.username;
            }
            addGroupOther += name_2 + '、';
        }
    }
    if (addGroupOther.length > 0) {
        addGroupOther = addGroupOther.slice(0, addGroupOther.length - 1);
    }
    var flag1 = true;
    for (var i = 0; i < state.conversation.length; i++) {
        if (state.conversation[i].type === 4 &&
            Number(payload.gid) === Number(state.conversation[i].key)) {
            flag1 = false;
            var index = i;
            if (!state.conversation[i].extras || !state.conversation[i].extras.top_time_ms) {
                var item = state.conversation.splice(i, 1);
                index = filterTopConversation(state, item[0]);
            }
            isRecentmsg(state, payload, addGroupOther, operation, index);
            break;
        }
    }
    if (flag1) {
        for (var _c = 0, _d = state.groupList; _c < _d.length; _c++) {
            var group = _d[_c];
            if (Number(group.gid) === Number(payload.gid)) {
                var conversation = util_1.Util.deepCopyObj(group);
                conversation.type = 4;
                conversation.key = group.gid;
                conversation.unreadNum = 0;
                for (var _e = 0, _f = state.noDisturb.groups; _e < _f.length; _e++) {
                    var noDisturbGroup = _f[_e];
                    if (Number(noDisturbGroup.gid) === Number(payload.gid)) {
                        conversation.noDisturb = true;
                        break;
                    }
                }
                var index = filterTopConversation(state, conversation);
                flag1 = false;
                isRecentmsg(state, payload, addGroupOther, operation, index);
                break;
            }
        }
    }
    // 对群组列表和会话列表中没有的群，并且是离线的事件消息，不做任何处理
    if (flag1 && payload.isOffline) {
        return;
    }
    if (flag1) {
        var conversation = {
            key: payload.gid,
            name: payload.name,
            type: 4,
            unreadNum: 0,
            avatarUrl: payload.avatarUrl,
            recentMsg: {
                ctime_ms: payload.ctime_ms,
                content: {
                    msg_body: {
                        text: addGroupOther + operation
                    },
                    msg_type: 'event'
                },
                conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms),
                msg_type: 4
            }
        };
        // 如果群聊事件消息的群名和群头像不存在，去群组列表获取
        for (var _g = 0, _h = state.groupList; _g < _h.length; _g++) {
            var group = _h[_g];
            if (Number(group.gid) === Number(payload.gid)) {
                if (group.avatarUrl) {
                    conversation.avatarUrl = group.avatarUrl;
                }
                if (!payload.name || payload.name === '') {
                    conversation.name = group.name;
                }
                break;
            }
        }
        filterTopConversation(state, conversation);
    }
    // 重新对conversation排序
    if (payload.isOffline) {
        sortConversationByRecentMsg(state);
    }
    addEventMsgToMessageList(state, payload, addGroupOther, operation);
}
// 将群聊事件消息添加到消息列表
function addEventMsgToMessageList(state, payload, addGroupOther, operation) {
    var message = {
        ctime_ms: payload.ctime_ms,
        msg_type: 5,
        content: {
            msg_body: {
                text: addGroupOther + operation
            }
        },
        time_show: ''
    };
    var flag2 = true;
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        if (Number(payload.gid) === Number(messageList.key)) {
            flag2 = false;
            var msgs = messageList.msgs;
            if (payload.isOffline) {
                if (msgs.length === 0) {
                    message.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                    msgs.push(message);
                }
                else if (msgs[msgs.length - 1].ctime_ms < payload.ctime_ms) {
                    if (util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, payload.ctime_ms)) {
                        message.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                    }
                    msgs.push(message);
                }
                else {
                    for (var j = 0; j < msgs.length - 1; j++) {
                        if (msgs[j].ctime_ms < payload.ctime_ms &&
                            payload.ctime_ms < msgs[j + 1].ctime_ms) {
                            if (util_1.Util.fiveMinutes(msgs[j].ctime_ms, payload.ctime_ms)) {
                                message.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                            }
                            if (!util_1.Util.fiveMinutes(payload.ctime_ms, msgs[j + 1].ctime_ms)) {
                                messageList.msgs[j + 1].time_show = '';
                            }
                            messageList.msgs.splice(j + 1, 0, message);
                            break;
                        }
                    }
                }
            }
            else {
                if (msgs.length === 0 ||
                    util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, payload.ctime_ms)) {
                    message.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                }
                msgs.push(message);
            }
            break;
        }
    }
    if (flag2) {
        message.time_show = util_1.Util.reducerDate(payload.ctime_ms);
        state.messageList.push({
            key: payload.gid,
            msgs: [message],
            type: 4
        });
    }
}
// 离线消息15天后消失，而会话列表依然存在，导致不一一对应，所以补全离线消息
function completionMessageList(state) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        var flag = false;
        for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
            var messageList = _c[_b];
            var group = messageList.type === 4 &&
                Number(conversation.key) === Number(messageList.key);
            var single = messageList.type === 3 &&
                conversation.name === messageList.name;
            if (group || single) {
                flag = true;
                break;
            }
        }
        if (!flag) {
            if (conversation.type === 3) {
                state.messageList.push({
                    key: conversation.key,
                    msgs: [],
                    type: 3,
                    appkey: conversation.appkey,
                    name: conversation.name
                });
            }
            else if (conversation.type === 4) {
                state.messageList.push({
                    key: conversation.key,
                    msgs: [],
                    type: 4
                });
            }
        }
    }
}
// 切换单聊用户免打扰
function changeSingleNoDisturb(state, payload) {
    var flag = true;
    for (var i = 0; i < state.noDisturb.users.length; i++) {
        if (payload.name === state.noDisturb.users[i].username) {
            flag = false;
            state.noDisturb.users.splice(i, 1);
        }
    }
    if (flag) {
        state.noDisturb.users.push({
            username: payload.name,
            appkey: payload.appkey
        });
    }
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        if (conversation.type === 3 && conversation.name === payload.name) {
            if (flag) {
                conversation.noDisturb = true;
            }
            else {
                conversation.noDisturb = false;
            }
            break;
        }
    }
}
// 初始化免打扰
function initNoDisturb(state, noDisturb) {
    for (var _i = 0, _a = noDisturb.users; _i < _a.length; _i++) {
        var user = _a[_i];
        for (var _b = 0, _c = state.conversation; _b < _c.length; _b++) {
            var conversation = _c[_b];
            if (conversation.type === 3 && user.username === conversation.name) {
                conversation.noDisturb = true;
                break;
            }
        }
    }
    for (var _d = 0, _e = noDisturb.groups; _d < _e.length; _d++) {
        var group = _e[_d];
        group.key = group.gid;
        for (var _f = 0, _g = state.conversation; _f < _g.length; _f++) {
            var conversation = _g[_f];
            if (conversation.type === 4 && Number(group.key) === Number(conversation.key)) {
                conversation.noDisturb = true;
                break;
            }
        }
    }
}
// 切换群免打扰
function changeGroupNoDisturb(state, payload) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        var group = conversation.type === 4 && payload.type === 4 &&
            Number(payload.key) === Number(conversation.key);
        if (group) {
            conversation.noDisturb = !conversation.noDisturb;
            break;
        }
    }
    var flag = true;
    for (var i = 0; i < state.noDisturb.groups.length; i++) {
        if (Number(state.noDisturb.groups[i].key) === Number(payload.key)) {
            state.noDisturb.groups.splice(i, 1);
            flag = false;
            break;
        }
    }
    if (flag) {
        state.noDisturb.groups.push({
            key: Number(payload.key),
            name: payload.name,
            appkey: payload.appkey
        });
    }
}
// 初始化群屏蔽
function initGroupShield(state, shield) {
    for (var _i = 0, shield_1 = shield; _i < shield_1.length; _i++) {
        var shieldItem = shield_1[_i];
        for (var _a = 0, _b = state.conversation; _a < _b.length; _a++) {
            var conversation = _b[_a];
            if (conversation.type === 4 && Number(shieldItem.gid) === Number(conversation.key)) {
                conversation.shield = true;
                break;
            }
        }
    }
    state.groupShield = shield;
}
// 切换群屏蔽
function changeGroupShield(state, payload) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var item = _a[_i];
        if (item.type === 4 && Number(payload.key) === Number(item.key)) {
            item.shield = !item.shield;
            if (item.shield) {
                state.groupShield.push({
                    gid: item.key,
                    name: item.name
                });
            }
            else {
                for (var i = 0; i < state.groupShield.length; i++) {
                    if (item.type === 4 && Number(state.groupShield[i].gid) === Number(item.key)) {
                        state.groupShield.splice(i, 1);
                        break;
                    }
                }
            }
            break;
        }
    }
}
// 过滤出当前图片预览的数组
function filterImageViewer(state) {
    var messageList = state.messageList[state.activePerson.activeIndex];
    if (state.activePerson.activeIndex < 0 || !messageList || !messageList.msgs) {
        return [];
    }
    var imgResult = [];
    var msgs = messageList.msgs;
    for (var _i = 0, msgs_3 = msgs; _i < msgs_3.length; _i++) {
        var message = msgs_3[_i];
        var content = message.content;
        var jpushEmoji = (!content.msg_body.extras || !content.msg_body.extras.kLargeEmoticon
            || content.msg_body.extras.kLargeEmoticon !== 'kLargeEmoticon');
        if (content.msg_type === 'image' && jpushEmoji) {
            imgResult.push({
                mediaId: content.msg_body.media_id,
                src: content.msg_body.media_url,
                width: content.msg_body.width,
                height: content.msg_body.height,
                msg_id: message.msg_id
            });
        }
    }
    return imgResult;
}
// 切换当前会话用户
function changeActivePerson(state) {
    if (state.activePerson.type === 4 && state.activePerson.gid) {
        state.activePerson.key = state.activePerson.gid;
    }
    for (var i = 0; i < state.messageList.length; i++) {
        var group = state.activePerson.type === 4 && state.messageList[i].type === 4 &&
            Number(state.messageList[i].key) === Number(state.activePerson.key);
        var single = state.activePerson.type === 3 && state.messageList[i].type === 3 &&
            state.messageList[i].name === state.activePerson.name;
        if (group || single) {
            state.activePerson.activeIndex = i;
            break;
        }
    }
    var list = state.messageList[state.activePerson.activeIndex];
    for (var _i = 0, _a = list.msgs; _i < _a.length; _i++) {
        var msg = _a[_i];
        var video = (msg.content.msg_body.extras && msg.content.msg_body.extras.video);
        if (msg.content.msg_type === 'file' && video) {
            // audio 0 正在加载  1 加载完成  2 正在播放
            msg.content.load = 0;
            // 加载进度 0%
            msg.content.range = 0;
        }
        else if (msg.content.msg_type === 'voice') {
            // voice 播放时的动画
            msg.content.playing = false;
            msg.content.load = 0;
        }
        // 给群聊消息中的好友添加备注名
        for (var _b = 0, _c = state.friendList; _b < _c.length; _b++) {
            var friend = _c[_b];
            if (friend.name === msg.content.from_id) {
                msg.content.memo_name = friend.memo_name;
                break;
            }
        }
        // 初始化图片消息的loading状态
        if (msg.content.msg_type === 'image') {
            msg.content.msg_body.loading = false;
        }
    }
    // 给群成员中的好友添加备注名
    if (state.activePerson.type === 4 &&
        list && list.groupSetting && list.groupSetting.memberList) {
        for (var _d = 0, _e = list.groupSetting.memberList; _d < _e.length; _d++) {
            var member = _e[_d];
            for (var _f = 0, _g = state.friendList; _f < _g.length; _f++) {
                var friend = _g[_f];
                if (friend.name === member.username) {
                    member.memo_name = friend.memo_name;
                    util_1.Util.getMemo_nameFirstLetter(member);
                    break;
                }
            }
        }
    }
    // 初始化已读语音消息的状态
    for (var i = 0; i < state.voiceState.length; i++) {
        if (Number(state.voiceState[i].key) === Number(list.key)) {
            var flag = true;
            for (var _h = 0, _j = list.msgs; _h < _j.length; _h++) {
                var msg = _j[_h];
                if (Number(state.voiceState[i].msgId) === Number(msg.msg_id)) {
                    msg.content.havePlay = true;
                    flag = false;
                    break;
                }
            }
            if (flag) {
                state.voiceState.splice(i, 1);
            }
        }
    }
    state.imageViewer = filterImageViewer(state);
}
// 添加最近一条聊天消息
function filterRecentMsg(state) {
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
            var messageList = _c[_b];
            var group = conversation.type === 4 && messageList.type === 4 &&
                Number(conversation.key) === Number(messageList.key);
            var single = conversation.type === 3 && messageList.type === 3 &&
                conversation.name === messageList.name;
            if (group || single) {
                var msgs = messageList.msgs;
                if (msgs.length > 0) {
                    msgs[msgs.length - 1].conversation_time_show =
                        util_1.Util.reducerDate(msgs[msgs.length - 1].ctime_ms);
                    conversation.recentMsg = msgs[msgs.length - 1];
                }
                break;
            }
        }
    }
    sortConversationByRecentMsg(state);
}
// 将群主放在第一位
function sortGroupMember(memberList) {
    for (var i = 0; i < memberList.length; i++) {
        if (memberList[i].flag === 1) {
            var temp = memberList.splice(i, 1);
            memberList.unshift(temp[0]);
            break;
        }
    }
}
// 完成消息的发送接口的调用后，返回成功或者失败状态
function sendMsgComplete(state, payload) {
    if (payload.success === 2) {
        payload.msgs.success = 2;
        for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
            var conversation = _a[_i];
            // 转发消息时没有key
            if (!payload.key) {
                if (payload.name === conversation.name) {
                    payload.key = conversation.key;
                    conversation.key = payload.msgs.key;
                }
                // 转发或者发送消息时key < 0
            }
            else if (Number(payload.key) < 0) {
                if (Number(payload.key) === Number(conversation.key)) {
                    conversation.key = payload.msgs.key;
                }
            }
            // 给recentMsg添加msg_id
            if (payload.type === 3 && payload.name === conversation.name &&
                conversation.type === 3) {
                payload.msgs.unread_count = 1;
                payload.msgs.conversation_time_show =
                    conversation.recentMsg.conversation_time_show;
                payload.msgs.ctime_ms = conversation.recentMsg.ctime_ms;
                conversation.recentMsg = payload.msgs;
            }
        }
    }
    for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
        var messageList = _c[_b];
        var group = payload.type === 4 && messageList.type === 4 &&
            Number(messageList.key) === Number(payload.key);
        var single = payload.type === 3 && messageList.type === 3 &&
            messageList.name === payload.name;
        if (group || single) {
            if (Number(payload.key) < 0 && payload.success === 2) {
                messageList.key = payload.msgs.key;
                if (Number(payload.key) === Number(state.activePerson.key)) {
                    state.activePerson.key = payload.msgs.key;
                }
            }
            var msgs = messageList.msgs;
            for (var j = msgs.length - 1; j >= 0; j--) {
                if (msgs[j].msgKey && Number(payload.msgKey) === Number(msgs[j].msgKey)) {
                    if (payload.msgs && payload.success === 2) {
                        var url = msgs[j].content.msg_body.media_url;
                        var localExtras = msgs[j].content.msg_body.extras;
                        if (url) {
                            payload.msgs.content.msg_body.media_url = url;
                        }
                        if (localExtras && localExtras.businessCard) {
                            payload.msgs.content.msg_body.extras.media_url = localExtras.media_url;
                            payload.msgs.content.msg_body.extras.nickName = localExtras.nickName;
                        }
                        delete msgs[j].msg_id;
                        var from_name = payload.msgs.content.from_name;
                        var nickname = msgs[j].content.from_name;
                        msgs[j] = Object.assign({}, msgs[j], payload.msgs);
                        if (!from_name) {
                            msgs[j].content.from_name = nickname;
                        }
                    }
                    msgs[j].success = payload.success;
                    return;
                }
            }
        }
    }
}
// 删除本地的会话列表
function deleteConversationItem(state, payload) {
    var itemKey = Number(payload.item.key);
    for (var i = 0; i < state.conversation.length; i++) {
        var conversationKey = Number(state.conversation[i].key);
        if (conversationKey === itemKey ||
            (state.conversation[i].name === payload.item.name &&
                payload.item.type === 3 && state.conversation[i].type === 3)) {
            state.conversation.splice(i, 1);
            break;
        }
    }
    var group = state.activePerson.type === 4 && payload.item.type === 4 &&
        itemKey === Number(state.activePerson.key);
    var single = state.activePerson.type === 3 && payload.item.type === 3 &&
        payload.item.name === state.activePerson.name;
    if (group || single) {
        state.defaultPanelIsShow = true;
        state.activePerson = {
            key: '0',
            name: '',
            nickName: '',
            activeIndex: -1,
            noDisturb: false,
            avatarUrl: '',
            shield: false,
            memo_name: '',
            appkey: ''
        };
    }
}
// 转发消息
function transmitMessage(state, payload) {
    payload.msgs.key = payload.select.key;
    var flag1 = true;
    var flag2 = true;
    for (var a = 0; a < state.conversation.length; a++) {
        var groupExist = payload.select.type === 4 && state.conversation[a].type === 4 &&
            Number(state.conversation[a].key) === Number(payload.select.key);
        var singleExist = payload.select.type === 3 && state.conversation[a].type === 3 &&
            state.conversation[a].name === payload.select.name;
        if (groupExist || singleExist) {
            flag1 = false;
            payload.select.conversation_time_show = 'today';
            state.conversation[a].recentMsg = payload.msgs;
            if (!state.conversation[a].extras || !state.conversation[a].extras.top_time_ms) {
                var item = state.conversation.splice(a, 1);
                filterTopConversation(state, item[0]);
            }
            break;
        }
    }
    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
        var messageList = _a[_i];
        var group = payload.select.type === 4 && messageList.type === 4 &&
            Number(messageList.key) === Number(payload.select.key);
        var single = payload.select.type === 3 && messageList.type === 3 &&
            messageList.name === payload.select.name;
        if (group || single) {
            flag2 = false;
            var msgs = messageList.msgs;
            if (msgs.length === 0 ||
                util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, payload.msgs.ctime_ms)) {
                payload.msgs.time_show = 'today';
            }
            msgs.push(payload.msgs);
            state.newMessage = payload.msgs;
            break;
        }
    }
    if (flag1 && payload.select.type === 3) {
        payload.select.conversation_time_show = 'today';
        payload.msgs.time_show = 'today';
        payload.select.recentMsg = payload.msgs;
        initConversation(state, payload.select);
        filterTopConversation(state, payload.select);
        if (flag2) {
            state.messageList.push({
                msgs: [payload.msgs],
                type: 3,
                name: payload.select.name,
                appkey: payload.select.appkey || common_1.authPayload.appkey
            });
        }
        state.newMessage = payload.msgs;
    }
    else if (flag1 && payload.select.type === 4) {
        payload.select.conversation_time_show = 'today';
        payload.msgs.time_show = 'today';
        payload.select.recentMsg = payload.msgs;
        initConversation(state, payload.select);
        filterTopConversation(state, payload.select);
        if (flag2) {
            state.messageList.push({
                key: payload.msgs.key,
                msgs: [payload.msgs],
                type: 4
            });
        }
        state.newMessage = payload.msgs;
    }
    // 更新imageViewer的数组
    if (payload.msgs.content.msg_type === 'image') {
        var isSingleMessage = payload.select.type === 3 && state.activePerson.type === 3 &&
            payload.select.name === state.activePerson.name;
        var isGroupMessage = payload.select.type === 4 && state.activePerson.type === 4 &&
            Number(payload.select.key) === Number(state.activePerson.key);
        if (isSingleMessage || isGroupMessage) {
            state.imageViewer.push({
                src: payload.msgs.content.msg_body.media_url,
                width: payload.msgs.content.msg_body.width,
                height: payload.msgs.content.msg_body.height,
                msgKey: payload.msgs.msgKey
            });
        }
    }
}
// 添加消息到消息面板
function addMessage(state, payload) {
    // 接收到别人的消息添加到消息列表/同步自己发送的消息
    if (payload.messages && payload.messages[0]) {
        var message = payload.messages[0];
        if (message.msg_type === 3) {
            var isMySelf = message.content.from_id !== common_1.global.user;
            message.content.name = isMySelf ? message.content.from_id : message.content.target_id;
            message.content.nickName =
                isMySelf ? message.content.from_name : message.content.target_name;
            message.content.appkey =
                isMySelf ? message.content.from_appkey : message.content.target_appkey;
        }
        else {
            message.content.name = message.content.from_id;
            message.content.nickName = message.content.from_name;
            message.content.appkey = message.content.from_appkey;
        }
        filterFriend(state, message.content);
        filterNewMessage(state, payload, message);
        var flag = false;
        // 如果发送人在会话列表里
        for (var a = 0; a < state.conversation.length; a++) {
            var groupMsg = message.msg_type === 4 && state.conversation[a].type === 4 &&
                Number(state.conversation[a].key) === Number(message.key);
            var singleMsg = message.msg_type === 3 && state.conversation[a].type === 3 &&
                state.conversation[a].name === message.content.name;
            if (groupMsg || singleMsg) {
                if (groupMsg && message.content.target_name === '') {
                    message.content.target_name = state.conversation[a].name;
                }
                var groupNoActive = message.msg_type === 4 &&
                    Number(state.activePerson.key) !== Number(message.key);
                var singleNoActive = message.msg_type === 3 &&
                    state.activePerson.name !== message.content.name;
                if (groupNoActive || singleNoActive) {
                    if (message.content.from_id !== common_1.global.user) {
                        if (!state.conversation[a].unreadNum) {
                            state.conversation[a].unreadNum = 1;
                        }
                        else {
                            state.conversation[a].unreadNum++;
                        }
                    }
                    var atList = messageHasAtList(payload.messages[0].content.at_list);
                    if (atList !== '') {
                        state.conversation[a].atUser = atList;
                    }
                }
                flag = true;
                if (state.conversation[a].key < 0) {
                    var oldKey = Number(state.conversation[a].key);
                    if (oldKey === Number(state.activePerson.key)) {
                        state.activePerson.key = message.key;
                    }
                    state.conversation[a].key = message.key;
                    for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
                        var messageList = _a[_i];
                        if (oldKey === Number(messageList.key)) {
                            messageList.key = message.key;
                            break;
                        }
                    }
                }
                var index = a;
                if (!state.conversation[a].extras || !state.conversation[a].extras.top_time_ms) {
                    var item = state.conversation.splice(a, 1);
                    index = filterTopConversation(state, item[0]);
                }
                state.conversation[index].recentMsg = payload.messages[0];
                payload.messages[0].conversation_time_show = 'today';
                state.newMessageIsDisturb = state.conversation[index].noDisturb ? true : false;
                break;
            }
        }
        for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
            var messageList = _c[_b];
            var groupMsg = message.msg_type === 4 && messageList.type === 4 &&
                Number(messageList.key) === Number(message.key);
            var singleMsg = message.msg_type === 3 && messageList.type === 3 &&
                messageList.name === message.content.name;
            if (groupMsg || singleMsg) {
                var msgs = messageList.msgs;
                if (msgs.length === 0 ||
                    util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, message.ctime_ms)) {
                    payload.messages[0].time_show = 'today';
                }
                msgs.push(payload.messages[0]);
                break;
            }
        }
        // 如果发送人不在会话列表里
        if (!flag) {
            addMessageUserNoConversation(state, payload, message);
        }
        state.newMessage = payload.messages[0];
    }
    else {
        // 自己发消息将消息添加到消息列表
        addMyselfMesssge(state, payload);
        // 清空会话草稿标志
        for (var _d = 0, _e = state.conversation; _d < _e.length; _d++) {
            var conversation = _e[_d];
            var single = payload.active.type === 3 && conversation.type === 3 &&
                payload.active.name === conversation.name;
            var group = payload.active.type === 4 && conversation.type === 4 &&
                Number(payload.active.key) === Number(conversation.key);
            if (single || group) {
                if (payload.msgs.content.msg_type === 'text') {
                    conversation.draft = '';
                }
                break;
            }
        }
    }
}
// 添加自己发的消息到消息面板
function addMyselfMesssge(state, payload) {
    var result = state.conversation.filter((function (item) {
        var single = item.type === 3 && payload.active.type === 3 &&
            item.name === payload.active.name;
        var group = item.type === 4 && payload.active.type === 4 &&
            Number(item.key) === Number(payload.active.key);
        return single || group;
    }));
    if (result.length === 0) {
        payload.active.extras = {};
        payload.msgs.conversation_time_show = 'today';
        payload.active.recentMsg = payload.msgs;
        var flag = true;
        for (var _i = 0, _a = state.messageList; _i < _a.length; _i++) {
            var message = _a[_i];
            var group = payload.active.type === 4 && message.type === 4 &&
                Number(payload.active.key) === Number(message.key);
            var single = payload.active.type === 3 && message.type === 3 &&
                payload.active.name === message.name;
            if (group || single) {
                message.msgs.push(payload.msgs);
                flag = false;
                break;
            }
        }
        if (flag && payload.active.type === 3) {
            state.messageList.push({
                msgs: [payload.msgs],
                type: 3,
                name: payload.active.name,
                appkey: payload.active.appkey || common_1.authPayload.appkey
            });
        }
        else if (flag && payload.active.type === 4) {
            state.messageList.push({
                msgs: [payload.msgs],
                type: 4,
                key: payload.active.key
            });
        }
        filterTopConversation(state, payload.active);
    }
    else {
        // 更新imageViewer的数组
        if (payload.msgs && payload.msgs.content.from_id === common_1.global.user
            && payload.msgs.content.msg_type === 'image') {
            var single = payload.active.type === 3 && state.activePerson.type === 3 &&
                payload.active.name === state.activePerson.name;
            var group = payload.active.type === 4 && state.activePerson.type === 4 &&
                Number(payload.active.key) === Number(state.activePerson.key);
            if (single || group) {
                state.imageViewer.push({
                    src: payload.msgs.content.msg_body.media_url,
                    width: payload.msgs.content.msg_body.width,
                    height: payload.msgs.content.msg_body.height,
                    msgKey: payload.msgs.msgKey
                });
            }
        }
        for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
            var messageList = _c[_b];
            var single = payload.active.type === 3 && messageList.type === 3 &&
                messageList.name === payload.active.name;
            var group = messageList.type === 4 && payload.active.type === 4 &&
                Number(messageList.key) === Number(payload.key);
            if (single || group) {
                var msgs = messageList.msgs;
                if (msgs.length === 0 ||
                    util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, payload.msgs.ctime_ms)) {
                    payload.msgs.time_show = 'today';
                }
                msgs.push(payload.msgs);
                state.newMessage = payload.msgs;
                break;
            }
        }
        // 将当前会话放在第一位
        for (var a = 0; a < state.conversation.length; a++) {
            var group = payload.active.type === 4 && state.conversation[a].type === 4 &&
                Number(state.conversation[a].key) === Number(payload.key);
            var single = payload.active.type === 3 && state.conversation[a].type === 3 &&
                state.conversation[a].name === payload.active.name;
            if (group || single) {
                payload.msgs.conversation_time_show = 'today';
                if (payload.msgs.msg_type === 3) {
                    payload.msgs.unread_count = 1;
                }
                state.conversation[a].recentMsg = payload.msgs;
                if (!state.conversation[a].extras || !state.conversation[a].extras.top_time_ms) {
                    var item = state.conversation.splice(a, 1);
                    filterTopConversation(state, item[0]);
                }
                break;
            }
        }
    }
}
// 处理新消息
function filterNewMessage(state, payload, message) {
    // 更新imageViewer的数组
    var isGroupMessage = message.msg_type === 4 && state.activePerson.type === 4 &&
        Number(message.key) === Number(state.activePerson.key);
    var isSingleMessage = message.msg_type === 3 && state.activePerson.type === 3 &&
        message.content.from_id === state.activePerson.name;
    var isImage = message.content.msg_type === 'image';
    if ((isGroupMessage || isSingleMessage) && isImage) {
        state.imageViewer.push({
            src: message.content.msg_body.media_url,
            width: message.content.msg_body.width,
            height: message.content.msg_body.height,
            msg_id: message.msg_id
        });
    }
    // 接收到语音初始化播放动画
    var isVoice = message.content.msg_type === 'voice';
    if (isVoice) {
        payload.messages[0].content.playing = false;
        payload.messages[0].content.havePlay = false;
        payload.messages[0].content.load = 0;
    }
    // 接收到小视频初始化loading
    var isVideo = message.content.msg_type === 'file' &&
        message.content.msg_body.extras &&
        message.content.msg_body.extras.video;
    if (isVideo) {
        payload.messages[0].content.load = 0;
        payload.messages[0].content.range = 0;
    }
}
// 新消息用户不在会话列表中
function addMessageUserNoConversation(state, payload, message) {
    var msg;
    var conversationItem;
    if (message.msg_type === 3) {
        msg = {
            key: message.key,
            msgs: [
                message
            ],
            draft: '',
            content: message.content,
            type: 3,
            name: message.content.name,
            appkey: message.content.appkey
        };
        conversationItem = {
            avatar: '',
            avatarUrl: message.content.avatarUrl,
            key: message.key,
            mtime: message.ctime_ms,
            name: message.content.name,
            nickName: message.content.nickName,
            type: 3,
            unreadNum: message.content.from_id !== common_1.global.user ? 1 : 0,
            noDisturb: false,
            extras: {}
        };
        for (var _i = 0, _a = state.noDisturb.users; _i < _a.length; _i++) {
            var user = _a[_i];
            if (user.username === message.content.name) {
                conversationItem.noDisturb = true;
                state.newMessageIsDisturb = true;
                break;
            }
        }
    }
    else {
        // 如果新消息没群名，从群列表中获取
        if (!message.content.target_name || message.content.target_name.length === 0) {
            for (var _b = 0, _c = state.groupList; _b < _c.length; _b++) {
                var group = _c[_b];
                if (Number(group.gid) === Number(message.key)) {
                    message.content.target_name = group.name;
                    break;
                }
            }
        }
        msg = {
            key: message.key,
            msgs: [
                message
            ],
            draft: '',
            content: message.content,
            type: 4
        };
        var avatarUrl = void 0;
        for (var _d = 0, _e = state.groupList; _d < _e.length; _d++) {
            var group = _e[_d];
            if (Number(group.gid) === Number(message.key)) {
                avatarUrl = group.avatarUrl;
                break;
            }
        }
        conversationItem = {
            avatar: '',
            avatarUrl: avatarUrl || '',
            key: message.key,
            mtime: message.ctime_ms,
            name: message.content.target_name,
            type: 4,
            unreadNum: message.content.from_id !== common_1.global.user ? 1 : 0,
            noDisturb: false,
            extras: {}
        };
        for (var _f = 0, _g = state.noDisturb.groups; _f < _g.length; _f++) {
            var group = _g[_f];
            if (Number(group.key) === Number(message.key)) {
                conversationItem.noDisturb = true;
                state.newMessageIsDisturb = true;
                break;
            }
        }
    }
    if (!conversationItem.noDisturb) {
        state.newMessageIsDisturb = false;
    }
    payload.messages[0].conversation_time_show = 'today';
    payload.messages[0].time_show = 'today';
    state.newMessage = msg;
    state.messageList.push(msg);
    var index = filterTopConversation(state, conversationItem);
    state.conversation[index].recentMsg = payload.messages[0];
    var atList = messageHasAtList(payload.messages[0].content.at_list);
    if (atList !== '') {
        state.conversation[index].atUser = atList;
    }
}
// 添加会话列表中的@文本
function messageHasAtList(atList) {
    var atUser = '';
    if (atList && atList.length === 0) {
        atUser = '@所有成员';
    }
    else if (atList && atList.length > 0) {
        for (var _i = 0, atList_1 = atList; _i < atList_1.length; _i++) {
            var atItem = atList_1[_i];
            if (atItem.username === common_1.global.user) {
                atUser = '有人@我';
                break;
            }
        }
    }
    return atUser;
}
// 搜索单聊或者好友
function searchSingleUser(state, payload) {
    var singleArr = [];
    // 查找最近联系人
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var item = _a[_i];
        searchSingle(payload.keywords, singleArr, item);
    }
    // 查找好友
    for (var _b = 0, _c = state.friendList; _b < _c.length; _b++) {
        var item = _c[_b];
        searchSingle(payload.keywords, singleArr, item);
    }
    if (payload.result) {
        var item = singleArr.filter((function (single) {
            return single.name === payload.result.name;
        }));
        if (item.length === 0) {
            singleArr.push(payload.result);
        }
    }
    return singleArr;
}
// 搜索用户、群组
function searchUser(state, payload) {
    if (payload === '') {
        return {
            result: {
                groupArr: [],
                singleArr: [],
                roomArr: []
            },
            isSearch: false
        };
    }
    var singleArr = [];
    var groupArr = [];
    // 查找最近联系人
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var item = _a[_i];
        searchSingle(payload, singleArr, item);
    }
    // 查找好友
    for (var _b = 0, _c = state.friendList; _b < _c.length; _b++) {
        var item = _c[_b];
        searchSingle(payload, singleArr, item);
    }
    // 查找群组
    for (var _d = 0, _e = state.groupList; _d < _e.length; _d++) {
        var item = _e[_d];
        var existGroup = (item.name.toLowerCase().indexOf(payload.toLowerCase()) !== -1);
        if (existGroup) {
            groupArr.push(item);
        }
    }
    return {
        result: {
            singleArr: singleArr,
            groupArr: groupArr,
            roomArr: []
        },
        isSearch: true
    };
}
// 搜索单聊用户或好友
function searchSingle(payload, singleArr, item) {
    var existMemoName = item.memo_name &&
        item.memo_name.toLowerCase().indexOf(payload.toLowerCase()) !== -1;
    var existNickName = item.nickName &&
        item.nickName.toLowerCase().indexOf(payload.toLowerCase()) !== -1;
    var existName = item.name &&
        item.name.toLowerCase().indexOf(payload.toLowerCase()) !== -1;
    var existSingle = item.type === 3;
    var isExist = singleArr.filter((function (single) {
        return single.name === item.name;
    }));
    if (isExist.length > 0) {
        return;
    }
    if (existSingle && (existMemoName || existNickName || existName)) {
        singleArr.push(item);
    }
}
// 选择搜索的用户、发起单聊
function selectUserResult(state, payload, type) {
    if (payload.gid) {
        payload.key = payload.gid;
    }
    var conversation = state.conversation;
    var flag = false;
    var index;
    for (var i = 0; i < conversation.length; i++) {
        var group = payload.type === 4 && conversation[i].type === 4 &&
            Number(conversation[i].key) === Number(payload.key);
        var single = payload.type === 3 && conversation[i].type === 3 &&
            conversation[i].name === payload.name;
        if (group || single) {
            index = i;
            payload.key = conversation[i].key;
            if (!conversation[i].extras || !conversation[i].extras.top_time_ms) {
                var item = conversation.splice(i, 1);
                index = filterTopConversation(state, item[0]);
            }
            if (!conversation[index].name) {
                conversation[index].name = payload.name;
                conversation[index].unreadNum = 0;
            }
            flag = true;
            break;
        }
    }
    var result = state.messageList.filter((function (item) {
        var group = item.type === 4 && payload.type === 4 &&
            Number(item.key) === Number(payload.key);
        var single = payload.type === 3 && item.type === 3 && payload.name === item.name;
        return group || single;
    }));
    if (result.length === 0) {
        if (payload.type === 3) {
            state.messageList.push({
                key: payload.key,
                msgs: [],
                type: 3,
                name: payload.name,
                appkey: payload.appkey || common_1.authPayload.appkey
            });
        }
        else if (payload.type === 4) {
            state.messageList.push({
                key: payload.key,
                msgs: [],
                type: 4
            });
        }
    }
    if (!flag) {
        initConversation(state, payload);
        if (result.length > 0 && result[0].msgs.length > 0) {
            payload.recentMsg = result[0].msgs[result[0].msgs.length - 1];
        }
        filterTopConversation(state, payload);
    }
    if (type === 'search' && index) {
        state.activePerson = util_1.Util.deepCopyObj(state.conversation[index]);
    }
    else if (type === 'search') {
        state.activePerson = util_1.Util.deepCopyObj(payload);
    }
}
// 创建会话时初始化会话
function initConversation(state, payload) {
    payload.extras = {};
    if (payload.type === 3) {
        var single = state.noDisturb.users.filter((function (item) {
            return payload.name === item.username;
        }));
        if (single.length !== 0) {
            payload.noDisturb = true;
        }
    }
    else if (payload.type === 4) {
        var group = state.noDisturb.groups.filter((function (item) {
            return Number(payload.key) === Number(item.gid);
        }));
        if (group.length !== 0) {
            payload.noDisturb = true;
        }
        var shield = state.groupShield.filter((function (item) {
            return Number(item.gid) === Number(payload.key);
        }));
        if (shield.length !== 0) {
            payload.shield = true;
        }
    }
}
// 切换当前会话时,清空未读消息数目
function emptyUnreadNum(state, payload) {
    state.readObj = [];
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var item = _a[_i];
        var group = payload.type === 4 && item.type === 4 &&
            Number(item.key) === Number(payload.key);
        var single = payload.type === 3 && item.type === 3 && item.name === payload.name;
        if (group || single) {
            item.atUser = '';
            if (item.unreadNum) {
                item.unreadNum = 0;
            }
            break;
        }
    }
}
// 将会话插入到置顶会话之后
function filterTopConversation(state, item) {
    var flag = true;
    var index;
    for (var i = 0; i < state.conversation.length; i++) {
        if (!state.conversation[i].extras || !state.conversation[i].extras.top_time_ms) {
            state.conversation.splice(i, 0, item);
            index = i;
            flag = false;
            break;
        }
    }
    if (flag) {
        state.conversation.push(item);
        index = state.conversation.length - 1;
    }
    return index;
}
// 添加群成员禁言事件
function addGroupMemberSilenceEvent(state, payload) {
    changeGroupMemberSilence(state, payload, true, '被禁言');
}
// 取消群成员禁言事件
function deleteGroupMemberSilenceEvent(state, payload) {
    changeGroupMemberSilence(state, payload, false, '被解除禁言');
}
// 切换群成员禁言
function changeGroupMemberSilence(state, payload, silence, text) {
    for (var _i = 0, _a = state.groupShield; _i < _a.length; _i++) {
        var shield = _a[_i];
        if (Number(shield.gid) === Number(payload.gid)) {
            return;
        }
    }
    for (var _b = 0, _c = state.messageList; _b < _c.length; _b++) {
        var messageList = _c[_b];
        if (Number(payload.gid) === Number(messageList.key)) {
            if (messageList.groupSetting && messageList.groupSetting.memberList) {
                for (var _d = 0, _e = payload.to_usernames; _d < _e.length; _d++) {
                    var user = _e[_d];
                    for (var _f = 0, _g = messageList.groupSetting.memberList; _f < _g.length; _f++) {
                        var member = _g[_f];
                        if (member.username === user.username) {
                            member.keep_silence = silence;
                            break;
                        }
                    }
                }
            }
            break;
        }
    }
    for (var _h = 0, _j = payload.to_usernames; _h < _j.length; _h++) {
        var user = _j[_h];
        var name_3 = user.nickname || user.username;
        for (var _k = 0, _l = state.friendList; _k < _l.length; _k++) {
            var friend = _l[_k];
            if (friend.name === user.username) {
                if (friend.memo_name) {
                    name_3 = friend.memo_name;
                }
                break;
            }
        }
        var msg = {
            ctime_ms: payload.ctime_ms,
            msg_type: 5,
            content: {
                msg_body: {
                    text: name_3 + " " + text
                },
                msg_type: 'event'
            },
            time_show: '',
            conversation_time_show: util_1.Util.reducerDate(payload.ctime_ms)
        };
        var flag = false;
        for (var i = 0; i < state.conversation.length; i++) {
            if (state.conversation[i].type === 4 &&
                Number(state.conversation[i].key) === Number(payload.gid)) {
                state.conversation[i].recentMsg = msg;
                var item = state.conversation.splice(i, 1)[0];
                filterTopConversation(state, item);
                flag = true;
                for (var _m = 0, _o = state.messageList; _m < _o.length; _m++) {
                    var messageList = _o[_m];
                    if (messageList.type === 4 &&
                        Number(messageList.key) === Number(payload.gid)) {
                        var msgs = messageList.msgs;
                        if (msgs.length > 0) {
                            if (util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, payload.ctime_ms)) {
                                msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                            }
                        }
                        else {
                            msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                        }
                        msgs.push(msg);
                        break;
                    }
                }
                break;
            }
        }
        if (!flag) {
            for (var _p = 0, _q = state.groupList; _p < _q.length; _p++) {
                var group = _q[_p];
                if (Number(group.gid) === Number(payload.gid)) {
                    var conversation = util_1.Util.deepCopyObj(group);
                    for (var _r = 0, _s = state.noDisturb.groups; _r < _s.length; _r++) {
                        var noDisturbGroup = _s[_r];
                        if (Number(noDisturbGroup.gid) === Number(payload.gid)) {
                            conversation.noDisturb = true;
                            break;
                        }
                    }
                    conversation.type = 4;
                    conversation.recentMsg = msg;
                    if (conversation.gid) {
                        conversation.key = conversation.gid;
                    }
                    filterTopConversation(state, conversation);
                    var flag2 = false;
                    for (var _t = 0, _u = state.messageList; _t < _u.length; _t++) {
                        var messageList = _u[_t];
                        if (messageList.type === 4 &&
                            Number(messageList.key) === Number(payload.gid)) {
                            var msgs = messageList.msgs;
                            if (msgs.length > 0) {
                                if (util_1.Util.fiveMinutes(msgs[msgs.length - 1].ctime_ms, payload.ctime_ms)) {
                                    msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                                }
                            }
                            else {
                                msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                            }
                            flag2 = true;
                            msgs.push(msg);
                            break;
                        }
                    }
                    if (!flag2) {
                        msg.time_show = util_1.Util.reducerDate(payload.ctime_ms);
                        state.messageList.push({
                            key: payload.gid,
                            msgs: [
                                msg
                            ],
                            type: 4
                        });
                    }
                    break;
                }
            }
        }
    }
}
// 更新会话的未读总数
function conversationUnreadNum(state) {
    var count = 0;
    for (var _i = 0, _a = state.conversation; _i < _a.length; _i++) {
        var conversation = _a[_i];
        if (!conversation.noDisturb && conversation.unreadNum) {
            count += conversation.unreadNum;
        }
    }
    state.conversationUnreadNum = count;
}
//  给入群邀请的邀请者和被邀请者添加备注名
function filterInvitationEventMeMoName(state, payload) {
    for (var _i = 0, _a = state.friendList; _i < _a.length; _i++) {
        var friend = _a[_i];
        if (payload.from_username === friend.username && payload.from_appkey === friend.appkey) {
            if (friend.memo_name) {
                payload.from_memo_name = friend.memo_name;
            }
            break;
        }
    }
    for (var _b = 0, _c = payload.to_usernames; _b < _c.length; _b++) {
        var user = _c[_b];
        for (var _d = 0, _e = state.friendList; _d < _e.length; _d++) {
            var friend = _e[_d];
            if (user.username === friend.username && user.appkey === friend.appkey) {
                if (friend.memo_name) {
                    user.memo_name = friend.memo_name;
                }
                break;
            }
        }
    }
}


/***/ }),

/***/ 792:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(791), exports);


/***/ }),

/***/ 793:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.contactAction = {
    selectContactItem: '[contact] select contact item',
    getGroupList: '[contact] get group list',
    getGroupListSuccess: '[contact] get group list success',
    init: '[contact] init',
    isAgreeAddFriend: '[contact] is agree add friend',
    agreeAddFriendSuccess: '[contact] agree add friend success',
    refuseAddFriendSuccess: '[contact] refuse add friend success',
    changeTab: '[contact] change tab',
    dispatchContactUnreadNum: '[contact] dispatch contact unread num',
    watchVerifyUser: '[contact] watch verify user',
    watchVerifyUserSuccess: '[contact] watch verify user success',
    addFriendError: '[contact] add friend error',
    isAgreeEnterGroup: '[contact] is ggree enter group',
    isAgreeEnterGroupSuccess: '[contact] is ggree enter group success',
    isAgreeEnterGroupError: '[contact] is ggree enter group error',
    watchGroupInfo: '[contact] watch group info',
    changeVerifyTab: '[contact] change verify tab',
    watchGroupVerifyUser: '[contact] watch group verify user'
};


/***/ }),

/***/ 794:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var rxjs_1 = __webpack_require__(43);
var effects_1 = __webpack_require__(70);
var store_1 = __webpack_require__(32);
var router_1 = __webpack_require__(89);
var actions_1 = __webpack_require__(104);
var actions_2 = __webpack_require__(90);
var common_1 = __webpack_require__(28);
var actions_3 = __webpack_require__(124);
var ContactEffect = /** @class */ (function () {
    function ContactEffect(actions$, store$, router, apiService) {
        var _this = this;
        this.actions$ = actions$;
        this.store$ = store$;
        this.router = router;
        this.apiService = apiService;
        // 获取群组列表
        this.getGroupList$ = this.actions$
            .ofType(actions_3.contactAction.getGroupList)
            .map(effects_1.toPayload)
            .switchMap((function () { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var data, groupList, promises, _i, groupList_1, group, groupObj, pro1, _loop_1, this_1, _a, groupList_2, group;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.apiService.getGroups()];
                    case 1:
                        data = _b.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 4];
                    case 2:
                        groupList = data.group_list;
                        promises = [];
                        // 解决移动端有些群聊没有用户名的问题
                        for (_i = 0, groupList_1 = groupList; _i < groupList_1.length; _i++) {
                            group = groupList_1[_i];
                            if (!group.name || group.name === '') {
                                groupObj = { gid: group.gid };
                                pro1 = this.concatGroupName(groupObj, group);
                                promises.push(pro1);
                            }
                        }
                        return [4 /*yield*/, Promise.all(promises)];
                    case 3:
                        _b.sent();
                        this.store$.dispatch({
                            type: actions_3.contactAction.getGroupListSuccess,
                            payload: groupList
                        });
                        _loop_1 = function (group) {
                            if (group.avatar && group.avatar !== '') {
                                var urlObj = { media_id: group.avatar };
                                var pro2 = this_1.apiService.getResource(urlObj).then((function (urlInfo) {
                                    if (!urlInfo.code) {
                                        group.avatarUrl = urlInfo.url;
                                    }
                                }));
                            }
                        };
                        this_1 = this;
                        for (_a = 0, groupList_2 = groupList; _a < groupList_2.length; _a++) {
                            group = groupList_2[_a];
                            _loop_1(group);
                        }
                        _b.label = 4;
                    case 4: return [2 /*return*/, { type: '[contact] get group list useless' }];
                }
            }));
        })); }));
        // 同意或拒绝好友请求
        this.isAgreeAddFriend$ = this.actions$
            .ofType(actions_3.contactAction.isAgreeAddFriend)
            .map(effects_1.toPayload)
            .switchMap((function (message) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var friendObj, data, friendObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(message.stateType === 1)) return [3 /*break*/, 2];
                        friendObj = {
                            target_name: message.name,
                            appkey: message.appkey,
                        };
                        return [4 /*yield*/, this.apiService.declineFriend(friendObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            message.stateType = 0;
                            this.store$.dispatch({
                                type: actions_3.contactAction.addFriendError,
                                payload: message
                            });
                            this.errorFn(data);
                        }
                        else {
                            message.stateType = 3;
                            this.store$.dispatch({
                                type: actions_3.contactAction.refuseAddFriendSuccess,
                                payload: message
                            });
                        }
                        return [3 /*break*/, 4];
                    case 2:
                        if (!(message.stateType === 2)) return [3 /*break*/, 4];
                        friendObj = {
                            target_name: message.name,
                            appkey: message.appkey
                        };
                        return [4 /*yield*/, this.apiService.acceptFriend(friendObj)];
                    case 3:
                        data = _a.sent();
                        if (data.code) {
                            message.stateType = 0;
                            this.store$.dispatch({
                                type: actions_3.contactAction.addFriendError,
                                payload: message
                            });
                            this.errorFn(data);
                        }
                        else {
                            message.stateType = 4;
                            this.store$.dispatch({
                                type: actions_3.contactAction.agreeAddFriendSuccess,
                                payload: message
                            });
                        }
                        _a.label = 4;
                    case 4: return [2 /*return*/, { type: '[contact] is agree add friend useless' }];
                }
            }));
        })); }));
        // 同意或拒绝入群请求
        this.isAgreeEnterGroup$ = this.actions$
            .ofType(actions_3.contactAction.isAgreeEnterGroup)
            .map(effects_1.toPayload)
            .switchMap((function (verifyGroup) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var memeberObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        memeberObj = {
                            gid: verifyGroup.from_gid,
                            event_id: verifyGroup.event_id,
                            target_appkey: verifyGroup.to_usernames[0].appkey,
                            target_username: verifyGroup.to_usernames[0].username,
                            result: verifyGroup.stateType === 1 ? 1 : 0,
                            from_appkey: verifyGroup.from_appkey,
                            from_username: verifyGroup.from_username
                        };
                        return [4 /*yield*/, this.apiService.addGroupMemberResp(memeberObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            verifyGroup.stateType = 0;
                            this.store$.dispatch({
                                type: actions_3.contactAction.isAgreeEnterGroupError,
                                payload: verifyGroup
                            });
                        }
                        else {
                            verifyGroup.stateType = verifyGroup.stateType === 1 ? 3 : 4;
                            this.store$.dispatch({
                                type: actions_3.contactAction.isAgreeEnterGroupSuccess,
                                payload: verifyGroup
                            });
                        }
                        return [2 /*return*/, { type: '[contact] is agree enter group useless' }];
                }
            }));
        })); }));
        // 好友验证消息查看用户资料
        this.watchVerifyUser$ = this.actions$
            .ofType(actions_3.contactAction.watchVerifyUser)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var usrObj, data, infoType, user, item, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        usrObj = { username: info.name };
                        return [4 /*yield*/, this.apiService.getUserInfo(usrObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 5];
                    case 2:
                        infoType = '';
                        if (info.stateType === 4 || info.stateType === 5) {
                            infoType = 'watchOtherInfo';
                        }
                        else {
                            infoType = 'verifyFriend';
                        }
                        user = data.user_info;
                        item = {
                            avatar: user.avatar,
                            mtime: user.mtime,
                            name: user.username,
                            nickName: user.nickname,
                            username: user.username,
                            nickname: user.nickname,
                            type: 3,
                            signature: user.signature,
                            gender: user.gender,
                            region: user.region,
                            avatarUrl: '',
                            infoType: infoType,
                            eventId: info.eventId,
                            stateType: info.stateType
                        };
                        if (!(item.avatar !== '')) return [3 /*break*/, 4];
                        urlObj = { media_id: user.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        urlInfo = _a.sent();
                        if (!urlInfo.code) {
                            item.avatarUrl = urlInfo.url;
                        }
                        _a.label = 4;
                    case 4:
                        this.store$.dispatch({
                            type: actions_3.contactAction.watchVerifyUserSuccess,
                            payload: item
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[contact] watch verify user useless' }];
                }
            }));
        })); }));
        // 群组验证消息查看用户资料
        this.watchGroupVerifyUser$ = this.actions$
            .ofType(actions_3.contactAction.watchGroupVerifyUser)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data, user, item, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = { username: info.name };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 5];
                    case 2:
                        user = data.user_info;
                        item = {
                            avatar: user.avatar,
                            mtime: user.mtime,
                            name: user.username,
                            nickName: user.nickname,
                            username: user.username,
                            nickname: user.nickname,
                            type: 3,
                            signature: user.signature,
                            gender: user.gender,
                            region: user.region,
                            avatarUrl: info.avatarUrl ? info.avatarUrl : '',
                            infoType: info.infoType
                        };
                        if (!(item.avatar !== '' && !info.avatarUrl)) return [3 /*break*/, 4];
                        urlObj = { media_id: user.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        urlInfo = _a.sent();
                        if (!urlInfo.code) {
                            item.avatarUrl = urlInfo.url;
                        }
                        _a.label = 4;
                    case 4:
                        this.store$.dispatch({
                            type: actions_3.contactAction.watchVerifyUserSuccess,
                            payload: item
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[contact] watch group verify user useless' }];
                }
            }));
        })); }));
        // 查看群资料
        this.watchGroupInfo$ = this.actions$
            .ofType(actions_3.contactAction.watchGroupInfo)
            .map(effects_1.toPayload)
            .switchMap((function (verifyGroup) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var groupInfo, groupObj, pro1, pro2;
            var _this = this;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        groupInfo = {
                            gid: verifyGroup.from_gid,
                            name: verifyGroup.group_name,
                            avatarUrl: verifyGroup.avatarUrl,
                            avatar: verifyGroup.avatar
                        };
                        groupObj = {
                            gid: verifyGroup.from_gid
                        };
                        pro1 = this.apiService.getGroupInfo(groupObj).then((function (result) {
                            if (result.code) {
                                groupInfo.desc = '';
                                _this.errorFn(result);
                            }
                            else {
                                groupInfo.desc = result.group_info.desc || '';
                            }
                        }));
                        pro2 = this.apiService.getGroupMembers(groupObj).then((function (result) {
                            if (result.code) {
                                _this.errorFn(result);
                            }
                            else {
                                groupInfo.member_list_count = result.member_list.length;
                                for (var _i = 0, _a = result.member_list; _i < _a.length; _i++) {
                                    var member = _a[_i];
                                    if (member.flag === 1) {
                                        groupInfo.host = member;
                                    }
                                    if (member.username === common_1.global.user) {
                                        groupInfo.isMember = true;
                                    }
                                }
                            }
                        }));
                        return [4 /*yield*/, Promise.all([pro1, pro2])];
                    case 1:
                        _a.sent();
                        this.store$.dispatch({
                            type: actions_2.mainAction.searchPublicGroupSuccess,
                            payload: {
                                show: true,
                                info: groupInfo
                            }
                        });
                        return [2 /*return*/, { type: '[contact] watch group info useless' }];
                }
            }));
        })); }));
    }
    ContactEffect.prototype.errorFn = function (error) {
        this.store$.dispatch({
            type: actions_1.appAction.errorApiTip,
            payload: error
        });
    };
    // 拼接群名
    ContactEffect.prototype.concatGroupName = function (groupObj, group) {
        return this.apiService.getGroupMembers(groupObj).then((function (result) {
            if (result.code) {
                group.name = '#群名获取失败？？';
            }
            else {
                var memberList = result.member_list;
                var name_1 = '';
                for (var j = 0; j < memberList.length && j < 5; j++) {
                    name_1 = name_1 + (memberList[j].nickName || memberList[j].username);
                    var length_1 = memberList.length < 5 ? memberList.length : 5;
                    if (j < length_1 - 1) {
                        name_1 += '、';
                    }
                }
                group.name = name_1.substr(0, 20);
            }
        }));
    };
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ContactEffect.prototype, "getGroupList$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ContactEffect.prototype, "isAgreeAddFriend$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ContactEffect.prototype, "isAgreeEnterGroup$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ContactEffect.prototype, "watchVerifyUser$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ContactEffect.prototype, "watchGroupVerifyUser$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], ContactEffect.prototype, "watchGroupInfo$", void 0);
    ContactEffect = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [effects_1.Actions,
            store_1.Store,
            router_1.Router,
            common_1.ApiService])
    ], ContactEffect);
    return ContactEffect;
}());
exports.ContactEffect = ContactEffect;


/***/ }),

/***/ 795:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(794), exports);


/***/ }),

/***/ 796:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.contactInit = {
    actionType: '',
    groupList: [],
    friendList: [],
    verifyMessageList: [],
    verifyUnreadNum: 0,
    contactUnreadNum: 0,
    tab: 1,
    listTab: 0,
    verifyTab: 0,
    verifyGroupList: [],
    groupVerifyUnreadNum: 0,
    singleVerifyUnreadNum: 0,
    groupLoading: false,
    friendLoading: false
};


/***/ }),

/***/ 797:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(796), exports);


/***/ }),

/***/ 798:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(124);
var model_1 = __webpack_require__(797);
var actions_2 = __webpack_require__(90);
var actions_3 = __webpack_require__(107);
var util_1 = __webpack_require__(72);
var common_1 = __webpack_require__(28);
exports.contactReducer = function (state, _a) {
    if (state === void 0) { state = model_1.contactInit; }
    var type = _a.type, payload = _a.payload;
    state.actionType = type;
    switch (type) {
        // 初始化state
        case actions_1.contactAction.init:
            state = util_1.Util.deepCopyObj(model_1.contactInit);
            break;
        // 获取好友列表
        case actions_3.chatAction.getFriendList:
            if (payload === 'first') {
                state.groupLoading = true;
            }
            break;
        // 传递群列表
        case actions_3.chatAction.dispatchGroupList:
            state.groupList = util_1.Util.sortByLetter(payload);
            state.groupLoading = false;
            break;
        // 切换联系人或者会话的tab
        case actions_2.mainAction.changeListTab:
            state.listTab = payload;
            changeListTab(state, payload);
            break;
        // 切换联系人中的tab
        case actions_1.contactAction.changeTab:
            state.tab = payload;
            if (payload === 0) {
                updateUnreadNum(state);
            }
            break;
        // 添加好友邀请事件
        case actions_3.chatAction.friendInvitationEventSuccess:
            friendVerify(state, payload);
            break;
        // 自己拒绝添加好友
        case actions_1.contactAction.refuseAddFriendSuccess:
            isAgreeAddFriend(state, payload);
            break;
        // 自己同意添加好友
        case actions_1.contactAction.agreeAddFriendSuccess:
            isAgreeAddFriend(state, payload);
            break;
        // 自己同意添加好友失败
        case actions_1.contactAction.addFriendError:
            isAgreeAddFriend(state, payload);
            break;
        // 获取群组列表
        case actions_1.contactAction.getGroupList:
            if (payload === 'first') {
                state.friendLoading = true;
            }
            break;
        // 传递好友列表的数据
        case actions_3.chatAction.dispatchFriendList:
            state.friendList = util_1.Util.sortByLetter(payload);
            state.friendLoading = false;
            break;
        // 添加好友的应答事件
        case actions_3.chatAction.friendReplyEventSuccess:
            friendReply(state, payload);
            break;
        // 发送给好友验证信息
        case actions_3.chatAction.addFriendConfirm:
            waitReply(state, payload);
            break;
        // 添加好友同步事件
        case actions_3.chatAction.addFriendSyncEvent:
            addFriendSyncEvent(state, payload);
            break;
        // 传递收到进入邀请的事件
        case actions_3.chatAction.dispatchReceiveGroupInvitationEvent:
            filterVerifyGroupList(state, payload);
            break;
        // 同意或者拒绝入群成功
        case actions_1.contactAction.isAgreeEnterGroupSuccess:
            updateVerifyGroupList(state, payload);
            break;
        // 同意或者拒绝入群失败
        case actions_1.contactAction.isAgreeEnterGroupError:
            updateVerifyGroupList(state, payload);
            break;
        // 传递被拒绝入群的事件
        case actions_3.chatAction.dispatchReceiveGroupRefuseEvent:
            filterReceiveGroupRefuse(state, payload);
            break;
        // 切换验证信息的tab
        case actions_1.contactAction.changeVerifyTab:
            state.verifyTab = payload;
            updateUnreadNum(state);
            break;
        default:
    }
    return state;
};
// 切换左侧tab
function changeListTab(state, payload) {
    if (payload === 1) {
        if (state.tab === 0) {
            if (state.verifyTab === 0) {
                state.singleVerifyUnreadNum = 0;
            }
            else if (state.verifyTab === 1) {
                state.groupVerifyUnreadNum = 0;
            }
            state.verifyUnreadNum = state.groupVerifyUnreadNum + state.singleVerifyUnreadNum;
            state.contactUnreadNum = state.verifyUnreadNum;
        }
    }
}
// 更新验证信息未读数
function updateUnreadNum(state) {
    if (state.verifyTab === 0) {
        state.singleVerifyUnreadNum = 0;
        state.verifyUnreadNum = state.groupVerifyUnreadNum;
        state.contactUnreadNum = state.verifyUnreadNum;
        changeFriendFirstOne(state);
    }
    else if (state.verifyTab === 1) {
        state.groupVerifyUnreadNum = 0;
        state.verifyUnreadNum = state.singleVerifyUnreadNum;
        state.contactUnreadNum = state.verifyUnreadNum;
        changeGroupFirstOne(state);
    }
}
// 多端在线同意好友请求事件
function addFriendSyncEvent(state, payload) {
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var user = _a[_i];
        for (var _b = 0, _c = state.verifyMessageList; _b < _c.length; _b++) {
            var verifyMessage = _c[_b];
            if (verifyMessage.stateType === 0 && verifyMessage.name === user.username) {
                verifyMessage.stateType = 4;
                break;
            }
        }
    }
}
// 等待好友验证
function waitReply(state, payload) {
    var verifyMessage = {
        name: payload.name,
        nickName: payload.nickName,
        avatarUrl: payload.avatarUrl,
        stateType: 6,
        type: 3,
        ctime_ms: new Date().getTime()
    };
    /**
     * 对方同意  对方拒绝  已同意  已拒绝
     * 这些验证消息在消息列表中是永远不会被覆盖的
     */
    for (var i = 0; i < state.verifyMessageList.length; i++) {
        var stateType = state.verifyMessageList[i].stateType;
        var canBeCover = stateType !== 3 && stateType !== 4 && stateType !== 5 && stateType !== 7;
        if (payload.name === state.verifyMessageList[i].name && canBeCover) {
            state.verifyMessageList.splice(i, 1);
            break;
        }
    }
    state.verifyMessageList.unshift(verifyMessage);
}
// 好友应答
function friendReply(state, payload) {
    payload.name = payload.from_username;
    var verifyMessage = {
        name: payload.from_username,
        nickName: payload.from_nickname,
        description: payload.description,
        avatarUrl: payload.avatarUrl,
        extra: payload.extra,
        eventId: payload.event_id,
        stateType: 0,
        type: 3,
        ctime_ms: payload.ctime_ms
    };
    if (payload.return_code === 0) {
        verifyMessage.stateType = 5;
    }
    else {
        verifyMessage.stateType = 7;
    }
    for (var i = 0; i < state.verifyMessageList.length; i++) {
        var stateType = state.verifyMessageList[i].stateType;
        var canBeCover = stateType !== 3 && stateType !== 4 && stateType !== 5 && stateType !== 7;
        if (state.verifyMessageList[i].name === payload.from_username && canBeCover) {
            state.verifyMessageList.splice(i, 1);
            break;
        }
    }
    if (state.tab !== 0 || state.listTab !== 1 ||
        (state.tab === 0 && state.verifyTab !== 0)) {
        state.singleVerifyUnreadNum++;
        state.verifyUnreadNum = state.groupVerifyUnreadNum + state.singleVerifyUnreadNum;
        state.contactUnreadNum = state.verifyUnreadNum;
    }
    state.verifyMessageList.unshift(verifyMessage);
}
// 标识好友验证消息已读
function changeFriendFirstOne(state) {
    for (var _i = 0, _a = state.verifyMessageList; _i < _a.length; _i++) {
        var verifyMessage = _a[_i];
        verifyMessage.isFriendFirstOne = false;
    }
}
// 标识群组验证信息已读
function changeGroupFirstOne(state) {
    for (var _i = 0, _a = state.verifyGroupList; _i < _a.length; _i++) {
        var verifyMessage = _a[_i];
        verifyMessage.isGroupFirstOne = false;
    }
}
// 同意或者拒绝好友请求
function isAgreeAddFriend(state, payload) {
    for (var _i = 0, _a = state.verifyMessageList; _i < _a.length; _i++) {
        var verifyMessage = _a[_i];
        if (verifyMessage.eventId === payload.eventId) {
            verifyMessage.stateType = payload.stateType;
            break;
        }
    }
}
// 邀请加好友
function friendVerify(state, payload) {
    var verifyMessage = {
        name: payload.from_username,
        nickName: payload.from_nickname,
        description: payload.description,
        avatarUrl: payload.avatarUrl,
        extra: payload.extra,
        eventId: payload.event_id,
        stateType: 0,
        type: 3,
        ctime_ms: payload.ctime_ms,
        isFriendFirstOne: false
    };
    /**
     * verifyUnreadNum 用来标识验证信息的的未读数量
     * contactUnreadNum 用来标识联系人的未读数量
     * isFriendFirstOne 用来标识是否是同一用户的好友邀请的第一条消息（在未读状态），因为未读状态的第一条会显示数量，此后就不再增加未读数量
     */
    var flag = false;
    for (var i = 0; i < state.verifyMessageList.length; i++) {
        var message = state.verifyMessageList[i];
        var stateType = message.stateType;
        var canBeCover = stateType !== 3 && stateType !== 4 && stateType !== 5 && stateType !== 7;
        if (message.name === verifyMessage.name && canBeCover) {
            if (message.stateType === 0) {
                if (message.isFriendFirstOne) {
                    flag = true;
                }
            }
            state.verifyMessageList.splice(i, 1);
            break;
        }
    }
    if ((state.tab !== 0 || state.listTab !== 1 ||
        (state.tab === 0 && state.verifyTab !== 0))) {
        if (!flag) {
            state.singleVerifyUnreadNum++;
            state.verifyUnreadNum = state.groupVerifyUnreadNum + state.singleVerifyUnreadNum;
            state.contactUnreadNum = state.verifyUnreadNum;
        }
        verifyMessage.isFriendFirstOne = true;
    }
    state.verifyMessageList.unshift(verifyMessage);
}
// 收到群组验证信息
function filterVerifyGroupList(state, payload) {
    payload.stateType = 0;
    payload.isGroupFirstOne = false;
    for (var _i = 0, _a = payload.to_usernames; _i < _a.length; _i++) {
        var user = _a[_i];
        var newPayload = util_1.Util.deepCopyObj(payload);
        newPayload.to_usernames = [user];
        var flag = false;
        for (var i = 0; i < state.verifyGroupList.length; i++) {
            var verifyGroupList = state.verifyGroupList[i];
            if ((verifyGroupList.stateType === 0 || verifyGroupList.stateType === 1 ||
                verifyGroupList.stateType === 2) && verifyGroupList.from_gid === payload.from_gid &&
                verifyGroupList.to_usernames[0].username === user.username) {
                if (verifyGroupList.isGroupFirstOne) {
                    flag = true;
                }
                state.verifyGroupList.splice(i, 1);
                break;
            }
        }
        if (state.tab !== 0 || state.listTab !== 1 ||
            (state.tab === 0 && state.verifyTab !== 1)) {
            if (!flag) {
                state.groupVerifyUnreadNum++;
                state.verifyUnreadNum = state.groupVerifyUnreadNum + state.singleVerifyUnreadNum;
                state.contactUnreadNum = state.verifyUnreadNum;
            }
            newPayload.isGroupFirstOne = true;
        }
        state.verifyGroupList.unshift(newPayload);
    }
}
// 更新群组验证信息
function updateVerifyGroupList(state, payload) {
    for (var _i = 0, _a = state.verifyGroupList; _i < _a.length; _i++) {
        var verifyGroup = _a[_i];
        if (verifyGroup.event_id === payload.event_id &&
            verifyGroup.to_usernames[0].username === payload.to_usernames[0].username) {
            verifyGroup.stateType = payload.stateType;
            break;
        }
    }
}
// 收到入群被拒绝的事件
function filterReceiveGroupRefuse(state, payload) {
    if (payload.to_usernames[0].username === common_1.global.user) {
        payload.stateType = 5;
    }
    else {
        payload.stateType = 6;
    }
    if (state.tab !== 0 || state.listTab !== 1 ||
        (state.tab === 0 && state.verifyTab !== 1)) {
        state.groupVerifyUnreadNum++;
        state.verifyUnreadNum = state.groupVerifyUnreadNum + state.singleVerifyUnreadNum;
        state.contactUnreadNum = state.verifyUnreadNum;
    }
    state.verifyGroupList.unshift(payload);
}


/***/ }),

/***/ 799:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(798), exports);


/***/ }),

/***/ 800:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.loginAction = {
    login: '[login] login',
    loginSuccess: '[login] login success',
    loginFailed: '[login] login failed',
    passwordBlur: '[login] password blur',
    isButtonAvailableAction: '[login] is button available action',
    emptyTip: '[login] empty tip'
};


/***/ }),

/***/ 801:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(802), exports);


/***/ }),

/***/ 802:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var rxjs_1 = __webpack_require__(43);
var effects_1 = __webpack_require__(70);
var store_1 = __webpack_require__(32);
var actions_1 = __webpack_require__(317);
var common_1 = __webpack_require__(28);
var LoginEffect = /** @class */ (function () {
    function LoginEffect(actions$, store$, apiService) {
        var _this = this;
        this.actions$ = actions$;
        this.store$ = store$;
        this.apiService = apiService;
        // 登录
        this.login$ = this.actions$
            .ofType(actions_1.loginAction.login)
            .map(effects_1.toPayload)
            .switchMap((function (val) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var loginObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        loginObj = {
                            username: val.username,
                            password: val.password,
                            is_md5: val.md5
                        };
                        return [4 /*yield*/, this.apiService.login(loginObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.store$.dispatch({
                                type: actions_1.loginAction.loginFailed,
                                payload: data
                            });
                        }
                        else {
                            common_1.global.user = data.username;
                            this.store$.dispatch({
                                type: actions_1.loginAction.loginSuccess,
                                payload: val
                            });
                        }
                        return [2 /*return*/, { type: '[login] login useless' }];
                }
            }));
        })); }));
    }
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], LoginEffect.prototype, "login$", void 0);
    LoginEffect = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [effects_1.Actions,
            store_1.Store,
            common_1.ApiService])
    ], LoginEffect);
    return LoginEffect;
}());
exports.LoginEffect = LoginEffect;


/***/ }),

/***/ 803:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(804), exports);


/***/ }),

/***/ 804:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(317);
var loginInit = {
    isLoginSuccess: false,
    loginTip: '',
    isButtonAvailable: false,
    actionType: 'init',
    userInfo: {
        username: '',
        password: ''
    },
    loginRemember: false
};
exports.loginReducer = function (state, _a) {
    if (state === void 0) { state = loginInit; }
    var type = _a.type, payload = _a.payload;
    if (type) {
        state.actionType = type;
    }
    switch (type) {
        case actions_1.loginAction.loginSuccess:
            state.isLoginSuccess = true;
            state.loginTip = '';
            state.userInfo.username = payload.username;
            state.userInfo.password = payload.password;
            state.loginRemember = payload.loginRemember;
            break;
        case actions_1.loginAction.loginFailed:
            state.isLoginSuccess = false;
            if (Number(payload.code) === 880106) {
                state.loginTip = '账号已被禁用';
            }
            else {
                state.loginTip = '用户名或密码错误';
            }
            break;
        case actions_1.loginAction.isButtonAvailableAction:
            isButtonAvailable(state, payload);
            break;
        case actions_1.loginAction.emptyTip:
            state.loginTip = '';
            break;
        default:
    }
    return state;
};
// 判断按钮是否可以点击的状态
function isButtonAvailable(state, payload) {
    if (payload.password.length > 0 && payload.username.length > 0) {
        state.isButtonAvailable = true;
    }
    else {
        state.isButtonAvailable = false;
    }
}


/***/ }),

/***/ 805:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.mainAction = {
    jimInit: '[main] jim init',
    jimInitSuccess: '[main] jim init success',
    getSelfInfo: '[main] get self info',
    showSelfInfo: '[main] show self info',
    updateSelfInfo: '[main] update self info',
    updateSelfInfoFlag: '[main] update self info flag',
    changeListTab: '[main] change list tab',
    logoutAction: '[main] logout action',
    createGroupShow: '[main] create group show',
    createGroup: '[main] create group',
    addGroupMember: '[main] add group member',
    addGroupMemberSuccess: '[main] add group member success',
    createGroupSuccess: '[main] create group success',
    modifyPasswordShow: '[main] modify password show',
    modifyPassword: '[main] modify password',
    searchUser: '[main] search user',
    searchUserSuccess: '[main] search user success',
    selectSearchUser: '[main] select search user',
    selectSearchRoomUser: '[main] select search room user',
    hideModalTip: '[main] hide modal tip',
    showModalTip: '[main] show modal tip',
    addBlackListAction: '[main] add black list action',
    addBlackListSuccess: '[main] add black list success',
    createSingleChatShow: '[main] create single chat show',
    createSingleChatAction: '[main] create single chat action',
    createSingleChatSuccess: '[main] create single chat success',
    emptySingleChatTip: '[main] empty single chat tip',
    blackMenu: '[main] black menu',
    blackMenuSuccess: '[main] black menu success',
    delSingleBlack: '[main] delete single black',
    delSingleBlackSuccess: '[main] delete single black success',
    delSingleBlackError: '[main] delete single black error',
    hideBlackMenu: '[main] hide black menu',
    selectGroupItem: '[main] select group item',
    exitGroupAction: '[main] exit group action',
    exitGroupSuccess: '[main] exit group success',
    deleteMemberAction: '[main] delete member action',
    deleteMemberSuccess: '[main] delete member success',
    createGroupSearchAction: '[main] create group search action',
    login: '[main] login',
    logoutKickShow: '[main] logout kick show',
    init: '[main] init',
    addSingleNoDisturbAction: '[main] add single no disturb action',
    addSingleNoDisturbSuccess: '[main] add single no disturb success',
    deleteFriend: '[main] delete friend',
    deleteFriendSuccess: '[main] delete friend success',
    dispatchSendSelfCard: '[main] dispatch send self card',
    enterPublicGroupShow: '[main] enter public group show',
    searchPublicGroup: '[main] search public group',
    searchPublicGroupSuccess: '[main] search public group success',
    groupVerifyModal: '[main] group verify modal',
    sendGroupVerifyMessage: '[main] send group verify message',
    createGroupNextShow: '[main] create group next show',
    // 确认提示模态框action
    logoutShowConfirmModal: '[main] logout show confirm modal',
    addBlackListConfirmModal: '[main] add black list confirm modal',
    exitGroupConfirmModal: '[main] exit group confirm modal',
    deleteMemberConfirmModal: '[main] delete member',
    addSingleNoDisturbConfirmModal: '[main] add single no disturb confirm modal',
    deleteFriendConfirmModal: '[main] delete friend modal'
};


/***/ }),

/***/ 806:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(807), exports);


/***/ }),

/***/ 807:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var rxjs_1 = __webpack_require__(43);
var effects_1 = __webpack_require__(70);
var store_1 = __webpack_require__(32);
var router_1 = __webpack_require__(89);
var actions_1 = __webpack_require__(90);
var actions_2 = __webpack_require__(107);
var common_1 = __webpack_require__(28);
var tools_1 = __webpack_require__(160);
var util_1 = __webpack_require__(72);
var actions_3 = __webpack_require__(104);
var MainEffect = /** @class */ (function () {
    function MainEffect(actions$, store$, router, apiService, signatureService) {
        var _this = this;
        this.actions$ = actions$;
        this.store$ = store$;
        this.router = router;
        this.apiService = apiService;
        this.signatureService = signatureService;
        // JIM初始化
        this.jimInit$ = this.actions$
            .ofType(actions_1.mainAction.jimInit)
            .map(effects_1.toPayload)
            .switchMap((function () { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var timestamp, signature, data_1, initObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        timestamp = new Date().getTime();
                        if (!common_1.authPayload.isFrontSignature) return [3 /*break*/, 1];
                        // 使用jchat demo自身的签名
                        if (common_1.authPayload.masterSecret.length === 0) {
                            signature = common_1.demoInitConfig.signature;
                            timestamp = common_1.demoInitConfig.timestamp;
                            // 开发者配置前端生成签名
                        }
                        else {
                            signature = util_1.Util.createSignature(timestamp);
                        }
                        return [3 /*break*/, 3];
                    case 1:
                        data_1 = {
                            timestamp: timestamp,
                            appkey: common_1.authPayload.appkey,
                            randomStr: common_1.authPayload.randomStr
                        };
                        return [4 /*yield*/, this.signatureService.requestSignature(common_1.authPayload.signatureApiUrl, data_1)];
                    case 2:
                        signature = _a.sent();
                        _a.label = 3;
                    case 3:
                        initObj = {
                            appkey: common_1.authPayload.appkey,
                            random_str: common_1.authPayload.randomStr,
                            signature: signature,
                            timestamp: timestamp,
                            flag: common_1.authPayload.flag
                        };
                        return [4 /*yield*/, this.apiService.init(initObj)];
                    case 4:
                        data = _a.sent();
                        if (data.code) {
                            this.store$.dispatch({
                                type: actions_3.appAction.errorApiTip,
                                payload: data
                            });
                            return [2 /*return*/, { type: '[main] jim init useless' }];
                        }
                        else {
                            return [2 /*return*/, { type: actions_1.mainAction.jimInitSuccess }];
                        }
                        return [2 /*return*/];
                }
            }));
        })); }));
        // 获取个人信息
        this.getSelfInfo$ = this.actions$
            .ofType(actions_1.mainAction.getSelfInfo)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userInfoObj, userInfo, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userInfoObj = {
                            username: common_1.global.user
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userInfoObj)];
                    case 1:
                        userInfo = _a.sent();
                        if (!userInfo.code) return [3 /*break*/, 2];
                        this.errorFn(userInfo);
                        return [3 /*break*/, 5];
                    case 2:
                        if (!(!userInfo.user_info.avatar || userInfo.user_info.avatar === '')) return [3 /*break*/, 3];
                        userInfo.user_info.avatarUrl = '';
                        this.store$.dispatch({
                            type: actions_1.mainAction.showSelfInfo,
                            payload: {
                                info: userInfo.user_info,
                                show: false,
                                loading: false
                            }
                        });
                        return [3 /*break*/, 5];
                    case 3:
                        urlObj = {
                            media_id: userInfo.user_info.avatar
                        };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 4:
                        urlInfo = _a.sent();
                        if (urlInfo.code) {
                            userInfo.user_info.avatarUrl = '';
                        }
                        else {
                            userInfo.user_info.avatarUrl = urlInfo.url;
                        }
                        this.store$.dispatch({
                            type: actions_1.mainAction.showSelfInfo,
                            payload: {
                                info: userInfo.user_info,
                                show: false,
                                loading: false
                            }
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[main] get selfInfo useless' }];
                }
            }));
        })); }));
        // 退出登录
        this.logoutAction$ = this.actions$
            .ofType(actions_1.mainAction.logoutAction)
            .map(effects_1.toPayload)
            .switchMap((function () { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.loginOut()];
                    case 1:
                        _a.sent();
                        this.router.navigate(['/login']);
                        return [2 /*return*/, { type: '[main] login out useless' }];
                }
            }));
        })); }));
        // 更新个人信息
        this.updateSelfInfo$ = this.actions$
            .ofType(actions_1.mainAction.updateSelfInfo)
            .map(effects_1.toPayload)
            .switchMap((function (self) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.updateSelfInfo(self.info)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                            if (self.avatar && self.avatar.url) {
                                this.updateSelfAvatar(self);
                            }
                            else {
                                this.store$.dispatch({
                                    type: actions_1.mainAction.showSelfInfo,
                                    payload: {
                                        loading: false
                                    }
                                });
                            }
                        }
                        else {
                            if (self.avatar && self.avatar.url) {
                                this.updateSelfAvatar(self);
                            }
                            else {
                                this.store$.dispatch({
                                    type: actions_1.mainAction.showSelfInfo,
                                    payload: {
                                        info: self.info,
                                        loading: false
                                    }
                                });
                                this.store$.dispatch({
                                    type: actions_1.mainAction.updateSelfInfoFlag
                                });
                            }
                        }
                        return [2 /*return*/, { type: '[main] update self info useless' }];
                }
            }));
        })); }));
        // 创建群聊
        this.createGroup$ = this.actions$
            .ofType(actions_1.mainAction.createGroup)
            .map(effects_1.toPayload)
            .switchMap((function (groupInfo) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var param, data, groupObj, memberObj, member;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        param = {
                            group_name: groupInfo.groupName
                        };
                        if (groupInfo.isLimit) {
                            param.is_limit = groupInfo.isLimit;
                        }
                        if (groupInfo.avatar) {
                            param.avatar = groupInfo.avatar;
                        }
                        return [4 /*yield*/, this.apiService.createGroup(param)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 5];
                    case 2:
                        this.store$.dispatch({
                            type: actions_1.mainAction.createGroupNextShow,
                            payload: {
                                show: false,
                                display: false,
                                info: {}
                            }
                        });
                        this.store$.dispatch({
                            type: actions_1.mainAction.createGroupShow,
                            payload: {
                                show: false,
                                display: false,
                                info: {}
                            }
                        });
                        groupObj = {
                            appkey: common_1.authPayload.appkey,
                            desc: data.group_description,
                            gid: data.gid,
                            mtime: data.ctime,
                            name: data.group_name,
                            type: 4,
                            avatarUrl: groupInfo.avatarUrl ? groupInfo.avatarUrl : ''
                        };
                        if (!(groupInfo.memberUsernames.length > 0)) return [3 /*break*/, 4];
                        memberObj = {
                            gid: data.gid,
                            member_usernames: groupInfo.memberUsernames
                        };
                        return [4 /*yield*/, this.apiService.addGroupMembers(memberObj)];
                    case 3:
                        member = _a.sent();
                        if (member.code) {
                            this.errorFn(member);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.createGroupSuccess,
                                payload: groupObj
                            });
                        }
                        return [3 /*break*/, 5];
                    case 4:
                        this.store$.dispatch({
                            type: actions_1.mainAction.createGroupSuccess,
                            payload: groupObj
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[main] create group useless' }];
                }
            }));
        })); }));
        // 添加群聊成员
        this.addGroupMember$ = this.actions$
            .ofType(actions_1.mainAction.addGroupMember)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var memberObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        memberObj = {
                            gid: info.activeGroup.key,
                            member_usernames: info.memberUsernames
                        };
                        return [4 /*yield*/, this.apiService.addGroupMembers(memberObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.addGroupMemberSuccess,
                                payload: info.detailMember
                            });
                        }
                        return [2 /*return*/, { type: '[main] add group members useless' }];
                }
            }));
        })); }));
        // 修改密码
        this.modifyPassword$ = this.actions$
            .ofType(actions_1.mainAction.modifyPassword)
            .map(effects_1.toPayload)
            .switchMap((function (passwordInfo) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var passwordObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        passwordObj = {
                            old_pwd: tools_1.md5(passwordInfo.old_pwd),
                            new_pwd: tools_1.md5(passwordInfo.new_pwd),
                            is_md5: true
                        };
                        return [4 /*yield*/, this.apiService.updateSelfPwd(passwordObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.apiService.loginOut();
                            this.store$.dispatch({
                                type: actions_1.mainAction.modifyPasswordShow,
                                payload: {
                                    repeatLogin: tools_1.md5(passwordInfo.new_pwd),
                                    show: false
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '提示',
                                        tip: '密码修改成功',
                                        actionType: '[main] modify password alert',
                                        success: 1 // 1 代表成功 2代表失败
                                    }
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[main] modify password useless' }];
                }
            }));
        })); }));
        // 创建单聊/添加好友
        this.createSingleChatAction$ = this.actions$
            .ofType(actions_1.mainAction.createSingleChatAction)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data, user, item, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = { username: info.singleName };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        if (data.code === 882002) {
                            this.store$.dispatch({
                                type: actions_1.mainAction.createSingleChatShow,
                                payload: {
                                    show: true,
                                    info: '用户不存在'
                                }
                            });
                        }
                        else {
                            this.errorFn(data);
                        }
                        return [3 /*break*/, 5];
                    case 2:
                        user = data.user_info;
                        item = {
                            avatar: user.avatar,
                            mtime: user.mtime,
                            name: user.username,
                            nickName: user.nickname,
                            username: user.username,
                            nickname: user.nickname,
                            type: 3,
                            signature: user.signature,
                            gender: user.gender,
                            region: user.region,
                            avatarUrl: '',
                            infoType: info.type
                        };
                        if (!(item.avatar !== '')) return [3 /*break*/, 4];
                        urlObj = { media_id: data.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        urlInfo = _a.sent();
                        if (urlInfo.code) {
                            item.avatarUrl = '';
                        }
                        else {
                            item.avatarUrl = urlInfo.url;
                        }
                        _a.label = 4;
                    case 4:
                        this.store$.dispatch({
                            type: actions_1.mainAction.createSingleChatSuccess,
                            payload: item
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[main] create single chat action useless' }];
                }
            }));
        })); }));
        // 创建群聊搜索联系人或者转发消息搜索联系人
        this.createGroupSearchAction$ = this.actions$
            .ofType(actions_1.mainAction.createGroupSearchAction)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, userInfo, user, item, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = {
                            username: info.keywords
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        userInfo = _a.sent();
                        if (!userInfo.code) return [3 /*break*/, 2];
                        if (userInfo.code === 882002) {
                            this.searUserType(info, null, info.keywords);
                        }
                        else {
                            this.errorFn(userInfo);
                        }
                        return [3 /*break*/, 5];
                    case 2:
                        user = userInfo.user_info;
                        item = {
                            avatar: '',
                            avatarUrl: '',
                            mtime: user.mtime,
                            name: user.username,
                            username: user.username,
                            nickName: user.nickname,
                            type: 3,
                            appkey: user.appkey
                        };
                        if (!(user.avatar !== '')) return [3 /*break*/, 4];
                        urlObj = {
                            media_id: user.avatar
                        };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 3:
                        urlInfo = _a.sent();
                        if (!urlInfo.code) {
                            item.avatarUrl = urlInfo.url;
                        }
                        _a.label = 4;
                    case 4:
                        this.searUserType(info, item, info.keywords);
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[main] create group search action useless' }];
                }
            }));
        })); }));
        // 获取黑名单列表
        this.blackMenuShow$ = this.actions$
            .ofType(actions_1.mainAction.blackMenu)
            .map(effects_1.toPayload)
            .switchMap((function (isShow) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var blackInfo, _loop_1, this_1, _i, _a, black;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.apiService.getBlacks()];
                    case 1:
                        blackInfo = _b.sent();
                        if (blackInfo.code) {
                            this.errorFn(blackInfo);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.blackMenuSuccess,
                                payload: {
                                    show: isShow.show,
                                    menu: blackInfo.black_list
                                }
                            });
                            if (blackInfo.black_list.length > 0) {
                                _loop_1 = function (black) {
                                    var urlObj = {
                                        media_id: black.avatar
                                    };
                                    this_1.apiService.getResource(urlObj).then((function (urlInfo) {
                                        if (urlInfo.code) {
                                            black.avatarUrl = '';
                                        }
                                        else {
                                            black.avatarUrl = urlInfo.url;
                                        }
                                    }));
                                };
                                this_1 = this;
                                for (_i = 0, _a = blackInfo.black_list; _i < _a.length; _i++) {
                                    black = _a[_i];
                                    _loop_1(black);
                                }
                            }
                        }
                        return [2 /*return*/, { type: '[main] black menu show useless' }];
                }
            }));
        })); }));
        // 移出黑名单列表
        this.delSingleBlack$ = this.actions$
            .ofType(actions_1.mainAction.delSingleBlack)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var blackObj, blabkInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        blackObj = {
                            member_usernames: [{
                                    username: user.username,
                                    appkey: common_1.authPayload.appkey
                                }]
                        };
                        return [4 /*yield*/, this.apiService.delSingleBlacks(blackObj)];
                    case 1:
                        blabkInfo = _a.sent();
                        if (blabkInfo.code) {
                            this.errorFn(blabkInfo);
                            this.store$.dispatch({
                                type: actions_1.mainAction.delSingleBlackError,
                                payload: user
                            });
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.delSingleBlackSuccess,
                                payload: user
                            });
                        }
                        return [2 /*return*/, { type: '[main] delete single black useless' }];
                }
            }));
        })); }));
        // 加入黑名单
        this.addBlackListAction$ = this.actions$
            .ofType(actions_1.mainAction.addBlackListAction)
            .map(effects_1.toPayload)
            .switchMap((function (active) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var blackObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        blackObj = {
                            member_usernames: [{
                                    username: active.name || active.username,
                                    appkey: common_1.authPayload.appkey
                                }]
                        };
                        return [4 /*yield*/, this.apiService.addSingleBlacks(blackObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '加入黑名单',
                                        tip: '加入黑名单成功',
                                        actionType: '[main] add single black useless',
                                        success: 1
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.addBlackListSuccess,
                                payload: {
                                    deleteItem: {
                                        item: active
                                    }
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[main] add black list useless' }];
                }
            }));
        })); }));
        // 退出群聊
        this.exitGroupAction$ = this.actions$
            .ofType(actions_1.mainAction.exitGroupAction)
            .map(effects_1.toPayload)
            .filter((function (data) {
            return data ? data : false;
        })).switchMap((function (gid) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var groupObj, groupInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        groupObj = { gid: gid };
                        return [4 /*yield*/, this.apiService.exitGroup(groupObj)];
                    case 1:
                        groupInfo = _a.sent();
                        if (groupInfo.code) {
                            this.errorFn(groupInfo);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.exitGroupSuccess,
                                payload: {
                                    item: {
                                        key: gid
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: false,
                                    info: {
                                        title: '',
                                        tip: ''
                                    }
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[main] exit group useless' }];
                }
            }));
        })); }));
        // 删除群聊成员
        this.deleteMemberAction$ = this.actions$
            .ofType(actions_1.mainAction.deleteMemberAction)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var memberObj, groupInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        memberObj = {
                            gid: info.group.key,
                            member_usernames: [
                                { username: info.deleteItem.username }
                            ]
                        };
                        return [4 /*yield*/, this.apiService.delGroupMembers(memberObj)];
                    case 1:
                        groupInfo = _a.sent();
                        if (groupInfo.code) {
                            this.errorFn(groupInfo);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: false,
                                    info: {
                                        title: '',
                                        tip: ''
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.deleteMemberSuccess,
                                payload: {
                                    deleteItem: info.deleteItem,
                                    group: info.group
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[main] delete group member useless' }];
                }
            }));
        })); }));
        // 被踢后重新登录
        this.login$ = this.actions$
            .ofType(actions_1.mainAction.login)
            .map(effects_1.toPayload)
            .switchMap((function (val) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var timestamp, signature, data_2, initObj, data, loginObj, login;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        timestamp = new Date().getTime();
                        if (!common_1.authPayload.isFrontSignature) return [3 /*break*/, 1];
                        if (common_1.authPayload.masterSecret.length === 0) {
                            signature = common_1.demoInitConfig.signature;
                            timestamp = common_1.demoInitConfig.timestamp;
                        }
                        else {
                            signature = util_1.Util.createSignature(timestamp);
                        }
                        return [3 /*break*/, 3];
                    case 1:
                        data_2 = {
                            timestamp: timestamp,
                            appkey: common_1.authPayload.appkey,
                            randomStr: common_1.authPayload.randomStr
                        };
                        return [4 /*yield*/, this.signatureService.requestSignature(common_1.authPayload.signatureApiUrl, data_2)];
                    case 2:
                        signature = _a.sent();
                        _a.label = 3;
                    case 3:
                        initObj = {
                            appkey: common_1.authPayload.appkey,
                            random_str: common_1.authPayload.randomStr,
                            signature: signature,
                            timestamp: timestamp,
                            flag: common_1.authPayload.flag
                        };
                        return [4 /*yield*/, this.apiService.init(initObj)];
                    case 4:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 5];
                        this.errorFn(data);
                        return [3 /*break*/, 7];
                    case 5:
                        loginObj = {
                            username: val.username,
                            password: val.password,
                            is_md5: val.md5
                        };
                        return [4 /*yield*/, this.apiService.login(loginObj)];
                    case 6:
                        login = _a.sent();
                        if (login.code) {
                            this.errorFn(login);
                        }
                        else {
                            if (val.reload) {
                                window.location.reload();
                            }
                        }
                        _a.label = 7;
                    case 7: return [2 /*return*/, { type: '[main] login useless' }];
                }
            }));
        })); }));
        // 用户资料中添加免打扰
        this.addSingleNoDisturbAction$ = this.actions$
            .ofType(actions_1.mainAction.addSingleNoDisturbAction)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var userObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = {
                            target_name: user.name
                        };
                        return [4 /*yield*/, this.apiService.addSingleNoDisturb(userObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                            this.store$.dispatch({
                                type: actions_1.mainAction.hideModalTip,
                                payload: {
                                    show: false,
                                    info: {}
                                }
                            });
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '添加消息免打扰',
                                        tip: '添加消息免打扰成功',
                                        actionType: '[main] add single no disturb action useless',
                                        success: 1
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.addSingleNoDisturbSuccess,
                                payload: user
                            });
                        }
                        return [2 /*return*/, { type: '[main] add single no disturb action useless' }];
                }
            }));
        })); }));
        // 删除好友
        this.deleteFriend$ = this.actions$
            .ofType(actions_1.mainAction.deleteFriend)
            .map(effects_1.toPayload)
            .switchMap((function (user) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var friendObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        friendObj = {
                            target_name: user.name
                        };
                        return [4 /*yield*/, this.apiService.delFriend(friendObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '删除好友',
                                        tip: '删除好友成功',
                                        actionType: '[main] delete friend success useless',
                                        success: 1
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.deleteFriendSuccess,
                                payload: user
                            });
                        }
                        return [2 /*return*/, { type: '[main] delete friend useless' }];
                }
            }));
        })); }));
        // 搜索聊天室
        this.searchUser$ = this.actions$
            .ofType(actions_1.mainAction.searchUser)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var info, roomObj, roomInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        info = null;
                        if (!!Number.isNaN(Number(payload))) return [3 /*break*/, 2];
                        roomObj = {
                            id: payload
                        };
                        return [4 /*yield*/, this.apiService.getChatroomInfo(roomObj)];
                    case 1:
                        roomInfo = _a.sent();
                        if (!roomInfo.code) {
                            info = roomInfo.info;
                        }
                        _a.label = 2;
                    case 2:
                        this.store$.dispatch({
                            type: actions_1.mainAction.searchUserSuccess,
                            payload: {
                                room: info,
                                keywords: payload
                            }
                        });
                        return [2 /*return*/, { type: '[main] search user useless' }];
                }
            }));
        })); }));
        // 搜索公开群群组资料
        this.searchPublicGroup$ = this.actions$
            .ofType(actions_1.mainAction.searchPublicGroup)
            .map(effects_1.toPayload)
            .switchMap((function (gid) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var groupObj, data, promises, urlObj, pro1, pro2;
            var _this = this;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        if (Number.isNaN(Number(gid))) {
                            this.store$.dispatch({
                                type: actions_1.mainAction.enterPublicGroupShow,
                                payload: {
                                    show: true,
                                    info: {
                                        text: '群组ID由数字组成'
                                    }
                                }
                            });
                            return [2 /*return*/, { type: '[main] search public group useless' }];
                        }
                        groupObj = {
                            gid: gid
                        };
                        return [4 /*yield*/, this.apiService.getGroupInfo(groupObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        if (data.code === 882002) {
                            this.store$.dispatch({
                                type: actions_1.mainAction.enterPublicGroupShow,
                                payload: {
                                    show: true,
                                    info: {
                                        text: '未搜索到公开群'
                                    }
                                }
                            });
                        }
                        else if (data.code === -2) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.enterPublicGroupShow,
                                payload: {
                                    show: true,
                                    info: {
                                        text: '查找公开群失败'
                                    }
                                }
                            });
                        }
                        return [3 /*break*/, 5];
                    case 2:
                        if (!(data.group_info.group_type === 2)) return [3 /*break*/, 4];
                        promises = [];
                        if (data.group_info.avatar && data.group_info.avatar !== '') {
                            urlObj = { media_id: data.group_info.avatar };
                            pro1 = this.apiService.getResource(urlObj)
                                .then((function (urlInfo) {
                                if (!urlInfo.code) {
                                    data.group_info.avatarUrl = urlInfo.url;
                                }
                            }));
                            promises.push(pro1);
                        }
                        pro2 = this.apiService.getGroupMembers(groupObj)
                            .then((function (groupList) {
                            if (groupList.code === -2) {
                                _this.errorFn(groupList);
                            }
                            else if (groupList.code) {
                                _this.store$.dispatch({
                                    type: actions_1.mainAction.enterPublicGroupShow,
                                    payload: {
                                        show: true,
                                        info: {
                                            text: '查找公开群失败'
                                        }
                                    }
                                });
                            }
                            else {
                                data.group_info.member_list_count = groupList.member_list.length;
                                for (var _i = 0, _a = groupList.member_list; _i < _a.length; _i++) {
                                    var member = _a[_i];
                                    if (member.flag === 1) {
                                        data.group_info.host = member;
                                    }
                                    if (member.username === common_1.global.user) {
                                        data.group_info.isMember = true;
                                    }
                                }
                            }
                        }));
                        promises.push(pro2);
                        return [4 /*yield*/, Promise.all(promises)];
                    case 3:
                        _a.sent();
                        this.store$.dispatch({
                            type: actions_1.mainAction.searchPublicGroupSuccess,
                            payload: {
                                show: true,
                                info: data.group_info
                            }
                        });
                        return [3 /*break*/, 5];
                    case 4:
                        this.store$.dispatch({
                            type: actions_1.mainAction.enterPublicGroupShow,
                            payload: {
                                show: true,
                                info: {
                                    text: '未搜索到公开群'
                                }
                            }
                        });
                        _a.label = 5;
                    case 5: return [2 /*return*/, { type: '[main] search public group useless' }];
                }
            }));
        })); }));
        // 发送申请入群
        this.sendGroupVerifyMessage$ = this.actions$
            .ofType(actions_1.mainAction.sendGroupVerifyMessage)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var groupObj, groupInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        groupObj = {
                            gid: payload.info.gid,
                            reason: payload.text
                        };
                        return [4 /*yield*/, this.apiService.joinGroup(groupObj)];
                    case 1:
                        groupInfo = _a.sent();
                        if (groupInfo.code) {
                            this.errorFn(groupInfo);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showModalTip,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '发送成功',
                                        tip: '入群申请已发送，请等待审核',
                                        actionType: '[main] send verify group success',
                                        success: 1
                                    }
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.groupVerifyModal,
                                payload: {
                                    show: false
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[main] send group verify message useless' }];
                }
            }));
        })); }));
    }
    MainEffect.prototype.errorFn = function (error) {
        this.store$.dispatch({
            type: actions_3.appAction.errorApiTip,
            payload: error
        });
    };
    MainEffect.prototype.searUserType = function (info, item, keywords) {
        if (info.type === 'createGroup') {
            this.store$.dispatch({
                type: actions_2.chatAction.createGroupSearchComplete,
                payload: {
                    result: item,
                    keywords: keywords
                }
            });
        }
    };
    // 更新个人头像
    MainEffect.prototype.updateSelfAvatar = function (self) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var avatarObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        avatarObj = { avatar: self.avatar.formData };
                        return [4 /*yield*/, this.apiService.updateSelfAvatar(avatarObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showSelfInfo,
                                payload: {
                                    loading: false
                                }
                            });
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.mainAction.showSelfInfo,
                                payload: {
                                    avatar: self.avatar,
                                    info: self.info,
                                    loading: false
                                }
                            });
                            this.store$.dispatch({
                                type: actions_1.mainAction.updateSelfInfoFlag
                            });
                        }
                        return [2 /*return*/];
                }
            }));
        }));
    };
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "jimInit$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "getSelfInfo$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "logoutAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "updateSelfInfo$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "createGroup$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "addGroupMember$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "modifyPassword$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "createSingleChatAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "createGroupSearchAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "blackMenuShow$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "delSingleBlack$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "addBlackListAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "exitGroupAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "deleteMemberAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "login$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "addSingleNoDisturbAction$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "deleteFriend$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "searchUser$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "searchPublicGroup$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], MainEffect.prototype, "sendGroupVerifyMessage$", void 0);
    MainEffect = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [effects_1.Actions,
            store_1.Store,
            router_1.Router,
            common_1.ApiService,
            common_1.SignatureService])
    ], MainEffect);
    return MainEffect;
}());
exports.MainEffect = MainEffect;


/***/ }),

/***/ 808:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(809), exports);


/***/ }),

/***/ 809:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.mainInit = {
    mainLoading: false,
    selfInfo: {
        info: {
            avatar: '',
            avatarUrl: '',
        },
        show: false,
        loading: false
    },
    listTab: 0,
    createGroup: {
        show: false,
        display: false,
        info: {}
    },
    logoutShow: false,
    modifyPasswordShow: {
        repeatLogin: '',
        show: false
    },
    searchUserResult: {
        result: {
            singleArr: [],
            groupArr: [],
            roomArr: []
        },
        isSearch: false
    },
    actionType: '',
    tipModal: {
        show: false,
        info: {}
    },
    createSingleChat: {
        show: false,
        info: ''
    },
    blackMenu: {
        menu: [],
        show: false
    },
    errorApiTip: {},
    logoutKick: {
        show: false,
        info: {
            title: '',
            tip: ''
        }
    },
    contactUnreadNum: 0,
    conversationUnreadNum: 0,
    friendList: [],
    enterPublicGroup: {
        show: false,
        info: {}
    },
    groupInfo: {
        show: false,
        info: {}
    },
    groupVerifyModal: {
        show: false
    },
    createGroupNext: {
        show: false,
        display: false,
        info: {}
    }
};


/***/ }),

/***/ 810:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(811), exports);


/***/ }),

/***/ 811:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(90);
var model_1 = __webpack_require__(808);
var actions_2 = __webpack_require__(124);
var actions_3 = __webpack_require__(107);
var util_1 = __webpack_require__(72);
exports.mainReducer = function (state, _a) {
    if (state === void 0) { state = model_1.mainInit; }
    var type = _a.type, payload = _a.payload;
    state.actionType = type;
    switch (type) {
        // 初始化state
        case actions_1.mainAction.init:
            state = util_1.Util.deepCopyObj(model_1.mainInit);
            break;
        // 成功获取个人信息
        case actions_1.mainAction.showSelfInfo:
            // 获取个人信息成功或失败
            if (payload.info) {
                state.selfInfo.info = Object.assign({}, state.selfInfo.info, payload.info);
            }
            if (payload.avatar) {
                state.selfInfo.info.avatarUrl = payload.avatar.url;
            }
            if (!payload.info && !payload.avatar && payload.show !== undefined) {
                state.selfInfo.show = payload.show;
            }
            state.selfInfo.loading = payload.loading;
            break;
        // 更新自己的个人资料
        case actions_1.mainAction.updateSelfInfo:
            state.selfInfo.loading = true;
            break;
        // 切换好友或者最近列表
        case actions_1.mainAction.changeListTab:
            state.listTab = payload;
            break;
        // 点击选择联系人中的用户
        case actions_2.contactAction.selectContactItem:
            state.listTab = 0;
            break;
        // 是否显示创建群组模块
        case actions_1.mainAction.createGroupShow:
            state.createGroup = payload;
            break;
        // 创建群组成功
        case actions_1.mainAction.createGroupSuccess:
            state.createGroup.show = false;
            state.listTab = 0;
            break;
        // 显示创建群聊第二步
        case actions_1.mainAction.createGroupNextShow:
            state.createGroupNext.show = payload.show;
            state.createGroupNext.display = payload.display;
            if (payload.info) {
                state.createGroupNext.info = payload.info;
            }
            break;
        // 显示加入公开群的模态框
        case actions_1.mainAction.enterPublicGroupShow:
            state.enterPublicGroup = payload;
            break;
        // 搜索公开群成功
        case actions_1.mainAction.searchPublicGroupSuccess:
            state.groupInfo = payload;
            state.enterPublicGroup = {
                show: false,
                info: {}
            };
            break;
        // 显示发送群组验证信息模态框
        case actions_1.mainAction.groupVerifyModal:
            state.groupVerifyModal.show = payload.show;
            break;
        // 添加群成员成功
        case actions_1.mainAction.addGroupMemberSuccess:
            state.createGroup.show = false;
            state.listTab = 0;
            break;
        // 修改密码
        case actions_1.mainAction.modifyPasswordShow:
            state.modifyPasswordShow = payload;
            break;
        // 搜索本地用户成功
        case actions_3.chatAction.searchUserSuccess:
            state.searchUserResult = payload;
            break;
        // 选择搜索出来的联系人或者群组用户
        case actions_1.mainAction.selectSearchUser:
            state.listTab = 0;
            state.searchUserResult = {
                result: {
                    groupArr: [],
                    singleArr: [],
                    roomArr: []
                },
                isSearch: false
            };
            break;
        // 选择搜索出来的聊天室
        case actions_1.mainAction.selectSearchRoomUser:
            state.listTab = 2;
            state.searchUserResult = {
                result: {
                    groupArr: [],
                    singleArr: [],
                    roomArr: []
                },
                isSearch: false
            };
            break;
        // 提示框
        case actions_1.mainAction.showModalTip:
        case actions_1.mainAction.hideModalTip:
            state.tipModal = payload;
            break;
        // 显示创建单聊模态框
        case actions_1.mainAction.createSingleChatShow:
            state.createSingleChat = payload;
            break;
        // 创建单聊成功
        case actions_1.mainAction.createSingleChatSuccess:
            state.createSingleChat = {
                show: false,
                info: ''
            };
            break;
        // 对方资料中发起聊天
        case actions_3.chatAction.createOtherChat:
            state.listTab = 0;
            break;
        // 清除单聊模态框的提示信息
        case actions_1.mainAction.emptySingleChatTip:
            state.createSingleChat.info = payload.info;
            break;
        // 成功获取黑名单列表
        case actions_1.mainAction.blackMenuSuccess:
            if (payload.show !== null) {
                state.blackMenu.show = payload.show;
            }
            filterBlackMenuMemoName(state, payload.menu);
            state.blackMenu.menu = payload.menu;
            break;
        // 隐藏黑名单列表
        case actions_1.mainAction.hideBlackMenu:
            state.blackMenu = payload;
            break;
        // 删除黑名单列表
        case actions_1.mainAction.delSingleBlack:
            delSingleBlackLoading(state, payload, true);
            break;
        // 删除黑名单列表成功
        case actions_1.mainAction.delSingleBlackSuccess:
            delSingleBlackLoading(state, payload, false);
            break;
        case actions_1.mainAction.delSingleBlackError:
            delSingleBlackLoading(state, payload, false);
            break;
        // 被其他设备登录踢掉的提示
        case actions_1.mainAction.logoutKickShow:
            state.logoutKick = payload;
            break;
        // 传递联系人和会话tab的未读数
        case actions_2.contactAction.dispatchContactUnreadNum:
            state.contactUnreadNum = payload;
            break;
        // 传递通讯录未读数
        case actions_3.chatAction.dispatchConversationUnreadNum:
            state.conversationUnreadNum = payload;
            break;
        // 传递好友列表
        case actions_3.chatAction.dispatchFriendList:
            state.friendList = payload;
            break;
        case actions_3.chatAction.changeHideAll:
            state.listTab = payload;
            break;
        default:
    }
    return state;
};
// 为黑名单列表添加备注名
function filterBlackMenuMemoName(state, payload) {
    for (var _i = 0, payload_1 = payload; _i < payload_1.length; _i++) {
        var black = payload_1[_i];
        for (var _a = 0, _b = state.friendList; _a < _b.length; _a++) {
            var friend = _b[_a];
            if (friend.username === black.username && friend.appkey === black.appkey &&
                friend.memo_name && friend.memo_name !== '') {
                black.memo_name = friend.memo_name;
                break;
            }
        }
    }
}
// 切换删除黑名单列表的loading状态
function delSingleBlackLoading(state, payload, loadingValue) {
    for (var _i = 0, _a = state.blackMenu.menu; _i < _a.length; _i++) {
        var black = _a[_i];
        if (black.username === payload.username) {
            black.loading = loadingValue;
            break;
        }
    }
}


/***/ }),

/***/ 812:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.registerAction = {
    register: '[register] register',
    registerSuccess: '[register] register success',
    registerFailed: '[register] register failed',
    isButtonAvailableAction: '[register] is button available action',
    isUsernameAvailableAction: '[register] is username available action',
    usernameTip: '[register] username tip',
    password: '[register] password',
    passwordTip: '[register] password tip',
    repeatPasswordTip: '[register] repeat password tip',
    init: '[register] init state',
    emptyTip: '[register] empty tip'
};


/***/ }),

/***/ 813:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(814), exports);


/***/ }),

/***/ 814:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var rxjs_1 = __webpack_require__(43);
var effects_1 = __webpack_require__(70);
var store_1 = __webpack_require__(32);
var actions_1 = __webpack_require__(318);
var actions_2 = __webpack_require__(104);
var common_1 = __webpack_require__(28);
var tools_1 = __webpack_require__(160);
var RegisterEffect = /** @class */ (function () {
    function RegisterEffect(actions$, store$, apiService) {
        var _this = this;
        this.actions$ = actions$;
        this.store$ = store$;
        this.apiService = apiService;
        this.minLength = 4;
        this.maxLength = 128;
        this.chineseReg = /[\u4e00-\u9fa5]/ig;
        this.letterNumberStartReg = /^[0-9a-zA-Z]/ig;
        this.charReg = /^([a-zA-Z]|[0-9]|_|\.|-|@]){4,}$/ig;
        // 注册
        this.register$ = this.actions$
            .ofType(actions_1.registerAction.register)
            .map(effects_1.toPayload)
            .filter((function (val) {
            if (!val.isButtonAvailable) {
                return false;
            }
            if (val.password !== val.repeatPassword) {
                _this.store$.dispatch({
                    type: actions_1.registerAction.repeatPasswordTip,
                    payload: '您两次输入的密码不一致'
                });
                return false;
            }
            else {
                _this.store$.dispatch({
                    type: actions_1.registerAction.repeatPasswordTip,
                    payload: ''
                });
            }
            if (val.username.length > _this.maxLength
                || val.username.length < _this.minLength
                || val.username.match(_this.chineseReg)
                || !val.username.match(_this.letterNumberStartReg)
                || val.password.length > _this.maxLength
                || val.password.length < _this.minLength
                || !val.username.match(_this.charReg)) {
                return false;
            }
            return val;
        })).switchMap((function (val) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var registerObj, data, usernameTip;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        registerObj = {
                            username: val.username,
                            password: tools_1.md5(val.password),
                            is_md5: true
                        };
                        return [4 /*yield*/, this.apiService.register(registerObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            usernameTip = '';
                            if (data.code === 882002) {
                                usernameTip = '用户名已存在';
                                this.store$.dispatch({
                                    type: actions_1.registerAction.registerFailed,
                                    payload: usernameTip
                                });
                            }
                            else if (data.code === -2) {
                                this.store$.dispatch({
                                    type: actions_2.appAction.errorApiTip,
                                    payload: data
                                });
                            }
                            else {
                                usernameTip = '注册失败';
                                this.store$.dispatch({
                                    type: actions_1.registerAction.registerFailed,
                                    payload: usernameTip
                                });
                            }
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.registerAction.registerSuccess,
                                payload: {
                                    show: true,
                                    info: {
                                        title: '提示',
                                        tip: '注册成功',
                                        actionType: '[main] register success',
                                        success: 1
                                    }
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[register] register useless' }];
                }
            }));
        })); }));
        // 用户名是否符合正则
        this.isUsernameAvailable$ = this.actions$
            .ofType(actions_1.registerAction.isUsernameAvailableAction)
            .map(effects_1.toPayload)
            .filter((function (val) {
            if (val.username.length === 0) {
                val.usernameTip = '';
                return val;
            }
            var usernameTip = '';
            if (val.username.length > _this.maxLength || val.username.length < _this.minLength) {
                usernameTip = "\u7528\u6237\u540D\u4E3A" + _this.minLength + "-" + _this.maxLength + "\u4F4D\u5B57\u7B26";
            }
            else if (val.username.match(_this.chineseReg)) {
                usernameTip = '用户名不支持中文';
            }
            else if (!val.username.match(_this.letterNumberStartReg)) {
                usernameTip = '用户名以字母或数字开头';
            }
            else if (!val.username.match(_this.charReg)) {
                usernameTip = '支持字母、数字、下划线、英文点、减号、@';
            }
            val.usernameTip = usernameTip;
            return val;
        })).switchMap((function (val) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            return tslib_1.__generator(this, (function (_a) {
                this.store$.dispatch({
                    type: actions_1.registerAction.usernameTip,
                    payload: val.usernameTip
                });
                return [2 /*return*/, { type: '[register] is username available useless' }];
            }));
        })); }));
        // 正则验证密码
        this.password = this.actions$
            .ofType(actions_1.registerAction.password)
            .map(effects_1.toPayload)
            .filter((function (val) {
            var passwordTip = '';
            if (val.password.length > _this.maxLength || val.password.length < _this.minLength
                && val.password !== '') {
                passwordTip = "\u5BC6\u7801\u957F\u5EA6\u4E3A" + _this.minLength + "-" + _this.maxLength + "\u5B57\u8282";
            }
            _this.store$.dispatch({
                type: actions_1.registerAction.passwordTip,
                payload: passwordTip
            });
            return val;
        })).map((function (val) {
            return { type: '[register] password useless' };
        }));
    }
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RegisterEffect.prototype, "register$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RegisterEffect.prototype, "isUsernameAvailable$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RegisterEffect.prototype, "password", void 0);
    RegisterEffect = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [effects_1.Actions,
            store_1.Store,
            common_1.ApiService])
    ], RegisterEffect);
    return RegisterEffect;
}());
exports.RegisterEffect = RegisterEffect;


/***/ }),

/***/ 815:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(816), exports);


/***/ }),

/***/ 816:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(318);
var util_1 = __webpack_require__(72);
var registerInit = {
    actionType: '',
    isRegisterSuccess: false,
    usernameTip: '',
    passwordTip: '',
    repeatPasswordTip: '',
    isButtonAvailable: false,
    tipModal: {
        show: false,
        info: {}
    }
};
exports.registerReducer = function (state, _a) {
    if (state === void 0) { state = registerInit; }
    var type = _a.type, payload = _a.payload;
    state.actionType = type;
    switch (type) {
        case actions_1.registerAction.init:
            state = util_1.Util.deepCopyObj(registerInit);
            break;
        case actions_1.registerAction.register:
            break;
        case actions_1.registerAction.registerSuccess:
            state.isRegisterSuccess = true;
            state.usernameTip = '';
            state.tipModal = payload;
            break;
        case actions_1.registerAction.registerFailed:
            state.isRegisterSuccess = false;
            state.usernameTip = payload;
            break;
        case actions_1.registerAction.usernameTip:
            state.usernameTip = payload;
            break;
        case actions_1.registerAction.passwordTip:
            state.passwordTip = payload;
            break;
        case actions_1.registerAction.isButtonAvailableAction:
            isButtonAvailable(state, payload);
            break;
        case actions_1.registerAction.repeatPasswordTip:
            state.repeatPasswordTip = payload;
            break;
        case actions_1.registerAction.emptyTip:
            switch (payload) {
                case 'username':
                    state.usernameTip = '';
                    break;
                case 'password':
                    state.passwordTip = '';
                    break;
                case 'repeatPassword':
                    state.repeatPasswordTip = '';
                    break;
                default:
            }
            break;
        default:
    }
    return state;
};
function isButtonAvailable(state, payload) {
    if (payload.username.length > 0 &&
        payload.password.length > 0 && payload.repeatPassword.length > 0) {
        state.isButtonAvailable = true;
    }
    else {
        state.isButtonAvailable = false;
    }
}


/***/ }),

/***/ 817:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.roomAction = {
    init: '[room] state init',
    getRoomList: '[room] get room list',
    getRoomListSuccess: '[room] get room list success',
    changeRoom: '[room] change room',
    changeRoomSuccess: '[room] change room success',
    enterRoom: '[room] enter room',
    enterRoomSuccess: '[room] enter room success',
    enterRoomError: '[room] enter room success error',
    exitRoom: '[room] exit room',
    exitRoomSuccess: '[room] exit room success',
    showRoomInfomation: '[room] show room infomation',
    showRoomInfomationSuccess: '[room] show room infomation success',
    receiveMessage: '[room] receive message',
    receiveMessageSuccess: '[room] receive message success',
    receiveMessageUrlSuccess: '[room] receive message url success',
    getSelfChatrooms: '[room] get self chatrooms',
    exitAllChatroomsSuccess: '[room] get all chatrooms success',
    sendTextMsg: '[room] send text msg',
    transmitPicMsg: '[room] transmit pic msg',
    sendFileMsg: '[room] send file msg',
    sendPicMsg: '[room] send pic msg',
    sendMsgComplete: '[room] send msg complete',
    transmitAllMsg: '[room] transmit all msg',
    getRoomVoiceState: '[room] get room voice state',
    getRoomVoiceStateSuccess: '[room] get room voice state success',
    showPanel: '[room] show panel',
    storageVoiceState: '[room] storage voice state'
};


/***/ }),

/***/ 818:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(819), exports);


/***/ }),

/***/ 819:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var rxjs_1 = __webpack_require__(43);
var effects_1 = __webpack_require__(70);
var store_1 = __webpack_require__(32);
var actions_1 = __webpack_require__(222);
var actions_2 = __webpack_require__(104);
var common_1 = __webpack_require__(28);
var RoomEffect = /** @class */ (function () {
    function RoomEffect(actions$, store$, storageService, apiService) {
        var _this = this;
        this.actions$ = actions$;
        this.store$ = store$;
        this.storageService = storageService;
        this.apiService = apiService;
        // 获取storage里的voice状态
        this.getVoiceState$ = this.actions$
            .ofType(actions_1.roomAction.getRoomVoiceState)
            .map(effects_1.toPayload)
            .switchMap((function (key) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var voiceState;
            return tslib_1.__generator(this, (function (_a) {
                voiceState = this.storageService.get(key);
                if (voiceState) {
                    this.store$.dispatch({
                        type: actions_1.roomAction.getRoomVoiceStateSuccess,
                        payload: JSON.parse(voiceState)
                    });
                }
                return [2 /*return*/, { type: '[room] get room voice state useless' }];
            }));
        })); }));
        // 更新storage里的voice状态
        this.storageVoiceState$ = this.actions$
            .ofType(actions_1.roomAction.storageVoiceState)
            .map(effects_1.toPayload)
            .switchMap((function (info) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            return tslib_1.__generator(this, (function (_a) {
                if (info.voiceStateKey && info.voiceState) {
                    this.storageService.set(info.voiceStateKey, JSON.stringify(info.voiceState));
                    this.store$.dispatch({
                        type: actions_1.roomAction.getRoomVoiceStateSuccess,
                        payload: info.voiceState
                    });
                }
                return [2 /*return*/, { type: '[room] storage room voice state useless' }];
            }));
        })); }));
        // 获取自己已经进入的聊天室列表，并一一退出
        this.getSelfChatrooms$ = this.actions$
            .ofType(actions_1.roomAction.getSelfChatrooms)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var data, promises, _i, _a, room, roomObj, pro;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.apiService.getSelfChatrooms()];
                    case 1:
                        data = _b.sent();
                        if (!data.code) return [3 /*break*/, 2];
                        this.errorFn(data);
                        return [3 /*break*/, 4];
                    case 2:
                        promises = [];
                        for (_i = 0, _a = data.chat_rooms; _i < _a.length; _i++) {
                            room = _a[_i];
                            roomObj = {
                                id: room.id
                            };
                            pro = this.apiService.exitChatroom(roomObj);
                            promises.push(pro);
                        }
                        return [4 /*yield*/, Promise.all(promises)];
                    case 3:
                        _b.sent();
                        this.store$.dispatch({
                            type: actions_1.roomAction.exitAllChatroomsSuccess,
                            payload: null
                        });
                        _b.label = 4;
                    case 4: return [2 /*return*/, { type: '[room] get self chatrooms useless' }];
                }
            }));
        })); }));
        // 请求聊天室列表
        this.getRoomList$ = this.actions$
            .ofType(actions_1.roomAction.getRoomList)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var roomsObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        roomsObj = {
                            start: payload.start,
                            appkey: payload.appkey
                        };
                        return [4 /*yield*/, this.apiService.getAppkeyChatrooms(roomsObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.roomAction.getRoomListSuccess,
                                payload: data.result.rooms
                            });
                        }
                        return [2 /*return*/, { type: '[room] get room list useless' }];
                }
            }));
        })); }));
        // 切换active聊天室，退出聊天室，请求聊天室详情
        this.changeRoom$ = this.actions$
            .ofType(actions_1.roomAction.changeRoom)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var roomObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        this.store$.dispatch({
                            type: actions_1.roomAction.changeRoomSuccess,
                            payload: {
                                active: payload,
                                info: {}
                            }
                        });
                        this.exitRoom(payload);
                        roomObj = {
                            id: payload.id
                        };
                        return [4 /*yield*/, this.apiService.getChatroomInfo(roomObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.roomAction.changeRoomSuccess,
                                payload: {
                                    active: payload,
                                    info: data.info
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[room] change room useless' }];
                }
            }));
        })); }));
        // 进入新的聊天室
        this.enterRoom$ = this.actions$
            .ofType(actions_1.roomAction.enterRoom)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var roomObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        roomObj = {
                            id: payload.id
                        };
                        return [4 /*yield*/, this.apiService.enterChatroom(roomObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            if (data.code === 881507) {
                                this.store$.dispatch({
                                    type: actions_1.roomAction.enterRoomSuccess,
                                    payload: payload
                                });
                            }
                            else {
                                this.errorFn(data);
                                this.store$.dispatch({
                                    type: actions_1.roomAction.enterRoomError,
                                    payload: payload
                                });
                            }
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.roomAction.enterRoomSuccess,
                                payload: payload
                            });
                        }
                        return [2 /*return*/, { type: '[room] enter room useless' }];
                }
            }));
        })); }));
        // 退出聊天室
        this.exitRoom$ = this.actions$
            .ofType(actions_1.roomAction.exitRoom)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            return tslib_1.__generator(this, (function (_a) {
                if (payload.id) {
                    this.exitRoom(payload);
                }
                return [2 /*return*/, { type: '[room] exit room useless' }];
            }));
        })); }));
        // 显示聊天室资料
        this.showRoomInfomation$ = this.actions$
            .ofType(actions_1.roomAction.showRoomInfomation)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var roomObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        roomObj = {
                            id: payload.id
                        };
                        return [4 /*yield*/, this.apiService.getChatroomInfo(roomObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            this.errorFn(data);
                        }
                        else {
                            this.store$.dispatch({
                                type: actions_1.roomAction.showRoomInfomationSuccess,
                                payload: {
                                    show: true,
                                    info: data.info
                                }
                            });
                        }
                        return [2 /*return*/, { type: '[room] show room infomation useless' }];
                }
            }));
        })); }));
        // 收到新消息
        this.receiveMessage$ = this.actions$
            .ofType(actions_1.roomAction.receiveMessage)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var urlObj, data, username, flag, _i, _a, message, messageUsername, userObj, data, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_b) {
                switch (_b.label) {
                    case 0:
                        this.store$.dispatch({
                            type: actions_1.roomAction.receiveMessageSuccess,
                            payload: payload.data
                        });
                        if (!payload.data.content.msg_body.media_id) return [3 /*break*/, 2];
                        urlObj = { media_id: payload.data.content.msg_body.media_id };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 1:
                        data = _b.sent();
                        if (data.code) {
                            payload.data.content.msg_body.media_url = '';
                        }
                        else {
                            payload.data.content.msg_body.media_url = data.url;
                        }
                        this.store$.dispatch({
                            type: actions_1.roomAction.receiveMessageUrlSuccess,
                            payload: payload.data
                        });
                        _b.label = 2;
                    case 2:
                        // 如果接收的是名片
                        if (payload.data.content.msg_type === 'text' && payload.data.content.msg_body.extras &&
                            payload.data.content.msg_body.extras.businessCard) {
                            this.requestCardInfo(payload.data);
                        }
                        username = payload.data.content.from_id !== common_1.global.user ?
                            payload.data.content.from_id : payload.data.content.target_id;
                        flag = false;
                        for (_i = 0, _a = payload.messageList; _i < _a.length; _i++) {
                            message = _a[_i];
                            messageUsername = message.content.from_id !== common_1.global.user ?
                                message.content.from_id : message.content.target_id;
                            if (username === messageUsername &&
                                (message.content.avatarUrl || message.content.avatarUrl === '')) {
                                payload.data.content.avatarUrl = message.content.avatarUrl;
                                flag = true;
                                break;
                            }
                        }
                        if (!!flag) return [3 /*break*/, 5];
                        userObj = {
                            username: username
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 3:
                        data = _b.sent();
                        if (!(!data.code && data.user_info.avatar !== '')) return [3 /*break*/, 5];
                        urlObj = { media_id: data.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 4:
                        urlInfo = _b.sent();
                        if (!urlInfo.code) {
                            payload.data.content.avatarUrl = urlInfo.url;
                        }
                        _b.label = 5;
                    case 5: return [2 /*return*/, { type: '[room] receive message useless' }];
                }
            }));
        })); }));
        // 发送文本消息
        this.sendTextMsg$ = this.actions$
            .ofType(actions_1.roomAction.sendTextMsg)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msg, newPayload;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendChatroomMsg(payload.sendMsg)];
                    case 1:
                        msg = _a.sent();
                        newPayload = {
                            localMsg: payload.localMsg,
                            repeatSend: payload.repeatSend
                        };
                        if (msg.code) {
                            payload.localMsg.success = 3;
                            payload.localMsg.sendMsg = payload.sendMsg;
                            this.errorFn(msg);
                        }
                        else {
                            payload.localMsg.success = 2;
                            newPayload.msg = msg;
                        }
                        this.store$.dispatch({
                            type: actions_1.roomAction.sendMsgComplete,
                            payload: newPayload
                        });
                        return [2 /*return*/, { type: '[room] send text msg useless' }];
                }
            }));
        })); }));
        // 发送文件消息
        this.sendFileMsg$ = this.actions$
            .ofType(actions_1.roomAction.sendFileMsg)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msg, newPayload;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendChatroomFile(payload.sendMsg)];
                    case 1:
                        msg = _a.sent();
                        newPayload = {
                            localMsg: payload.localMsg,
                            repeatSend: payload.repeatSend
                        };
                        if (msg.code) {
                            payload.localMsg.success = 3;
                            payload.localMsg.sendMsg = payload.sendMsg;
                            this.errorFn(msg);
                        }
                        else {
                            payload.localMsg.success = 2;
                            newPayload.msg = msg;
                        }
                        this.store$.dispatch({
                            type: actions_1.roomAction.sendMsgComplete,
                            payload: newPayload
                        });
                        return [2 /*return*/, { type: '[room] send file msg useless' }];
                }
            }));
        })); }));
        // 发送图片消息, 发送jpush表情
        this.sendPicMsg$ = this.actions$
            .ofType(actions_1.roomAction.sendPicMsg, actions_1.roomAction.transmitPicMsg)
            .map(effects_1.toPayload)
            .switchMap((function (payload) { return tslib_1.__awaiter(_this, void 0, void 0, (function () {
            var msg, newPayload;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.apiService.sendChatroomPic(payload.sendMsg)];
                    case 1:
                        msg = _a.sent();
                        newPayload = {
                            localMsg: payload.localMsg,
                            repeatSend: payload.repeatSend
                        };
                        if (msg.code) {
                            payload.localMsg.success = 3;
                            payload.localMsg.sendMsg = payload.sendMsg;
                            this.errorFn(msg);
                        }
                        else {
                            payload.localMsg.success = 2;
                            newPayload.msg = msg;
                        }
                        this.store$.dispatch({
                            type: actions_1.roomAction.sendMsgComplete,
                            payload: newPayload
                        });
                        return [2 /*return*/, { type: '[room] send pic msg useless or transmit pic msg useless' }];
                }
            }));
        })); }));
    }
    RoomEffect.prototype.errorFn = function (error) {
        this.store$.dispatch({
            type: actions_2.appAction.errorApiTip,
            payload: error
        });
    };
    // 退出聊天室
    RoomEffect.prototype.exitRoom = function (payload) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var roomObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        roomObj = {
                            id: payload.id
                        };
                        return [4 /*yield*/, this.apiService.exitChatroom(roomObj)];
                    case 1:
                        data = _a.sent();
                        if (!data.code) {
                            this.store$.dispatch({
                                type: actions_1.roomAction.exitRoomSuccess,
                                payload: null
                            });
                        }
                        return [2 /*return*/];
                }
            }));
        }));
    };
    // 接收名片获取对方的信息
    RoomEffect.prototype.requestCardInfo = function (data) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var userObj, otherInfo, urlObj, urlInfo;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        userObj = {
                            username: data.content.msg_body.extras.userName,
                            appkey: common_1.authPayload.appkey
                        };
                        return [4 /*yield*/, this.apiService.getUserInfo(userObj)];
                    case 1:
                        otherInfo = _a.sent();
                        if (!!otherInfo.code) return [3 /*break*/, 3];
                        data.content.msg_body.extras.nickName = otherInfo.user_info.nickname;
                        if (!(otherInfo.user_info.avatar !== '')) return [3 /*break*/, 3];
                        urlObj = { media_id: otherInfo.user_info.avatar };
                        return [4 /*yield*/, this.apiService.getResource(urlObj)];
                    case 2:
                        urlInfo = _a.sent();
                        if (!urlInfo.code) {
                            data.content.msg_body.extras.media_url = urlInfo.url;
                        }
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            }));
        }));
    };
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "getVoiceState$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "storageVoiceState$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "getSelfChatrooms$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "getRoomList$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "changeRoom$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "enterRoom$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "exitRoom$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "showRoomInfomation$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "receiveMessage$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "sendTextMsg$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "sendFileMsg$", void 0);
    tslib_1.__decorate([
        effects_1.Effect(),
        tslib_1.__metadata("design:type", rxjs_1.Observable)
    ], RoomEffect.prototype, "sendPicMsg$", void 0);
    RoomEffect = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [effects_1.Actions,
            store_1.Store,
            common_1.StorageService,
            common_1.ApiService])
    ], RoomEffect);
    return RoomEffect;
}());
exports.RoomEffect = RoomEffect;
;


/***/ }),

/***/ 820:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(821), exports);


/***/ }),

/***/ 821:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.roomInit = {
    actionType: 'init',
    voiceRoomState: [],
    roomList: [],
    active: {},
    roomDetail: {},
    enter: {
        id: -1
    },
    roomInfomation: {
        show: false,
        info: {}
    },
    messageList: [],
    imageViewer: [],
    newMessage: {},
    friendList: [],
    enterRoomLoading: false,
    showPanel: 0,
    noMoreRooms: false
};


/***/ }),

/***/ 822:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(823), exports);


/***/ }),

/***/ 823:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(222);
var actions_2 = __webpack_require__(90);
var model_1 = __webpack_require__(820);
var util_1 = __webpack_require__(72);
var actions_3 = __webpack_require__(107);
exports.roomReducer = function (state, _a) {
    if (state === void 0) { state = model_1.roomInit; }
    var type = _a.type, payload = _a.payload;
    state.actionType = type;
    switch (type) {
        case actions_2.mainAction.init:
            state = util_1.Util.deepCopyObj(model_1.roomInit);
            break;
        // 成功获取语音已读状态
        case actions_1.roomAction.getRoomVoiceStateSuccess:
            state.voiceRoomState = payload;
            break;
        // 成功获取聊天室列表
        case actions_1.roomAction.getRoomListSuccess:
            filterRepeatRoom(state, payload);
            break;
        // 切换聊天室
        case actions_1.roomAction.changeRoomSuccess:
            state.active = payload.active;
            state.roomDetail = payload.info;
            state.messageList = [];
            break;
        // 进入聊天室
        case actions_1.roomAction.enterRoom:
            state.enterRoomLoading = true;
            break;
        // 成功进入聊天室
        case actions_1.roomAction.enterRoomSuccess:
            if (state.active.id === payload.id) {
                state.enter = payload;
            }
            state.enterRoomLoading = false;
            state.messageList = [];
            break;
        // 进入聊天室失败
        case actions_1.roomAction.enterRoomError:
            state.enterRoomLoading = false;
            break;
        // 成功退出聊天室
        case actions_1.roomAction.exitRoomSuccess:
            state.enter = {
                id: -1
            };
            state.imageViewer = [];
            break;
        // 显示聊天室信息
        case actions_1.roomAction.showRoomInfomationSuccess:
            state.roomInfomation = payload;
            break;
        // 成功收到聊天室信息
        case actions_1.roomAction.receiveMessageSuccess:
            addMessage(state, payload);
            state.newMessage = payload;
            break;
        // 收到聊天室信息加载信息的media_url成功
        case actions_1.roomAction.receiveMessageUrlSuccess:
            filterImageViewer(state, payload);
            break;
        // 发送聊天室消息
        case actions_1.roomAction.sendTextMsg:
        case actions_1.roomAction.sendFileMsg:
        case actions_1.roomAction.sendPicMsg:
        case actions_1.roomAction.transmitPicMsg:
            if (!payload.repeatSend) {
                addMessage(state, payload.localMsg);
                filterImageViewer(state, payload.localMsg);
            }
            break;
        // 完成聊天室消息的发送
        case actions_1.roomAction.sendMsgComplete:
            sendMsgComplete(state, payload);
            break;
        // 搜索聊天室ID，点击进入某聊天室
        case actions_2.mainAction.selectSearchRoomUser:
            addRoomToList(state, payload);
            break;
        // 传递好友列表
        case actions_3.chatAction.dispatchFriendList:
            state.friendList = payload;
            break;
        // 显示聊天室状态
        case actions_1.roomAction.showPanel:
            state.showPanel = payload;
            break;
        // 切换左侧tab
        case actions_2.mainAction.changeListTab:
            if (payload !== 2) {
                state.messageList = [];
            }
            break;
        default:
    }
    return state;
};
// 过滤重复的聊天室，并添加到聊天室列表中
function filterRepeatRoom(state, payload) {
    if (payload.length > 0) {
        var newPayload = [];
        for (var _i = 0, payload_1 = payload; _i < payload_1.length; _i++) {
            var newRoom = payload_1[_i];
            var flag = true;
            for (var _a = 0, _b = state.roomList; _a < _b.length; _a++) {
                var room = _b[_a];
                if (newRoom.id === room.id) {
                    flag = false;
                    break;
                }
            }
            if (flag) {
                newPayload.push(newRoom);
            }
        }
        state.roomList = state.roomList.concat(newPayload);
    }
    else {
        state.noMoreRooms = true;
    }
}
// 添加消息到消息列表
function addMessage(state, payload) {
    // 判断消息是否要显示时间
    if (state.messageList.length === 0) {
        payload.time_show = util_1.Util.reducerDate(payload.ctime_ms);
    }
    else {
        var fiveMinutes = util_1.Util.fiveMinutes(state.messageList[state.messageList.length - 1].ctime_ms, payload.ctime_ms);
        if (fiveMinutes) {
            payload.time_show = util_1.Util.reducerDate(payload.ctime_ms);
        }
    }
    // 初始化语音动画和未读状态
    if (payload.content.msg_type === 'voice') {
        payload.content.playing = false;
        payload.content.havePlay = false;
        for (var _i = 0, _a = state.voiceRoomState; _i < _a.length; _i++) {
            var voice = _a[_i];
            if (Number(voice.id) === Number(payload.room_id) &&
                Number(voice.msgId) === Number(payload.msg_id)) {
                payload.content.havePlay = true;
                break;
            }
        }
        payload.content.load = 0;
    }
    // 初始化小视频动画
    if (payload.content.msg_type === 'file' && payload.content.msg_body.extras &&
        payload.content.msg_body.extras.video) {
        payload.content.load = 0;
        payload.content.range = 0;
    }
    for (var _b = 0, _c = state.friendList; _b < _c.length; _b++) {
        var friend = _c[_b];
        if (friend.username === payload.content.from_id &&
            friend.appkey === payload.content.from_appkey) {
            if (friend.memo_name) {
                payload.content.memo_name = friend.memo_name;
            }
            break;
        }
    }
    state.messageList.push(payload);
}
// 完成消息发送（失败或者成功）
function sendMsgComplete(state, payload) {
    for (var i = state.messageList.length - 1; i >= 0; i--) {
        if (payload.localMsg.msgKey === state.messageList[i].msgKey) {
            state.messageList[i].success = payload.localMsg.success;
            if (payload.msg) {
                var url = void 0;
                var loading = void 0;
                var extras = void 0;
                if (state.messageList[i].content.msg_body.media_url) {
                    url = state.messageList[i].content.msg_body.media_url;
                    loading = state.messageList[i].content.msg_body.loading;
                }
                if (state.messageList[i].content.msg_body.extras) {
                    extras = state.messageList[i].content.msg_body.extras;
                }
                state.messageList[i].content.msg_body = payload.msg.content.msg_body;
                if (url) {
                    state.messageList[i].content.msg_body.media_url = url;
                    state.messageList[i].content.msg_body.loading = loading;
                }
                if (extras) {
                    state.messageList[i].content.msg_body.extras = extras;
                }
            }
            break;
        }
    }
}
// 过滤出当前图片预览的数组
function filterImageViewer(state, payload) {
    var content = payload.content;
    var jpushEmoji = (!content.msg_body.extras || !content.msg_body.extras.kLargeEmoticon
        || content.msg_body.extras.kLargeEmoticon !== 'kLargeEmoticon');
    if (content.msg_type === 'image' && jpushEmoji) {
        var view = {
            mediaId: content.msg_body.media_id,
            src: content.msg_body.media_url,
            width: content.msg_body.width,
            height: content.msg_body.height
        };
        if (payload.msg_id) {
            view.msg_id = payload.msg_id;
        }
        else if (payload.msgKey) {
            view.msgKey = payload.msgKey;
        }
        state.imageViewer.push(view);
    }
}
// 搜索聊天室查看资料
function addRoomToList(state, payload) {
    if (payload.id === state.enter.id) {
        return;
    }
    state.showPanel = 1;
    var flag = false;
    for (var i = 0; i < state.roomList.length; i++) {
        if (state.roomList[i].id === payload.id) {
            var item = state.roomList.splice(i, 1)[0];
            state.roomList.unshift(item);
            flag = true;
            break;
        }
    }
    if (!flag) {
        state.roomList.unshift(payload);
    }
    state.active = payload;
    state.roomDetail = payload;
}


/***/ }),

/***/ 824:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var actions_1 = __webpack_require__(104);
var appInit = {
    actionType: '',
    errorApiTip: {},
    tipModal: {}
};
exports.appReducer = function (state, _a) {
    if (state === void 0) { state = appInit; }
    var type = _a.type, payload = _a.payload;
    state.actionType = type;
    switch (type) {
        case actions_1.appAction.errorApiTip:
            state.errorApiTip = payload;
            break;
        case actions_1.appAction.tipModal:
            state.tipModal = payload;
            break;
        default:
    }
    return state;
};


/***/ }),

/***/ 825:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(824), exports);


/***/ }),

/***/ 826:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
/**
 * emoji和jpush表情的配置
 */
exports.emojiConfig = [
    {
        imgNum: 1,
        text: '哈哈',
        unicode: '😄'
    },
    {
        imgNum: 2,
        text: '大笑',
        unicode: '😃'
    },
    {
        imgNum: 3,
        text: '开心',
        unicode: '😊'
    },
    {
        imgNum: 4,
        text: '你懂的',
        unicode: '😉'
    },
    {
        imgNum: 5,
        text: '好喜欢',
        unicode: '😍'
    },
    {
        imgNum: 6,
        text: '爱你',
        unicode: '😘'
    },
    {
        imgNum: 7,
        text: '亲亲',
        unicode: '😚'
    },
    {
        imgNum: 8,
        text: '扮鬼脸',
        unicode: '😜'
    },
    {
        imgNum: 9,
        text: '气死你',
        unicode: '😝'
    },
    {
        imgNum: 10,
        text: '啥意思',
        unicode: '😳'
    },
    {
        imgNum: 11,
        text: '嘿嘿',
        unicode: '😁'
    },
    {
        imgNum: 12,
        text: '对不起',
        unicode: '😔'
    },
    {
        imgNum: 13,
        text: '好吧',
        unicode: '😌'
    },
    {
        imgNum: 14,
        text: '嫌弃',
        unicode: '😒'
    },
    {
        imgNum: 15,
        text: '失望',
        unicode: '😞'
    },
    {
        imgNum: 16,
        text: '难受',
        unicode: '😣'
    },
    {
        imgNum: 17,
        text: '想哭',
        unicode: '😢'
    },
    {
        imgNum: 18,
        text: '笑哭',
        unicode: '😂'
    },
    {
        imgNum: 19,
        text: '大哭',
        unicode: '😭'
    },
    {
        imgNum: 20,
        text: '好困',
        unicode: '😪'
    },
    {
        imgNum: 21,
        text: '担心',
        unicode: '😥'
    },
    {
        imgNum: 22,
        text: '害怕',
        unicode: '😰'
    },
    {
        imgNum: 23,
        text: '汗',
        unicode: '😓'
    },
    {
        imgNum: 24,
        text: '不会吧',
        unicode: '😨'
    },
    {
        imgNum: 25,
        text: '天啊',
        unicode: '😱'
    },
    {
        imgNum: 26,
        text: '生气',
        unicode: '😠'
    },
    {
        imgNum: 27,
        text: '气死我了',
        unicode: '😡'
    },
    {
        imgNum: 28,
        text: '纠结',
        unicode: '😖'
    },
    {
        imgNum: 29,
        text: '生病了',
        unicode: '😷'
    },
    {
        imgNum: 30,
        text: '晕',
        unicode: '😲'
    },
    {
        imgNum: 31,
        text: '恶魔',
        unicode: '👿'
    },
    {
        imgNum: 32,
        text: '哼哼',
        unicode: '😏'
    },
    {
        imgNum: 33,
        text: '男孩',
        unicode: '👦'
    },
    {
        imgNum: 34,
        text: '女孩',
        unicode: '👧'
    },
    {
        imgNum: 35,
        text: '男人',
        unicode: '👨'
    },
    {
        imgNum: 36,
        text: '女人',
        unicode: '👩'
    },
    {
        imgNum: 37,
        text: '星星',
        unicode: '🌟'
    },
    {
        imgNum: 38,
        text: '红唇',
        unicode: '👄'
    },
    {
        imgNum: 39,
        text: '强',
        unicode: '👍'
    },
    {
        imgNum: 40,
        text: '垃圾',
        unicode: '👎'
    },
    {
        imgNum: 41,
        text: 'ok',
        unicode: '👌'
    },
    {
        imgNum: 42,
        text: '揍你',
        unicode: '👊'
    },
    {
        imgNum: 43,
        text: '宣誓',
        unicode: '✊'
    },
    {
        imgNum: 44,
        text: '胜利',
        unicode: '✌️'
    },
    {
        imgNum: 45,
        text: '向上',
        unicode: '👆'
    },
    {
        imgNum: 46,
        text: '向下',
        unicode: '👇'
    },
    {
        imgNum: 47,
        text: '向右',
        unicode: '👉'
    },
    {
        imgNum: 48,
        text: '向左',
        unicode: '👈'
    },
    {
        imgNum: 49,
        text: '拜托',
        unicode: '🙏'
    },
    {
        imgNum: 50,
        text: '鼓掌',
        unicode: '👏'
    },
    {
        imgNum: 51,
        text: '加油',
        unicode: '💪'
    },
    {
        imgNum: 52,
        text: '连衣裙',
        unicode: '👗'
    },
    {
        imgNum: 53,
        text: '丝带',
        unicode: '🎀'
    },
    {
        imgNum: 54,
        text: '爱心',
        unicode: '❤️'
    },
    {
        imgNum: 55,
        text: '心碎',
        unicode: '💔'
    },
    {
        imgNum: 56,
        text: '钻石',
        unicode: '💎'
    },
    {
        imgNum: 57,
        text: '狗狗',
        unicode: '🐶'
    },
    {
        imgNum: 58,
        text: '马',
        unicode: '🐺'
    },
    {
        imgNum: 59,
        text: '玫瑰',
        unicode: '🌹'
    },
    {
        imgNum: 60,
        text: '向日葵',
        unicode: '🌻'
    },
    {
        imgNum: 61,
        text: '枫叶',
        unicode: '🍁'
    },
    {
        imgNum: 62,
        text: '叶子',
        unicode: '🍃'
    },
    {
        imgNum: 63,
        text: '月亮',
        unicode: '🌙'
    },
    {
        imgNum: 64,
        text: '太阳',
        unicode: '☀️'
    },
    {
        imgNum: 65,
        text: '云朵',
        unicode: '☁️'
    },
    {
        imgNum: 66,
        text: '闪电',
        unicode: '⚡️'
    },
    {
        imgNum: 67,
        text: '下雨',
        unicode: '☔️'
    },
    {
        imgNum: 68,
        text: '幽灵',
        unicode: '👻'
    },
    {
        imgNum: 69,
        text: '圣诞老人',
        unicode: '🎅'
    },
    {
        imgNum: 70,
        text: '礼物',
        unicode: '🎁'
    },
    {
        imgNum: 71,
        text: '手机',
        unicode: '📱'
    },
    {
        imgNum: 72,
        text: '放大镜',
        unicode: '🔍'
    },
    {
        imgNum: 73,
        text: '炸弹',
        unicode: '💣'
    },
    {
        imgNum: 74,
        text: '足球',
        unicode: '⚽️'
    },
    {
        imgNum: 75,
        text: '咖啡',
        unicode: '☕️'
    },
    {
        imgNum: 76,
        text: '啤酒',
        unicode: '🍺'
    },
    {
        imgNum: 77,
        text: '蛋糕',
        unicode: '🎂'
    },
    {
        imgNum: 78,
        text: '家',
        unicode: '🏠'
    },
    {
        imgNum: 79,
        text: '汽车',
        unicode: '🚗'
    },
    {
        imgNum: 80,
        text: '时钟',
        unicode: '🕚'
    },
    {
        imgNum: 81,
        text: '乘',
        unicode: '✖️'
    },
    {
        imgNum: 82,
        text: '加',
        unicode: '➕'
    },
    {
        imgNum: 83,
        text: '减',
        unicode: '➖'
    },
    {
        imgNum: 84,
        text: '除',
        unicode: '➗'
    },
    {
        imgNum: 85,
        text: '黑桃',
        unicode: '♠️'
    },
    {
        imgNum: 86,
        text: '红心',
        unicode: '♥️'
    },
    {
        imgNum: 87,
        text: '梅花',
        unicode: '♣️'
    },
    {
        imgNum: 88,
        text: '方块',
        unicode: '♦️'
    },
    {
        imgNum: 89,
        text: '100分',
        unicode: '💯'
    },
    {
        imgNum: 90,
        text: '正确',
        unicode: '✔️'
    },
    {
        imgNum: 91,
        text: '1',
        unicode: '1️⃣ '
    },
    {
        imgNum: 92,
        text: '2',
        unicode: '2️⃣ '
    },
    {
        imgNum: 93,
        text: '3',
        unicode: '3️⃣ '
    },
    {
        imgNum: 94,
        text: '4',
        unicode: '4️⃣ '
    },
    {
        imgNum: 95,
        text: '5',
        unicode: '5️⃣ '
    },
    {
        imgNum: 96,
        text: '6',
        unicode: '6️⃣ '
    },
    {
        imgNum: 97,
        text: '7',
        unicode: '7️⃣ '
    },
    {
        imgNum: 98,
        text: '8',
        unicode: '8️⃣ '
    },
    {
        imgNum: 99,
        text: '9',
        unicode: '9️⃣ '
    },
    {
        imgNum: 100,
        text: '0',
        unicode: '0️⃣ '
    },
    {
        imgNum: 101,
        text: '10',
        unicode: '🔟'
    },
    {
        imgNum: 102,
        text: '向上箭头',
        unicode: '⬆️'
    },
    {
        imgNum: 103,
        text: '向下箭头',
        unicode: '⬇️'
    },
    {
        imgNum: 104,
        text: '向左箭头',
        unicode: '⬅️'
    },
    {
        imgNum: 105,
        text: '向右箭头',
        unicode: '➡️'
    }
];
exports.jpushConfig = [
    {
        imgNum: 1,
        text: '呆萌',
        body: {
            format: 'png',
            fsize: 4533,
            height: 240,
            media_crc32: 3826496946,
            media_id: 'qiniu/image/j/49F4CA80FE6618A5498395ACBE5336C3.png',
            media_url: '/im/assets/images/jpush/1.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 2,
        text: '卡哇伊',
        body: {
            format: 'png',
            fsize: 4361,
            height: 240,
            media_crc32: 3451102955,
            media_id: 'qiniu/image/j/DEE03EC68B503894CECE3D7C39A32A76.png',
            media_url: '/im/assets/images/jpush/2.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 3,
        text: '笑哭',
        body: {
            format: 'png',
            fsize: 5562,
            height: 240,
            media_crc32: 3443401120,
            media_id: 'qiniu/image/j/2A823835941E299030EFBB76BA61DEB9.png',
            media_url: '/im/assets/images/jpush/3.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 4,
        text: '羞哒哒',
        body: {
            format: 'png',
            fsize: 4652,
            height: 240,
            loading: false,
            media_crc32: 204009172,
            media_id: 'qiniu/image/j/14989C47D386B83B81693EC15238449D.png',
            media_url: '/im/assets/images/jpush/4.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 5,
        text: '闪瞎',
        body: {
            format: 'png',
            fsize: 4939,
            height: 240,
            loading: true,
            media_crc32: 2707415862,
            media_id: 'qiniu/image/j/3453D5E7A86C9670BF89ED909E1E45AE.png',
            media_url: '/im/assets/images/jpush/5.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 6,
        text: '什么情况',
        body: {
            format: 'png',
            fsize: 4282,
            height: 240,
            loading: true,
            media_crc32: 1493882954,
            media_id: 'qiniu/image/j/4830861763123894377B07CD9B1C3CB5.png',
            media_url: '/im/assets/images/jpush/6.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 7,
        text: '怒气冲天',
        body: {
            format: 'png',
            fsize: 4998,
            height: 240,
            loading: true,
            media_crc32: 2771693272,
            media_id: 'qiniu/image/j/49DA482A7D3F08CF573E854AF7D5A3B2.png',
            media_url: '/im/assets/images/jpush/7.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 8,
        text: '吓屁了',
        body: {
            format: 'png',
            fsize: 5197,
            height: 240,
            loading: true,
            media_crc32: 1367212027,
            media_id: 'qiniu/image/j/490BCFE731CD9D319470EE8D24E9F66A.png',
            media_url: '/im/assets/images/jpush/8.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 9,
        text: '额~尴尬了',
        body: {
            format: 'png',
            fsize: 4117,
            height: 240,
            loading: true,
            media_crc32: 3673668983,
            media_id: 'qiniu/image/j/F413E2901AAAF7E68193C4F2767BEFF9.png',
            media_url: '/im/assets/images/jpush/9.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 10,
        text: '哭泣',
        body: {
            format: 'png',
            fsize: 5169,
            height: 240,
            loading: true,
            media_crc32: 1315062665,
            media_id: 'qiniu/image/j/E6330019D6F2F946E74E72DB919505E1.png',
            media_url: '/im/assets/images/jpush/10.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 11,
        text: '流汗',
        body: {
            format: 'png',
            fsize: 4411,
            height: 240,
            loading: true,
            media_crc32: 682350010,
            media_id: 'qiniu/image/j/133995E3B7B76080CAB6A7D26C701F7F.png',
            media_url: '/im/assets/images/jpush/11.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 12,
        text: '懵逼了',
        body: {
            format: 'png',
            fsize: 4676,
            height: 240,
            loading: true,
            media_crc32: 2392144957,
            media_id: 'qiniu/image/j/68C0F3E67E0E4E840D4E5850575C2FBE.png',
            media_url: '/im/assets/images/jpush/12.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 13,
        text: '笑死',
        body: {
            format: 'png',
            fsize: 5012,
            height: 240,
            loading: true,
            media_crc32: 3623582020,
            media_id: 'qiniu/image/j/321E3C8BB73B3AD584FB9F64A89B0E1F.png',
            media_url: '/im/assets/images/jpush/13.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 14,
        text: '约会周公',
        body: {
            format: 'png',
            fsize: 4393,
            height: 240,
            loading: true,
            media_crc32: 1454796791,
            media_id: 'qiniu/image/j/6BF3CDDD3849B5E8B7C1E1648D8CD1E9.png',
            media_url: '/im/assets/images/jpush/14.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 15,
        text: '哼哼哈嘿',
        body: {
            format: 'png',
            fsize: 5157,
            height: 240,
            loading: true,
            media_crc32: 2876362587,
            media_id: 'qiniu/image/j/F7353A0162D0A5E91CB2CE19C20FF176.png',
            media_url: '/im/assets/images/jpush/15.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 16,
        text: '我是老大',
        body: {
            format: 'png',
            fsize: 4882,
            height: 240,
            loading: true,
            media_crc32: 2056303917,
            media_id: 'qiniu/image/j/8C1D7A5590BD53B3FBEB4C54196873C8.png',
            media_url: '/im/assets/images/jpush/16.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 17,
        text: '嘴儿一个',
        body: {
            format: 'png',
            fsize: 4684,
            height: 240,
            loading: true,
            media_crc32: 3617721261,
            media_id: 'qiniu/image/j/28A4148B84584B542C7AA2F28902D619.png',
            media_url: '/im/assets/images/jpush/17.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 18,
        text: '看我大白眼',
        body: {
            format: 'png',
            fsize: 4591,
            height: 240,
            loading: true,
            media_crc32: 3703220224,
            media_id: 'qiniu/image/j/60B4C128E7B2DF0E8893BE0B2C6FCAF7.png',
            media_url: '/im/assets/images/jpush/18.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 19,
        text: '邪恶',
        body: {
            format: 'png',
            fsize: 5555,
            height: 240,
            loading: true,
            media_crc32: 3903917023,
            media_id: 'qiniu/image/j/93F5C6A5E4192817218C84230F42C528.png',
            media_url: '/im/assets/images/jpush/19.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 20,
        text: '32个赞',
        body: {
            format: 'png',
            fsize: 5478,
            height: 240,
            loading: true,
            media_crc32: 1300923030,
            media_id: 'qiniu/image/j/BD43FA9BC130EC7D2994446FBF6C3985.png',
            media_url: '/im/assets/images/jpush/20.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 21,
        text: '拜拜了您的',
        body: {
            format: 'png',
            fsize: 5599,
            height: 240,
            loading: true,
            media_crc32: 3165375826,
            media_id: 'qiniu/image/j/118E97F05277755DB8A48403BE7DD302.png',
            media_url: '/im/assets/images/jpush/21.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 22,
        text: '哇~红包',
        body: {
            format: 'png',
            fsize: 5988,
            height: 240,
            loading: true,
            media_crc32: 232147965,
            media_id: 'qiniu/image/j/47C8CF846603D31687B08B20ED42AC29.png',
            media_url: '/im/assets/images/jpush/22.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 23,
        text: '冻人不美丽',
        body: {
            format: 'png',
            fsize: 6438,
            height: 240,
            loading: true,
            media_crc32: 1228539628,
            media_id: 'qiniu/image/j/29D3BD633FF812048A2CAD8965B8194E.png',
            media_url: '/im/assets/images/jpush/23.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    },
    {
        imgNum: 24,
        text: '呆若木鸡',
        body: {
            format: 'png',
            fsize: 4668,
            height: 240,
            loading: true,
            media_crc32: 4265504358,
            media_id: 'qiniu/image/j/50E0597DB7761F9353DDE658D8837D9C.png',
            media_url: '/im/assets/images/jpush/24.png',
            width: 240,
            extras: {
                kLargeEmoticon: 'kLargeEmoticon'
            }
        }
    }
];


/***/ }),

/***/ 827:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
var core_1 = __webpack_require__(1);
var router_1 = __webpack_require__(89);
var storage_service_1 = __webpack_require__(447);
var global_1 = __webpack_require__(158);
var config_1 = __webpack_require__(445);
var tools_1 = __webpack_require__(160);
var util_1 = __webpack_require__(72);
var signature_service_1 = __webpack_require__(446);
var api_service_1 = __webpack_require__(444);
/**
 * main路由的路由守卫服务
 */
var MainCanActivate = /** @class */ (function () {
    function MainCanActivate(router, storageService, signatureService, apiService) {
        this.router = router;
        this.storageService = storageService;
        this.signatureService = signatureService;
        this.apiService = apiService;
        this.username = '';
        this.password = '';
    }
    MainCanActivate.prototype.canActivate = function () {
        var _this = this;
        // 如果是从登陆界面跳转过来的就直接return true
        if (window.location.href.match(/\/login$/g)) {
            return true;
        }
        // 不是从登陆界面跳转过来的，如刷新时或者是关闭窗口五分钟内重新打开则自动登录
        var storageUsername = this.storageService.get(tools_1.md5('afterFiveMinutes-username'), true);
        var storagePassword = this.storageService.get(tools_1.md5('afterFiveMinutes-password'), true);
        if (storageUsername && storagePassword) {
            this.username = storageUsername;
            this.password = storagePassword;
            return new Promise(function (resolve, reject) {
                _this.JIMInit(resolve);
            });
        }
        else {
            this.router.navigate(['/login']);
            return false;
        }
    };
    MainCanActivate.prototype.JIMInit = function (resolve) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var timestamp, signature, data_1, initObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        timestamp = new Date().getTime();
                        if (!config_1.authPayload.isFrontSignature) return [3 /*break*/, 1];
                        // 使用jchat demo自身的签名
                        if (config_1.authPayload.masterSecret.length === 0) {
                            signature = config_1.demoInitConfig.signature;
                            timestamp = config_1.demoInitConfig.timestamp;
                            // 开发者配置前端生成签名
                        }
                        else {
                            signature = util_1.Util.createSignature(timestamp);
                        }
                        return [3 /*break*/, 3];
                    case 1:
                        data_1 = {
                            timestamp: timestamp,
                            appkey: config_1.authPayload.appkey,
                            randomStr: config_1.authPayload.randomStr
                        };
                        return [4 /*yield*/, this.signatureService.requestSignature(config_1.authPayload.signatureApiUrl, data_1)];
                    case 2:
                        signature = _a.sent();
                        _a.label = 3;
                    case 3:
                        initObj = {
                            appkey: config_1.authPayload.appkey,
                            random_str: config_1.authPayload.randomStr,
                            signature: signature,
                            timestamp: timestamp,
                            flag: config_1.authPayload.flag
                        };
                        return [4 /*yield*/, this.apiService.init(initObj)];
                    case 4:
                        data = _a.sent();
                        if (data.code) {
                            resolve(false);
                        }
                        else {
                            this.autoLogin(resolve);
                        }
                        return [2 /*return*/];
                }
            }));
        }));
    };
    MainCanActivate.prototype.autoLogin = function (resolve) {
        return tslib_1.__awaiter(this, void 0, void 0, (function () {
            var loginObj, data;
            return tslib_1.__generator(this, (function (_a) {
                switch (_a.label) {
                    case 0:
                        loginObj = {
                            username: this.username,
                            password: this.password,
                            is_md5: true
                        };
                        return [4 /*yield*/, this.apiService.login(loginObj)];
                    case 1:
                        data = _a.sent();
                        if (data.code) {
                            resolve(false);
                        }
                        else {
                            global_1.global.user = data.username;
                            global_1.global.password = this.password;
                            resolve(true);
                        }
                        return [2 /*return*/];
                }
            }));
        }));
    };
    MainCanActivate = tslib_1.__decorate([
        core_1.Injectable(),
        tslib_1.__metadata("design:paramtypes", [router_1.Router,
            storage_service_1.StorageService,
            signature_service_1.SignatureService,
            api_service_1.ApiService])
    ], MainCanActivate);
    return MainCanActivate;
}());
exports.MainCanActivate = MainCanActivate;


/***/ }),

/***/ 828:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var rxjs_1 = __webpack_require__(43);
// 预加载
var PreloadService = /** @class */ (function () {
    function PreloadService() {
    }
    PreloadService.prototype.preload = function (route, load) {
        return route.data && route.data.preload ? load() : rxjs_1.Observable.of(null);
    };
    return PreloadService;
}());
exports.PreloadService = PreloadService;


/***/ }),

/***/ 829:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var common_1 = __webpack_require__(28);
/**
 * emoji表情与unicode之间相互转化的类
 */
var Emoji = /** @class */ (function () {
    function Emoji() {
    }
    /**
     * 将原始表情转化成带有unicode编码路径的图片
     * params text 需要被转化的的unicode
     * return 转化好的字符串string
     */
    Emoji.emoji = function (text, fontSize) {
        // 在第一次调用的时候检查浏览器是否支持emoji符号
        var isSupportEmoji = false;
        var UA = navigator.userAgent;
        if (UA.match(/Mac\s+OS/i) && !UA.match(/(Chrome|Firefox)/i)) {
            isSupportEmoji = true;
        }
        // 如果浏览器支持原生的emoji，无需转换，去除两边空格
        return isSupportEmoji ? text.trim() : this.trans(text, fontSize);
    };
    Emoji.trans = function (text, fontSize) {
        var _this = this;
        text = text.replace(this.reg, (function (code) {
            return "<img width='" + fontSize + "' class=\"emoji\"\n                    src=\"" + common_1.imgRouter + _this._escapeToUtf32(code) + ".png\">";
        }));
        return text;
    };
    // 编码转换
    Emoji._escapeToUtf32 = function (str) {
        var escaped = [];
        var unicodeCodes = this._convertStringToUnicodeCodePoints(str);
        var i = 0;
        var l = unicodeCodes.length;
        var hex;
        for (; i < l; i++) {
            hex = unicodeCodes[i].toString(16);
            escaped.push('0000'.substr(hex.length) + hex);
        }
        return escaped.join('-');
    };
    Emoji._convertStringToUnicodeCodePoints = function (str) {
        var surrogate1st = 0;
        var unicodeCodes = [];
        var i = 0;
        var l = str.length;
        for (; i < l; i++) {
            var utf16Code = str.charCodeAt(i);
            if (Number(surrogate1st) !== 0) {
                if (utf16Code >= 0xDC00 && utf16Code <= 0xDFFF) {
                    var surrogate2nd = utf16Code;
                    var unicodeCode = (surrogate1st - 0xD800) * (1 << 10) + (1 << 16) + (surrogate2nd - 0xDC00);
                    unicodeCodes.push(unicodeCode);
                }
                surrogate1st = 0;
            }
            else if (utf16Code >= 0xD800 && utf16Code <= 0xDBFF) {
                surrogate1st = utf16Code;
            }
            else {
                unicodeCodes.push(utf16Code);
            }
        }
        return unicodeCodes;
    };
    /**
     * 将unicode转化成原始表情
     * params unicode
     * return string原始表情
     */
    Emoji.convert = function (unicode) {
        if (unicode.indexOf('-') > -1) {
            var parts = [];
            var s = unicode.split('-');
            for (var _i = 0, s_1 = s; _i < s_1.length; _i++) {
                var item = s_1[_i];
                var part = parseInt(item, 16);
                if (part >= 0x10000 && part <= 0x10FFFF) {
                    var hi = Math.floor((part - 0x10000) / 0x400) + 0xD800;
                    var lo = ((part - 0x10000) % 0x400) + 0xDC00;
                    part = (String.fromCharCode(hi) + String.fromCharCode(lo));
                }
                else {
                    part = String.fromCharCode(part);
                }
                parts.push(part);
            }
            return parts.join('');
        }
        else {
            var s = parseInt(unicode, 16);
            if (s >= 0x10000 && s <= 0x10FFFF) {
                var hi = Math.floor((s - 0x10000) / 0x400) + 0xD800;
                var lo = ((s - 0x10000) % 0x400) + 0xDC00;
                return (String.fromCharCode(hi) + String.fromCharCode(lo));
            }
            else {
                return String.fromCharCode(s);
            }
        }
    };
    Emoji.reg = /\ud83d\ude04|\ud83d\ude03|\ud83d\ude00|\ud83d\ude0a|\u263a\ufe0f|\ud83d\ude09|\ud83d\ude0d|\ud83d\ude18|\ud83d\ude1a|\ud83d\ude17|\ud83d\ude19|\ud83d\ude1c|\ud83d\ude1d|\ud83d\ude1b|\ud83d\ude33|\ud83d\ude01|\ud83d\ude14|\ud83d\ude0c|\ud83d\ude12|\ud83d\ude1e|\ud83d\ude23|\ud83d\ude22|\ud83d\ude02|\ud83d\ude2d|\ud83d\ude2a|\ud83d\ude25|\ud83d\ude30|\ud83d\ude05|\ud83d\ude13|\ud83d\ude29|\ud83d\ude2b|\ud83d\ude28|\ud83d\ude31|\ud83d\ude20|\ud83d\ude21|\ud83d\ude24|\ud83d\ude16|\ud83d\ude06|\ud83d\ude0b|\ud83d\ude37|\ud83d\ude0e|\ud83d\ude34|\ud83d\ude35|\ud83d\ude32|\ud83d\ude1f|\ud83d\ude26|\ud83d\ude27|\ud83d\ude08|\ud83d\udc7f|\ud83d\ude2e|\ud83d\ude2c|\ud83d\ude10|\ud83d\ude15|\ud83d\ude2f|\ud83d\ude36|\ud83d\ude07|\ud83d\ude0f|\ud83d\ude11|\ud83d\udc72|\ud83d\udc73|\ud83d\udc6e|\ud83d\udc77|\ud83d\udc82|\ud83d\udc76|\ud83d\udc66|\ud83d\udc67|\ud83d\udc68|\ud83d\udc69|\ud83d\udc74|\ud83d\udc75|\ud83d\udc71|\ud83d\udc7c|\ud83d\udc78|\ud83d\ude3a|\ud83d\ude38|\ud83d\ude3b|\ud83d\ude3d|\ud83d\ude3c|\ud83d\ude40|\ud83d\ude3f|\ud83d\ude39|\ud83d\ude3e|\ud83d\udc79|\ud83d\udc7a|\ud83d\ude48|\ud83d\ude49|\ud83d\ude4a|\ud83d\udc80|\ud83d\udc7d|\ud83d\udca9|\ud83d\udd25|\u2728|\ud83c\udf1f|\ud83d\udcab|\ud83d\udca5|\ud83d\udca2|\ud83d\udca6|\ud83d\udca7|\ud83d\udca4|\ud83d\udca8|\ud83d\udc42|\ud83d\udc40|\ud83d\udc43|\ud83d\udc45|\ud83d\udc44|\ud83d\udc4d|\ud83d\udc4e|\ud83d\udc4c|\ud83d\udc4a|\u270a|\u270c\ufe0f|\ud83d\udc4b|\u270b|\ud83d\udc50|\ud83d\udc46|\ud83d\udc47|\ud83d\udc49|\ud83d\udc48|\ud83d\ude4c|\ud83d\ude4f|\u261d\ufe0f|\ud83d\udc4f|\ud83d\udcaa|\ud83d\udeb6|\ud83c\udfc3|\ud83d\udc83|\ud83d\udc6b|\ud83d\udc6a|\ud83d\udc6c|\ud83d\udc6d|\ud83d\udc8f|\ud83d\udc91|\ud83d\udc6f|\ud83d\ude46|\ud83d\ude45|\ud83d\udc81|\ud83d\ude4b|\ud83d\udc86|\ud83d\udc87|\ud83d\udc85|\ud83d\udc70|\ud83d\ude4e|\ud83d\ude4d|\ud83d\ude47|\ud83c\udfa9|\ud83d\udc51|\ud83d\udc52|\ud83d\udc5f|\ud83d\udc5e|\ud83d\udc61|\ud83d\udc60|\ud83d\udc62|\ud83d\udc55|\ud83d\udc54|\ud83d\udc5a|\ud83d\udc57|\ud83c\udfbd|\ud83d\udc56|\ud83d\udc58|\ud83d\udc59|\ud83d\udcbc|\ud83d\udc5c|\ud83d\udc5d|\ud83d\udc5b|\ud83d\udc53|\ud83c\udf80|\ud83c\udf02|\ud83d\udc84|\ud83d\udc9b|\ud83d\udc99|\ud83d\udc9c|\ud83d\udc9a|\u2764\ufe0f|\ud83d\udc94|\ud83d\udc97|\ud83d\udc93|\ud83d\udc95|\ud83d\udc96|\ud83d\udc9e|\ud83d\udc98|\ud83d\udc8c|\ud83d\udc8b|\ud83d\udc8d|\ud83d\udc8e|\ud83d\udc64|\ud83d\udc65|\ud83d\udcac|\ud83d\udc63|\ud83d\udcad|\ud83d\udc36|\ud83d\udc3a|\ud83d\udc31|\ud83d\udc2d|\ud83d\udc39|\ud83d\udc30|\ud83d\udc38|\ud83d\udc2f|\ud83d\udc28|\ud83d\udc3b|\ud83d\udc37|\ud83d\udc3d|\ud83d\udc2e|\ud83d\udc17|\ud83d\udc35|\ud83d\udc12|\ud83d\udc34|\ud83d\udc11|\ud83d\udc18|\ud83d\udc3c|\ud83d\udc27|\ud83d\udc26|\ud83d\udc24|\ud83d\udc25|\ud83d\udc23|\ud83d\udc14|\ud83d\udc0d|\ud83d\udc22|\ud83d\udc1b|\ud83d\udc1d|\ud83d\udc1c|\ud83d\udc1e|\ud83d\udc0c|\ud83d\udc19|\ud83d\udc1a|\ud83d\udc20|\ud83d\udc1f|\ud83d\udc2c|\ud83d\udc33|\ud83d\udc0b|\ud83d\udc04|\ud83d\udc0f|\ud83d\udc00|\ud83d\udc03|\ud83d\udc05|\ud83d\udc07|\ud83d\udc09|\ud83d\udc0e|\ud83d\udc10|\ud83d\udc13|\ud83d\udc15|\ud83d\udc16|\ud83d\udc01|\ud83d\udc02|\ud83d\udc32|\ud83d\udc21|\ud83d\udc0a|\ud83d\udc2b|\ud83d\udc2a|\ud83d\udc06|\ud83d\udc08|\ud83d\udc29|\ud83d\udc3e|\ud83d\udc90|\ud83c\udf38|\ud83c\udf37|\ud83c\udf40|\ud83c\udf39|\ud83c\udf3b|\ud83c\udf3a|\ud83c\udf41|\ud83c\udf43|\ud83c\udf42|\ud83c\udf3f|\ud83c\udf3e|\ud83c\udf44|\ud83c\udf35|\ud83c\udf34|\ud83c\udf32|\ud83c\udf33|\ud83c\udf30|\ud83c\udf31|\ud83c\udf3c|\ud83c\udf10|\ud83c\udf1e|\ud83c\udf1d|\ud83c\udf1a|\ud83c\udf11|\ud83c\udf12|\ud83c\udf13|\ud83c\udf14|\ud83c\udf15|\ud83c\udf16|\ud83c\udf17|\ud83c\udf18|\ud83c\udf1c|\ud83c\udf1b|\ud83c\udf19|\ud83c\udf0d|\ud83c\udf0e|\ud83c\udf0f|\ud83c\udf0b|\ud83c\udf0c|\ud83c\udf20|\u2b50\ufe0f|\u2600\ufe0f|\u26c5\ufe0f|\u2601\ufe0f|\u26a1\ufe0f|\u2614\ufe0f|\u2744\ufe0f|\u26c4\ufe0f|\ud83c\udf00|\ud83c\udf01|\ud83c\udf08|\ud83c\udf0a|\ud83c\udf8d|\ud83d\udc9d|\ud83c\udf8e|\ud83c\udf92|\ud83c\udf93|\ud83c\udf8f|\ud83c\udf86|\ud83c\udf87|\ud83c\udf90|\ud83c\udf91|\ud83c\udf83|\ud83d\udc7b|\ud83c\udf85|\ud83c\udf84|\ud83c\udf81|\ud83c\udf8b|\ud83c\udf89|\ud83c\udf8a|\ud83c\udf88|\ud83c\udf8c|\ud83d\udd2e|\ud83c\udfa5|\ud83d\udcf7|\ud83d\udcf9|\ud83d\udcfc|\ud83d\udcbf|\ud83d\udcc0|\ud83d\udcbd|\ud83d\udcbe|\ud83d\udcbb|\ud83d\udcf1|\u260e\ufe0f|\ud83d\udcde|\ud83d\udcdf|\ud83d\udce0|\ud83d\udce1|\ud83d\udcfa|\ud83d\udcfb|\ud83d\udd0a|\ud83d\udd09|\ud83d\udd08|\ud83d\udd07|\ud83d\udd14|\ud83d\udd15|\ud83d\udce2|\ud83d\udce3|\u23f3|\u231b\ufe0f|\u23f0|\u231a\ufe0f|\ud83d\udd13|\ud83d\udd12|\ud83d\udd0f|\ud83d\udd10|\ud83d\udd11|\ud83d\udd0e|\ud83d\udca1|\ud83d\udd26|\ud83d\udd06|\ud83d\udd05|\ud83d\udd0c|\ud83d\udd0b|\ud83d\udd0d|\ud83d\udec1|\ud83d\udec0|\ud83d\udebf|\ud83d\udebd|\ud83d\udd27|\ud83d\udd29|\ud83d\udd28|\ud83d\udeaa|\ud83d\udeac|\ud83d\udca3|\ud83d\udd2b|\ud83d\udd2a|\ud83d\udc8a|\ud83d\udc89|\ud83d\udcb0|\ud83d\udcb4|\ud83d\udcb5|\ud83d\udcb7|\ud83d\udcb6|\ud83d\udcb3|\ud83d\udcb8|\ud83d\udcf2|\ud83d\udce7|\ud83d\udce5|\ud83d\udce4|\u2709\ufe0f|\ud83d\udce9|\ud83d\udce8|\ud83d\udcef|\ud83d\udceb|\ud83d\udcea|\ud83d\udcec|\ud83d\udced|\ud83d\udcee|\ud83d\udce6|\ud83d\udcdd|\ud83d\udcc4|\ud83d\udcc3|\ud83d\udcd1|\ud83d\udcca|\ud83d\udcc8|\ud83d\udcc9|\ud83d\udcdc|\ud83d\udccb|\ud83d\udcc5|\ud83d\udcc6|\ud83d\udcc7|\ud83d\udcc1|\ud83d\udcc2|\u2702\ufe0f|\ud83d\udccc|\ud83d\udcce|\u2712\ufe0f|\u270f\ufe0f|\ud83d\udccf|\ud83d\udcd0|\ud83d\udcd5|\ud83d\udcd7|\ud83d\udcd8|\ud83d\udcd9|\ud83d\udcd3|\ud83d\udcd4|\ud83d\udcd2|\ud83d\udcda|\ud83d\udcd6|\ud83d\udd16|\ud83d\udcdb|\ud83d\udd2c|\ud83d\udd2d|\ud83d\udcf0|\ud83c\udfa8|\ud83c\udfac|\ud83c\udfa4|\ud83c\udfa7|\ud83c\udfbc|\ud83c\udfb5|\ud83c\udfb6|\ud83c\udfb9|\ud83c\udfbb|\ud83c\udfba|\ud83c\udfb7|\ud83c\udfb8|\ud83d\udc7e|\ud83c\udfae|\ud83c\udccf|\ud83c\udfb4|\ud83c\udc04\ufe0f|\ud83c\udfb2|\ud83c\udfaf|\ud83c\udfc8|\ud83c\udfc0|\u26bd\ufe0f|\u26be\ufe0f|\ud83c\udfbe|\ud83c\udfb1|\ud83c\udfc9|\ud83c\udfb3|\u26f3\ufe0f|\ud83d\udeb5|\ud83d\udeb4|\ud83c\udfc1|\ud83c\udfc7|\ud83c\udfc6|\ud83c\udfbf|\ud83c\udfc2|\ud83c\udfca|\ud83c\udfc4|\ud83c\udfa3|\u2615\ufe0f|\ud83c\udf75|\ud83c\udf76|\ud83c\udf7c|\ud83c\udf7a|\ud83c\udf7b|\ud83c\udf78|\ud83c\udf79|\ud83c\udf77|\ud83c\udf74|\ud83c\udf55|\ud83c\udf54|\ud83c\udf5f|\ud83c\udf57|\ud83c\udf56|\ud83c\udf5d|\ud83c\udf5b|\ud83c\udf64|\ud83c\udf71|\ud83c\udf63|\ud83c\udf65|\ud83c\udf59|\ud83c\udf58|\ud83c\udf5a|\ud83c\udf5c|\ud83c\udf72|\ud83c\udf62|\ud83c\udf61|\ud83c\udf73|\ud83c\udf5e|\ud83c\udf69|\ud83c\udf6e|\ud83c\udf66|\ud83c\udf68|\ud83c\udf67|\ud83c\udf82|\ud83c\udf70|\ud83c\udf6a|\ud83c\udf6b|\ud83c\udf6c|\ud83c\udf6d|\ud83c\udf6f|\ud83c\udf4e|\ud83c\udf4f|\ud83c\udf4a|\ud83c\udf4b|\ud83c\udf52|\ud83c\udf47|\ud83c\udf49|\ud83c\udf53|\ud83c\udf51|\ud83c\udf48|\ud83c\udf4c|\ud83c\udf50|\ud83c\udf4d|\ud83c\udf60|\ud83c\udf46|\ud83c\udf45|\ud83c\udf3d|\ud83c\udfe0|\ud83c\udfe1|\ud83c\udfeb|\ud83c\udfe2|\ud83c\udfe3|\ud83c\udfe5|\ud83c\udfe6|\ud83c\udfea|\ud83c\udfe9|\ud83c\udfe8|\ud83d\udc92|\u26ea\ufe0f|\ud83c\udfec|\ud83c\udfe4|\ud83c\udf07|\ud83c\udf06|\ud83c\udfef|\ud83c\udff0|\u26fa\ufe0f|\ud83c\udfed|\ud83d\uddfc|\ud83d\uddfe|\ud83d\uddfb|\ud83c\udf04|\ud83c\udf05|\ud83c\udf03|\ud83d\uddfd|\ud83c\udf09|\ud83c\udfa0|\ud83c\udfa1|\u26f2\ufe0f|\ud83c\udfa2|\ud83d\udea2|\u26f5\ufe0f|\ud83d\udea4|\ud83d\udea3|\u2693\ufe0f|\ud83d\ude80|\u2708\ufe0f|\ud83d\udcba|\ud83d\ude81|\ud83d\ude82|\ud83d\ude8a|\ud83d\ude89|\ud83d\ude9e|\ud83d\ude86|\ud83d\ude84|\ud83d\ude85|\ud83d\ude88|\ud83d\ude87|\ud83d\ude9d|\ud83d\ude8b|\ud83d\ude83|\ud83d\ude8e|\ud83d\ude8c|\ud83d\ude8d|\ud83d\ude99|\ud83d\ude98|\ud83d\ude97|\ud83d\ude95|\ud83d\ude96|\ud83d\ude9b|\ud83d\ude9a|\ud83d\udea8|\ud83d\ude93|\ud83d\ude94|\ud83d\ude92|\ud83d\ude91|\ud83d\ude90|\ud83d\udeb2|\ud83d\udea1|\ud83d\ude9f|\ud83d\udea0|\ud83d\ude9c|\ud83d\udc88|\ud83d\ude8f|\ud83c\udfab|\ud83d\udea6|\ud83d\udea5|\u26a0\ufe0f|\ud83d\udea7|\ud83d\udd30|\u26fd\ufe0f|\ud83c\udfee|\ud83c\udfb0|\u2668\ufe0f|\ud83d\uddff|\ud83c\udfaa|\ud83c\udfad|\ud83d\udccd|\ud83d\udea9|\ud83c\uddef\ud83c\uddf5|\ud83c\uddf0\ud83c\uddf7|\ud83c\udde9\ud83c\uddea|\ud83c\udde8\ud83c\uddf3|\ud83c\uddfa\ud83c\uddf8|\ud83c\uddeb\ud83c\uddf7|\ud83c\uddea\ud83c\uddf8|\ud83c\uddee\ud83c\uddf9|\ud83c\uddf7\ud83c\uddfa|\ud83c\uddec\ud83c\udde7|\u0031\ufe0f\u20e3|\u0032\ufe0f\u20e3|\u0033\ufe0f\u20e3|\u0034\ufe0f\u20e3|\u0035\ufe0f\u20e3|\u0036\ufe0f\u20e3|\u0037\ufe0f\u20e3|\u0038\ufe0f\u20e3|\u0039\ufe0f\u20e3|\u0030\ufe0f\u20e3|\ud83d\udd1f|\ud83d\udd22|\u0023\ufe0f\u20e3|\ud83d\udd23|\u2b06\ufe0f|\u2b07\ufe0f|\u2b05\ufe0f|\u27a1\ufe0f|\ud83d\udd20|\ud83d\udd21|\ud83d\udd24|\u2197\ufe0f|\u2196\ufe0f|\u2198\ufe0f|\u2199\ufe0f|\u2194\ufe0f|\u2195\ufe0f|\ud83d\udd04|\u25c0\ufe0f|\u25b6\ufe0f|\ud83d\udd3c|\ud83d\udd3d|\u21a9\ufe0f|\u21aa\ufe0f|\u2139\ufe0f|\u23ea|\u23e9|\u23eb|\u23ec|\u2935\ufe0f|\u2934\ufe0f|\ud83c\udd97|\ud83d\udd00|\ud83d\udd01|\ud83d\udd02|\ud83c\udd95|\ud83c\udd99|\ud83c\udd92|\ud83c\udd93|\ud83c\udd96|\ud83d\udcf6|\ud83c\udfa6|\ud83c\ude01|\ud83c\ude2f\ufe0f|\ud83c\ude33|\ud83c\ude35|\ud83c\ude34|\ud83c\ude32|\ud83c\ude50|\ud83c\ude39|\ud83c\ude3a|\ud83c\ude36|\ud83c\ude1a\ufe0f|\ud83d\udebb|\ud83d\udeb9|\ud83d\udeba|\ud83d\udebc|\ud83d\udebe|\ud83d\udeb0|\ud83d\udeae|\ud83c\udd7f\ufe0f|\u267f\ufe0f|\ud83d\udead|\ud83c\ude37|\ud83c\ude38|\ud83c\ude02|\u24c2\ufe0f|\ud83d\udec2|\ud83d\udec4|\ud83d\udec5|\ud83d\udec3|\ud83c\ude51|\u3299\ufe0f|\u3297\ufe0f|\ud83c\udd91|\ud83c\udd98|\ud83c\udd94|\ud83d\udeab|\ud83d\udd1e|\ud83d\udcf5|\ud83d\udeaf|\ud83d\udeb1|\ud83d\udeb3|\ud83d\udeb7|\ud83d\udeb8|\u26d4\ufe0f|\u2733\ufe0f|\u2747\ufe0f|\u274e|\u2705|\u2734\ufe0f|\ud83d\udc9f|\ud83c\udd9a|\ud83d\udcf3|\ud83d\udcf4|\ud83c\udd70|\ud83c\udd71|\ud83c\udd8e|\ud83c\udd7e|\ud83d\udca0|\u27bf|\u267b\ufe0f|\u2648\ufe0f|\u2649\ufe0f|\u264a\ufe0f|\u264b\ufe0f|\u264c\ufe0f|\u264d\ufe0f|\u264e\ufe0f|\u264f\ufe0f|\u2650\ufe0f|\u2651\ufe0f|\u2652\ufe0f|\u2653\ufe0f|\u26ce|\ud83d\udd2f|\ud83c\udfe7|\ud83d\udcb9|\ud83d\udcb2|\ud83d\udcb1|\u00a9|\u00ae|\u2122|\u274c|\u203c\ufe0f|\u2049\ufe0f|\u2757\ufe0f|\u2753|\u2755|\u2754|\u2b55\ufe0f|\ud83d\udd1d|\ud83d\udd1a|\ud83d\udd19|\ud83d\udd1b|\ud83d\udd1c|\ud83d\udd03|\ud83d\udd5b|\ud83d\udd67|\ud83d\udd50|\ud83d\udd5c|\ud83d\udd51|\ud83d\udd5d|\ud83d\udd52|\ud83d\udd5e|\ud83d\udd53|\ud83d\udd5f|\ud83d\udd54|\ud83d\udd60|\ud83d\udd55|\ud83d\udd56|\ud83d\udd57|\ud83d\udd58|\ud83d\udd59|\ud83d\udd5a|\ud83d\udd61|\ud83d\udd62|\ud83d\udd63|\ud83d\udd64|\ud83d\udd65|\ud83d\udd66|\u2716\ufe0f|\u2795|\u2796|\u2797|\u2660\ufe0f|\u2665\ufe0f|\u2663\ufe0f|\u2666\ufe0f|\ud83d\udcae|\ud83d\udcaf|\u2714\ufe0f|\u2611\ufe0f|\ud83d\udd18|\ud83d\udd17|\u27b0|\u3030|\u303d\ufe0f|\ud83d\udd31|\u25fc\ufe0f|\u25fb\ufe0f|\u25fe\ufe0f|\u25fd\ufe0f|\u25aa\ufe0f|\u25ab\ufe0f|\ud83d\udd3a|\ud83d\udd32|\ud83d\udd33|\u26ab\ufe0f|\u26aa\ufe0f|\ud83d\udd34|\ud83d\udd35|\ud83d\udd3b|\u2b1c\ufe0f|\u2b1b\ufe0f|\ud83d\udd36|\ud83d\udd37|\ud83d\udd38|\ud83d\udd39/g;
    return Emoji;
}());
exports.Emoji = Emoji;
;


/***/ }),

/***/ 830:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.md5 = function (string) {
    function RotateLeft(lValue, iShiftBits) {
        return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));
    }
    function AddUnsigned(lX, lY) {
        var lX4, lY4, lX8, lY8, lResult;
        lX8 = (lX & 0x80000000);
        lY8 = (lY & 0x80000000);
        lX4 = (lX & 0x40000000);
        lY4 = (lY & 0x40000000);
        lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
        if (lX4 & lY4) {
            return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
        }
        if (lX4 | lY4) {
            if (lResult & 0x40000000) {
                return (lResult ^ 0xC0000000 ^ lX8 ^ lY8);
            }
            else {
                return (lResult ^ 0x40000000 ^ lX8 ^ lY8);
            }
        }
        else {
            return (lResult ^ lX8 ^ lY8);
        }
    }
    function F(x, y, z) {
        return (x & y) | ((~x) & z);
    }
    function G(x, y, z) {
        return (x & z) | (y & (~z));
    }
    function H(x, y, z) {
        return (x ^ y ^ z);
    }
    function I(x, y, z) {
        return (y ^ (x | (~z)));
    }
    function FF(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(F(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    }
    ;
    function GG(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(G(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    }
    ;
    function HH(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(H(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    }
    ;
    function II(a, b, c, d, x, s, ac) {
        a = AddUnsigned(a, AddUnsigned(AddUnsigned(I(b, c, d), x), ac));
        return AddUnsigned(RotateLeft(a, s), b);
    }
    ;
    function ConvertToWordArray(string) {
        var lWordCount;
        var lMessageLength = string.length;
        var lNumberOfWords_temp1 = lMessageLength + 8;
        var lNumberOfWords_temp2 = (lNumberOfWords_temp1 - (lNumberOfWords_temp1 % 64)) / 64;
        var lNumberOfWords = (lNumberOfWords_temp2 + 1) * 16;
        var lWordArray = Array(lNumberOfWords - 1);
        var lBytePosition = 0;
        var lByteCount = 0;
        while (lByteCount < lMessageLength) {
            lWordCount = (lByteCount - (lByteCount % 4)) / 4;
            lBytePosition = (lByteCount % 4) * 8;
            lWordArray[lWordCount] = (lWordArray[lWordCount] | (string.charCodeAt(lByteCount) << lBytePosition));
            lByteCount++;
        }
        lWordCount = (lByteCount - (lByteCount % 4)) / 4;
        lBytePosition = (lByteCount % 4) * 8;
        lWordArray[lWordCount] = lWordArray[lWordCount] | (0x80 << lBytePosition);
        lWordArray[lNumberOfWords - 2] = lMessageLength << 3;
        lWordArray[lNumberOfWords - 1] = lMessageLength >>> 29;
        return lWordArray;
    }
    ;
    function WordToHex(lValue) {
        var WordToHexValue = "", WordToHexValue_temp = "", lByte, lCount;
        for (lCount = 0; lCount <= 3; lCount++) {
            lByte = (lValue >>> (lCount * 8)) & 255;
            WordToHexValue_temp = "0" + lByte.toString(16);
            WordToHexValue = WordToHexValue + WordToHexValue_temp.substr(WordToHexValue_temp.length - 2, 2);
        }
        return WordToHexValue;
    }
    ;
    function Utf8Encode(string) {
        string = string.replace(/\r\n/g, "\n");
        var utftext = "";
        for (var n = 0; n < string.length; n++) {
            var c = string.charCodeAt(n);
            if (c < 128) {
                utftext += String.fromCharCode(c);
            }
            else if ((c > 127) && (c < 2048)) {
                utftext += String.fromCharCode((c >> 6) | 192);
                utftext += String.fromCharCode((c & 63) | 128);
            }
            else {
                utftext += String.fromCharCode((c >> 12) | 224);
                utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                utftext += String.fromCharCode((c & 63) | 128);
            }
        }
        return utftext;
    }
    ;
    var x = Array();
    var k, AA, BB, CC, DD, a, b, c, d;
    var S11 = 7, S12 = 12, S13 = 17, S14 = 22;
    var S21 = 5, S22 = 9, S23 = 14, S24 = 20;
    var S31 = 4, S32 = 11, S33 = 16, S34 = 23;
    var S41 = 6, S42 = 10, S43 = 15, S44 = 21;
    string = Utf8Encode(string);
    x = ConvertToWordArray(string);
    a = 0x67452301;
    b = 0xEFCDAB89;
    c = 0x98BADCFE;
    d = 0x10325476;
    for (k = 0; k < x.length; k += 16) {
        AA = a;
        BB = b;
        CC = c;
        DD = d;
        a = FF(a, b, c, d, x[k + 0], S11, 0xD76AA478);
        d = FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756);
        c = FF(c, d, a, b, x[k + 2], S13, 0x242070DB);
        b = FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
        a = FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF);
        d = FF(d, a, b, c, x[k + 5], S12, 0x4787C62A);
        c = FF(c, d, a, b, x[k + 6], S13, 0xA8304613);
        b = FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
        a = FF(a, b, c, d, x[k + 8], S11, 0x698098D8);
        d = FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF);
        c = FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1);
        b = FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
        a = FF(a, b, c, d, x[k + 12], S11, 0x6B901122);
        d = FF(d, a, b, c, x[k + 13], S12, 0xFD987193);
        c = FF(c, d, a, b, x[k + 14], S13, 0xA679438E);
        b = FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
        a = GG(a, b, c, d, x[k + 1], S21, 0xF61E2562);
        d = GG(d, a, b, c, x[k + 6], S22, 0xC040B340);
        c = GG(c, d, a, b, x[k + 11], S23, 0x265E5A51);
        b = GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
        a = GG(a, b, c, d, x[k + 5], S21, 0xD62F105D);
        d = GG(d, a, b, c, x[k + 10], S22, 0x2441453);
        c = GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681);
        b = GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
        a = GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6);
        d = GG(d, a, b, c, x[k + 14], S22, 0xC33707D6);
        c = GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87);
        b = GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
        a = GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905);
        d = GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8);
        c = GG(c, d, a, b, x[k + 7], S23, 0x676F02D9);
        b = GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
        a = HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942);
        d = HH(d, a, b, c, x[k + 8], S32, 0x8771F681);
        c = HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122);
        b = HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
        a = HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44);
        d = HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9);
        c = HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60);
        b = HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
        a = HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6);
        d = HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA);
        c = HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085);
        b = HH(b, c, d, a, x[k + 6], S34, 0x4881D05);
        a = HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039);
        d = HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5);
        c = HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8);
        b = HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
        a = II(a, b, c, d, x[k + 0], S41, 0xF4292244);
        d = II(d, a, b, c, x[k + 7], S42, 0x432AFF97);
        c = II(c, d, a, b, x[k + 14], S43, 0xAB9423A7);
        b = II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
        a = II(a, b, c, d, x[k + 12], S41, 0x655B59C3);
        d = II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92);
        c = II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D);
        b = II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
        a = II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F);
        d = II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0);
        c = II(c, d, a, b, x[k + 6], S43, 0xA3014314);
        b = II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
        a = II(a, b, c, d, x[k + 4], S41, 0xF7537E82);
        d = II(d, a, b, c, x[k + 11], S42, 0xBD3AF235);
        c = II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB);
        b = II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
        a = AddUnsigned(a, AA);
        b = AddUnsigned(b, BB);
        c = AddUnsigned(c, CC);
        d = AddUnsigned(d, DD);
    }
    var temp = WordToHex(a) + WordToHex(b) + WordToHex(c) + WordToHex(d);
    return temp.toLowerCase();
};


/***/ }),

/***/ 831:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tools_1 = __webpack_require__(160);
var common_1 = __webpack_require__(28);
__webpack_require__(1120);
__webpack_require__(1121);
/**
 * 工具类
 */
var Util = /** @class */ (function () {
    function Util() {
        // pass
    }
    /**
     * 将input file转化成formData对象
     * @param {Element} file - input type=file dom element
     * @returns {Object} fd - FormData对象
     */
    Util.getFileFormData = function (file) {
        var fd = new FormData();
        fd.append(file.files[0].name, file.files[0]);
        return fd;
    };
    /**
     * 发送文件时截取后缀名作为拓展字段
     * @param {string} name - 文件名
     * @returns {string} 后缀名
     */
    Util.getExt = function (name) {
        var index = name.lastIndexOf('.');
        return index === -1 ? '' : name.substring(index + 1);
    };
    /**
     * 将文件后缀名分类
     * @param {string} ext - 后缀名
     * @returns {string} newType - 分类名
     */
    Util.sortByExt = function (ext) {
        if (ext === '') {
            return 'other';
        }
        var audio = ['wav', 'mp3', 'wma', 'midi'];
        var document = ['ppt', 'pptx', 'doc', 'docx', 'pdf', 'xls', 'xlsx', 'txt', 'wps'];
        var video = ['mp4', 'mov', 'rm', 'rmvb', 'wmv', 'avi', '3gp', 'mkv'];
        var image = ['jpg', 'jpeg', 'png', 'bmp', 'gif'];
        var newType = '';
        if (audio.indexOf(ext) !== -1) {
            // 音频
            newType = 'audio';
        }
        else if (document.indexOf(ext) !== -1) {
            // 文档
            newType = 'document';
        }
        else if (video.indexOf(ext) !== -1) {
            // 视频
            newType = 'video';
        }
        else if (image.indexOf(ext) !== -1) {
            // 图片
            newType = 'image';
        }
        else {
            // 其他
            newType = 'other';
        }
        return newType;
    };
    /**
     * doubleNumber 将数字格式化成两位数，如9转化成09，15还是转化成15
     * @param {number} num - 一位或者两位整数
     * @returns {string} 两位数的字符串
     */
    Util.doubleNumber = function (num) {
        return num < 10 ? '0' + num : num.toString();
    };
    /**
     * fileReader预览图片返回img url
     * @param {Element} file - input type=file dom element
     * @param {Function} callback - 回调函数
     * @param {Function} callback2 - 回调函数
     */
    Util.imgReader = function (file, callback, callback2) {
        var files = file.files[0];
        if (!files) {
            return false;
        }
        if (!files.type || files.type === '' || !/image\/\w+/.test(files.type)) {
            callback();
            return false;
        }
        var reader = new FileReader();
        reader.readAsDataURL(files);
        var img = new Image();
        var promise = new Promise(function (resolve, reject) {
            reader.onload = function (e) {
                img.src = this.result;
                var that = this;
                img.onload = function () {
                    var width = img.naturalWidth;
                    var height = img.naturalHeight;
                    resolve({
                        src: that.result,
                        width: width,
                        height: height
                    });
                };
            };
        }).catch((function () {
            console.log('Promise Rejected');
        }));
        promise.then((function (value) {
            callback2(value);
        }), (function (error) {
            // pass
        })).catch((function () {
            console.log('Promise Rejected');
        }));
    };
    /**
     * 获取头像裁剪的预览对象
     * @param {Object} file - input type=file dom element的files[0]
     * @param {Function} callback1 - 回调函数1
     * @param {Function} callback2 - 回调函数2
     * @param {Function} callback3 - 回调函数3
     */
    Util.getAvatarImgObj = function (file, callback1, callback2, callback3) {
        if (!file) {
            return false;
        }
        if (!file.type || file.type === '' || !/image\/\w+/.test(file.type)) {
            callback1();
            return false;
        }
        var that = this;
        var img = new Image();
        var pasteFile = file;
        var reader = new FileReader();
        reader.readAsDataURL(pasteFile);
        var fd = new FormData();
        fd.append(file.name, file);
        reader.onload = function (e) {
            img.src = this.result;
            var _this = this;
            img.onload = function () {
                // 如果选择的图片尺寸小于80*80，弹窗提示
                if (img.naturalWidth < 80 || img.naturalHeight < 80) {
                    callback2();
                    return;
                }
                callback3(_this, pasteFile, img);
            };
        };
    };
    /**
     * fileReader预览图片url
     * @param {Element} file - input type=file dom element
     * @param {Function} callback - 回调函数
     */
    Util.fileReader = function (file, callback) {
        var files = file.files[0];
        if (!files.type || files.type === '') {
            return false;
        }
        if (!/image\/\w+/.test(files.type)) {
            callback();
            return false;
        }
        var reader = new FileReader();
        reader.readAsDataURL(files);
        return new Promise(function (resolve, reject) {
            reader.onload = function (e) {
                resolve(this.result);
            };
        }).catch((function () {
            console.log('Promise Rejected');
        }));
    };
    /**
     * contenteditable输入框插入内容（表情、粘贴文本等）
     * @param {Element} field - dom element
     * @param {string} value - 需要插入的内容
     * @param {boolean} selectPastedContent - 选中内容还是开始点和结束点一致
     */
    Util.insertAtCursor = function (field, value, selectPastedContent) {
        var sel;
        var range;
        field.focus();
        if (window.getSelection) {
            sel = window.getSelection();
            if (sel.getRangeAt && sel.rangeCount) {
                range = sel.getRangeAt(0);
                range.deleteContents();
                var el = document.createElement('div');
                el.innerHTML = value;
                var frag = document.createDocumentFragment();
                var node = void 0;
                var lastNode = void 0;
                while ((node = el.firstChild)) {
                    lastNode = frag.appendChild(node);
                }
                var firstNode = frag.firstChild;
                range.insertNode(frag);
                if (lastNode) {
                    range = range.cloneRange();
                    range.setStartAfter(lastNode);
                    if (selectPastedContent) {
                        range.setStartBefore(firstNode);
                    }
                    else {
                        range.collapse(true);
                    }
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }
        }
    };
    /**
     * contenteditable输入框光标聚焦到最后
     * @param {Element} element - dom element
     */
    Util.focusLast = function (element) {
        if (window.getSelection) {
            var range = window.getSelection();
            range.selectAllChildren(element);
            range.collapse(element, element.childNodes.length);
        }
    };
    /**
     * 判断字符串首字母是否是中文
     * @param {string} str - 需要操作的字符串
     * @returns {boolean}
     */
    Util.firstLetterIsChinese = function (str) {
        var re = /^[\\u4e00-\\u9fa5]/;
        return re.test(str) ? false : true;
    };
    /**
     * 将数组中的字符串按照首字母及中文拼音首字母排序
     * @param {Array} payload - 需要排序的数组
     * @returns {Array} result - 排好序的数组
     */
    Util.sortByLetter = function (payload) {
        var letter = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L',
            'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '#'];
        var result = [];
        for (var _i = 0, letter_1 = letter; _i < letter_1.length; _i++) {
            var item = letter_1[_i];
            result.push({
                letter: item,
                data: []
            });
        }
        for (var _a = 0, payload_1 = payload; _a < payload_1.length; _a++) {
            var item = payload_1[_a];
            var flag = false;
            for (var _b = 0, result_1 = result; _b < result_1.length; _b++) {
                var re = result_1[_b];
                var name_1 = void 0;
                if (item.memo_name && item.memo_name !== '') {
                    name_1 = item.memo_name;
                }
                else if (item.nickName && item.nickName !== '') {
                    name_1 = item.nickName;
                }
                else {
                    name_1 = item.name;
                }
                if (!name_1 || name_1.length === 0) {
                    break;
                }
                var firstLetter = name_1.charAt(0);
                if (name_1.match(/^[a-zA-Z]/)) {
                    if (firstLetter.toUpperCase() === re.letter) {
                        re.data.push(item);
                        flag = true;
                        break;
                    }
                }
                else if (this.firstLetterIsChinese(name_1)) {
                    var py = pinyinUtil.getFirstLetter(name_1, false)[0];
                    if (py && py.toUpperCase() === re.letter) {
                        re.data.push(item);
                        flag = true;
                        break;
                    }
                }
            }
            if (!flag) {
                result[result.length - 1].data.push(item);
            }
        }
        return result;
    };
    /**
     * 将元素插入按首字母排序的数组中
     * @param {Array} arr - 之前排好序的数组
     * @param {Object} payload - 需要插入的对象
     * @returns {Array} arr - 插入元素之后的数组
     */
    Util.insertSortByLetter = function (arr, payload) {
        var name = (payload.nickName && payload.nickName !== '') ? payload.nickName : payload.name;
        var firstLetter = this.getFirstLetter(name);
        for (var _i = 0, arr_1 = arr; _i < arr_1.length; _i++) {
            var item = arr_1[_i];
            if (item.letter === firstLetter) {
                var result = item.data.filter((function (friend) {
                    return friend.name === payload.name;
                }));
                if (result.length === 0) {
                    item.data.push(payload);
                }
                break;
            }
        }
        return arr;
    };
    /**
     * 获取首字母
     * @param {string} name - 要获取首字母的字符串
     * @returns {string} firstLetter - 首字母
     */
    Util.getFirstLetter = function (name) {
        var firstLetter = name.charAt(0);
        if (name.match(/^[a-zA-Z]/)) {
            firstLetter = firstLetter.toUpperCase();
        }
        else if (this.firstLetterIsChinese(name)) {
            var py = pinyinUtil.getFirstLetter(firstLetter, false)[0];
            if (py) {
                firstLetter = py.toUpperCase();
            }
            else {
                firstLetter = '#';
            }
        }
        else {
            firstLetter = '#';
        }
        return firstLetter;
    };
    /**
     * 获取成员备注名、昵称、用户名首字母
     * @param {Array} arr - 成员列表
     */
    Util.getMembersFirstLetter = function (arr) {
        for (var _i = 0, arr_2 = arr; _i < arr_2.length; _i++) {
            var item = arr_2[_i];
            if (item.nickName && item.nickName !== '') {
                item.nickNameFirstLetter = this.getFirstLetter(item.nickName);
            }
            if (item.username && item.username !== '') {
                item.usernameFirstLetter = this.getFirstLetter(item.username);
            }
            if (item.memo_name && item.memo_name !== '') {
                item.memo_nameFirstLetter = this.getFirstLetter(item.memo_name);
            }
        }
    };
    /**
     * 获取备注名首字母
     * @param {Object} member - 用户对象
     */
    Util.getMemo_nameFirstLetter = function (member) {
        if (member.memo_name && member.memo_name !== '') {
            member.memo_nameFirstLetter = this.getFirstLetter(member.memo_name);
        }
    };
    /**
     * 将接收到的地理定位坐标转化为地图
     * @param {Object} obj - 坐标对象
     */
    Util.theLocation = function (obj) {
        var point = new BMap.Point(obj.longitude, obj.latitude);
        var map = new BMap.Map(obj.id);
        // 默认缩放比例是13
        var scale = 13;
        if (obj.scale && !Number.isNaN(Number(obj.scale))) {
            // 百度地图的缩放比例为1到19的整数
            if (scale >= 1 && scale < 20) {
                scale = Math.floor(Number(obj.scale));
            }
        }
        map.centerAndZoom(point, scale);
        map.disableDragging();
        if (obj.scroll) {
            map.enableScrollWheelZoom(true);
            map.enableDragging();
        }
        var marker = new BMap.Marker(point);
        map.addOverlay(marker);
        map.panTo(point);
    };
    /**
     * 将时间转化成需要的格式
     * @param {number} msgTime - 需要转换的时间毫秒数
     * @returns {string} showTime - 时间的标识，根据标识可以再页面应用不同的date管道
     * 当天 --- today
     * 昨天和前天 --- yesterday或the day before
     * 近7天（排除今天，昨天，前天） --- day
     * 今年其他时间 --- month
     * 今年之前的时间 --- year
     */
    Util.reducerDate = function (msgTime) {
        var time = new Date(msgTime);
        var now = new Date();
        var msgYear = time.getFullYear();
        var nowYear = now.getFullYear();
        var nowHour = now.getHours();
        var nowMinute = now.getMinutes();
        var nowSecond = now.getSeconds();
        var nowTime = now.getTime();
        var todayTime = nowHour * 60 * 1000 * 60 + nowMinute * 1000 * 60 + nowSecond * 1000;
        var gapDate = (nowTime - todayTime - msgTime) / 1000 / 60 / 60 / 24;
        var showTime = '';
        if (msgYear !== nowYear) {
            showTime = 'year';
        }
        else if (gapDate > 6) {
            showTime = 'month';
        }
        else if (gapDate <= 6 && gapDate > 2) {
            showTime = 'day';
        }
        else if (gapDate <= 2 && gapDate > 1) {
            showTime = 'the day before';
        }
        else if (gapDate <= 1 && gapDate > 0) {
            showTime = 'yesterday';
        }
        else if (gapDate <= 0) {
            showTime = 'today';
        }
        return showTime;
    };
    /**
     * 判断两个时间间隔是否超过5分钟
     * @param {number} oldTime
     * @param {number} newTime
     * @returns {boolean}
     */
    Util.fiveMinutes = function (oldTime, newTime) {
        var gap = newTime - oldTime;
        return gap / 1000 / 60 > 5 ? true : false;
    };
    /**
     * 获取当前光标的在页面中的位置
     * @param {Element} input - input dom element
     * @returns {Object} offset - 光标的位置
     */
    Util.getOffset = function (input) {
        var sel = window.getSelection();
        var range = sel.getRangeAt(0);
        var offset;
        if (!this.isSafari()) {
            offset = range.getBoundingClientRect();
        }
        else {
            var clonedRange = void 0;
            var rect = void 0;
            var shadowCaret = void 0;
            clonedRange = range.cloneRange();
            clonedRange.setStart(range.endContainer, range.endOffset - 1);
            clonedRange.setEnd(range.endContainer, range.endOffset);
            rect = clonedRange.getBoundingClientRect();
            offset = {
                height: rect.height,
                left: rect.left + rect.width,
                top: rect.top
            };
            clonedRange.detach();
            if (input.innerHTML === '@') {
                clonedRange = range.cloneRange();
                shadowCaret = document.createTextNode('|');
                clonedRange.insertNode(shadowCaret);
                clonedRange.selectNode(shadowCaret);
                rect = clonedRange.getBoundingClientRect();
                offset = {
                    height: rect.height,
                    left: rect.left,
                    top: rect.top
                };
                input.innerHTML = '@';
                this.focusLast(input);
                clonedRange.detach();
            }
        }
        return offset;
    };
    /**
     * 深度拷贝对象（只能深度拷贝没有方法属性的对象）
     * @param {Object} obj - 需要拷贝的对象
     * @returns {Object} result - 新的对象
     */
    Util.deepCopyObj = function (obj) {
        return JSON.parse(JSON.stringify(obj));
    };
    
    /**
     * 生成JIM初始化的签名
     * @param {number} timestamp - 当前的时间毫秒数
     * @returns {string} 签名
     */
    Util.createSignature = function (timestamp) {
        return tools_1.md5("appkey=" + common_1.authPayload.appkey + "&timestamp=" + timestamp + "&random_str=" + common_1.authPayload.randomStr + "&key=" + common_1.authPayload.masterSecret);
    };
    /**
     * 处理头像的大小
     * @param {Event} event 头像dom的事件对象
     */
    Util.reduceAvatarSize = function (event) {
        if (event.target.naturalHeight >= event.target.naturalWidth) {
            event.target.style.width = '100%';
            event.target.style.height = 'auto';
        }
        else {
            event.target.style.height = '100%';
            event.target.style.width = 'auto';
        }
    };
    /**
     * 判断是否是safari浏览器
     * @returns {boolean}
     */
    Util.isSafari = function () {
        var userAgent = navigator.userAgent;
        return userAgent.indexOf('Safari') > -1 && userAgent.indexOf('Chrome') === -1;
    };
    return Util;
}());
exports.Util = Util;


/***/ }),

/***/ 832:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var hmr_1 = __webpack_require__(607);
var HMR = /** @class */ (function () {
    function HMR(appRef) {
        this.appRef = appRef;
    }
    HMR.prototype.hmrOnInit = function (store) {
        if (!store) {
            return;
        }
    };
    HMR.prototype.hmrOnDestroy = function (store) {
        var cmpLocation = this.appRef.components.map((function (cmp) { return cmp.location.nativeElement; }));
        // recreate elements
        store.disposeOldHosts = hmr_1.createNewHosts(cmpLocation);
        // remove styles
        hmr_1.removeNgStyles();
    };
    HMR.prototype.hmrAfterDestroy = function (store) {
        // display new elements
        store.disposeOldHosts();
        delete store.disposeOldHosts;
        // anything you need done the component is removed
    };
    return HMR;
}());
exports.HMR = HMR;


/***/ }),

/***/ 835:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var platform_browser_dynamic_1 = __webpack_require__(221);
var core_1 = __webpack_require__(1);
var app_module_1 = __webpack_require__(489);
var global_1 = __webpack_require__(158);
core_1.enableProdMode();
platform_browser_dynamic_1.platformBrowserDynamic().bootstrapModule(app_module_1.AppModule)
    .then((function (componentRef) {
    global_1.global.injector = componentRef.injector;
}));


/***/ }),

/***/ 90:
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = __webpack_require__(4);
tslib_1.__exportStar(__webpack_require__(805), exports);


/***/ })

},[835]);