<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>EAV前端Demo</title>
    <style>
        .eav-table {
            border: 1px solid #ddd;
            border-spacing: 0;
            margin-top: 5px;
        }

        .eav-table th, .eav-table td {
            border: 1px solid #ddd;
            padding: 5px;
        }
    </style>
</head>
<body>
<div>
    <h3>1.获取所有方案</h3>
    <div><code>json:/eav/getEavSchemas.html</code></div>
    <button type="button" onclick="$.acooly.eav.loadSchemes()">加载所有方案</button>
    <div id="loadSchemes"></div>
</div>

<div>
    <h3>2.加载方案元数据</h3>
    <div><code><a href="/eav/getEavScheme.html?id=1" target="_blank">/eav/getEavScheme.html?id=1</a></code></div>
    <button type="button" onclick="$.acooly.eav.loadScheme({schemeId:1})">方案元数据</button>
    <div id="schemeMetadata"></div>
</div>

<div>
    <h3>3.实体单个查询</h3>
    <div><code><a href="/eav/getEavEntity.html?id=4" target="_blank">/eav/getEavScheme.html?id=4</a></code></div>
    <button type="button" onclick="$.acooly.eav.loadEntityInfo(4)">查询单个实体（全属性）</button>
    <div id="entity_info"></div>
</div>

<div>
    <h3>4.实体列表查询</h3>
    <div><code><a href="/eav/getEavEntity.html?id=4" target="_blank">/eav/getEavScheme.html?id=4</a></code></div>
    <button type="button" onclick="$.acooly.eav.loadEntityInfo(4)">查询单个实体（全属性）</button>
    <div id="entity_info"></div>
</div>

<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/manage/assert/plugin/template/baiduTemplate.js"></script>
<!--<script src="http://wangxiao.github.com/BaiduTemplate/debug/js/baiduTemplate.js"></script>-->
<!--<script src="/manage/assert/script/acooly.template.js"></script>-->
<!-- shemes列表模板 -->
<script id="loadSchemes_template" type="text/html">
    <table class="eav-table">
        <tr>
            <th>Id(schemeId)</th>
            <th>表名(name)</th>
            <th>方案名(title)</th>
            <th>编辑框宽高(panelWidth,panelHeight)</th>
            <th>权限(permission)</th>
        </tr>
        <%for(var i=0;i
        <data.length
                ; i++){ var e=data[i];%>
            <tr>
                <td><%=e.id%></td>
                <td><%=e.name%></td>
                <td><%=e.title%></td>
                <td>(<%=e.panelWidth%>,<%=e.panelHeight%>)</td>
                <th><%=e.permission%></th>
            </tr>
            <%}%>
    </table>
</script>
<!-- sheme的字段属性列表模板 -->
<script id="schemeMetadata_template" type="text/html">
    <table class="eav-table">
        <tr>
            <th>Id</th>
            <th>字段名(name)</th>
            <th>中文名(title)</th>
            <th>分组标签</th>
            <th>是否为空</th>
            <th>数字最小值</th>
            <th>数字最大值</th>
            <th>最小长度</th>
            <th>最大长度</th>
            <th>正则</th>
            <th>正则消息</th>
            <th>显示权限</th>
            <th>显示格式</th>
            <th>选项值</th>
        </tr>
        <%
        var attrs = entity.attributes;
        for (var key in attrs) {
        var e = attrs[key];
        %>
            <tr>
                <td><%=e.id%></td>
                <td><%=e.name%></td>
                <td><%=e.displayName%></td>
                <td><%=e.tag%></td>
                <td><%=e.nullable%></td>
                <td><%=e.minimum%></td>
                <td><%=e.maximum%></td>
                <td><%=e.minLength%></td>
                <td><%=e.maxLength%></td>
                <td><%=e.regex%></td>
                <td><%=e.regexMessage%></td>
                <td><%=e.showType%></td>
                <td><%=e.showFormat%></td>
                <td><%=JSON.stringify(e.options,["code","name"])%></td>
            </tr>
        <%}%>

    </table>
</script>
<!-- 实体全属性展示模板 -->
<script id="entity_full_info_template" type="text/html">
    <table class="eav-table" >
        <tr>
            <th width="20%">方案:</th>
            <td colspan="2"><%=data.schemeId%>/<%=data.schemeName%>/<%=data.schemeTitle%></td>
        </tr>
        <tr>
            <th>ID</th>
            <td><%=data.id%></td>
            <td></td>
        </tr>
        <%
        var prevTag=null;
        for(var i=0;i<data.eavAttributeInfos.length;i++){
            var e=data.eavAttributeInfos[i];
        %>
        <% if(prevTag != e.tag && e.tag != ''){%>
        <tr><td colspan="3"><div style="padding: 5px;">
            <i class="fa fa-tag" aria-hidden="true"></i> <%=e.tag%>
        </div></td></tr>
        <%}%>
        <tr>
            <th><%=e.displayName%></th>
            <td><%=e.value%></td>
            <td><%=e.formatValue%></td>
        </tr>
        <%
        var prevTag=e.tag;
        }
        %>
        <tr>
            <th>创建时间</th>
            <td><%=data.createTime%></td>
            <td></td>
        </tr>
        <tr>
            <th>最后修改时间</th>
            <td><%=data.updateTime%></td>
            <td></td>
        </tr>
    </table>
</script>

<script>

    var classEav = {

        loadSchemes: function () {
            $.ajax({
                url: '/eav/getEavSchemas.html',
                success: function (result) {
                    $('#loadSchemes').html(baidu.template("loadSchemes_template", result));
                }
            });
        },

        loadScheme: function (opts) {
            var options = $.extend({
                schemeId: null,
                onSuccess: null,
            }, opts);
            var That = this;
            $.ajax({
                url: '/eav/getEavScheme.html?id=' + options.schemeId,
                success: function (result) {
                    if (options.onSuccess) {
                        options.onSuccess.call(this,result);
                    } else {
                        //显示元数据
                        That.renderSchemeMetadata(result);
                    }
                }
            });
        },

        loadEntityInfo:function(entityId){
            $.ajax({
                url: '/eav/getEavEntity.html?id=' + entityId,
                success: function (result) {
                    $('#entity_info').html(baidu.template("entity_full_info_template",result));
                }
            });
        },

        renderSchemeMetadata: function(result){
            $('#schemeMetadata').html(baidu.template("schemeMetadata_template", result));
        }

    };

    $(function () {

        if (!$.acooly) {
            $.acooly = {};
        }

        $.extend($.acooly, {
            eav: classEav
        })

    });


</script>
</body>
</html>